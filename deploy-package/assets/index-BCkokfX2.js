var Vt=Object.defineProperty;var Wt=(a,t,s)=>t in a?Vt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var re=(a,t,s)=>Wt(a,typeof t!="symbol"?t+"":t,s);import{r as f,j as e,B as Gt,P as be,A as Yt,U as Kt,a as ke,T as Jt,L as Qt,C as ve,b as De,c as rt,d as Le,S as Xt,e as He,f as de,g as Re,h as Te,E as nt,H as At,i as st,k as Zt,l as es,m as ts,X as fe,n as St,o as ye,p as Et,R as Ve,q as Pt,s as ss,M as Ft,t as kt,u as at,F as rs,v as me,w as xt,x as Dt,y as We,z as ns,D as Ge,G as Je,W as as,I as os,J as Ye,K as pt,N as Q,O as B,Q as is,V as ls,_ as cs,Y as Lt,Z as Rt,$ as ht,a0 as gt,a1 as mt,a2 as ds,a3 as ms,a4 as us,a5 as xs,a6 as Ie,a7 as ps,a8 as hs,a9 as bt,aa as It,ab as gs,ac as bs,ad as fs,ae as Ot,af as vs,ag as ys,ah as Z,ai as ot,aj as js,ak as Ns,al as Cs}from"./vendor-OEzT2cvG.js";import{S as Ts}from"./ui-utils-Bfb2iWCB.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const ws=({onShowClients:a,onShowInvoices:t,onShowProducts:s,onShowGoogleDrive:r,onShowDebug:n,onGoToIpad:o,invoiceNumber:i,clientName:l,canSendToDrive:m=!1})=>{const[d,h]=f.useState(!1),[c,x]=f.useState("idle"),g=async()=>{if(m){h(!0),x("idle");try{await r(),x("success"),setTimeout(()=>x("idle"),3e3)}catch{x("error"),setTimeout(()=>x("idle"),3e3)}finally{h(!1)}}},N=()=>m?c==="success"?"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white":c==="error"?"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white":"bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white":"bg-gray-400 cursor-not-allowed px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md text-white opacity-60",p=()=>d?e.jsx(Qt,{size:18,className:"animate-spin"}):c==="success"?e.jsx(ve,{size:18}):c==="error"?e.jsx(De,{size:18}):e.jsx(rt,{size:18}),u=()=>d?"Envoi...":c==="success"?"✅ Envoyé":c==="error"?"❌ Erreur":"📤 Drive",v=()=>{if(!m)return"Complétez les champs obligatoires pour envoyer vers Google Drive";if(d)return"Envoi en cours vers Google Drive...";if(c==="success")return"PDF envoyé avec succès vers Google Drive";if(c==="error")return"Erreur lors de l'envoi vers Google Drive";const y=[];return i&&y.push(`Facture: ${i}`),l&&y.push(`Client: ${l}`),`Envoyer la facture vers Google Drive${y.length>0?` (${y.join(", ")})`:""}`};return e.jsx("header",{className:"bg-gradient-to-r from-[#477A0C] to-[#5A8F0F] shadow-xl sticky top-0 z-40",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(Gt,{className:"w-6 h-6 text-[#F2EFE2]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold tracking-tight text-[#F2EFE2]",children:"MYCONFORT"}),e.jsx("p",{className:"text-[#F2EFE2]/80 text-sm font-medium",children:"Facturation professionnelle avec signature électronique"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[e.jsxs("button",{onClick:s,className:"bg-[#F2EFE2] hover:bg-white px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-black",title:"Gérer les produits",children:[e.jsx(be,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Produits"})]}),e.jsxs("button",{onClick:t,className:"bg-[#14281D] hover:bg-[#0F1F15] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-[#F2EFE2]",title:"Voir toutes les factures",children:[e.jsx(Yt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Factures"})]}),e.jsxs("button",{onClick:a,className:"bg-[#D68FD6] hover:bg-[#C67FC6] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-[#14281D]",title:"Gérer les clients",children:[e.jsx(Kt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Clients"})]}),n&&e.jsxs("button",{onClick:n,className:"bg-[#F59E0B] hover:bg-[#D97706] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-[#14281D]",title:"Centre de débogage N8N",children:[e.jsx(ke,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Debug"})]}),o&&e.jsxs("button",{onClick:o,className:"bg-[#3B82F6] hover:bg-[#2563EB] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white",title:"Mode iPad tactile optimisé",children:[e.jsx(Jt,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Mode iPad"})]}),e.jsxs("button",{onClick:g,disabled:!m||d,className:N(),title:v(),children:[p(),e.jsx("span",{className:"hidden md:inline",children:u()})]})]})]})})},As=({invoice:a,onUpdate:t})=>e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 border border-gray-100 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsx("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"INFORMATIONS FACTURE"})}),e.jsx("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-black mb-2",children:e.jsx("strong",{children:"MYCONFORT"})}),e.jsx("p",{className:"text-black font-semibold",children:e.jsx("strong",{children:"88 Avenue des Ternes"})}),e.jsx("p",{className:"text-black font-semibold",children:"75017 Paris, France"}),e.jsx("p",{className:"text-black font-semibold",children:"SIRET: 824 313 530 00027"}),e.jsx("p",{className:"text-black font-semibold",children:"Tél: 04 68 50 41 45"}),e.jsx("p",{className:"text-black font-semibold",children:"Email: myconfort@gmail.com"}),e.jsx("p",{className:"text-black font-semibold",children:"Site web: https://www.htconfort.com"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-black",children:"Facture n°:"}),e.jsx("input",{value:a.invoiceNumber,type:"text",className:"border-2 border-[#477A0C] rounded-lg px-4 py-2 w-32 text-right font-mono text-black bg-white focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all font-bold",readOnly:!0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-bold text-black",children:["Date: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.invoiceDate,onChange:s=>t({invoiceDate:s.target.value}),type:"date",required:!0,className:`border-2 rounded-lg px-4 py-2 text-black bg-white focus:ring-2 focus:ring-[#89BBFE] transition-all font-bold ${!a.invoiceDate||a.invoiceDate.trim()===""?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`})]}),(!a.invoiceDate||a.invoiceDate.trim()==="")&&e.jsx("p",{className:"text-red-600 text-xs font-semibold",children:"⚠️ La date de la facture est obligatoire"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-bold mb-1 text-black",children:["Lieu de l'événement: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.eventLocation,onChange:s=>t({eventLocation:s.target.value}),type:"text",required:!0,className:`w-full border-2 rounded-lg px-4 py-2 text-black bg-white focus:ring-2 focus:ring-[#89BBFE] transition-all font-bold ${!a.eventLocation||a.eventLocation.trim()===""?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`,placeholder:"Lieu obligatoire (ex: Salon de l'habitat Paris)"}),(!a.eventLocation||a.eventLocation.trim()==="")&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Le lieu de l'événement est obligatoire"})]})]})]})})]}),Ss=({client:a,onUpdate:t})=>{const s=(o,i)=>{t({...a,[o]:i})},r=o=>!o||o.trim()==="",n=o=>`w-full border-2 rounded-lg px-4 py-3 focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-semibold ${r(o)?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`;return e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsxs("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:[e.jsx(Le,{className:"mr-3 text-xl"}),e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-4 py-2 rounded-full font-bold",children:"INFORMATIONS CLIENT"})]}),e.jsxs("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Nom complet ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.name,onChange:o=>s("name",o.target.value),type:"text",required:!0,className:n(a.name),placeholder:"Nom complet obligatoire"}),r(a.name)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Le nom complet est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Adresse ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.address,onChange:o=>s("address",o.target.value),type:"text",required:!0,className:n(a.address),placeholder:"Adresse obligatoire"}),r(a.address)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ L'adresse est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Code postal ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.postalCode,onChange:o=>s("postalCode",o.target.value),type:"text",required:!0,className:n(a.postalCode),placeholder:"Code postal obligatoire"}),r(a.postalCode)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Le code postal est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Ville ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.city,onChange:o=>s("city",o.target.value),type:"text",required:!0,className:n(a.city),placeholder:"Ville obligatoire"}),r(a.city)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ La ville est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Type de logement ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:a.housingType||"",onChange:o=>s("housingType",o.target.value),required:!0,className:n(a.housingType),children:[e.jsx("option",{value:"",children:"Sélectionner obligatoirement"}),e.jsx("option",{value:"Maison",children:"Maison"}),e.jsx("option",{value:"Appartement",children:"Appartement"})]}),r(a.housingType)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Le type de logement est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Code porte / étage ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.doorCode||"",onChange:o=>s("doorCode",o.target.value),type:"text",required:!0,className:n(a.doorCode),placeholder:"Code porte/étage obligatoire"}),r(a.doorCode)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Le code porte/étage est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Téléphone ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.phone,onChange:o=>s("phone",o.target.value),type:"tel",required:!0,className:n(a.phone),placeholder:"Téléphone obligatoire"}),r(a.phone)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Le téléphone est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Email ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.email,onChange:o=>s("email",o.target.value),type:"email",required:!0,className:n(a.email),placeholder:"Email obligatoire"}),r(a.email)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ L'email est obligatoire"}),a.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ Format d'email invalide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"SIRET (si applicable)"}),e.jsx("input",{value:a.siret||"",onChange:o=>s("siret",o.target.value),type:"text",className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-semibold",placeholder:"SIRET (optionnel)"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-800 text-sm font-semibold",children:["⚠️ ",e.jsx("span",{className:"text-red-600",children:"*"})," Tous les champs marqués d'un astérisque rouge sont obligatoires pour pouvoir éditer la facture."]})})]})]})},Se=[{category:"Matelas",name:"MATELAS BAMBOU 70 x 190",priceTTC:900,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 80 x 200",priceTTC:1050,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 90 x 190",priceTTC:1110,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 90 x 200",priceTTC:1150,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 120 x 190",priceTTC:1600,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 140 x 190",priceTTC:1800,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 140 x 200",priceTTC:1880,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 160 x 200",priceTTC:2100,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 180 x 200",priceTTC:2200,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 200 x 200",priceTTC:2300,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 70 x 190",priceTTC:220,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 80 x 200",priceTTC:280,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 90 x 190",priceTTC:310,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 90 x 200",priceTTC:320,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 120 x 190",priceTTC:420,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 140 x 190",priceTTC:440,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 160 x 200",priceTTC:490,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 180 x 200",priceTTC:590,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 200 x 200",priceTTC:630,autoCalculateHT:!0},{category:"Couettes",name:"Couette 220x240",priceTTC:300,autoCalculateHT:!0},{category:"Couettes",name:"Couette 240 x 260",priceTTC:350,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Douceur",priceTTC:80,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Thalasso",priceTTC:60,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Dual",priceTTC:60,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Panama",priceTTC:70,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Papillon",priceTTC:80,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Flocon",priceTTC:50,autoCalculateHT:!0},{category:"Oreillers",name:"Pack de 2 oreillers (thal et dual)",priceTTC:100,autoCalculateHT:!0},{category:"Oreillers",name:"Pack 2 Dual",priceTTC:100,autoCalculateHT:!0},{category:"Oreillers",name:"Pack 2 Thalasso",priceTTC:100,autoCalculateHT:!0},{category:"Oreillers",name:"Pack oreiller 2 douceur",priceTTC:150,autoCalculateHT:!0},{category:"Oreillers",name:"Pack deux oreillers papillon",priceTTC:150,autoCalculateHT:!0},{category:"Oreillers",name:"Pack de deux oreillers Panama",priceTTC:130,autoCalculateHT:!0},{category:"Oreillers",name:"Pack deux oreillers flocons",priceTTC:90,autoCalculateHT:!0},{category:"Oreillers",name:"Traversin 140",priceTTC:140,autoCalculateHT:!0},{category:"Oreillers",name:"Traversin 160",priceTTC:160,autoCalculateHT:!0},{category:"Oreillers",name:"Pack divers",price:0,priceTTC:0,autoCalculateHT:!1},{category:"Plateau",name:"PLATEAU PRESTIGE 70 x 190",priceTTC:70,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 80 x 200",priceTTC:80,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 90 x 190",priceTTC:100,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 90 x 200",priceTTC:110,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 120 x 190",priceTTC:160,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 140 x 190",priceTTC:180,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 140 x 200",priceTTC:190,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 160 x 200",priceTTC:210,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 180 x 200",priceTTC:220,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 200 x 200",priceTTC:230,autoCalculateHT:!0},{category:"Accessoires",name:"Le régule jambes",priceTTC:70,autoCalculateHT:!0},{category:"Accessoires",name:"Protège-matelas",price:0,priceTTC:0,autoCalculateHT:!1},{category:"Accessoires",name:"Housse de couette",price:0,priceTTC:0,autoCalculateHT:!1},{category:"Accessoires",name:"Taie d'oreiller",price:0,priceTTC:0,autoCalculateHT:!1}],Ee=["Matelas","Sur-matelas","Couettes","Oreillers","Plateau","Accessoires"],k=a=>typeof a!="number"||isNaN(a)?"0,00 €":Number(a).toLocaleString("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}),te=(a,t)=>a/(1+t/100),q=(a,t,s,r)=>{let n=t*a;return s>0&&(r==="percent"?n-=n*(s/100):n-=s*a),Math.max(0,n)};let ft=0,vt=null;function it(a,t){const s=new Date().getFullYear(),r=Date.now(),n=()=>{ft=Date.now();const o=localStorage.getItem("lastInvoiceNumber")||`${s}-000`;try{const i=parseInt(o.split("-")[1])||0,l=`${s}-${String(i+1).padStart(3,"0")}`;return localStorage.setItem("lastInvoiceNumber",l),console.log(`🔢 Génération facture [${a||"direct"}]: ${o} → ${l}`),t==null||t(l),l}catch(i){return console.error("Erreur lors de la génération du numéro de facture:",i),yt()}};return r-ft<800?(console.log("⚠️ Génération retardée - anti-spam actif"),clearTimeout(vt),vt=setTimeout(()=>n(),850),yt()):n()}const yt=()=>{const t=new Date().getFullYear(),s=localStorage.getItem("lastInvoiceNumber")||`${t}-000`;try{const r=parseInt(s.split("-")[1])||0;return`${t}-${String(r+1).padStart(3,"0")}`}catch{return`${t}-001`}};function we(a,t){if(t<=0||a<=0)return{acompte:0,montantCheque:0,nbCheques:0,totalTTC:a,economieTemps:"❌ Configuration invalide"};const s=Math.floor(a/t);let r=a-s*t;const n=Math.ceil(a*.15);if(r<n){r=n;const i=a-r,l=Math.floor(i/t),m=i-l*t;m>0&&(r=r+m);const d=`✨ ${t} chèques de ${l}€ pile + acompte 15% minimum (${Math.round(r/a*100)}%)`;return{acompte:Math.round(r*100)/100,montantCheque:l,nbCheques:t,totalTTC:a,economieTemps:d}}const o=r>0?`✨ ${t} chèques de ${s}€ pile (gain de temps énorme !)`:`🎯 Déjà optimal ! ${t} chèques de ${s}€ exactement`;return{acompte:Math.round(r*100)/100,montantCheque:s,nbCheques:t,totalTTC:a,economieTemps:o}}function Es(a){if(a.nbCheques<=0)return"";const{acompte:t,montantCheque:s,nbCheques:r,totalTTC:n}=a;return t===0?`🎯 Parfait ! ${r} chèques de ${s}€ exactement = ${n}€`:`💡 Suggestion optimale : Acompte de ${t}€ + ${r} chèques de ${s}€ chacun = ${n}€ total`}function Ps(a,t){if(!t||a<=0)return"";const s=a*8,r=Math.round(s/60*10)/10;return r<1?`⏱️ Gain estimé : ${s}s d'écriture économisées`:`⏱️ Gain estimé : ~${r} min d'écriture économisées (${a} chèques sans centimes)`}function Fs(a,t){return t<=0?!1:a/t%1!==0}we(1840,9),we(1500,10),we(2157.89,8),we(1737,10);const ks=({product:a,productIndex:t,onStatusChange:s,disabled:r=!1})=>{const n=[{value:"pending",label:"⏳ En attente",color:"#FF9800",bgColor:"#FFF3E0"},{value:"delivered",label:"✅ Emporté",color:"#4CAF50",bgColor:"#E8F5E8"},{value:"to_deliver",label:"📦 À livrer",color:"#2196F3",bgColor:"#E3F2FD"},{value:"cancelled",label:"❌ Annulé",color:"#f44336",bgColor:"#FFEBEE"}],o=n.find(i=>i.value===a.statut_livraison)||n[0];return e.jsxs("div",{className:"delivery-status-selector",children:[e.jsx("label",{htmlFor:`status-${t}`,className:"status-label",children:"Statut de livraison :"}),e.jsx("select",{id:`status-${t}`,value:a.statut_livraison,onChange:i=>s(t,i.target.value),disabled:r,className:"status-select",style:{backgroundColor:o.bgColor,color:o.color,borderColor:o.color},children:n.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))}),e.jsx("div",{className:"status-indicator",style:{color:o.color},children:o.label})]})},ze=({status:a,size:t="medium"})=>{const r={pending:{icon:"⏳",label:"En attente",color:"#FF9800",bg:"#FFF3E0"},delivered:{icon:"✅",label:"Emporté",color:"#4CAF50",bg:"#E8F5E8"},to_deliver:{icon:"📦",label:"À livrer",color:"#2196F3",bg:"#E3F2FD"},cancelled:{icon:"❌",label:"Annulé",color:"#f44336",bg:"#FFEBEE"}}[a],n=`status-badge-${t}`;return e.jsxs("span",{className:`status-badge ${n}`,style:{backgroundColor:r.bg,color:r.color,border:`1px solid ${r.color}40`},children:[e.jsx("span",{className:"status-icon",children:r.icon}),e.jsx("span",{className:"status-text",children:r.label})]})},Ds=({products:a})=>{const t=a.reduce((m,d)=>{const h=d.statut_livraison||"pending";return m[h]=(m[h]||0)+1,m},{}),s=a.length,r=t.delivered||0,n=t.pending||0,o=t.to_deliver||0,i=t.cancelled||0,l=s>0?Math.round((r+i)/s*100):0;return s===0?null:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-800 mb-3 flex items-center",children:"📊 Résumé des statuts de livraison"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Progression globale"}),e.jsxs("span",{children:[l,"% terminé"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full transition-all duration-300",style:{width:`${l}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[n>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ze,{status:"pending"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:n})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"En attente"})]}),o>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ze,{status:"to_deliver"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:o})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"À livrer"})]}),r>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ze,{status:"delivered"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:r})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Emporté"})]}),i>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ze,{status:"cancelled"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:i})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Annulé"})]})]}),n>0&&e.jsxs("div",{className:"mt-3 p-2 bg-orange-100 border border-orange-300 rounded text-sm text-orange-700",children:["⚠️ ",n," produit(s) en attente de traitement"]}),n===0&&o===0&&s>0&&e.jsx("div",{className:"mt-3 p-2 bg-green-100 border border-green-300 rounded text-sm text-green-700",children:"✅ Tous les produits ont été traités !"})]})};class Mt{static async notifyStatusChange(t,s,r,n){try{const o=await fetch(this.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({invoiceNumber:t,productName:s,newStatus:r,oldStatus:n,timestamp:new Date().toISOString(),source:"facturation-app"})});if(!o.ok)throw new Error(`HTTP Error: ${o.status}`);const i=await o.json();return console.log("✅ Statut notifié avec succès:",i),!0}catch(o){return console.error("❌ Erreur notification statut:",o),!1}}}re(Mt,"webhookUrl","https://n8n.srv765811.hstgr.cloud/webhook/sync/status-update");const ut="/assets/Alma_orange-CdugUa7W.png",Ls=({products:a,onUpdate:t,taxRate:s,invoiceNotes:r,onNotesChange:n,acompteAmount:o,onAcompteChange:i,paymentMethod:l,onPaymentMethodChange:m,advisorName:d,onAdvisorNameChange:h,termsAccepted:c,onTermsAcceptedChange:x,signature:g,onShowSignaturePad:N,nombreChequesAVenir:p,onNombreChequesAVenirChange:u,invoiceNumber:v})=>{const[y,S]=f.useState({category:"",name:"",quantity:1,unitPrice:0,priceTTC:0}),[b,j]=f.useState(null),P=f.useMemo(()=>Se.filter(C=>C.category===y.category),[y.category]),w=f.useMemo(()=>{const C=a.reduce((se,W)=>se+W.quantity*te(W.priceTTC,s),0),I=a.reduce((se,W)=>se+q(W.quantity,W.priceTTC,W.discount,W.discountType),0),R=a.reduce((se,W)=>{const et=W.priceTTC*W.quantity,A=q(W.quantity,W.priceTTC,W.discount,W.discountType);return se+(et-A)},0),K=Number(o||0),H=Math.max(0,I-K),oe=Number(p||0);return{subtotal:C,totalWithTax:I,totalDiscount:R,taxAmount:I-I/(1+s/100),totalPercu:K,totalARecevoir:Math.max(0,I-K),montantParCheque:H&&oe?H/oe:0,totalCheques:H&&oe?H:0}},[a,s,o,p]),F=f.useMemo(()=>{if(p<=0||w.totalWithTax<=0)return null;const C=we(w.totalWithTax,p),I=Fs(w.totalWithTax,p),R=Ps(p,I);return{...C,message:Es(C),gainTemps:R,estBenefique:I,acompteActuel:o||0,peutOptimiser:I&&C.acompte!==(o||0)}},[w.totalWithTax,p,o]);f.useEffect(()=>{const C=l&&(l.toLowerCase().includes("chèque")||l.toLowerCase().includes("cheque"));C&&p>0&&!c&&x(!0),l==="Chèques à venir"&&(p===0||p===null)&&_(9),C&&p>0&&F&&F.estBenefique&&F.peutOptimiser&&i(F.acompte)},[l,p,F==null?void 0:F.acompte,F==null?void 0:F.estBenefique,F==null?void 0:F.peutOptimiser,i,c,x]),f.useEffect(()=>{if(l==="Virement"&&(p>0&&u(0),w.totalWithTax>0)){const C=Math.round(w.totalWithTax*.2*100)/100;o!==C&&i(C)}},[l,w.totalWithTax,p,o,u,i]),f.useEffect(()=>{l==="Alma"&&(p===0||p===null||p>4)&&u(3)},[l,p,u]);const D=()=>!l||l.trim()==="",T=()=>c===!0,O=()=>`w-full border-2 rounded-lg px-4 py-3 focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold ${D()?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`,z=C=>{const I=C.target.value.replace(/^0+/,"");i(Number(I||"0"))},L=C=>{const I=C.target.value.replace(/^0+/,"");u(Number(I||"0"))},_=C=>{u(C)},U=C=>{S({...y,category:C,name:"",unitPrice:0,priceTTC:0})},ee=C=>{const I=Se.find(R=>R.name===C);I&&S({...y,name:C,priceTTC:I.priceTTC,unitPrice:I.autoCalculateHT?te(I.priceTTC,s):I.price||0})},V=C=>{S({...y,priceTTC:C,unitPrice:te(C,s)})},ue=()=>{if(!y.name||y.quantity<=0||y.priceTTC<=0){alert("Veuillez remplir tous les champs obligatoires");return}const C=Se.find(H=>H.name===y.name),I=y.category==="Diverse",R={id:Date.now().toString(),name:y.name,category:y.category,quantity:y.quantity,unitPrice:y.unitPrice,priceHT:te(y.priceTTC,s),priceTTC:y.priceTTC,discount:0,discountType:"percent",totalHT:te(y.priceTTC,s)*y.quantity,totalTTC:y.priceTTC*y.quantity,autoCalculateHT:I?!1:(C==null?void 0:C.autoCalculateHT)||!1,isPickupOnSite:!1,statut_livraison:"pending"},K=a.findIndex(H=>H.name===R.name&&Math.abs(H.priceTTC-R.priceTTC)<.01);if(K>=0){const H=[...a];H[K].quantity+=R.quantity,t(H)}else t([...a,R]);S({category:"",name:"",quantity:1,unitPrice:0,priceTTC:0})},Oe=C=>{if(window.confirm("Êtes-vous sûr de vouloir supprimer ce produit ?")){const I=a.filter((R,K)=>K!==C);t(I)}},ae=(C,I)=>{const R=[...a];R[C]={...R[C],...I},I.priceTTC&&R[C].autoCalculateHT&&(R[C].unitPrice=te(I.priceTTC,s)),t(R)},xe=C=>{j(C)},pe=()=>{j(null)};return e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsxs("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:[e.jsx(Xt,{className:"mr-3 text-xl"}),e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"PRODUITS & TARIFICATION"})]}),e.jsxs("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:[e.jsxs("div",{className:"mb-6 bg-white rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2 mb-2",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Catégorie"}),e.jsxs("select",{value:y.category,onChange:C=>U(C.target.value),className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 bg-white font-bold focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",children:[e.jsx("option",{value:"",children:"Sélectionner"}),Ee.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Produit"}),y.category==="Diverse"?e.jsx("input",{type:"text",value:y.name,onChange:C=>S({...y,name:C.target.value}),placeholder:"Saisir le nom du produit...",className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 bg-white font-bold focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",disabled:!y.category}):e.jsxs("select",{value:y.name,onChange:C=>ee(C.target.value),className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 bg-white font-bold focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",disabled:!y.category,children:[e.jsx("option",{value:"",children:y.category?"Sélectionner un produit":"Sélectionner une catégorie d'abord"}),P.map(C=>e.jsx("option",{value:C.name,children:C.name},C.name))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Quantité"}),e.jsx("input",{value:y.quantity,onChange:C=>S({...y,quantity:parseInt(C.target.value)||1}),type:"number",min:"1",className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",onFocus:C=>C.target.select(),onTouchStart:C=>C.currentTarget.select()})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Prix TTC"}),e.jsx("input",{value:y.priceTTC,onChange:C=>V(parseFloat(C.target.value)||0),type:"number",step:"0.01",min:"0",className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",onFocus:C=>C.target.select(),onTouchStart:C=>C.currentTarget.select()})]}),e.jsx("div",{className:"md:col-span-1 flex items-end",children:e.jsx("button",{onClick:ue,className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center justify-center",title:"Ajouter le produit",children:e.jsx(He,{className:"w-4 h-4"})})})]}),y.priceTTC>0&&e.jsx("div",{className:"mt-2 text-sm text-black",children:e.jsxs("span",{className:"font-semibold",children:["Prix HT calculé: ",k(y.unitPrice)]})})]}),a.length>0&&e.jsx(Ds,{products:a}),e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#477A0C] text-[#F2EFE2]",children:[e.jsx("th",{className:"border border-[#477A0C] px-4 py-3 text-left font-extrabold",children:"PRODUIT"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-center font-bold",children:"STATUT DE LIVRAISON"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-center font-bold",children:"Quantité"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"PU HT"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"PU TTC"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"Remise"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"Total TTC"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-center font-bold",children:"Actions"})]})}),e.jsxs("tbody",{children:[a.map((C,I)=>e.jsxs("tr",{className:"bg-white",children:[e.jsxs("td",{className:"border border-gray-300 px-3 py-2",children:[e.jsx("div",{className:"font-bold text-black",children:C.name}),C.category&&e.jsx("div",{className:"text-xs text-gray-600",children:C.category})]}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsx(ks,{product:{nom:C.name,quantite:C.quantity,prix_ttc:C.priceTTC,total_ttc:q(C.quantity,C.priceTTC,C.discount,C.discountType),categorie:C.category||"",remise:C.discount,type_remise:C.discountType,statut_livraison:C.statut_livraison||"pending",emporte:C.isPickupOnSite},productIndex:I,onStatusChange:async(R,K)=>{const H=a[R],oe=H.statut_livraison;if(ae(R,{statut_livraison:K,isPickupOnSite:K==="delivered"}),v&&H.name)try{await Mt.notifyStatusChange(v,H.name,K,oe)}catch(se){console.warn("⚠️ Notification N8N échouée, mais le changement local est conservé:",se)}}})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:b===I?e.jsx("input",{type:"number",min:"1",value:C.quantity,onChange:R=>ae(I,{quantity:parseInt(R.target.value)||1}),className:"w-16 text-center border border-gray-300 rounded px-1 py-1 text-black",onBlur:pe,onKeyPress:R=>R.key==="Enter"&&pe(),onFocus:R=>R.target.select(),onTouchStart:R=>R.currentTarget.select(),autoFocus:!0}):e.jsx("span",{className:"font-bold cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-black",onClick:()=>xe(I),children:C.quantity})}),e.jsxs("td",{className:"border border-gray-300 px-3 py-2 text-right",children:[e.jsx("div",{className:"font-bold text-black",children:k(te(C.priceTTC,s))}),e.jsx("div",{className:"text-xs text-gray-600",children:"HT"})]}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-right",children:b===I?e.jsx("input",{type:"number",step:"0.01",min:"0",value:C.priceTTC,onChange:R=>ae(I,{priceTTC:parseFloat(R.target.value)||0}),className:"w-20 text-right border border-gray-300 rounded px-1 py-1 text-black",onBlur:pe,onKeyPress:R=>R.key==="Enter"&&pe(),onFocus:R=>R.target.select(),onTouchStart:R=>R.currentTarget.select()}):e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>xe(I),children:[e.jsx("div",{className:"font-bold text-black",children:k(C.priceTTC)}),e.jsx("div",{className:"text-xs text-gray-600",children:"TTC"})]})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 bg-[#F55D3E] bg-opacity-20",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsxs("select",{value:C.discountType,onChange:R=>ae(I,{discountType:R.target.value}),className:"border border-gray-300 rounded px-1 py-1 text-xs w-12 text-black",children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"€"})]}),e.jsx("input",{value:C.discount,onChange:R=>ae(I,{discount:parseFloat(R.target.value)||0}),type:"number",step:"0.01",min:"0",className:"w-16 border border-gray-300 rounded px-1 py-1 text-right text-black",onFocus:R=>R.target.select(),onTouchStart:R=>R.currentTarget.select()})]})}),e.jsxs("td",{className:"border border-gray-300 px-3 py-2 text-right font-bold",children:[e.jsx("span",{className:"text-black",children:k(q(C.quantity,C.priceTTC,C.discount,C.discountType))}),C.discount>0&&e.jsxs("div",{className:"text-xs text-gray-600",children:["(-",C.discountType==="percent"?`${C.discount}%`:k(C.discount),")"]})]}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-1",children:[e.jsx("button",{onClick:()=>xe(I),className:"text-white bg-blue-500 hover:bg-blue-600 p-1 rounded transition-all",title:"Modifier",children:e.jsx(de,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>Oe(I),className:"text-white bg-red-500 hover:bg-red-600 p-1 rounded transition-all",title:"Supprimer",children:e.jsx(Re,{className:"w-3 h-3"})})]})})]},C.id||I)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"border border-gray-300 px-3 py-4 text-center text-gray-500",children:e.jsx("span",{className:"text-black font-bold",children:"Aucun produit ajouté"})})})]})]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-[#FFE4B5] rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"bg-[#477A0C] text-[#F2EFE2] p-2 rounded-full mr-3",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-black font-bold text-lg",children:"REMARQUES"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-black font-semibold mb-2",children:"Notes de facture"}),e.jsx("textarea",{value:r,onChange:C=>n(C.target.value),className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 h-24 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black",placeholder:"Notes ou remarques sur la facture..."})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Te,{className:"w-5 h-5 text-purple-600 mr-2"}),e.jsx("h4",{className:"font-bold text-purple-800 bg-[#F55D3E] text-white px-4 py-2 rounded-lg border-2 border-[#F55D3E]",children:"TOTAL À RECEVOIR"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-purple-700 font-semibold mb-1 flex items-center",children:[e.jsx(nt,{className:"w-4 h-4 mr-1"}),"Total à recevoir (€) - Calculé automatiquement"]}),e.jsx("input",{type:"text",value:k(w.totalARecevoir),readOnly:!0,className:"w-full border-2 border-[#F55D3E] rounded-lg px-3 py-2 bg-[#F55D3E] text-white font-bold cursor-not-allowed",placeholder:"Calculé automatiquement : Total TTC - Acompte"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:['✨ Synchronisé avec "TOTAUX & ACOMPTE" (',k(w.totalWithTax)," -"," ",k(Number(o||0)),")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-purple-700 font-semibold mb-1 flex items-center",children:[e.jsx(At,{className:"w-4 h-4 mr-1"}),l==="Alma"?"Nombre de paiements ALMA":"Nombre de chèques (à venir)"]}),e.jsx("input",{type:"number",min:"0",step:"1",placeholder:"0",value:p||0,onChange:L,className:"w-full border-2 border-purple-300 rounded-lg px-3 py-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all bg-white text-purple-800 font-bold",onFocus:C=>C.target.select(),onTouchStart:C=>C.currentTarget.select()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-purple-700 font-semibold mb-1 flex items-center",children:[e.jsx(st,{className:"w-4 h-4 mr-1"}),l==="Alma"?"Montant par paiement (calculé)":"Montant par chèque (calculé)"]}),e.jsx("input",{type:"text",value:w.montantParCheque>0?k(w.montantParCheque):"",readOnly:!0,className:"w-full border-2 border-purple-300 rounded-lg px-3 py-2 bg-purple-100 text-purple-800 font-bold cursor-not-allowed",placeholder:"Calculé automatiquement"})]})]}),w.totalARecevoir>0&&Number(p)>0&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-100 border border-purple-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-purple-700 font-semibold",children:"Calcul automatique :"}),e.jsx("span",{className:"text-purple-800 font-bold text-lg",children:k(w.montantParCheque)})]}),e.jsxs("div",{className:"text-xs text-purple-600",children:[k(w.totalARecevoir)," ÷"," ",p," ",l==="Alma"?"paiement":"chèque",Number(p)>1?"s":""," ="," ",k(w.montantParCheque)," par"," ",l==="Alma"?"paiement":"chèque"]}),e.jsx("div",{className:"mt-2 p-2 bg-green-100 border border-green-300 rounded",children:e.jsxs("div",{className:"text-sm text-green-800 font-semibold",children:["✅ Total ",l==="Alma"?"ALMA":"des chèques"," ",": ",k(w.totalCheques)]})})]}),e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:["✨ ",e.jsx("strong",{children:"Synchronisation automatique :"}),' Le "Total à recevoir" est automatiquement calculé (Total TTC - Acompte) et synchronisé avec le bloc "TOTAUX & ACOMPTE". Saisissez uniquement le nombre'," ",l==="Alma"?"de paiements ALMA":"de chèques"," ","pour calculer automatiquement le montant par"," ",l==="Alma"?"paiement":"chèque","."]})]})]}),e.jsxs("div",{className:"bg-[#89BBFE] rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"bg-[#477A0C] text-[#F2EFE2] p-2 rounded-full mr-3",children:e.jsx(st,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-black font-bold text-lg",children:"TOTAUX & ACOMPTE"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between border-b border-gray-300 pb-2",children:[e.jsx("span",{className:"font-semibold text-black",children:"Total HT:"}),e.jsx("span",{className:"font-semibold text-black",children:k(w.subtotal)})]}),e.jsxs("div",{className:"flex justify-between border-b border-gray-300 pb-2",children:[e.jsxs("span",{className:"font-semibold text-black",children:["TVA (",s,"%):"]}),e.jsx("span",{className:"font-semibold text-black",children:k(w.taxAmount)})]}),w.totalDiscount>0&&e.jsxs("div",{className:"flex justify-between text-red-600 border-b border-gray-300 pb-2",children:[e.jsx("span",{className:"font-semibold",children:"Remise totale:"}),e.jsxs("span",{className:"font-semibold",children:["-",k(w.totalDiscount)]})]}),e.jsxs("div",{className:"flex justify-between bg-[#477A0C] text-[#F2EFE2] p-3 rounded-lg shadow-md",children:[e.jsx("span",{className:"font-bold text-lg",children:"Total TTC:"}),e.jsx("span",{className:"font-bold text-xl",children:k(w.totalWithTax)})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(nt,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("h4",{className:"font-bold text-blue-800",children:"GESTION ACOMPTE"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-blue-700 font-semibold mb-1 flex items-center",children:["Acompte versé (€)",F&&F.estBenefique&&o===F.acompte&&e.jsxs("span",{className:"ml-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full flex items-center",children:[e.jsx(Zt,{className:"w-3 h-3 mr-1"}),"Proposition automatique"]})]}),F&&F.estBenefique&&o===F.acompte&&e.jsx("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-xs text-blue-700 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"💡"}),e.jsx("strong",{children:"Proposition automatique"})," : Vous pouvez modifier ce montant si nécessaire"]})}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:w.totalWithTax,placeholder:"0.00",value:o!=null&&o!==0?o:"",onChange:z,className:`w-full border-2 rounded-lg px-4 py-2 focus:ring-2 transition-all bg-white text-blue-800 font-bold ${F&&F.estBenefique&&o===F.acompte?"border-green-400 focus:border-green-500 focus:ring-green-200 bg-green-50":"border-blue-300 focus:border-blue-500 focus:ring-blue-200"}`,onFocus:C=>C.target.select(),onTouchStart:C=>C.currentTarget.select()}),F&&F.estBenefique&&o===F.acompte&&e.jsxs("div",{className:"mt-2 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-2",children:[e.jsx(es,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{className:"font-semibold",children:["🎯 Proposition optimale : ",F.nbCheques," ","chèques de ",F.montantCheque,"€ pile"]})]}),F.gainTemps&&e.jsx("div",{className:"text-xs text-green-700 mb-2",children:F.gainTemps}),e.jsxs("div",{className:"text-xs text-green-600 bg-green-50 p-2 rounded border border-green-200",children:["✏️ ",e.jsx("strong",{children:"Modifiable :"})," Vous pouvez ajuster ce montant selon les besoins du client"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-100 border border-green-300 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(ts,{className:"w-4 h-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"Total perçu"})]}),e.jsx("div",{className:"text-green-800 font-bold text-lg",children:k(w.totalPercu)})]}),e.jsxs("div",{className:"bg-[#F55D3E] border-2 border-[#F55D3E] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(st,{className:"w-4 h-4 text-white mr-1"}),e.jsx("span",{className:"text-white font-semibold text-sm",children:"Total à recevoir"})]}),e.jsx("div",{className:"text-white font-bold text-lg",children:k(w.totalARecevoir)})]})]}),w.totalWithTax>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Progression du paiement"}),e.jsxs("span",{children:[Math.round(Number(o||0)/w.totalWithTax*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-300",style:{width:`${Math.min(Number(o||0)/w.totalWithTax*100,100)}%`}})})]})]})]}),l==="Virement"&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-[#F55D3E] rounded-lg p-3 mt-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Te,{className:"w-4 h-4 text-[#F55D3E] mr-2"}),e.jsx("h4",{className:"font-bold text-black text-sm",children:"RELEVÉ D'IDENTITÉ BANCAIRE (RIB)"})]}),e.jsxs("div",{className:"bg-white border-2 border-[#F55D3E] rounded-lg p-3",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("h5",{className:"font-bold text-black text-sm",children:"MYCONFORT"}),e.jsx("p",{className:"text-xs text-black",children:"Coordonnées bancaires pour virement"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"Titulaire du compte"}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded px-2 py-1 text-xs font-medium text-black",children:"MYCONFORT SARL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"Banque"}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded px-2 py-1 text-xs font-medium text-black",children:"BANQUE POPULAIRE DU SUD"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"IBAN"}),e.jsx("div",{className:"bg-[#F55D3E] bg-opacity-10 border-2 border-[#F55D3E] rounded px-2 py-1 text-xs font-bold text-black",children:"FR76 1660 7000 1708 1216 3980 964"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"BIC/SWIFT"}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded px-2 py-1 text-xs font-medium text-black",children:"CCBPFRPPPPG"})]})]})]}),e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-300 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-xs text-black",children:[e.jsx("div",{className:"bg-blue-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs font-bold mr-2 flex-shrink-0",children:"i"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-black",children:"Instructions de virement :"}),e.jsxs("p",{className:"text-xs mt-1 text-black",children:["• Montant à virer :"," ",e.jsx("strong",{children:k(w.totalARecevoir)}),e.jsx("br",{}),"• Merci d'indiquer votre nom et numéro de facture en référence",e.jsx("br",{}),"• Le RIB sera automatiquement joint à la facture par email"]})]})]})})]})]}),w.totalCheques>0&&e.jsxs("div",{className:"bg-[#F55D3E] border-2 border-[#F55D3E] rounded-lg p-3 mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"w-4 h-4 text-white mr-2"}),e.jsx("span",{className:"text-white font-semibold",children:l==="Alma"?"Total ALMA :":"Total à recevoir:"})]}),e.jsx("span",{className:"text-white font-bold",children:k(w.totalCheques)})]}),e.jsx("div",{className:"text-xs text-white opacity-90 mt-1",children:l==="Alma"?`${p} paiement${Number(p)>1?"s":""} de ${k(w.montantParCheque)} chacun (ALMA)`:`${p} chèque${Number(p)>1?"s":""} de ${k(w.montantParCheque)} chacun (à venir)`}),l==="Alma"&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx("img",{src:ut,alt:"Alma",className:"h-8 opacity-90 hover:opacity-100 transition-opacity"})})]})]})]}),e.jsxs("div",{className:"bg-[#FFE4B5] rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"bg-[#477A0C] text-[#F2EFE2] p-2 rounded-full mr-3",children:e.jsx(Te,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-black font-bold text-lg",children:"MODE DE RÈGLEMENT"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black font-semibold mb-1",children:["Méthode de paiement ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:l,onChange:C=>m(C.target.value),required:!0,className:O(),children:[e.jsx("option",{value:"",children:"Sélectionner obligatoirement"}),e.jsx("option",{value:"Chèques à venir",children:"Chèques à venir"}),e.jsx("option",{value:"Virement",children:"Virement bancaire"}),e.jsx("option",{value:"Carte Bleue",children:"Carte Bleue"}),e.jsx("option",{value:"Espèces",children:"Espèces"}),e.jsx("option",{value:"Alma",children:"Alma (paiement en plusieurs fois)"}),e.jsx("option",{value:"PayPal",children:"PayPal"}),e.jsx("option",{value:"Chèque",children:"Chèque"}),e.jsx("option",{value:"Acompte",children:"Acompte"})]}),l==="Chèques à venir"&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:!0,readOnly:!0,className:"form-checkbox h-4 w-4 text-purple-600 rounded"}),e.jsx("span",{className:"text-purple-700 font-semibold",children:"Nombre de fois :"})]}),e.jsxs("select",{value:p||9,onChange:C=>_(Number(C.target.value)),className:"w-full border-2 border-purple-300 rounded-lg px-3 py-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all bg-white text-purple-800 font-bold",children:[e.jsx("option",{value:9,children:"9 chèques"}),e.jsx("option",{value:8,children:"8 chèques"}),e.jsx("option",{value:7,children:"7 chèques"}),e.jsx("option",{value:6,children:"6 chèques"}),e.jsx("option",{value:5,children:"5 chèques"}),e.jsx("option",{value:4,children:"4 chèques"}),e.jsx("option",{value:3,children:"3 chèques"}),e.jsx("option",{value:2,children:"2 chèques"})]}),e.jsx("div",{className:"text-xs text-purple-600 mt-1",children:'🎯 Le nombre de chèques sera automatiquement appliqué dans "Chèques à venir"'})]}),l==="Alma"&&e.jsxs("div",{className:"mt-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:!0,readOnly:!0,className:"form-checkbox h-4 w-4 text-orange-600 rounded"}),e.jsx("span",{className:"text-orange-700 font-semibold",children:"Paiement en plusieurs fois :"})]}),e.jsxs("select",{value:p||3,onChange:C=>_(Number(C.target.value)),className:"w-full border-2 border-orange-300 rounded-lg px-3 py-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all bg-white text-orange-800 font-bold",children:[e.jsx("option",{value:2,children:"2 fois (sans frais)"}),e.jsx("option",{value:3,children:"3 fois (sans frais)"}),e.jsx("option",{value:4,children:"4 fois (sans frais)"})]}),e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["💳 Le paiement ALMA sera divisé en"," ",p||3," fois"]})]}),D()&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"⚠️ La méthode de paiement est obligatoire"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black font-semibold mb-1",children:"Conseiller(e)"}),e.jsx("input",{value:d,onChange:C=>h(C.target.value),type:"text",className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold",placeholder:"Nom du conseiller"})]}),e.jsxs("div",{className:`bg-gradient-to-r from-green-50 to-emerald-50 border-2 rounded-lg p-4 ${T()?"border-green-300":"border-red-300"}`,children:[e.jsxs("label",{className:"flex items-start",children:[e.jsx("input",{checked:c,onChange:C=>x(C.target.checked),type:"checkbox",required:!0,className:`form-checkbox h-5 w-5 rounded focus:ring-2 mr-3 mt-0.5 ${T()?"text-[#477A0C] focus:ring-[#477A0C]":"text-red-500 focus:ring-red-500"}`}),e.jsxs("span",{className:`font-semibold ${T()?"text-black":"text-red-600"}`,children:["J'ai lu et j'accepte les conditions générales de vente"," ",e.jsx("span",{className:"text-red-600",children:"*"})]})]}),T()?e.jsxs("div",{className:"mt-2 flex items-center text-green-700",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm font-semibold",children:"✅ Conditions acceptées"}),l&&(l.toLowerCase().includes("chèque")||l.toLowerCase().includes("cheque"))&&p>0&&e.jsx("span",{className:"ml-2 bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-bold",children:"🚀 Auto-validé"})]}):e.jsx("div",{className:"mt-2 text-red-600 text-xs font-semibold",children:"⚠️ L'acceptation des conditions générales de vente est obligatoire"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4",children:[e.jsxs("label",{className:"block text-black font-semibold mb-2 flex items-center",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Signature client MYCONFORT"]}),e.jsx("div",{className:"border-2 border-dashed border-[#477A0C] rounded h-20 flex items-center justify-center bg-white hover:bg-gray-50 transition-colors",children:g?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-green-600 font-semibold flex items-center justify-center space-x-1",children:[e.jsx("span",{children:"🔒"}),e.jsx("span",{children:"Signature électronique enregistrée"})]}),e.jsx("div",{className:"mt-2 h-12 flex items-center justify-center",children:e.jsx("img",{src:g,alt:"Signature",className:"max-h-full max-w-full"})}),e.jsx("button",{onClick:N,className:"text-sm text-blue-600 hover:text-blue-800 underline mt-2 px-3 py-1 bg-blue-100 rounded-lg transition-colors",children:"✏️ Modifier la signature"})]}):e.jsxs("button",{onClick:N,className:"text-black hover:text-[#477A0C] font-semibold flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[e.jsx("span",{children:"✍️"}),e.jsx("span",{children:"Cliquer pour signer électroniquement"})]})}),e.jsx("div",{className:"mt-3 text-xs text-blue-600",children:g?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"✅ Signature valide et sécurisée"}),e.jsxs("span",{className:"text-gray-500",children:["Signée le ",new Date().toLocaleDateString("fr-FR")]})]}):e.jsx("div",{className:"text-orange-600",children:"⚠️ Signature recommandée pour valider la commande"})})]}),e.jsx("div",{className:`p-3 rounded-lg border-2 ${!D()&&T()?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:e.jsx("div",{className:"text-sm font-semibold",children:!D()&&T()?e.jsxs("div",{className:"text-green-800 flex items-center",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"✅ Tous les champs obligatoires sont remplis"]}):e.jsxs("div",{className:"text-red-800",children:["⚠️ Champs obligatoires manquants :",e.jsxs("ul",{className:"list-disc list-inside mt-1 text-xs",children:[D()&&e.jsx("li",{children:"Méthode de paiement"}),!T()&&e.jsx("li",{children:"Acceptation des conditions générales"})]})]})})})]})]})]})]})},je=({isOpen:a,onClose:t,title:s,children:r,maxWidth:n="max-w-4xl"})=>a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl p-6 w-full ${n} max-h-[80vh] overflow-auto`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-[#14281D]",children:s}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(fe,{className:"w-6 h-6"})})]}),r]})}):null,Rs=({isOpen:a,onClose:t,clients:s,onLoadClient:r,onDeleteClient:n})=>{const o=i=>{window.confirm("Êtes-vous sûr de vouloir supprimer ce client ?")&&n(i)};return e.jsxs(je,{isOpen:a,onClose:t,title:"Liste des Clients",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#477A0C] text-[#F2EFE2]",children:[e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Nom"}),e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Email"}),e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Téléphone"}),e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Adresse"}),e.jsx("th",{className:"border px-4 py-2 text-center font-bold",children:"Actions"})]})}),e.jsxs("tbody",{children:[s.map((i,l)=>e.jsxs("tr",{className:"bg-white hover:bg-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-bold",children:i.name})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-semibold",children:i.email})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-semibold",children:i.phone})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-semibold",children:`${i.address}, ${i.postalCode} ${i.city}`})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsxs("button",{onClick:()=>{r(i),t()},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded flex items-center space-x-1 font-semibold",children:[e.jsx(St,{className:"w-4 h-4"}),e.jsx("span",{children:"Charger"})]}),e.jsxs("button",{onClick:()=>o(l),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded flex items-center space-x-1 font-semibold",children:[e.jsx(Re,{className:"w-4 h-4"}),e.jsx("span",{children:"Supprimer"})]})]})})]},i.id||l)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"border px-4 py-4 text-center",children:e.jsx("span",{className:"text-black font-bold",children:"Aucun client enregistré"})})})]})]})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:t,className:"bg-[#477A0C] hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-bold shadow-lg transition-all hover:scale-105",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Retour"})]})})]})},Is=()=>e.jsxs("div",{className:"conditions-generales",children:[e.jsx("div",{className:"conditions-header",children:e.jsx("h1",{style:{textAlign:"center",color:"#477A0C",marginBottom:"15px",fontSize:"18px"},children:"CONDITIONS GÉNÉRALES DE VENTE"})}),e.jsxs("div",{className:"conditions-content",style:{fontSize:"9px",lineHeight:"1.3",columns:"2",columnGap:"15px"},children:[e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 1 - Livraison"}),e.jsx("p",{children:"Une fois la commande expédiée, vous serez contacté par SMS ou mail pour programmer la livraison en fonction de vos disponibilités (à la journée ou demi-journée). Le transporteur livre le produit au pas de porte ou en bas de l'immeuble. Veuillez vérifier que les dimensions du produit permettent son passage dans les escaliers, couloirs et portes. Aucun service d'installation ou de reprise de l'ancienne literie n'est prévu."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 2 - Délais de Livraison"}),e.jsx("p",{children:"Les délais de livraison sont donnés à titre indicatif et ne constituent pas un engagement ferme. En cas de retard, aucune indemnité ou annulation ne sera acceptée, notamment en cas de force majeure. Nous déclinons toute responsabilité en cas de délai dépassé."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 3 - Risques de Transport"}),e.jsx("p",{children:"Les marchandises voyagent aux risques du destinataire. En cas d'avarie ou de perte, il appartient au client de faire les réserves nécessaires obligatoire sur le bordereau du transporteur. En cas de non-respect de cette obligation on ne peut pas se retourner contre le transporteur."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 4 - Acceptation des Conditions"}),e.jsx("p",{children:"Toute livraison implique l'acceptation des présentes conditions. Le transporteur livre à l'adresse indiquée sans monter les étages. Le client est responsable de vérifier et d'accepter les marchandises lors de la livraison."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 5 - Réclamations"}),e.jsx("p",{children:"Les réclamations concernant la qualité des marchandises doivent être formulées par écrit dans les huit jours suivant la livraison, par lettre recommandée avec accusé de réception."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 6 - Retours"}),e.jsx("p",{children:"Aucun retour de marchandises ne sera accepté sans notre accord écrit préalable. Cet accord n'implique aucune reconnaissance."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 7 - Tailles des Matelas"}),e.jsx("p",{children:"Les dimensions des matelas peuvent varier de +/- 5 cm en raison de la thermosensibilité des mousses viscoélastiques. Les tailles standards sont données à titre indicatif et ne constituent pas une obligation contractuelle. Les matelas sur mesure doivent inclure les spécifications exactes du cadre de lit."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 8 - Odeur des Matériaux"}),e.jsx("p",{children:"Les mousses viscoélastiques naturelles (à base d'huile de ricin) et les matériaux de conditionnement peuvent émettre une légère odeur qui disparaît après déballage. Cela ne constitue pas un défaut."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 9 - Règlements et Remises"}),e.jsx("p",{children:"Sauf accord express, aucun rabais ou escompte ne sera appliqué pour paiement comptant. La garantie couvre les mousses, mais pas les textiles et accessoires."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 10 - Paiement"}),e.jsx("p",{children:"Les factures sont payables par chèque, virement, carte bancaire ou espèce à réception."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 11 - Pénalités de Retard"}),e.jsx("p",{children:"En cas de non-paiement, une majoration de 10% avec un minimum de 300 € sera appliquée, sans préjudice des intérêts de retard. Nous nous réservons le droit de résilier la vente sans sommation."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 12 - Exigibilité en Cas de Non-Paiement"}),e.jsx("p",{children:"Le non-paiement d'une échéance rend immédiatement exigible le solde de toutes les échéances à venir."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 13 - Livraison Incomplète ou Non-Conforme"}),e.jsx("p",{children:"En cas de livraison endommagée ou non conforme, mentionnez-le sur le bon de livraison et refusez le produit. Si l'erreur est constatée après le départ du transporteur, contactez-nous sous 72h ouvrables."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 14 - Litiges"}),e.jsx("p",{children:"Tout litige sera de la compétence exclusive du Tribunal de Commerce de Perpignan ou du tribunal compétent du prestataire."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 15 - Horaires de Livraison"}),e.jsx("p",{children:"Les livraisons sont effectuées du lundi au vendredi (hors jours fériés). Une personne majeure doit être présente à l'adresse lors de la livraison. Toute modification d'adresse après commande doit être signalée immédiatement à myconfort66@gmail.com."})]})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"15px",fontSize:"8px",fontStyle:"italic"},children:"Les présentes Conditions générales ont été mises à jour le 23 août 2024"})]}),Qe=f.forwardRef(({invoice:a,className:t=""},s)=>{const r=a.products.reduce((d,h)=>d+q(h.quantity,h.priceTTC,h.discount,h.discountType==="percent"?"percent":"fixed"),0),n=a.montantAcompte||0,o=r-n,i=r/(1+a.taxRate/100),l=r-i,m=a.products.reduce((d,h)=>{const c=h.priceTTC*h.quantity,x=q(h.quantity,h.priceTTC,h.discount,h.discountType==="percent"?"percent":"fixed");return d+(c-x)},0);return e.jsx("div",{ref:s,id:"facture-apercu-modern",className:`modern-invoice ${t}`,style:{fontFamily:"'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",lineHeight:1.4,color:"#2D3748",background:"#ffffff",minHeight:"100vh",padding:"0",margin:"0"},children:e.jsxs("div",{style:{maxWidth:"100%",margin:"0",background:"white",overflow:"hidden",minHeight:"297mm",pageBreakAfter:"always",display:"flex",flexDirection:"column"},children:[e.jsx("header",{style:{background:"#477A0C",color:"white",padding:"20px 30px",borderBottom:"3px solid #3a6509",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"28px",fontWeight:"bold",margin:"0 0 8px 0",letterSpacing:"1px"},children:"MYCONFORT"}),e.jsx("p",{style:{fontSize:"14px",margin:"0",color:"#E2E8F0",fontWeight:"normal"},children:"Votre spécialiste literie de qualité"})]}),a.signature&&e.jsxs("div",{style:{background:"#F5E6D3",padding:"8px 16px",border:"2px solid #D4A574",fontSize:"12px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"6px",color:"#2D3748"},children:[e.jsx("span",{style:{color:"#477A0C"},children:"✓"}),"FACTURE SIGNÉE"]})]})}),e.jsxs("div",{style:{padding:"40px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"40px",marginBottom:"40px"},children:[e.jsxs("div",{style:{background:"#F2EFE2",padding:"24px",border:"2px solid #E2E8F0"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 16px 0",color:"#2D3748"},children:"MYCONFORT"}),e.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#4A5568"},children:[e.jsx("div",{style:{marginBottom:"4px"},children:"📍 88 Avenue des Ternes"}),e.jsx("div",{style:{marginBottom:"4px"},children:"75017 Paris, France"}),e.jsx("div",{style:{marginBottom:"4px"},children:"🏢 SIRET: 824 313 530 00027"}),e.jsx("div",{style:{marginBottom:"4px"},children:"📞 Tél: 04 68 50 41 45"}),e.jsx("div",{style:{marginBottom:"4px"},children:"✉️ myconfort@gmail.com"}),e.jsx("div",{children:"🌐 https://www.htconfort.com"})]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{background:"#477A0C",color:"white",padding:"24px",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 12px 0"},children:"FACTURE"}),e.jsxs("div",{style:{fontSize:"16px"},children:["N° ",a.invoiceNumber]})]}),e.jsxs("div",{style:{fontSize:"14px",color:"#4A5568",lineHeight:"1.8"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Date:"})," ",new Date(a.invoiceDate).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),a.eventLocation&&e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Lieu:"})," ",a.eventLocation]})]})]})]}),e.jsxs("div",{style:{marginBottom:"24px",background:"#FEF2F2",padding:"12px",border:"1px solid #EF4444",fontSize:"11px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px",color:"#B91C1C",fontSize:"12px"},children:"⚖️ INFORMATION LÉGALE - ARTICLE L224-59"}),e.jsx("div",{style:{lineHeight:"1.4",color:"#2D3748",fontStyle:"italic"},children:"« Avant la conclusion de tout contrat entre un consommateur et un professionnel à l'occasion d'une foire, d'un salon [...] le professionnel informe le consommateur qu'il ne dispose pas d'un délai de rétractation. »"})]}),e.jsxs("div",{style:{marginBottom:"24px",background:"#F2EFE2",padding:"20px",border:"2px solid #E2E8F0"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 20px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"👤 INFORMATIONS CLIENT"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",fontSize:"14px"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Nom:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientName})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Adresse:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientAddress})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Code postal:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientPostalCode})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Ville:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientCity})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Code porte:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientDoorCode||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Email:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientEmail})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Téléphone:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientPhone})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{background:"#F2EFE2",padding:"20px",border:"2px solid #E2E8F0"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"💳 MODE DE RÈGLEMENT"}),e.jsx("div",{style:{fontSize:"14px",color:"#2D3748"},children:a.paymentMethod||"Non spécifié"})]}),e.jsxs("div",{style:{background:"#F2EFE2",padding:"20px",border:"2px solid #E2E8F0"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"🚚 LIVRAISON"}),e.jsx("div",{style:{fontSize:"14px",color:"#2D3748",marginBottom:"8px"},children:a.deliveryMethod||"Non spécifié"}),e.jsx("div",{style:{fontSize:"12px",color:"#6B7280",fontStyle:"italic"},children:"Livraison réalisée au pied de l'immeuble ou au portail"})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",margin:"0 0 16px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"🛏️ PRODUITS & TARIFICATION"}),e.jsx("div",{style:{overflow:"hidden",border:"2px solid #E2E8F0"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#477A0C",color:"white"},children:[e.jsx("th",{style:{padding:"16px",textAlign:"left",fontWeight:"bold"},children:"Produit"}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"bold"},children:"Emporté"}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"bold"},children:"Qté"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"bold"},children:"Prix unitaire"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"bold"},children:"Remise"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"bold"},children:"Total TTC"})]})}),e.jsx("tbody",{children:a.products.map((d,h)=>{const c=q(d.quantity,d.priceTTC,d.discount,d.discountType==="percent"?"percent":"fixed");return e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",background:h%2===0?"#F8FAFC":"white"},children:[e.jsxs("td",{style:{padding:"16px"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"4px"},children:d.name}),d.category&&e.jsx("div",{style:{fontSize:"12px",color:"#6B7280"},children:d.category})]}),e.jsx("td",{style:{padding:"16px",textAlign:"center",fontWeight:"500"},children:e.jsx("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"12px",background:d.isPickupOnSite?"#4ADE80":"#EF4444",color:"white",fontWeight:"bold"},children:d.isPickupOnSite?"📦 Emporté":"🚛 À livrer"})}),e.jsx("td",{style:{padding:"16px",textAlign:"center",fontWeight:"500"},children:d.quantity}),e.jsx("td",{style:{padding:"16px",textAlign:"right"},children:k(d.priceTTC)}),e.jsx("td",{style:{padding:"16px",textAlign:"right"},children:d.discount>0?e.jsxs("span",{style:{color:"#dc2626"},children:["-",d.discount,d.discountType==="percent"?"%":"€"]}):"-"}),e.jsx("td",{style:{padding:"16px",textAlign:"right",fontWeight:"600"},children:k(c)})]},h)})})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"24px",marginBottom:"24px",alignItems:"flex-start"},children:[a.signature&&e.jsxs("div",{style:{background:"#F0FDF4",padding:"24px",border:"2px solid #22C55E"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 16px 0",color:"#15803D",display:"flex",alignItems:"center",gap:"8px"},children:"✍️ SIGNATURE CLIENT"}),e.jsx("div",{style:{background:"white",padding:"16px",borderRadius:"4px",border:"1px solid #22c55e",textAlign:"center",minHeight:"80px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("img",{src:a.signature,alt:"Signature électronique",style:{maxHeight:"60px",maxWidth:"200px"}})}),e.jsx("div",{style:{textAlign:"center",marginTop:"12px",fontSize:"14px",color:"#15803d",fontWeight:"500"},children:"✓ Signature électronique enregistrée"})]}),e.jsxs("div",{style:{minWidth:"320px",background:"white",border:"2px solid #E2E8F0",overflow:"hidden"},children:[m>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9"},children:[e.jsx("span",{children:"Sous-total:"}),e.jsx("span",{children:k(r+m)})]}),m>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9",color:"#dc2626"},children:[e.jsx("span",{children:"Remise totale:"}),e.jsxs("span",{children:["-",k(m)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9"},children:[e.jsx("span",{children:"Total HT:"}),e.jsx("span",{children:k(i)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("span",{children:["TVA (",a.taxRate,"%):"]}),e.jsx("span",{children:k(l)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"16px 20px",fontSize:"18px",fontWeight:"bold",background:"#477A0C",color:"white"},children:[e.jsx("span",{children:"TOTAL TTC:"}),e.jsx("span",{children:k(r)})]}),n>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9",background:"#fef3c7"},children:[e.jsx("span",{children:"Acompte versé:"}),e.jsxs("span",{children:["-",k(n)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"16px 20px",fontSize:"16px",fontWeight:"600",background:"#F55D3E",color:"#2D3748"},children:[e.jsx("span",{children:"MONTANT RESTANT:"}),e.jsx("span",{children:k(o)})]})]})]})]}),a.invoiceNotes&&e.jsxs("div",{style:{background:"#FFFBEB",padding:"16px",border:"2px solid #F59E0B",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#92400E",display:"flex",alignItems:"center",gap:"8px"},children:"📝 NOTES"}),e.jsx("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#2D3748"},children:a.invoiceNotes})]}),e.jsxs("div",{style:{background:"#F2EFE2",padding:"16px",border:"2px solid #477A0C",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#477A0C",display:"flex",alignItems:"center",gap:"8px"},children:"💰 RÈGLEMENTS ET MODE DE PAIEMENT"}),e.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#14281D"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Adresse pour règlements :"})," SAV MYCONFORT • 8 rue du Grégal • 66510 Saint-Hippolyte"]}),a.paymentMethod&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("strong",{children:"Mode de règlement :"})," ",a.paymentMethod]}),a.nombreChequesAVenir&&a.nombreChequesAVenir>0&&e.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"white",borderRadius:"6px",border:"2px solid #477A0C"},children:[e.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#477A0C",marginBottom:"8px",textAlign:"center"},children:["📅 ",a.nombreChequesAVenir," chèque",a.nombreChequesAVenir>1?"s":""," à venir"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"12px",fontSize:"13px"},children:[e.jsxs("div",{style:{padding:"8px",background:"#F2EFE2",borderRadius:"4px",border:"1px solid #477A0C"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#477A0C"},children:"💰 Acompte versé"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#14281D"},children:k(n)}),e.jsxs("div",{style:{fontSize:"11px",color:"#477A0C"},children:["(",(n/r*100).toFixed(1),"% du total)"]})]}),e.jsxs("div",{style:{padding:"8px",background:"#F2EFE2",borderRadius:"4px",border:"1px solid #477A0C"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#477A0C"},children:"📋 Reste à percevoir"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#14281D"},children:k(o)}),e.jsxs("div",{style:{fontSize:"11px",color:"#477A0C"},children:["Réparti sur ",a.nombreChequesAVenir," chèque",a.nombreChequesAVenir>1?"s":""]})]})]}),e.jsxs("div",{style:{marginTop:"12px",padding:"10px",background:"#477A0C",borderRadius:"4px",color:"white",textAlign:"center"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px"},children:"💳 Montant par chèque"}),e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",marginTop:"4px"},children:k(o/a.nombreChequesAVenir)}),e.jsxs("div",{style:{fontSize:"11px",marginTop:"2px",opacity:.9},children:[k(o)," ÷"," ",a.nombreChequesAVenir," ="," ",k(o/a.nombreChequesAVenir)," ","par chèque"]})]})]})]})]}),e.jsxs("div",{style:{background:"#F8FAFC",padding:"16px",border:"2px solid #E2E8F0",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 16px 0",color:"#2D3748"},children:"📋 CONDITIONS GÉNÉRALES"}),e.jsx(Is,{})]})]}),e.jsxs("footer",{style:{background:"#477A0C",color:"white",padding:"32px 40px",textAlign:"center"},children:[e.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",margin:"0 0 12px 0",letterSpacing:"-0.025em"},children:"MYCONFORT"}),e.jsx("p",{style:{fontSize:"16px",margin:"0 0 16px 0",opacity:.9},children:"Merci pour votre confiance !"}),e.jsxs("div",{style:{fontSize:"14px",opacity:.8,lineHeight:"1.6"},children:[e.jsx("div",{style:{marginBottom:"4px"},children:"Votre spécialiste en matelas et literie de qualité"}),e.jsx("div",{style:{marginBottom:"4px"},children:"88 Avenue des Ternes, 75017 Paris - Tél: 04 68 50 41 45"}),e.jsx("div",{children:"Email: myconfort@gmail.com - SIRET: 824 313 530 00027"})]})]})]})})});Qe.displayName="InvoicePreviewModern";class Os{static async printInvoice(t){try{const s=window.open("","_blank");if(!s){alert("Impossible d'ouvrir la fenêtre d'impression. Veuillez autoriser les pop-ups.");return}const r=this.generateCompactPrint(t);s.document.write(r),s.document.close(),s.onload=()=>{setTimeout(()=>{s.print(),setTimeout(()=>{s.close()},1e3)},500)}}catch(s){console.error("Erreur impression:",s),alert("Erreur lors de l'impression de la facture")}}static generateCompactPrint(t){const s=t.products.map(r=>{const n=q(r.quantity,r.priceTTC,r.discount,r.discountType),o=r.discount>0?r.discountType==="percent"?`-${r.discount}%`:`-${k(r.discount)}`:"";return`
        <tr>
          <td>${r.name}</td>
          <td style="text-align: center;">${r.quantity}</td>
          <td style="text-align: right;">${k(r.priceTTC)}</td>
          <td style="text-align: center;">${o||"-"}</td>
          <td style="text-align: right; font-weight: bold;">${k(n)}</td>
        </tr>
      `}).join("");return`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Facture ${t.invoiceNumber}</title>
        <meta charset="UTF-8">
        <style>
          @page {
            size: A4;
            margin: 10mm;
          }
          
          * {
            box-sizing: border-box;
          }
          
          body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 0; 
            background: white; 
            font-size: 11px;
            line-height: 1.2;
            color: #000;
          }
          
          .invoice-page {
            width: 100%;
            max-width: none;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
          }

          /* En-tête compact */
          .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #477A0C;
            flex-shrink: 0;
          }

          .company-info {
            flex: 1;
          }

          .company-name {
            font-size: 22px;
            font-weight: bold;
            color: #477A0C;
            margin-bottom: 6px;
          }

          .company-details {
            font-size: 12px;
            color: #000;
            line-height: 1.3;
          }

          .invoice-info {
            text-align: right;
            flex: 1;
          }

          .invoice-title {
            background: #477A0C;
            color: white;
            margin: 0;
            padding: 12px 16px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 4px;
          }

          .invoice-number {
            color: #000;
            margin-top: 8px;
            font-weight: bold;
            font-size: 14px;
          }

          /* Section client compact */
          .client-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            margin-top: 18px;
          }

          .client-info {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #477A0C;
            flex: 1;
            margin-right: 10px;
          }

          .client-info h3 {
            margin: 0 0 6px 0;
            color: #000;
            font-size: 14px;
            font-weight: bold;
          }

          .delivery-info {
            background: #e8f5e8;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #28a745;
            flex: 1;
          }

          .delivery-info h3 {
            margin: 0 0 6px 0;
            color: #000;
            font-size: 14px;
            font-weight: bold;
          }

          /* Tableau compact */
          .table-container {
            flex-grow: 1;
            margin: 12px 0;
            min-height: 200px;
          }

          table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
            font-size: 12px;
          }

          th {
            background: #477A0C;
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 12px;
          }

          td {
            padding: 6px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
            color: #000;
          }

          td:first-child {
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            color: #000;
          }

          tr:nth-child(even) {
            background-color: #f9f9f9;
          }

          /* Totaux et paiement en ligne - OPTIMISÉ */
          .footer-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 8px;
            gap: 8px;
            flex-shrink: 0;
          }

          .totals-section {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            min-width: 180px;
          }

          .totals-section h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 12px;
            font-weight: bold;
          }

          .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
            font-size: 10px;
            color: #000;
          }

          .total-final {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 12px;
            color: #000;
            border-top: 1px solid #477A0C;
            padding-top: 2px;
            margin-top: 2px;
          }

          .payment-signature {
            flex: 1;
            display: flex;
            gap: 8px;
          }

          .payment-info, .signature-section {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            flex: 1;
          }

          .payment-info h3, .signature-section h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 12px;
            font-weight: bold;
          }

          .signature-box {
            border: 1px dashed #ccc;
            min-height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 9px;
            margin-top: 4px;
            position: relative;
            overflow: hidden;
          }
          
          .signature-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 3px;
          }
          
          .signature-text {
            color: #666;
            font-style: italic;
            font-size: 9px;
          }
          }

          /* Styles RIB pour virement bancaire */
          .rib-section {
            margin-top: 8px;
            padding: 6px;
            background: #e1f5fe;
            border: 1px solid #2563eb;
            border-radius: 4px;
          }

          .rib-info {
            font-size: 9px;
            line-height: 1.3;
            color: #000;
          }

          /* Notes compactes */
          .notes-compact {
            margin-top: 8px;
            font-size: 8px;
            color: #666;
            text-align: center;
            border-top: 1px solid #eee;
            padding-top: 6px;
            margin-bottom: 8px;
          }

          /* Information légale - COMPACTE */
          .legal-info {
            margin-top: 8px;
            font-size: 10px;
            color: #000;
            text-align: center;
            border: 1px solid #477A0C;
            background: #f8f9fa;
            padding: 6px;
            border-radius: 4px;
            margin-bottom: 8px;
          }

          .legal-info h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 11px;
            font-weight: bold;
          }

          .legal-info p {
            margin: 0;
            font-weight: bold;
            line-height: 1.2;
          }

          /* Espace flexible pour expansion tableau - RÉDUIT */
          .flexible-space {
            flex-grow: 1;
            min-height: 5px;
          }

          /* Footer légal - COMPACT */
          .footer-legal {
            margin-top: 4px;
            border-top: 1px solid #477A0C;
            padding-top: 4px;
            font-size: 7px;
            background: #f8f9fa;
            padding: 4px;
            border-radius: 4px;
            flex-shrink: 0;
          }

          .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
          }

          .footer-left {
            flex: 1;
          }

          .footer-left p {
            margin: 0 0 2px 0;
            line-height: 1.1;
            text-align: justify;
          }

          /* Footer final - COMPACT */
          .final-footer {
            margin-top: 4px;
            padding-top: 2px;
            border-top: 1px solid #477A0C;
            font-size: 6px;
            text-align: center;
            color: #000;
            flex-shrink: 0;
          }

          .final-footer p {
            margin: 0;
            line-height: 1.1;
          }

          /* Statuts de livraison */
          .delivery-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            color: white;
          }

          .status-emporte { background-color: #28a745; }
          .status-a-livrer { background-color: #ffc107; color: #000; }

          /* Conditions Générales de Vente - COMPACTES */
          .cgv-section {
            margin-top: auto;
            border-top: 1px solid #477A0C;
            padding-top: 4px;
            flex-shrink: 0;
          }

          .cgv-section h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 8px;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
          }

          .cgv-content {
            display: flex;
            gap: 8px;
            font-size: 6px;
            line-height: 1.0;
            color: #000;
          }

          .cgv-column {
            flex: 1;
          }

          .cgv-content p {
            margin: 0 0 2px 0;
            text-align: justify;
            color: #000;
          }

          .cgv-content strong {
            color: #000;
            font-size: 6.5px;
          }

          @media print {
            body { margin: 0; padding: 0; }
            .invoice-page { height: auto; min-height: 0; }
            @page { margin: 12mm; }
          }
        </style>
      </head>
      <body>
        <div class="invoice-page">
          <!-- En-tête -->
          <div class="header">
            <div class="company-info">
              <div class="company-name">MYCONFORT</div>
              <div class="company-details">
                88 Avenue des Ternes, 75017 Paris<br>
                SIRET: 824 313 530 00027<br>
                Tél: 04 68 50 41 45 | Email: myconfort@gmail.com
              </div>
            </div>
            <div class="invoice-info">
              <h1 class="invoice-title">FACTURE</h1>
              <div class="invoice-number">
                N° ${t.invoiceNumber}<br>
                Date: ${new Date(t.invoiceDate).toLocaleDateString("fr-FR")}
              </div>
            </div>
          </div>

          <!-- Section client et livraison -->
          <div class="client-section">
            <div class="client-info">
              <h3>FACTURÉ À :</h3>
              <strong>${t.clientName}</strong><br>
              ${t.clientAddress}<br>
              ${t.clientPostalCode} ${t.clientCity}<br>
              Tél: ${t.clientPhone}<br>
              Email: ${t.clientEmail}
            </div>
            <div class="delivery-info">
              <h3>LIVRAISON :</h3>
              Mode: Livraison par transporteur France Express CXI<br>
              ${t.deliveryNotes?`Notes: ${t.deliveryNotes}`:""}
            </div>
          </div>

          <!-- Tableau des produits -->
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th style="width: 60%;">Désignation</th>
                  <th style="width: 8%; text-align: center;">Qté</th>
                  <th style="width: 12%; text-align: right;">Prix Unit.</th>
                  <th style="width: 8%; text-align: center;">Remise</th>
                  <th style="width: 12%; text-align: right;">Total</th>
                </tr>
              </thead>
              <tbody>
                ${s}
              </tbody>
            </table>
          </div>

          <!-- Footer avec totaux, paiement et signature -->
          <div class="footer-section">
            <div class="payment-signature">
              <div class="payment-info">
                <h3>PAIEMENT</h3>
                <div>Mode: ${t.paymentMethod}</div>
                ${t.montantAcompte>0?`<div>Acompte: ${k(t.montantAcompte)}</div>`:""}
                ${t.montantRestant>0?`<div><strong>Reste à payer: ${k(t.montantRestant)}</strong></div>`:""}
                
                ${t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`
                <!-- RIB pour Virement Bancaire -->
                <div class="rib-section">
                  <h4 style="margin: 8px 0 4px 0; font-size: 11px; font-weight: bold; color: #2563eb;">COORDONNÉES BANCAIRES</h4>
                  <div class="rib-info">
                    <div style="font-size: 9px; line-height: 1.3;">
                      <div><strong>Bénéficiaire:</strong> MYCONFORT</div>
                      <div><strong>IBAN:</strong> FR76 1660 7000 1708 1216 3980 964</div>
                      <div><strong>BIC:</strong> CCBPFRPPPPG</div>
                      <div><strong>Banque:</strong> Banque Populaire du Sud</div>
                      <div style="margin-top: 4px; font-style: italic; color: #666;">
                        Merci d'indiquer le numéro de facture en référence
                      </div>
                    </div>
                  </div>
                </div>
                `:""}
              </div>
              <div class="signature-section">
                <h3>SIGNATURE CLIENT</h3>
                <div class="signature-box">
                  ${t.signature&&t.signature.trim()!==""?`<img src="${t.signature}" alt="Signature client" class="signature-image" />`:'<span class="signature-text">Signature requise</span>'}
                </div>
              </div>
            </div>
            
            <div class="totals-section">
              <h3>TOTAUX</h3>
              <div class="total-line">
                <span>Total HT:</span>
                <span>${k(t.montantHT)}</span>
              </div>
              <div class="total-line">
                <span>TVA (${t.taxRate}%):</span>
                <span>${k(t.montantTVA)}</span>
              </div>
              <div class="total-final">
                <span>TOTAL TTC:</span>
                <span>${k(t.montantTTC)}</span>
              </div>
            </div>
          </div>

          <!-- Information légale -->
          <div class="legal-info">
            <h3>⚖️ INFORMATION LÉGALE - ARTICLE L224-59</h3>
            <p><strong>« Avant la conclusion de tout contrat entre un consommateur et un professionnel à l'occasion d'une foire, d'un salon [...] le professionnel informe le consommateur qu'il ne dispose pas d'un délai de rétractation. »</strong></p>
          </div>

          <!-- Espace flexible pour expansion tableau -->
          <div class="flexible-space"></div>

          <!-- Footer légal -->
          <div class="footer-legal">
            <div class="footer-content">
              <div class="footer-left">
                <p><strong>✅ Conditions générales acceptées</strong></p>
                <p><strong>RETARD DE PAIEMENT :</strong> Toute somme non payée à l'échéance porte de plein droit intérêt à au moins 4 fois le taux d'intérêt légal. Une indemnité forfaitaire de 40 € pour frais de recouvrement sera due en cas de retard de paiement (article L441-3 du Code du commerce).</p>
              </div>
            </div>
          </div>

          <!-- Conditions Générales de Vente -->
          <div class="cgv-section">
            <h3>CONDITIONS GÉNÉRALES DE VENTE</h3>
            <div class="cgv-content">
              <div class="cgv-column">
                <p><strong>Art. 1 - Livraison</strong><br>
                Une fois la commande expédiée, vous serez contacté par SMS ou mail pour programmer la livraison. Le transporteur livre au pas de porte. Vérifiez les dimensions pour le passage. Aucun service d'installation prévu.</p>
                
                <p><strong>Art. 2 - Délais de Livraison</strong><br>
                Délais indicatifs, pas d'engagement ferme. En cas de retard, aucune indemnité. Déclinons toute responsabilité en cas de force majeure.</p>
                
                <p><strong>Art. 3 - Risques de Transport</strong><br>
                Marchandises aux risques du destinataire. Réserves obligatoires sur bordereau transporteur en cas d'avarie.</p>
                
                <p><strong>Art. 4 - Acceptation</strong><br>
                Livraison implique acceptation des conditions. Transporteur livre sans monter étages. Client responsable vérification.</p>
                
                <p><strong>Art. 5 - Réclamations</strong><br>
                Réclamations qualité par écrit sous 8 jours, lettre recommandée avec AR.</p>
                
                <p><strong>Art. 6 - Retours</strong><br>
                Aucun retour sans accord écrit préalable. Accord n'implique aucune reconnaissance.</p>
                
                <p><strong>Art. 7 - Tailles Matelas</strong><br>
                Dimensions +/- 5 cm possibles (thermosensibilité mousses). Tailles indicatives. Matelas sur mesure : spécifications exactes requises.</p>
                
                <p><strong>Art. 8 - Odeur Matériaux</strong><br>
                Mousses naturelles peuvent émettre légère odeur qui disparaît. Ne constitue pas défaut.</p>
              </div>
              
              <div class="cgv-column">
                <p><strong>Art. 9 - Règlements</strong><br>
                Sauf accord express, aucun rabais pour paiement comptant. Garantie mousses, pas textiles/accessoires.</p>
                
                <p><strong>Art. 10 - Paiement</strong><br>
                Factures payables par chèque, virement, carte bancaire ou espèce à réception.</p>
                
                <p><strong>Art. 11 - Pénalités Retard</strong><br>
                Non-paiement : majoration 10% min. 300€, intérêts de retard. Droit de résiliation sans sommation.</p>
                
                <p><strong>Art. 12 - Exigibilité</strong><br>
                Non-paiement échéance rend exigible solde toutes échéances à venir.</p>
                
                <p><strong>Art. 13 - Livraison Non-Conforme</strong><br>
                Livraison endommagée : mentionner sur bon, refuser produit. Erreur constatée après : contact sous 72h ouvrables.</p>
                
                <p><strong>Art. 14 - Litiges</strong><br>
                Compétence exclusive Tribunal Commerce Perpignan ou tribunal du prestataire.</p>
                
                <p><strong>Art. 15 - Horaires Livraison</strong><br>
                Lundi-vendredi hors fériés. Personne majeure présente obligatoire. Modification adresse : myconfort66@gmail.com.</p>
              </div>
            </div>
          </div>

          <!-- Footer final - Réserve de propriété -->
          <div class="final-footer">
            <p><strong>RÉSERVE DE PROPRIÉTÉ :</strong> Toutes nos marchandises restent propriété jusqu'au paiement complet du prix convenu. Dès l'expédition, l'acheteur restera gardien des dites marchandises et assumera le risque de conservation.</p>
          </div>
        </div>
      </body>
      </html>
    `}}const Ms=({isOpen:a,onClose:t,invoice:s})=>{if(!a)return null;const r=async()=>{try{await Os.printInvoice(s)}catch(n){console.error("Erreur impression:",n),alert("Erreur lors de l'impression de la facture")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[95vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:t,className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded flex items-center space-x-2",title:"Retour",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Retour"})]}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Aperçu - ",s.invoiceNumber]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:r,className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm flex items-center space-x-1",title:"Imprimer",children:[e.jsx(Et,{className:"w-4 h-4"}),e.jsx("span",{children:"Imprimer"})]}),e.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 rounded",title:"Fermer",children:e.jsx(fe,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"overflow-auto max-h-[calc(95vh-80px)] p-6 bg-gray-50",children:e.jsx(Qe,{invoice:s})})]})})},qs=({isOpen:a,onClose:t,invoices:s,onDeleteInvoice:r,onLoadInvoice:n})=>{const[o,i]=f.useState(""),[l,m]=f.useState("date"),[d,h]=f.useState("desc"),[c,x]=f.useState("all"),[g,N]=f.useState(null),[p,u]=f.useState(!1),v=Ve.useMemo(()=>s.filter(w=>{const F=w.invoiceNumber.toLowerCase().includes(o.toLowerCase())||w.clientName.toLowerCase().includes(o.toLowerCase())||w.clientEmail.toLowerCase().includes(o.toLowerCase())||w.eventLocation&&w.eventLocation.toLowerCase().includes(o.toLowerCase()),D=c==="all"||c==="signed"&&w.signature||c==="unsigned"&&!w.signature;return F&&D}).sort((w,F)=>{let D=0;switch(l){case"date":D=new Date(w.invoiceDate).getTime()-new Date(F.invoiceDate).getTime();break;case"number":D=w.invoiceNumber.localeCompare(F.invoiceNumber);break;case"client":D=w.clientName.localeCompare(F.clientName);break;case"amount":const T=w.products.reduce((_,U)=>_+q(U.quantity,U.priceTTC,U.discount,U.discountType),0),O=F.products.reduce((_,U)=>_+q(U.quantity,U.priceTTC,U.discount,U.discountType),0);D=T-O;break;case"eventLocation":const z=w.eventLocation||"",L=F.eventLocation||"";D=z.localeCompare(L);break}return d==="asc"?D:-D}),[s,o,l,d,c]),y=P=>{N(P),u(!0)},S=(P,w)=>{window.confirm(`Êtes-vous sûr de vouloir supprimer la facture ${w.invoiceNumber} ?

Cette action est irréversible.`)&&r(P)},b=P=>{window.confirm(`Charger la facture ${P.invoiceNumber} ?

Les données actuelles seront remplacées par cette facture.`)&&(n(P),t())},j=P=>P.products.reduce((w,F)=>w+q(F.quantity,F.priceTTC,F.discount,F.discountType),0);return a?e.jsxs(e.Fragment,{children:[e.jsx(je,{isOpen:a,onClose:t,title:"📋 Toutes les Factures MYCONFORT",maxWidth:"max-w-7xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Rechercher facture, client, lieu...",value:o,onChange:P=>i(P.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold"})]}),e.jsxs("select",{value:l,onChange:P=>m(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold",children:[e.jsx("option",{value:"date",children:"Trier par date"}),e.jsx("option",{value:"number",children:"Trier par numéro"}),e.jsx("option",{value:"client",children:"Trier par client"}),e.jsx("option",{value:"amount",children:"Trier par montant"}),e.jsx("option",{value:"eventLocation",children:"Trier par lieu d'événement"})]}),e.jsxs("select",{value:d,onChange:P=>h(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold",children:[e.jsx("option",{value:"desc",children:"Décroissant"}),e.jsx("option",{value:"asc",children:"Croissant"})]}),e.jsxs("select",{value:c,onChange:P=>x(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold",children:[e.jsx("option",{value:"all",children:"Toutes les factures"}),e.jsx("option",{value:"signed",children:"Factures signées"}),e.jsx("option",{value:"unsigned",children:"En attente de signature"})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse bg-white rounded-lg overflow-hidden shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#477A0C] text-[#F2EFE2]",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"N° Facture"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Date"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Client"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Email"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Lieu d'événement"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-right font-bold",children:"Montant TTC"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-bold",children:"Statut"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-bold",children:"Email"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-bold",children:"Actions"})]})}),e.jsxs("tbody",{children:[v.map((P,w)=>{const F=j(P),D=s.findIndex(T=>T.invoiceNumber===P.invoiceNumber&&T.invoiceDate===P.invoiceDate);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"border border-gray-300 px-4 py-3",children:[e.jsx("div",{className:"font-bold text-[#477A0C]",children:P.invoiceNumber}),P.products.length>0&&e.jsxs("div",{className:"text-xs text-gray-600 font-semibold",children:[P.products.length," produit",P.products.length>1?"s":""]})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ss,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-black font-semibold",children:new Date(P.invoiceDate).toLocaleDateString("fr-FR")})]})}),e.jsxs("td",{className:"border border-gray-300 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Le,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-bold text-black",children:P.clientName})]}),P.clientCity&&e.jsx("div",{className:"text-xs text-gray-600 font-semibold",children:P.clientCity})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ft,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-black font-semibold",children:P.clientEmail})]})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(kt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-black font-semibold",children:P.eventLocation||e.jsx("span",{className:"text-gray-400 italic",children:"Non spécifié"})})]})}),e.jsxs("td",{className:"border border-gray-300 px-4 py-3 text-right",children:[e.jsx("div",{className:"font-bold text-lg text-[#477A0C]",children:k(F)}),P.montantAcompte>0&&e.jsxs("div",{className:"text-xs text-orange-600 font-bold",children:["Acompte: ",k(P.montantAcompte)]})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:P.signature?e.jsxs("div",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold flex items-center justify-center space-x-1",children:[e.jsx("span",{children:"🔒"}),e.jsx("span",{children:"Signée"})]}):e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-semibold",children:"En attente"})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:P.emailSent?e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:"text-2xl",title:"Email envoyé avec succès",children:"✅"}),P.emailSentDate&&e.jsx("span",{className:"text-xs text-green-600 font-semibold",children:new Date(P.emailSentDate).toLocaleDateString("fr-FR")})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-2xl",title:"Email non envoyé",children:"❌"}),e.jsx("span",{className:"text-xs text-red-600 font-semibold",children:"Non envoyé"})]})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-blue-600 font-medium mb-1",children:"Voir"}),e.jsx("button",{onClick:()=>y(P),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded transition-all",title:"Aperçu de la facture",children:e.jsx(at,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-purple-600 font-medium mb-1",children:"Charger"}),e.jsx("button",{onClick:()=>b(P),className:"bg-purple-500 hover:bg-purple-600 text-white p-2 rounded transition-all",title:"Charger cette facture pour modification",children:e.jsx(St,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-red-600 font-medium mb-1",children:"Supprimer"}),e.jsx("button",{onClick:()=>S(D,P),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded transition-all",title:"Supprimer cette facture",children:e.jsx(Re,{className:"w-4 h-4"})})]})]})})]},`${P.invoiceNumber}-${w}`)}),v.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"border border-gray-300 px-4 py-8 text-center",children:o||c!=="all"?e.jsxs("div",{children:[e.jsx(rs,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-black font-bold",children:"Aucune facture ne correspond aux critères de recherche"})]}):e.jsxs("div",{children:[e.jsx(me,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-black font-bold",children:"Aucune facture enregistrée"}),e.jsx("p",{className:"text-sm mt-1 text-gray-600 font-semibold",children:"Les factures seront automatiquement sauvegardées"})]})})})]})]})}),v.length>0&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"text-sm text-black font-bold",children:[e.jsx("strong",{children:v.length})," facture",v.length>1?"s":""," affichée",v.length>1?"s":"",o&&` pour "${o}"`,c!=="all"&&` (${c==="signed"?"signées":"en attente"})`]})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:t,className:"bg-[#477A0C] hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-bold shadow-lg transition-all hover:scale-105",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Retour"})]})})]})}),g&&e.jsx(Ms,{isOpen:p,onClose:()=>{u(!1),N(null)},invoice:g})]}):null},zs=({isOpen:a,onClose:t})=>{const[s,r]=f.useState(Se),[n,o]=f.useState(""),[i,l]=f.useState(""),[m,d]=f.useState(null),[h,c]=f.useState(!1),[x,g]=f.useState({category:"",name:"",priceTTC:0,autoCalculateHT:!0}),N=Ve.useMemo(()=>s.filter(j=>{const P=j.name.toLowerCase().includes(n.toLowerCase())||j.category.toLowerCase().includes(n.toLowerCase()),w=i===""||j.category===i;return P&&w}),[s,n,i]),p=Ve.useMemo(()=>{const j={};return N.forEach(P=>{j[P.category]||(j[P.category]=[]),j[P.category].push(P)}),j},[N]),u=()=>{if(!x.name||!x.category||x.priceTTC<=0){alert("Veuillez remplir tous les champs obligatoires");return}const j=[...s,{...x}];r(j),g({category:"",name:"",priceTTC:0,autoCalculateHT:!0}),c(!1)},v=(j,P)=>{const w=[...s];w[j]=P,r(w),d(null)},y=j=>{const P=s[j];if(window.confirm(`Êtes-vous sûr de vouloir supprimer "${P.name}" ?`)){const w=s.filter((F,D)=>D!==j);r(w)}},S=j=>{d(j)},b=()=>{d(null)};return a?e.jsxs(je,{isOpen:a,onClose:t,title:"",maxWidth:"max-w-6xl",children:[e.jsx("div",{className:"flex justify-between items-center mb-6 pb-4 border-b-2 border-[#477A0C]",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:t,className:"bg-[#477A0C] hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-bold shadow-lg transition-all hover:scale-105",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Retour"})]}),e.jsxs("h3",{className:"text-2xl font-bold text-[#477A0C] flex items-center space-x-2",children:[e.jsx(be,{className:"w-6 h-6"}),e.jsx("span",{children:"Gestion des Produits MYCONFORT"})]})]})}),e.jsxs("div",{className:"space-y-6",style:{backgroundColor:"#F2EFE2",color:"#000000"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 rounded-lg",style:{backgroundColor:"#F2EFE2"},children:[e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Total Produits"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1 text-black",children:s.length})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Catégories"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1 text-black",children:Ee.length})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(nt,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Prix Moyen"})]}),e.jsx("div",{className:"text-lg font-bold mt-1 text-black",children:k(s.reduce((j,P)=>j+P.priceTTC,0)/s.length||0)})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(be,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Matelas"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1 text-black",children:s.filter(j=>j.category==="Matelas").length})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Pt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-black w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:n,onChange:j=>o(j.target.value),className:"w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-black bg-white"})]}),e.jsxs("select",{value:i,onChange:j=>l(j.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-black bg-white",children:[e.jsx("option",{value:"",children:"Toutes les catégories"}),Ee.map(j=>e.jsx("option",{value:j,children:j},j))]}),e.jsxs("button",{onClick:()=>c(!h),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-bold transition-all",children:[e.jsx(He,{className:"w-4 h-4"}),e.jsx("span",{children:"Ajouter un produit"})]})]})}),h&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border-2 border-green-300",children:[e.jsxs("h3",{className:"text-lg font-bold text-black mb-4 flex items-center space-x-2",children:[e.jsx(He,{className:"w-5 h-5"}),e.jsx("span",{children:"Ajouter un nouveau produit"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Catégorie*"}),e.jsxs("select",{value:x.category,onChange:j=>g({...x,category:j.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-3 py-2 text-black bg-white focus:border-blue-500",children:[e.jsx("option",{value:"",children:"Sélectionner"}),Ee.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Nom du produit*"}),e.jsx("input",{type:"text",value:x.name,onChange:j=>g({...x,name:j.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-3 py-2 text-black bg-white focus:border-blue-500",placeholder:"Ex: MATELAS BAMBOU 140 x 190"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Prix TTC*"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:x.priceTTC,onChange:j=>g({...x,priceTTC:parseFloat(j.target.value)||0}),className:"w-full border-2 border-gray-300 rounded-lg px-3 py-2 text-black bg-white focus:border-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:x.autoCalculateHT||!1,onChange:j=>g({...x,autoCalculateHT:j.target.checked}),className:"form-checkbox h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-black font-semibold",children:"Calcul automatique HT"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:u,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-1 font-bold",children:[e.jsx(Dt,{className:"w-4 h-4"}),e.jsx("span",{children:"Ajouter"})]}),e.jsx("button",{onClick:()=>c(!1),className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-bold",children:"Annuler"})]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.keys(p).length===0?e.jsxs("div",{className:"bg-white p-8 rounded-lg border-2 border-gray-300 text-center",children:[e.jsx(be,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-black font-bold",children:"Aucun produit trouvé"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Modifiez vos critères de recherche ou ajoutez un nouveau produit"})]}):Object.entries(p).map(([j,P])=>e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-300 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-100 px-4 py-3 border-b border-gray-300",children:e.jsxs("h3",{className:"text-lg font-bold text-black flex items-center space-x-2",children:[e.jsx(xt,{className:"w-5 h-5"}),e.jsx("span",{children:j}),e.jsx("span",{className:"bg-blue-500 text-white px-2 py-1 rounded-full text-xs",children:P.length})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-300",children:[e.jsx("th",{className:"px-4 py-3 text-left font-bold text-black",children:"Nom du produit"}),e.jsx("th",{className:"px-4 py-3 text-right font-bold text-black",children:"Prix TTC"}),e.jsx("th",{className:"px-4 py-3 text-center font-bold text-black",children:"Calcul HT"}),e.jsx("th",{className:"px-4 py-3 text-center font-bold text-black",children:"Actions"})]})}),e.jsx("tbody",{children:P.map((w,F)=>{const D=s.findIndex(T=>T.name===w.name&&T.category===w.category);return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:m===D?e.jsx("input",{type:"text",value:w.name,onChange:T=>{const O={...w,name:T.target.value};v(D,O)},className:"w-full border border-gray-300 rounded px-2 py-1 text-black bg-white",onBlur:b,onKeyPress:T=>T.key==="Enter"&&b(),autoFocus:!0}):e.jsx("div",{className:"font-semibold text-black cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>S(D),children:w.name})}),e.jsx("td",{className:"px-4 py-3 text-right",children:m===D?e.jsx("input",{type:"number",step:"0.01",min:"0",value:w.priceTTC,onChange:T=>{const O={...w,priceTTC:parseFloat(T.target.value)||0};v(D,O)},className:"w-24 border border-gray-300 rounded px-2 py-1 text-right text-black bg-white",onBlur:b,onKeyPress:T=>T.key==="Enter"&&b()}):e.jsx("div",{className:"font-bold text-green-600 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>S(D),children:k(w.priceTTC)})}),e.jsx("td",{className:"px-4 py-3 text-center",children:w.autoCalculateHT?e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold",children:"Auto"}):e.jsx("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-semibold",children:"Manuel"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-center space-x-1",children:[e.jsx("button",{onClick:()=>S(D),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded transition-all",title:"Modifier",children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(D),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded transition-all",title:"Supprimer",children:e.jsx(Re,{className:"w-4 h-4"})})]})})]},`${w.category}-${F}`)})})]})})]},j))}),N.length>0&&e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-300",children:e.jsxs("div",{className:"text-sm text-black font-semibold",children:[e.jsx("strong",{children:N.length})," produit",N.length>1?"s":""," affiché",N.length>1?"s":"",n&&` pour "${n}"`,i&&` dans la catégorie "${i}"`]})}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(De,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold",children:"Gestion des produits MYCONFORT"}),e.jsxs("p",{className:"mt-1",children:["• Cliquez sur un nom ou prix pour le modifier directement",e.jsx("br",{}),"• Les modifications sont automatiquement sauvegardées",e.jsx("br",{}),"• Le calcul HT automatique utilise le taux de TVA de la facture",e.jsx("br",{}),"• Les nouveaux produits seront disponibles dans le catalogue"]})]})]})})]})]}):null};class $s{static async printInvoice(t){try{const s=window.open("","_blank");if(!s){alert("Impossible d'ouvrir la fenêtre d'impression. Veuillez autoriser les pop-ups.");return}const r=t.products.reduce((o,i)=>o+q(i.quantity,i.priceTTC,i.discount,i.discountType),0),n=this.generateModernPrint(t,r);s.document.write(n),s.document.close(),s.onload=()=>{setTimeout(()=>{s.print(),setTimeout(()=>{s.close()},1e3)},500)}}catch(s){console.error("Erreur impression:",s),alert("Erreur lors de l'impression de la facture")}}static generateModernPrint(t,s){return`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Facture ${t.invoiceNumber}</title>
        <meta charset="UTF-8">
        <style>
          body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 0; 
            background: white; 
            font-size: 13px;
            line-height: 1.4;
          }
          
          .page {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 15mm;
            box-sizing: border-box;
            page-break-after: always;
          }
          
          .page:last-child {
            page-break-after: avoid;
          }

          .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #477A0C;
          }

          .company-info {
            flex: 1;
          }

          .company-name {
            font-size: 22px;
            font-weight: bold;
            color: #477A0C;
            margin-bottom: 8px;
          }

          .company-details {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
          }

          .invoice-title {
            text-align: right;
            flex: 1;
          }

          .invoice-title h1 {
            background: #477A0C;
            color: white;
            margin: 0;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 8px;
          }

          .invoice-number {
            color: #477A0C;
            margin-top: 8px;
            font-weight: bold;
            font-size: 14px;
          }

          .client-info {
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #477A0C;
          }

          .client-info h3 {
            margin: 0 0 10px 0;
            color: #477A0C;
            font-size: 14px;
            font-weight: bold;
          }

          .table-container {
            margin: 20px 0;
          }

          table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid #ddd;
          }

          th {
            background: #477A0C;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: bold;
            font-size: 12px;
          }

          td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            font-size: 12px;
          }

          tr:nth-child(even) {
            background-color: #f9f9f9;
          }

          .discount-badge {
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
          }

          /* Styles pour les nouvelles sections */
          .payment-method-section, .deposit-section, .notes-section {
            margin-top: 20px;
            padding: 12px 15px;
            border-radius: 6px;
            border-left: 4px solid;
            margin-bottom: 15px;
          }

          .payment-method-section {
            background: #E8F5E8;
            border-left-color: #477A0C;
          }

          .deposit-section {
            background: #FFF4E6;
            border-left-color: #FF8C00;
          }

          .notes-section {
            background: #F0F8FF;
            border-left-color: #4A90E2;
          }

          .section-header {
            font-weight: bold;
            font-size: 12px;
            color: #14281D;
            margin-bottom: 8px;
          }

          .payment-badge {
            font-size: 12px;
            color: #477A0C;
            font-weight: bold;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #477A0C;
            display: inline-block;
          }

          /* Styles RIB pour virement bancaire */
          .rib-section {
            margin-top: 8px;
            padding: 8px;
            background: #e1f5fe;
            border: 1px solid #2563eb;
            border-radius: 4px;
          }

          .rib-header {
            font-size: 11px;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 6px;
          }

          .rib-info {
            font-size: 10px;
            line-height: 1.4;
            color: #000;
          }

          .rib-info div {
            margin-bottom: 2px;
          }

          .deposit-amount {
            font-size: 14px;
            color: #FF8C00;
            font-weight: bold;
          }

          .deposit-percentage {
            font-size: 10px;
            margin-left: 5px;
          }

          .note-item {
            font-size: 11px;
            color: #14281D;
            line-height: 1.4;
            margin-bottom: 8px;
          }

          .note-item:last-child {
            margin-bottom: 0;
          }

          .totals {
            margin-top: 30px;
            text-align: right;
          }

          .total-line {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
          }

          .total-final {
            background: #477A0C;
            color: white;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin-top: 10px;
          }

          .remaining-amount {
            background: #F55D3E;
            color: white;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin-top: 10px;
          }

          .footer-section {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
          }

          .signature-section {
            width: 300px;
            text-align: center;
          }

          .signature-box {
            border: 2px solid #477A0C;
            height: 120px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #f8f9fa;
          }

          .signature-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
          }

          .law-article {
            background: #fff3cd;
            border: 2px solid #dc3545;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 11px;
            color: #721c24;
            text-align: center;
            font-weight: bold;
          }

          .info-section {
            flex: 1;
            margin-right: 20px;
          }

          .info-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #477A0C;
          }

          .info-label {
            font-weight: bold;
            color: #477A0C;
            font-size: 12px;
          }

          .cgv-page {
            page-break-before: always;
          }

          .cgv-title {
            color: #477A0C;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #477A0C;
            padding-bottom: 10px;
          }

          .cgv-content {
            font-size: 11px;
            line-height: 1.5;
            text-align: justify;
          }

          .cgv-section {
            margin-bottom: 15px;
          }

          .cgv-section h4 {
            color: #477A0C;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: bold;
          }

          @media print {
            body { 
              background: white; 
              font-size: 12px;
            }
            
            .page {
              width: auto;
              min-height: auto;
              margin: 0;
              padding: 10mm;
              page-break-after: always;
            }
            
            .page:last-child {
              page-break-after: avoid;
            }
          }
        </style>
      </head>
      <body>
        <!-- PAGE 1: FACTURE -->
        <div class="page">
          <!-- En-tête -->
          <div class="header">
            <div class="company-info">
              <div class="company-name">HT CONFORT</div>
              <div class="company-details">
                Spécialiste climatisation et chauffage<br>
                123 Rue de la Climatisation<br>
                75000 PARIS<br>
                Tél: 01 23 45 67 89<br>
                Email: contact@htconfort.fr<br>
                SIRET: 123 456 789 00012 | TVA: FR12345678901
              </div>
            </div>
            <div class="invoice-title">
              <h1>FACTURE</h1>
              <div class="invoice-number">N° ${t.invoiceNumber}</div>
              <div style="font-size: 12px; color: #666; margin-top: 5px;">
                Date: ${new Date(t.invoiceDate).toLocaleDateString("fr-FR")}
              </div>
            </div>
          </div>

          <!-- Informations client -->
          <div class="client-info">
            <h3>FACTURER À:</h3>
            <strong>${t.clientName}</strong><br>
            ${t.clientAddress}<br>
            ${t.clientPostalCode} ${t.clientCity}<br>
            ${t.clientEmail?`Email: ${t.clientEmail}<br>`:""}
            ${t.clientPhone?`Tél: ${t.clientPhone}<br>`:""}
          </div>

          <!-- Tableau des produits -->
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Désignation</th>
                  <th style="width: 80px;">Qté</th>
                  <th style="width: 100px;">Prix HT</th>
                  <th style="width: 100px;">Prix TTC</th>
                  <th style="width: 80px;">Remise</th>
                  <th style="width: 120px;">Total TTC</th>
                </tr>
              </thead>
              <tbody>
                ${t.products.map(r=>{const n=q(r.quantity,r.priceTTC,r.discount,r.discountType),o=r.discount>0?`<span class="discount-badge">${r.discount}${r.discountType==="percent"?"%":"€"}</span>`:"-";return`
                    <tr>
                      <td>
                        <strong>${r.name}</strong>
                      </td>
                      <td>${r.quantity}</td>
                      <td>${k(r.priceTTC/1.2)}</td>
                      <td>${k(r.priceTTC)}</td>
                      <td>${o}</td>
                      <td><strong>${k(n)}</strong></td>
                    </tr>
                  `}).join("")}
              </tbody>
            </table>
          </div>

          <!-- Section Taux d'Acompte - EN 2ème POSITION POUR MOBILE -->
          ${t.montantAcompte>0?`
            <div class="deposit-section">
              <div class="section-header">💰 Acompte versé:</div>
              <div class="deposit-amount">
                ${k(t.montantAcompte)}
                <span class="deposit-percentage">(${(t.montantAcompte/s*100).toFixed(1)}% du total)</span>
              </div>
            </div>
          `:""}

          <!-- Section Remarques - EN 3ème POSITION POUR MOBILE -->
          ${t.invoiceNotes||t.deliveryNotes?`
            <div class="notes-section">
              <div class="section-header">📝 Remarques:</div>
              ${t.invoiceNotes?`
                <div class="note-item">
                  <strong>Notes générales:</strong> ${t.invoiceNotes}
                </div>
              `:""}
              ${t.deliveryNotes?`
                <div class="note-item">
                  <strong>Livraison par transporteur France Express CXI:</strong> ${t.deliveryNotes}
                </div>
              `:`
                <div class="note-item">
                  <strong>Livraison:</strong> Livraison par transporteur France Express CXI
                </div>
              `}
            </div>
          `:""}

          <!-- Section Mode de Règlement - EN 4ème POSITION POUR MOBILE -->
          ${t.paymentMethod?`
            <div class="payment-method-section">
              <div class="section-header">💳 Mode de règlement:</div>
              <div class="payment-badge">${t.paymentMethod}</div>
              
              ${t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`
                <!-- RIB pour Virement Bancaire -->
                <div class="rib-section">
                  <div class="rib-header">📋 Coordonnées bancaires pour virement</div>
                  <div class="rib-info">
                    <div><strong>Bénéficiaire:</strong> MYCONFORT</div>
                    <div><strong>IBAN:</strong> FR76 1660 7000 1708 1216 3980 964</div>
                    <div><strong>BIC:</strong> CCBPFRPPPPG</div>
                    <div><strong>Banque:</strong> Banque Populaire du Sud</div>
                    <div style="margin-top: 4px; font-style: italic; color: #666; font-size: 10px;">
                      Merci d'indiquer le numéro de facture en référence
                    </div>
                  </div>
                </div>
              `:""}
            </div>
          `:""}

          <!-- Totaux -->
          <div class="totals">
            <div class="total-line">
              <span>Total HT:</span>
              <span>${k(s/1.2)}</span>
            </div>
            <div class="total-line">
              <span>TVA (20%):</span>
              <span>${k(s*.2/1.2)}</span>
            </div>
            <div class="total-final">
              <div class="total-line" style="border: none; color: white;">
                <span>TOTAL TTC:</span>
                <span>${k(s)}</span>
              </div>
            </div>
            ${t.montantAcompte>0?`
              <div class="remaining-amount">
                <div class="total-line" style="border: none; color: #F55D3E; font-weight: bold; font-size: 16px;">
                  <span>Reste à payer:</span>
                  <span>${k(s-t.montantAcompte)}</span>
                </div>
              </div>
            `:""}
          </div>

          <!-- Section footer avec informations et signature -->
          <div class="footer-section">
            <div class="info-section">
              ${t.eventLocation?`
                <div class="info-item">
                  <div class="info-label">LIEU D'INTERVENTION:</div>
                  ${t.eventLocation}
                </div>
              `:""}
              
              ${t.eventLocation?`
                <div class="info-item">
                  <div class="info-label">DATE D'INTERVENTION:</div>
                  ${new Date(t.invoiceDate).toLocaleDateString("fr-FR")}
                </div>
              `:""}

              <div class="info-item">
                <div class="info-label">CONDITIONS DE PAIEMENT:</div>
                Paiement à réception de facture<br>
                En cas de retard, pénalités de 3% par mois
              </div>
            </div>

            <div class="signature-section">
              <div style="font-weight: bold; color: #477A0C; margin-bottom: 10px;">
                Signature du client
              </div>
              <div class="signature-box">
                ${t.signature?`<img src="${t.signature}" alt="Signature client" class="signature-image" />`:'<span style="color: #999; font-style: italic;">Signature requise</span>'}
              </div>
              <div style="font-size: 11px; color: #666;">
                Bon pour accord et exécution
              </div>

              <!-- Article de loi -->
              <div class="law-article">
                ⚖️ Article L.441-6 du Code de commerce ⚖️<br>
                Facturation immédiate obligatoire pour les prestations de services
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE 2: CONDITIONS GÉNÉRALES -->
        <div class="page cgv-page">
          <div class="cgv-title">CONDITIONS GÉNÉRALES DE VENTE</div>
          
          <div class="cgv-content">
            <div class="cgv-section">
              <h4>1. OBJET</h4>
              <p>Les présentes conditions générales de vente régissent les relations contractuelles entre HT CONFORT et ses clients pour la fourniture et l'installation d'équipements de climatisation et de chauffage.</p>
            </div>

            <div class="cgv-section">
              <h4>2. PRIX ET PAIEMENT</h4>
              <p>Les prix sont exprimés en euros TTC. Le paiement est exigible à réception de facture. En cas de retard de paiement, des pénalités de retard au taux de 3% par mois sont automatiquement appliquées, ainsi qu'une indemnité forfaitaire pour frais de recouvrement de 40€.</p>
            </div>

            <div class="cgv-section">
              <h4>3. DÉLAIS D'EXÉCUTION</h4>
              <p>Les délais d'intervention sont donnés à titre indicatif. Un retard dans l'exécution ne peut donner lieu à annulation de la commande, pénalités ou dommages-intérêts.</p>
            </div>

            <div class="cgv-section">
              <h4>4. GARANTIES</h4>
              <p>Nous garantissons nos installations contre tout vice de fabrication pendant 2 ans à compter de la réception des travaux. Cette garantie ne couvre pas l'usure normale, les dommages résultant d'un mauvais usage ou d'un défaut d'entretien.</p>
            </div>

            <div class="cgv-section">
              <h4>5. RESPONSABILITÉ</h4>
              <p>Notre responsabilité est limitée au montant de la facture. Nous ne saurions être tenus responsables des dommages indirects ou immatériels.</p>
            </div>

            <div class="cgv-section">
              <h4>6. PROPRIÉTÉ</h4>
              <p>Les équipements livrés demeurent notre propriété jusqu'au paiement intégral du prix. En cas de non-paiement, nous nous réservons le droit de reprendre les équipements installés.</p>
            </div>

            <div class="cgv-section">
              <h4>7. DROIT DE RÉTRACTATION</h4>
              <p>Conformément à l'article L.121-21 du Code de la consommation, le client dispose d'un délai de 14 jours pour exercer son droit de rétractation, sauf exceptions prévues par la loi.</p>
            </div>

            <div class="cgv-section">
              <h4>8. LITIGES</h4>
              <p>Tout litige relatif à l'interprétation ou à l'exécution des présentes conditions générales sera de la compétence exclusive des tribunaux de Paris. Le droit français est seul applicable.</p>
            </div>

            <div class="cgv-section">
              <h4>9. DONNÉES PERSONNELLES</h4>
              <p>Les données personnelles collectées sont traitées conformément au RGPD. Elles sont utilisées uniquement dans le cadre de la relation commerciale et ne sont pas transmises à des tiers.</p>
            </div>

            <div class="cgv-section">
              <h4>10. ACCEPTATION</h4>
              <p>La signature du présent devis/facture emporte acceptation pleine et entière des présentes conditions générales de vente.</p>
            </div>
          </div>

          <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #477A0C; color: #477A0C; font-weight: bold;">
            HT CONFORT - Votre spécialiste climatisation et chauffage<br>
            <span style="font-size: 11px; color: #666;">Conditions générales disponibles sur demande | Version du ${new Date().toLocaleDateString("fr-FR")}</span>
          </div>
        </div>
      </body>
      </html>
    `}static async generateInvoicePdf(t,s={includeSignature:!0,format:"a4"}){var d,h,c,x,g,N,p,u,v,y,S,b;const r=new We({unit:"pt",format:s.format==="compact"?[595,420]:"a4"}),n="#477A0C",o="#14281D";let i=50;const l=50,m=r.internal.pageSize.getWidth();if(r.setFontSize(24),r.setTextColor(n),r.text("MYCONFORT",l,i),r.setFontSize(12),r.setTextColor(o),r.text("Votre spécialiste literie et confort",l,i+20),i+=60,r.setFontSize(16),r.setTextColor(o),r.text(`Facture N° ${t.invoiceNumber||"XXX"}`,l,i),r.setFontSize(10),r.text(`Date: ${new Date(t.invoiceDate||Date.now()).toLocaleDateString("fr-FR")}`,m-150,i),i+=40,t.client&&(r.setFontSize(12),r.setTextColor(n),r.text("FACTURER À:",l,i),i+=20,r.setFontSize(10),r.setTextColor(o),(t.client.name||t.client.nom)&&(r.text(`${t.client.name||t.client.nom} ${t.client.prenom||""}`,l,i),i+=15),t.client.email&&(r.text(t.client.email,l,i),i+=15),(t.client.address||(d=t.client.adresse)!=null&&d.rue)&&(r.text(t.client.address||((h=t.client.adresse)==null?void 0:h.rue)||"",l,i),i+=15),t.client.city||(c=t.client.adresse)!=null&&c.ville)){const j=t.client.postalCode||((x=t.client.adresse)==null?void 0:x.codePostal)||"",P=t.client.city||((g=t.client.adresse)==null?void 0:g.ville)||"";r.text(`${j} ${P}`,l,i),i+=15}if(i+=20,t.produits&&t.produits.length>0){const j=t.produits.map(D=>[D.designation||D.nom||"",D.qty||D.quantite||1,`${(D.priceTTC||D.prixUnitaire||0).toFixed(2)} €`,`${((D.qty||D.quantite||1)*(D.priceTTC||D.prixUnitaire||0)/1).toFixed(2)} €`]);r.autoTable({head:[["Désignation","Qté","Prix unitaire","Total"]],body:j,startY:i,margin:{left:l,right:l},styles:{fontSize:9,cellPadding:8},headStyles:{fillColor:[71,122,12],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[248,250,252]}}),i=r.lastAutoTable.finalY+20;const P=t.produits.reduce((D,T)=>D+(T.qty||T.quantite||1)*(T.priceTTC||T.prixUnitaire||0)/1.2,0),w=t.produits.reduce((D,T)=>D+(T.qty||T.quantite||1)*(T.priceTTC||T.prixUnitaire||0),0),F=w-P;r.setFontSize(10),r.text(`Total HT: ${P.toFixed(2)} €`,m-200,i),i+=15,r.text(`TVA (20%): ${F.toFixed(2)} €`,m-200,i),i+=15,r.setFontSize(12),r.setTextColor(n),r.text(`Total TTC: ${w.toFixed(2)} €`,m-200,i),i+=30}if((N=t.paiement)!=null&&N.method&&(r.setFontSize(10),r.setTextColor(o),r.text(`Mode de paiement: ${t.paiement.method}`,l,i),i+=15,t.paiement.depositAmount>0&&(r.text(`Acompte: ${t.paiement.depositAmount.toFixed(2)} €`,l,i),i+=15),t.paiement.remainingAmount>0&&(r.text(`Restant dû: ${t.paiement.remainingAmount.toFixed(2)} €`,l,i),i+=15),i+=20),s.includeSignature&&((p=t.signature)!=null&&p.clientSignature||(u=t.signature)!=null&&u.technicienSignature)){if(i>r.internal.pageSize.getHeight()-200&&(r.addPage(),i=50),r.setFontSize(12),r.setTextColor(n),r.text("SIGNATURES",l,i),i+=30,(v=t.signature)!=null&&v.clientSignature){r.setFontSize(10),r.setTextColor(o),r.text("Signature client:",l,i),i+=10;try{r.addImage(t.signature.clientSignature,"PNG",l,i,200,60,"","FAST")}catch(j){console.warn("Erreur lors de l'ajout de la signature client:",j),r.text("Signature non disponible (format invalide)",l,i+30)}i+=80}if((y=t.signature)!=null&&y.technicienSignature){r.setFontSize(10),r.setTextColor(o),r.text("Signature responsable:",l,i),i+=10;try{r.addImage(t.signature.technicienSignature,"PNG",l,i,200,60,"","FAST")}catch(j){console.warn("Erreur lors de l'ajout de la signature responsable:",j),r.text("Signature non disponible (format invalide)",l,i+30)}i+=80}(S=t.signature)!=null&&S.lieu&&(r.text(`Lieu: ${t.signature.lieu}`,l,i),i+=15),(b=t.signature)!=null&&b.dateSignature&&r.text(`Date de signature: ${new Date(t.signature.dateSignature).toLocaleString("fr-FR")}`,l,i)}return r}static async exportInvoicePdf(t,s,r){try{const o=(await this.generateInvoicePdf(t,r)).output("blob");ns.saveAs(o,s||`facture_${(t==null?void 0:t.invoiceNumber)||"sans_num"}.pdf`)}catch(n){throw console.error("Erreur lors de l'export PDF:",n),new Error("Impossible de générer le PDF")}}}const Bs=({isOpen:a,onClose:t,invoice:s,onDownload:r})=>{const[n,o]=f.useState(!1),[i,l]=f.useState(""),[m,d]=f.useState(null),[h,c]=f.useState(null),x=f.useCallback(()=>{d(null),c(null),o(!1),l(""),t()},[t]);f.useEffect(()=>{if(m){const v=setTimeout(()=>{d(null)},5e3);return()=>clearTimeout(v)}},[m]),f.useEffect(()=>{const v=y=>{y.key==="Escape"&&a&&x()};if(a)return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[a,x]);const g=async()=>{try{o(!0),l("Génération du PDF en cours..."),await r(),d("PDF téléchargé avec succès !")}catch(v){console.error("Erreur téléchargement:",v),c(v instanceof Error?v.message:"Erreur lors du téléchargement")}finally{o(!1),l("")}},N=async()=>{try{await $s.printInvoice(s)}catch(v){console.error("Erreur impression:",v),alert("Erreur lors de l'impression de la facture")}},p=({error:v,onDismiss:y})=>e.jsx("div",{className:"no-print bg-red-50 border-l-4 border-red-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(De,{className:"w-5 h-5 text-red-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800",children:"Erreur"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:v})]}),e.jsx("button",{onClick:y,className:"ml-3 text-red-400 hover:text-red-600 transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]})}),u=({message:v,onDismiss:y})=>e.jsx("div",{className:"no-print bg-green-50 border-l-4 border-green-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800",children:"Succès"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:v})]}),e.jsx("button",{onClick:y,className:"ml-3 text-green-400 hover:text-green-600 transition-colors",children:e.jsx(fe,{className:"w-4 h-4"})})]})});return a?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#477A0C] to-[#5A8F0F] text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Aperçu PDF - Facture ",s.invoiceNumber]}),e.jsx("p",{className:"text-sm opacity-90",children:"Style: 🎨 MODERNE"})]})]}),e.jsx("button",{onClick:x,className:"text-white/80 hover:text-white hover:bg-white/20 p-2 rounded-lg transition-all",children:e.jsx(fe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"px-6 pt-4",children:[h&&e.jsx(p,{error:h,onDismiss:()=>c(null)}),m&&e.jsx(u,{message:m,onDismiss:()=>d(null)}),n&&e.jsx("div",{className:"no-print bg-blue-50 border-l-4 border-blue-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ge,{className:"w-5 h-5 text-blue-600 animate-spin mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800",children:"En cours..."}),e.jsx("p",{className:"text-sm text-blue-700",children:i})]})]})})]}),e.jsxs("div",{className:"no-print px-6 py-4 bg-gray-50 border-b flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:x,className:"flex items-center space-x-2 bg-[#477A0C] hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Retour"})]}),e.jsxs("button",{onClick:g,disabled:n,className:"flex items-center space-x-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[n?e.jsx(Ge,{className:"w-4 h-4 animate-spin"}):e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:"Télécharger PDF"})]}),e.jsxs("button",{onClick:N,disabled:n,className:"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[e.jsx(Et,{className:"w-4 h-4"}),e.jsx("span",{children:"Imprimer"})]})]}),e.jsx("div",{className:"overflow-auto max-h-[60vh] bg-gray-100 p-6",children:e.jsx("div",{className:"bg-white shadow-lg rounded-lg mx-auto",style:{width:"210mm",minHeight:"297mm"},children:e.jsx(Qe,{invoice:s})})})]})}):null},_s=({isOpen:a,onClose:t,onSuccess:s})=>a?e.jsx(je,{isOpen:a,onClose:t,title:"Génération de PDF - Guide d'utilisation",maxWidth:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(me,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Guide de génération PDF"}),e.jsx("p",{className:"text-green-100",children:"Créez et partagez vos factures facilement"})]})]}),e.jsx("p",{className:"mt-2 text-sm text-green-100",children:"Ce guide vous explique comment générer et partager vos factures au format PDF."})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Comment générer un PDF :"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-gray-700",children:[e.jsx("li",{children:"Remplissez toutes les informations de la facture (client, produits, etc.)"}),e.jsxs("li",{children:["Cliquez sur le bouton"," ",e.jsx("strong",{children:'"Générer et télécharger le PDF"'})," dans la section principale"]}),e.jsx("li",{children:"Le PDF sera automatiquement téléchargé sur votre appareil"}),e.jsxs("li",{children:["Pour prévisualiser avant de télécharger, utilisez le bouton"," ",e.jsx("strong",{children:'"APERÇU & PDF"'})]})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-3",children:"Comment partager votre facture :"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-purple-700",children:[e.jsxs("li",{children:["Cliquez sur ",e.jsx("strong",{children:'"APERÇU & PDF"'})," pour ouvrir la prévisualisation"]}),e.jsxs("li",{children:["Dans la fenêtre de prévisualisation, utilisez le bouton"," ",e.jsx("strong",{children:'"Partager Aperçu"'})]}),e.jsx("li",{children:"Vous pouvez également envoyer le PDF téléchargé par email manuellement"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Fonctionnalités disponibles :"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-blue-700",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{}),e.jsx("span",{children:"Génération PDF haute qualité"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{}),e.jsx("span",{children:"Téléchargement direct"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{}),e.jsx("span",{children:"Prévisualisation avant téléchargement"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{}),e.jsx("span",{children:"Impression directe"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{}),e.jsx("span",{children:"Signature électronique"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(he,{}),e.jsx("span",{children:"Gestion des acomptes"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Fermer"}),e.jsxs("button",{onClick:()=>{s("✅ Guide consulté avec succès ! Vous pouvez maintenant générer vos PDF."),t()},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2",children:[e.jsx(Je,{className:"w-5 h-5"}),e.jsx("span",{children:"Compris, générer mes PDF"})]})]})]})}):null,he=()=>e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),qt=(a,t,s=0,r="")=>{const n=a.reduce((m,d)=>{const h=q(d.quantity,d.priceTTC,d.discount,d.discountType),c=h/(1+t/100),g=d.priceTTC*d.quantity-h;return{totalHT:m.totalHT+c,totalTTC:m.totalTTC+h,totalDiscount:m.totalDiscount+g}},{totalHT:0,totalTTC:0,totalDiscount:0}),o=n.totalTTC-n.totalHT;let i;return["espèces","carte bleue","carte bancaire","virement","carte"].includes(r.toLowerCase().trim())&&s===0?i=0:i=Math.max(0,n.totalTTC-s),{montantHT:n.totalHT,montantTTC:n.totalTTC,montantTVA:o,montantRemise:n.totalDiscount,montantAcompte:s,montantRestant:i}},ne={WEBHOOK_URL:"https://n8n.srv765811.hstgr.cloud/webhook-test/facture-universelle",FOLDER_ID:"1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-"},le=class le{static getInstance(){return le.instance||(le.instance=new le),le.instance}static async uploadPDFToGoogleDrive(t,s){try{console.log("🚀 UPLOAD PDF VERS GOOGLE DRIVE VIA n8n");const r=await this.blobToBase64(s),n=qt(t.products,t.taxRate||20,t.montantAcompte||0,t.paymentMethod||""),o=n.montantTTC,i=n.montantAcompte,l=n.montantRestant,m={nom_facture:`Facture_MYCONFORT_${t.invoiceNumber}`,fichier_facture:r.split(",")[1],date_creation:new Date().toISOString(),numero_facture:t.invoiceNumber,date_facture:t.invoiceDate,montant_ttc:o,acompte:i,montant_restant:l,"Nom du client":t.clientName,client_email:t.clientEmail,client_telephone:t.clientPhone,adresse_client:`${t.clientAddress}, ${t.clientPostalCode} ${t.clientCity}`,mode_paiement:t.paymentMethod||"Non spécifié",signature:t.isSigned?"Oui":"Non",signature_image:t.signature||"",conseiller:t.advisorName||"MYCONFORT",lieu_evenement:t.eventLocation||"Non spécifié",nombre_produits:t.products.length,produits:t.products.map(c=>`${c.quantity}x ${c.name}`).join(", "),dossier_id:ne.FOLDER_ID};console.log("📤 Envoi des données vers n8n pour upload Google Drive...");const d=new AbortController,h=setTimeout(()=>{d.abort()},3e4);try{const c=ne.WEBHOOK_URL;console.log(`📡 Envoi vers: ${c}`);const x=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(m),signal:d.signal});if(clearTimeout(h),!x.ok){let g="";switch(x.status){case 404:g="Webhook n8n introuvable (404). Vérifiez que l'URL est correcte et que le workflow n8n est actif.";break;case 500:g="Erreur serveur n8n (500). Vérifiez la configuration de votre workflow n8n.";break;case 403:g="Accès refusé (403). Vérifiez les permissions de votre webhook n8n.";break;case 400:g="Requête invalide (400). Vérifiez la configuration de votre webhook n8n.";break;default:g=`Erreur HTTP ${x.status}: ${x.statusText}`}throw new Error(g)}return console.log("✅ PDF envoyé avec succès vers Google Drive via n8n"),!0}catch(c){throw clearTimeout(h),c.name==="AbortError"?new Error("Timeout: Le webhook n8n ne répond pas dans les temps. Vérifiez que votre instance n8n est active et accessible."):c.message.includes("Failed to fetch")?new Error(`Impossible de se connecter au webhook n8n. Vérifiez que:
• L'URL est correcte
• Votre instance n8n est en ligne
• Le workflow est actif
• Il n'y a pas de problème de réseau`):c.message.includes("CORS")?new Error("Erreur CORS: Le webhook n8n doit autoriser les requêtes depuis votre domaine. Vérifiez la configuration CORS de votre instance n8n."):c}}catch(r){throw console.error("❌ Erreur lors de l'upload vers Google Drive:",r),r}}static async blobToBase64(t){return new Promise((s,r)=>{const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?s(n.result):r(new Error("Erreur de conversion blob vers base64"))},n.onerror=r,n.readAsDataURL(t)})}static async testGoogleDriveIntegration(){try{console.log("🧪 TEST DE L'INTÉGRATION GOOGLE DRIVE VIA n8n");const t=this.getConfig(),s=t.webhookUrl,r=t.folderId;if(!s||s.trim()==="")return{success:!1,message:"❌ URL du webhook n8n non configurée. Veuillez saisir une URL valide."};try{new URL(s)}catch{return{success:!1,message:"❌ URL du webhook n8n invalide. Veuillez vérifier le format de l'URL."}}if(!r||r.trim()==="")return{success:!1,message:"❌ ID du dossier Google Drive non configuré. Veuillez saisir un ID de dossier valide."};console.log(`🔗 Test de connectivité vers: ${s}`);const n=new Blob(["Test PDF content for Google Drive integration"],{type:"application/pdf"}),i={nom_facture:"Test_Integration_n8n_GoogleDrive",fichier_facture:(await this.blobToBase64(n)).split(",")[1],date_creation:new Date().toISOString(),test:!0,dossier_id:r},l=new AbortController,m=setTimeout(()=>{l.abort()},3e4);try{const d=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i),signal:l.signal});if(clearTimeout(m),!d.ok){let c="";switch(d.status){case 404:c="Webhook n8n introuvable (404). Vérifiez que l'URL est correcte et que le workflow n8n est actif.";break;case 500:c="Erreur serveur n8n (500). Vérifiez la configuration de votre workflow n8n.";break;case 403:c="Accès refusé (403). Vérifiez les permissions de votre webhook n8n.";break;case 400:c="Requête invalide (400). Vérifiez la configuration de votre webhook n8n.";break;default:c=`Erreur HTTP ${d.status}: ${d.statusText}`}return{success:!1,message:`❌ ${c}`}}let h;try{const c=await d.text();c?h=JSON.parse(c):h={message:"Réponse vide du webhook"}}catch{h={message:"Webhook a répondu avec succès"}}return console.log("✅ Test réussi:",h),{success:!0,message:`✅ Test d'intégration Google Drive réussi ! Le webhook n8n a répondu correctement. Le fichier test devrait être uploadé dans le dossier ${r}.`}}catch(d){return clearTimeout(m),d.name==="AbortError"?{success:!1,message:"❌ Timeout: Le webhook n8n ne répond pas dans les temps. Vérifiez que votre instance n8n est active et accessible."}:d.message.includes("Failed to fetch")?{success:!1,message:`❌ Impossible de se connecter au webhook n8n. Vérifiez que:
• L'URL est correcte
• Votre instance n8n est en ligne
• Le workflow est actif
• Il n'y a pas de problème de réseau ou de pare-feu
• Le serveur n8n accepte les requêtes HTTPS`}:d.message.includes("CORS")?{success:!1,message:"❌ Erreur CORS: Le webhook n8n doit autoriser les requêtes depuis votre domaine. Vérifiez la configuration CORS de votre instance n8n."}:{success:!1,message:`❌ Erreur de connexion: ${d.message||"Erreur inconnue"}`}}}catch(t){return console.error("❌ Erreur test intégration Google Drive:",t),{success:!1,message:`❌ Erreur inattendue lors du test: ${t.message||"Erreur inconnue"}`}}}static updateWebhookConfig(t,s){t&&localStorage.setItem("n8n_webhook_url",t),s&&localStorage.setItem("google_drive_folder_id",s);const r=localStorage.getItem("n8n_webhook_url"),n=localStorage.getItem("google_drive_folder_id");r&&(ne.WEBHOOK_URL=r),n&&(ne.FOLDER_ID=n)}static getConfig(){const t=localStorage.getItem("n8n_webhook_url"),s=localStorage.getItem("google_drive_folder_id");return t&&(ne.WEBHOOK_URL=t),s&&(ne.FOLDER_ID=s),{webhookUrl:ne.WEBHOOK_URL,folderId:ne.FOLDER_ID}}};re(le,"instance");let Ke=le;const ce=class ce{constructor(){re(this,"config");this.config=this.loadConfig(),this.validateConfig()}static getInstance(){return ce.instance||(ce.instance=new ce),ce.instance}loadConfig(){return{googleDrive:{apiKey:"",clientId:"",mainFolderId:""},n8n:{webhookUrl:"https://n8n.srv765811.hstgr.cloud/webhook/facture-universelle",secret:void 0},company:{name:"HT CONFORT",phone:"+33 X XX XX XX XX",email:"contact@htconfort.com",address:"Adresse à configurer",siret:"SIRET à configurer"},pdf:{quality:parseFloat(void 0)||.8,maxSizeMB:parseInt(void 0)||5,compression:!1},app:{debugMode:!1,consoleLogs:!1,autoSaveInterval:parseInt(void 0)||6e4,maxProductsPerInvoice:parseInt(void 0)||50,defaultTaxRate:parseFloat(void 0)||20,currency:"EUR"},backup:{enabled:!1,intervalHours:parseInt(void 0)||24}}}validateConfig(){this.config.googleDrive.apiKey&&this.config.googleDrive.clientId,this.config.n8n.webhookUrl}get googleDrive(){return this.config.googleDrive}get n8n(){return this.config.n8n}get company(){return this.config.company}get pdf(){return this.config.pdf}get app(){return this.config.app}get backup(){return this.config.backup}isGoogleDriveConfigured(){return!!(this.config.googleDrive.apiKey&&this.config.googleDrive.clientId)}isN8NConfigured(){return!!this.config.n8n.webhookUrl}getConfigStatus(){return[{service:"Google Drive",configured:this.isGoogleDriveConfigured(),required:!1},{service:"N8N Webhook",configured:this.isN8NConfigured(),required:!0}]}logConfig(){this.config.app.debugMode&&this.config.app.consoleLogs&&(console.group("🔧 Configuration Application"),console.log("Google Drive configuré:",this.isGoogleDriveConfigured()),console.log("N8N configuré:",this.isN8NConfigured()),console.log("Mode debug:",this.config.app.debugMode),console.log("Sauvegarde auto:",this.config.backup.enabled),console.groupEnd())}};re(ce,"instance");let lt=ce;const Us=lt.getInstance();class Hs{static getWebhookUrl(t="webhook/facture-universelle"){console.log("🔍 WebhookUrlHelper - Environment check:",{isProd:!0,hostname:window.location.hostname,willUseProxy:!0});{const s=`/api/n8n/${t}`;return console.log("✅ Using proxy URL:",s),s}}static getDirectUrl(t="webhook/facture-universelle"){const s=Us.n8n.webhookUrl;return s.includes(t)?s:`${s.replace(/\/$/,"")}/${t}`}static isUsingProxy(){return!0}static getDebugInfo(){return{environment:"production",usingProxy:this.isUsingProxy(),webhookUrl:this.getWebhookUrl(),directUrl:this.getDirectUrl()}}}class Ne{static get WEBHOOK_URL(){const t=Hs.getWebhookUrl("webhook/facture-universelle");return console.log("🔗 N8nWebhookService - Using webhook URL:",t),t}static async sendInvoiceToN8n(t,s){try{console.log("🚀 DIAGNOSTIC COMPLET AVANT ENVOI N8N"),console.log("🔧 Création payload avec structure validée du commit e54c7f9...");const r=qt(t.products,t.taxRate||20,t.montantAcompte||0,t.paymentMethod||""),n=r.montantTTC,o=r.montantAcompte,i=r.montantRestant,l={nom_facture:`Facture_MYCONFORT_${t.invoiceNumber}`,fichier_facture:s,date_creation:new Date().toISOString(),type_document_email:"Bon de commande",type_document_pdf:"Facture",numero_bon_commande:t.invoiceNumber,objet_email:`Bon de commande n° ${t.invoiceNumber}`,titre_email:`Votre bon de commande n° ${t.invoiceNumber}`,numero_facture:t.invoiceNumber,date_facture:t.invoiceDate,montant_ttc:n,acompte:o,montant_restant:i,montant_ht:t.montantHT||0,montant_tva:t.montantTVA||0,montant_remise:t.montantRemise||0,taux_tva:t.taxRate||20,nom_du_client:t.clientName,email_client:t.clientEmail,telephone_client:t.clientPhone,adresse_client:`${t.clientAddress}, ${t.clientPostalCode} ${t.clientCity}`,client_adresse_rue:t.clientAddress,client_code_postal:t.clientPostalCode,client_ville:t.clientCity,client_type_logement:t.clientHousingType||"",client_code_porte:t.clientDoorCode||"",client_siret:t.clientSiret||"",mode_paiement:t.paymentMethod||"Non spécifié",signature:t.isSigned?"Oui":"Non",signature_presente:t.isSigned?"Oui":"Non",signature_image:t.signature||"",date_signature:t.signatureDate||"",methode_livraison:t.deliveryMethod||"",notes_livraison:t.deliveryNotes||"",nombre_cheques:t.nombreChequesAVenir||0,montant_par_cheque:t.nombreChequesAVenir&&t.nombreChequesAVenir>0&&i>0?(i/t.nombreChequesAVenir).toFixed(2):"",est_paiement_alma:t.paymentMethod&&t.paymentMethod.includes("ALMA"),nombre_paiements_alma:t.paymentMethod&&t.paymentMethod.includes("ALMA")&&t.nombreChequesAVenir||0,montant_par_paiement_alma:t.paymentMethod&&t.paymentMethod.includes("ALMA")&&t.nombreChequesAVenir&&t.nombreChequesAVenir>0&&i>0?(i/t.nombreChequesAVenir).toFixed(2):"",mode_paiement_avec_details:(!o||o===0)&&(!t.nombreChequesAVenir||t.nombreChequesAVenir===0)?`Montant à régler : ${n.toFixed(2)}€ par ${t.paymentMethod||"Non spécifié"}`:t.paymentMethod&&t.paymentMethod.includes("ALMA")&&t.nombreChequesAVenir&&t.nombreChequesAVenir>0?`${t.paymentMethod} - ${t.nombreChequesAVenir} paiement${t.nombreChequesAVenir>1?"s":""} de ${i>0?(i/t.nombreChequesAVenir).toFixed(2):"0.00"}€ chacun`:t.nombreChequesAVenir&&t.nombreChequesAVenir>0?`${t.paymentMethod||"Chèques à venir"} - ${t.nombreChequesAVenir} chèque${t.nombreChequesAVenir>1?"s":""} à venir de ${i>0?(i/t.nombreChequesAVenir).toFixed(2):"0.00"}€ chacun`:`Montant restant : ${i.toFixed(2)}€ par ${t.paymentMethod||"Non spécifié"}`,afficher_rib:t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement"),rib_html:t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`<div style="margin-top: 20px; padding: 15px; background-color: #e1f5fe; border: 1px solid #2563eb; border-radius: 8px;">
               <h3 style="margin: 0 0 10px 0; color: #2563eb; font-size: 14px;">📋 Coordonnées bancaires pour votre virement</h3>
               <div style="font-size: 12px; line-height: 1.4;">
                 <div><strong>Bénéficiaire :</strong> MYCONFORT</div>
                 <div><strong>IBAN :</strong> FR76 1660 7000 1708 1216 3980 964</div>
                 <div><strong>BIC :</strong> CCBPFRPPPPG</div>
                 <div><strong>Banque :</strong> Banque Populaire du Sud</div>
                 <div style="margin-top: 8px; font-style: italic; color: #666;">
                   Merci d'indiquer le numéro de facture <strong>${t.invoiceNumber}</strong> en référence de votre virement.
                 </div>
               </div>
             </div>`:"",rib_texte:t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`COORDONNÉES BANCAIRES POUR VIREMENT

Bénéficiaire : MYCONFORT
IBAN : FR76 1660 7000 1708 1216 3980 964
BIC : CCBPFRPPPPG
Banque : Banque Populaire du Sud

Merci d'indiquer le numéro de facture ${t.invoiceNumber} en référence de votre virement.`:"",notes_facture:t.invoiceNotes||"",conseiller:t.advisorName||"MYCONFORT",lieu_evenement:t.eventLocation||"Non spécifié",conditions_acceptees:t.termsAccepted?"Oui":"Non",date_creation_facture:t.createdAt||new Date().toISOString(),date_modification_facture:t.updatedAt||new Date().toISOString(),produits_html:t.products.map(c=>{const x=c.quantity*c.priceTTC;return`<li><strong>${c.name}</strong><br>
                   Quantité: ${c.quantity} × ${c.priceTTC.toFixed(2)}€ = <strong>${x.toFixed(2)}€</strong>
                   ${c.discount>0?`<br><em>Remise: -${c.discount}${c.discountType==="percent"?"%":"€"}</em>`:""}
                   </li>`}).join(""),liste_produits_email:t.products.map(c=>{const x=c.quantity*c.priceTTC;return`• ${c.name} - Quantité: ${c.quantity} - Prix unitaire: ${c.priceTTC.toFixed(2)}€ - Total: ${x.toFixed(2)}€`}).join(`
`),noms_produits_string:t.products.map(c=>c.name).join(", "),resume_produits:t.products.length===1?t.products[0].name:`${t.products[0].name} et ${t.products.length-1} autre${t.products.length>2?"s":""} produit${t.products.length>2?"s":""}`,produits_noms:t.products.map(c=>c.name),produits_categories:t.products.map(c=>c.category||""),produits_quantites:t.products.map(c=>c.quantity),produits_prix_unitaires:t.products.map(c=>c.priceTTC.toFixed(2)),produits_prix_ht_unitaires:t.products.map(c=>c.priceHT.toFixed(2)),produits_remises:t.products.map(c=>c.discount||0),produits_types_remises:t.products.map(c=>c.discountType||"fixed"),produits_totaux:t.products.map(c=>(c.quantity*c.priceTTC).toFixed(2)),produits_totaux_ht:t.products.map(c=>(c.quantity*c.priceHT).toFixed(2)),produits_statuts_livraison:t.products.map(c=>c.isPickupOnSite?"emporte":"a_livrer"),nombre_produits:t.products.length,nombre_produits_a_livrer:t.products.filter(c=>!c.isPickupOnSite).length,nombre_produits_emportes:t.products.filter(c=>c.isPickupOnSite).length,noms_produits_a_livrer:t.products.filter(c=>!c.isPickupOnSite).map(c=>c.name).join(", "),noms_produits_emportes:t.products.filter(c=>c.isPickupOnSite).map(c=>c.name).join(", "),a_une_livraison:t.products.some(c=>!c.isPickupOnSite)?"Oui":"Non",a_des_produits_emportes:t.products.some(c=>c.isPickupOnSite)?"Oui":"Non",produits:t.products.map(c=>({nom:c.name,quantite:c.quantity,prix_ttc:c.priceTTC,prix_ht:c.priceHT,total_ttc:c.quantity*c.priceTTC,total_ht:c.quantity*c.priceHT,categorie:c.category||"Non spécifiée",statut_livraison:c.isPickupOnSite?"emporte":"a_livrer",remise:c.discount||0,type_remise:c.discountType||"fixed"})),produits_text:t.products.map(c=>`${c.quantity}x ${c.name}`).join(", "),dossier_id:"1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-"};console.log("📦 Payload N8N préparé (structure e54c7f9):",{...l,fichier_facture:`[${s.length} caractères Base64]`}),console.group("🗺️ MAPPING WEBHOOK N8N - STRUCTURE FONCTIONNELLE e54c7f9"),console.log("🎯 URL Webhook:",this.WEBHOOK_URL),console.log("📊 Taille payload:",JSON.stringify(l).length,"caractères");const m={nom_facture:l.nom_facture,numero_facture:l.numero_facture,nom_du_client:l.nom_du_client,email_client:l.email_client,montant_ttc:l.montant_ttc,montant_ht:l.montant_ht,montant_tva:l.montant_tva,montant_remise:l.montant_remise,taux_tva:l.taux_tva,acompte:l.acompte,montant_restant:l.montant_restant,telephone_client:l.telephone_client,client_adresse_rue:l.client_adresse_rue,client_code_postal:l.client_code_postal,client_ville:l.client_ville,client_type_logement:l.client_type_logement,client_code_porte:l.client_code_porte,client_siret:l.client_siret||"Non renseigné",mode_paiement:l.mode_paiement,signature_presente:l.signature_presente,signature_image:l.signature_image?"Incluse (base64)":"Non disponible",date_signature:l.date_signature||"Non signé",methode_livraison:l.methode_livraison||"Non spécifiée",notes_livraison:l.notes_livraison||"Aucune",nombre_cheques:l.nombre_cheques,montant_par_cheque:l.montant_par_cheque||"Non applicable",mode_paiement_avec_details:l.mode_paiement_avec_details,notes_facture:l.notes_facture||"Aucune",conseiller:l.conseiller,lieu_evenement:l.lieu_evenement,conditions_acceptees:l.conditions_acceptees,"produits_html (longueur)":`${l.produits_html.length} chars`,"liste_produits_email (longueur)":`${l.liste_produits_email.length} chars`,noms_produits_string:`"${l.noms_produits_string}"`,resume_produits:`"${l.resume_produits}"`,"produits_noms (nombre)":`${l.produits_noms.length} items`,"produits_categories (nombre)":`${l.produits_categories.length} items`,"produits_quantites (nombre)":`${l.produits_quantites.length} items`,"produits_prix_ht_unitaires (nombre)":`${l.produits_prix_ht_unitaires.length} items`,nombre_produits:l.nombre_produits,"fichier_facture (taille)":`${s.length} chars`};Object.entries(m).forEach(([c,x])=>{const g=x!=null&&x!=="";console.log(`${g?"✅":"❌"} ${c}:`,typeof x=="string"&&x.length>30?`${x.substring(0,30)}...`:x)}),console.groupEnd();const d=new AbortController,h=setTimeout(()=>{d.abort()},this.TIMEOUT_MS);try{console.log("📤 ENVOI EN COURS VERS N8N...");const c=await fetch(this.WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"MYCONFORT-Invoice-System/1.0"},body:JSON.stringify(l),mode:"cors",signal:d.signal});clearTimeout(h);const x=await c.text();let g;try{g=JSON.parse(x)}catch{g={message:x}}if(console.group("📥 RÉPONSE N8N"),console.log("🔢 Status:",c.status),console.log("📄 Headers:",Object.fromEntries(c.headers.entries())),console.log("📋 Body:",g),c.ok?console.log("✅ WEBHOOK N8N A REÇU LE PAYLOAD AVEC SUCCÈS"):(console.error("❌ WEBHOOK N8N A REJETÉ LE PAYLOAD"),console.error("🔍 Vérifiez le workflow n8n et les champs attendus")),console.groupEnd(),!c.ok){const p=`❌ Erreur HTTP ${c.status}: ${x}`;return console.error(p),{success:!1,message:p,response:g,payload:l}}const N=`✅ Facture ${l.numero_facture} envoyée avec succès vers n8n`;return console.log(N),{success:!0,message:N,response:g,payload:l}}catch(c){if(clearTimeout(h),c instanceof Error&&c.name==="AbortError"){const g=`❌ Timeout: n8n ne répond pas dans les ${this.TIMEOUT_MS/1e3}s`;return console.error(g),{success:!1,message:g,payload:l}}if(c instanceof Error&&(c.message.includes("CORS")||c.message.includes("Failed to fetch"))){console.warn("⚠️ Erreur CORS détectée, tentative avec mode no-cors...");try{return await fetch(this.WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),mode:"no-cors"}),console.log("✅ Envoi no-cors réussi (pas de réponse lisible)"),{success:!0,message:"✅ Envoi réussi via mode no-cors (CORS configuré côté N8N requis pour les réponses)",response:{note:"Mode no-cors utilisé - réponse non lisible"},payload:l}}catch(g){console.error("❌ Échec même avec no-cors:",g)}}const x=`❌ Erreur réseau: ${c instanceof Error?c.message:String(c)}`;return console.error(x),{success:!1,message:x,payload:l}}}catch(r){const n=`❌ Erreur inattendue: ${r instanceof Error?r.message:String(r)}`;return console.error(n,r),{success:!1,message:n}}}static async testConnection(){try{console.log("🧪 TEST DE CONNECTIVITÉ N8N");const t=Date.now(),s={test:!0,timestamp:new Date().toISOString(),source:"MYCONFORT-Test"},r=new AbortController,n=setTimeout(()=>{r.abort()},1e4);try{const o=await fetch(this.WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:r.signal});clearTimeout(n);const i=Date.now()-t;if(o.ok){const l=`✅ n8n accessible (${i}ms)`;return console.log(l),{success:!0,message:l,responseTime:i}}else{const l=`❌ n8n répond avec erreur ${o.status}`;return console.error(l),{success:!1,message:l,responseTime:i}}}catch(o){return clearTimeout(n),o instanceof Error&&o.name==="AbortError"?{success:!1,message:"❌ Timeout: n8n ne répond pas"}:{success:!1,message:`❌ Erreur de connexion: ${o instanceof Error?o.message:String(o)}`}}}catch(t){return{success:!1,message:`❌ Erreur test: ${t instanceof Error?t.message:String(t)}`}}}}re(Ne,"TIMEOUT_MS",3e4);const Vs=({isOpen:a,onClose:t,onSuccess:s,onError:r})=>{const[n,o]=f.useState("https://n8n.srv765811.hstgr.cloud/webhook-test/facture-myconfort"),[i,l]=f.useState("1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-"),[m,d]=f.useState(!1),[h,c]=f.useState(!1),[x,g]=f.useState(null),[N,p]=f.useState("unknown");f.useEffect(()=>{if(a){const S=Ke.getConfig();o(S.webhookUrl),l(S.folderId),g(null),u()}},[a]);const u=()=>(navigator.onLine?p("online"):p("offline"),window.addEventListener("online",()=>p("online")),window.addEventListener("offline",()=>p("offline")),()=>{window.removeEventListener("online",()=>p("online")),window.removeEventListener("offline",()=>p("offline"))}),v=()=>{d(!0);try{if(!n.trim()){r("❌ L'URL du webhook n8n est requise"),d(!1);return}if(!i.trim()){r("❌ L'ID du dossier Google Drive est requis"),d(!1);return}try{new URL(n)}catch{r("❌ L'URL du webhook n8n n'est pas valide"),d(!1);return}Ke.updateWebhookConfig(n,i),s("✅ Configuration Google Drive mise à jour avec succès !"),d(!1)}catch(S){r(`❌ Erreur lors de l'enregistrement: ${S.message}`),d(!1)}},y=async()=>{if(N==="offline"){r("❌ Vous êtes hors ligne. Veuillez vérifier votre connexion internet.");return}c(!0),g(null);try{const S=await Ne.testConnection();g(S),S.success?s(S.message):r(S.message)}catch(S){const b=`❌ Erreur lors du test: ${S.message||"Erreur inconnue"}`;g({success:!1,message:b}),r(b)}finally{c(!1)}};return a?e.jsx(je,{isOpen:a,onClose:t,title:"Configuration Google Drive",maxWidth:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(rt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Intégration Google Drive"}),e.jsx("p",{className:"text-blue-100",children:"Sauvegardez automatiquement vos factures dans Google Drive"})]})]}),e.jsx("p",{className:"mt-2 text-sm text-blue-100",children:"Cette intégration permet d'envoyer automatiquement vos factures PDF vers Google Drive via n8n."})]}),N==="offline"&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(as,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700",children:"Vous êtes actuellement hors ligne"}),e.jsx("p",{className:"text-sm text-red-600",children:"Veuillez vérifier votre connexion internet pour utiliser cette fonctionnalité"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"URL du Webhook n8n *"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(rt,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("input",{type:"text",value:n,onChange:S=>o(S.target.value),placeholder:"https://n8n.srv765811.hstgr.cloud/webhook-test/facture-myconfort",className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"URL du webhook n8n qui recevra les données de la facture"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"ID du Dossier Google Drive *"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(os,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("input",{type:"text",value:i,onChange:S=>l(S.target.value),placeholder:"1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-",className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ID du dossier Google Drive où seront stockées les factures"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Comment configurer l'intégration :"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-sm text-blue-700",children:[e.jsx("li",{children:"Créez un workflow dans n8n avec un webhook comme déclencheur"}),e.jsx("li",{children:"Ajoutez un module Google Drive pour uploader un fichier"}),e.jsx("li",{children:"Copiez l'URL du webhook n8n et collez-la ci-dessus"}),e.jsx("li",{children:"Créez un dossier dans Google Drive et copiez son ID"}),e.jsx("li",{children:"Testez la connexion pour vérifier que tout fonctionne"})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Résolution des problèmes courants :"}),e.jsxs("ul",{className:"list-disc ml-5 space-y-2 text-sm text-yellow-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:'Erreur "Failed to fetch"'})," - Vérifiez que votre instance n8n est en ligne et accessible"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erreur CORS"})," - Configurez votre n8n pour accepter les requêtes de votre domaine"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erreur 404"})," - Vérifiez que l'URL du webhook est correcte et que le workflow est actif"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Timeout"})," - Vérifiez la connectivité réseau et que n8n répond dans un délai raisonnable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erreur HTTPS"})," - Assurez-vous que votre navigateur accepte les requêtes vers le serveur n8n"]})]})]}),x&&e.jsx("div",{className:`p-4 rounded-lg ${x.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-2",children:[x.success?e.jsx(ve,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}):e.jsx(De,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${x.success?"text-green-700":"text-red-700"}`,children:x.success?"✅ Test réussi !":"❌ Test échoué"}),e.jsx("div",{className:`text-sm mt-1 ${x.success?"text-green-600":"text-red-600"}`,children:x.message.split(`
`).map((S,b)=>e.jsx("div",{className:b>0?"mt-1":"",children:S.startsWith("•")?e.jsx("div",{className:"ml-2",children:S}):S},b))})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{onClick:t,disabled:m||h,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium disabled:opacity-50",children:"Fermer"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:y,disabled:!n.trim()||!i.trim()||m||h||N==="offline",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Test en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Tester la connexion"})]})}),e.jsx("button",{onClick:v,disabled:!n.trim()||!i.trim()||m,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Enregistrement..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Dt,{className:"w-5 h-5"}),e.jsx("span",{children:"Enregistrer"})]})})]})]})]})}):null},Ws=pt({invoiceNumber:B().min(1,"Numéro de facture obligatoire"),invoiceDate:B().min(1,"Date de facture obligatoire"),eventLocation:B().min(1,"Lieu d'événement obligatoire"),clientName:B().min(1,"Nom client obligatoire"),clientEmail:B().email("Email client invalide"),clientPhone:B().min(1,"Téléphone client obligatoire"),clientAddress:B().min(1,"Adresse client obligatoire"),clientCity:B().min(1,"Ville client obligatoire"),clientPostalCode:B().min(1,"Code postal client obligatoire"),clientHousingType:B().min(1,"Type de logement obligatoire"),clientDoorCode:B().min(1,"Code porte obligatoire"),clientSiret:B().optional(),advisorName:B().min(1,"Nom conseiller obligatoire"),products:ls(pt({name:B().min(1,"Nom produit obligatoire"),category:B().min(1,"Catégorie produit obligatoire"),quantity:Q().min(1,"Quantité doit être >= 1"),unitPriceHT:Q().min(0,"Prix HT doit être >= 0"),unitPriceTTC:Q().min(0,"Prix TTC doit être >= 0"),discount:Q().min(0,"Remise doit être >= 0"),discountType:cs(["percent","fixed"]),totalTTC:Q().min(0,"Total TTC doit être >= 0")})).min(1,"Au moins un produit obligatoire"),totalHT:Q().min(0,"Total HT doit être >= 0"),totalTTC:Q().min(0,"Total TTC doit être >= 0"),totalTVA:Q().min(0,"Total TVA doit être >= 0"),taxRate:Q().min(0,"Taux TVA doit être >= 0"),paymentMethod:B().min(1,"Méthode de paiement obligatoire"),depositAmount:Q().min(0,"Montant acompte doit être >= 0"),remainingAmount:Q().min(0,"Montant restant doit être >= 0"),deliveryMethod:B().optional(),deliveryNotes:B().optional(),invoiceNotes:B().optional(),termsAccepted:is(),signature:B().optional(),pdfBase64:B().min(1,"PDF base64 obligatoire"),pdfSizeKB:Q().min(0,"Taille PDF doit être >= 0"),generatedAt:B(),generatedTimestamp:Q()});class jt{static logToConsole(t,s){var l;console.group("🔍 DIAGNOSTIC PAYLOAD JSON - ANALYSE COMPLÈTE"),console.log("📦 PAYLOAD COMPLET À ENVOYER:",JSON.stringify(t,null,2)),console.group("⚠️ VÉRIFICATION CHAMPS CRITIQUES REQUIS");const n=["clientEmail","clientPhone","clientName","clientAddress","invoiceNumber","invoiceDate","totalHT","totalTTC","products","paymentMethod","pdfBase64"].filter(m=>{const d=t[m],h=!d||Array.isArray(d)&&d.length===0||d==="";return h?console.error(`❌ CHAMP CRITIQUE MANQUANT: ${m}`):console.log(`✅ ${m}:`,typeof d=="string"&&d.length>50?`${d.substring(0,50)}...`:d),h});n.length>0?(console.error("🚨 CHAMPS CRITIQUES MANQUANTS:",n),console.error("⚠️ LE WEBHOOK N8N RECEVRA UN PAYLOAD INCOMPLET !")):console.log("✅ TOUS LES CHAMPS CRITIQUES SONT PRÉSENTS"),console.groupEnd(),console.group("🗺️ MAPPING DES DONNÉES - CORRESPONDANCE EXACTE"),[{app:"clientPhone",webhook:"phone",value:t.clientPhone},{app:"clientEmail",webhook:"email",value:t.clientEmail},{app:"totalHT",webhook:"montantHT",value:t.totalHT},{app:"totalTTC",webhook:"montantTTC",value:t.totalTTC},{app:"clientName",webhook:"clientName",value:t.clientName},{app:"invoiceNumber",webhook:"invoiceNumber",value:t.invoiceNumber},{app:"products",webhook:"products",value:t.products},{app:"pdfBase64",webhook:"fichier_facture",value:t.pdfBase64?"PDF_PRESENT":"PDF_MISSING"}].forEach(m=>{const d=m.value!==void 0&&m.value!==null&&m.value!=="";console.log(`${d?"✅":"❌"} ${m.app} → ${m.webhook}:`,d?typeof m.value=="string"&&m.value.length>30?`${m.value.substring(0,30)}...`:m.value:"MANQUANT")}),console.groupEnd(),console.group("📦 ANALYSE DÉTAILLÉE DES PRODUITS"),t.products&&Array.isArray(t.products)?(console.log(`📊 Nombre de produits: ${t.products.length}`),t.products.forEach((m,d)=>{console.log(`Produit ${d+1}:`,{name:m.name,quantity:m.quantity,unitPriceTTC:m.unitPriceTTC,totalTTC:m.totalTTC,category:m.category})})):console.error("❌ PRODUITS MANQUANTS OU FORMAT INVALIDE"),console.groupEnd(),console.group("📄 ANALYSE DU PDF"),t.pdfBase64?(console.log("✅ PDF présent"),console.log("📊 Taille base64:",t.pdfBase64.length,"caractères"),console.log("📊 Taille estimée PDF:",t.pdfSizeKB,"KB"),console.log("🔍 Début base64:",t.pdfBase64.substring(0,50)+"...")):console.error("❌ PDF MANQUANT - CRITIQUE POUR N8N"),console.groupEnd(),console.group("🔍 VÉRIFICATION TYPES DE DONNÉES"),[{field:"totalHT",expected:"number",actual:typeof t.totalHT},{field:"totalTTC",expected:"number",actual:typeof t.totalTTC},{field:"taxRate",expected:"number",actual:typeof t.taxRate},{field:"depositAmount",expected:"number",actual:typeof t.depositAmount},{field:"products",expected:"array",actual:Array.isArray(t.products)?"array":typeof t.products},{field:"termsAccepted",expected:"boolean",actual:typeof t.termsAccepted}].forEach(m=>{const d=m.actual===m.expected;console.log(`${d?"✅":"❌"} ${m.field}: attendu ${m.expected}, reçu ${m.actual}`)}),console.groupEnd(),s&&(console.group("❌ ERREURS DE VALIDATION"),s.issues.forEach(m=>{console.error(`• ${m.path.join(".")}: ${m.message}`)}),console.groupEnd()),console.group("📊 STATISTIQUES PAYLOAD"),console.log("• Taille JSON:",JSON.stringify(t).length,"caractères"),console.log("• Nombre de produits:",((l=t.products)==null?void 0:l.length)||0),console.log("• Taille PDF:",t.pdfSizeKB||0,"KB"),console.log("• Signature présente:",!!t.signature),console.groupEnd(),console.groupEnd()}static logBeforeWebhookSend(t){console.group("🚀 DIAGNOSTIC FINAL AVANT ENVOI WEBHOOK N8N"),console.log("📦 PAYLOAD COMPLET À ENVOYER:",JSON.stringify(t,null,2));const r=["clientEmail","clientPhone","totalHT","totalTTC","invoiceNumber","pdfBase64"].filter(o=>{const i=t[o];return!i||i===""||Array.isArray(i)&&i.length===0});r.length>0?(console.error("🚨 CHAMPS MANQUANTS POUR WEBHOOK:",r),console.error("⚠️ LE WEBHOOK N8N RISQUE DE PLANTER !")):console.log("✅ PAYLOAD PRÊT POUR ENVOI WEBHOOK");const n=JSON.stringify(t).length;console.log("📊 Taille totale payload:",n,"caractères"),n>1e6&&console.warn("⚠️ PAYLOAD TRÈS VOLUMINEUX (>1MB) - RISQUE DE TIMEOUT"),console.groupEnd()}static logToFile(t,s){var r;try{const n={timestamp:new Date().toISOString(),payload:t,validation:{isValid:!s,errors:(s==null?void 0:s.issues)||[]},stats:{jsonSize:JSON.stringify(t).length,productsCount:((r=t.products)==null?void 0:r.length)||0,pdfSizeKB:t.pdfSizeKB||0,hasSignature:!!t.signature}};console.log("📁 LOG FICHIER (simulation):",JSON.stringify(n,null,2))}catch(n){console.error("❌ Erreur écriture log fichier:",n)}}static logPayload(t,s){this.logToConsole(t,s),this.logToFile(t,s)}}class Gs{static sanitizePayload(t,s,r){var c,x,g,N,p,u,v,y,S;console.log("🧹 NETTOYAGE ET PRÉPARATION DU PAYLOAD - DIAGNOSTIC COMPLET"),console.group("📋 DONNÉES BRUTES AVANT NETTOYAGE"),console.log("Invoice brute:",{invoiceNumber:t.invoiceNumber,clientName:t.clientName,clientEmail:t.clientEmail,clientPhone:t.clientPhone,products:t.products.length,paymentMethod:t.paymentMethod,signature:!!t.signature}),console.log("PDF info:",{base64Length:s.length,sizeKB:r}),console.groupEnd();const n=t.products.map(b=>{var w;const j=b.priceTTC/(1+t.taxRate/100),P=b.quantity*b.priceTTC*(1-b.discount/100);return{name:b.name.trim(),category:((w=b.category)==null?void 0:w.trim())||"",quantity:b.quantity,unitPriceHT:Math.round(j*100)/100,unitPriceTTC:b.priceTTC,discount:b.discount,discountType:b.discountType,totalTTC:Math.round(P*100)/100}}),o=n.reduce((b,j)=>b+j.totalTTC,0),i=o/(1+t.taxRate/100),l=o-i,m=t.montantAcompte||0,d=o-m;console.group("🧮 CALCULS EFFECTUÉS"),console.log("Totaux calculés:",{totalHT:Math.round(i*100)/100,totalTTC:Math.round(o*100)/100,totalTVA:Math.round(l*100)/100,depositAmount:Math.round(m*100)/100,remainingAmount:Math.round(d*100)/100}),console.groupEnd();const h={invoiceNumber:t.invoiceNumber.trim(),invoiceDate:t.invoiceDate,eventLocation:((c=t.eventLocation)==null?void 0:c.trim())||"",clientName:t.clientName.trim(),clientEmail:t.clientEmail.trim().toLowerCase(),clientPhone:t.clientPhone.trim(),clientAddress:t.clientAddress.trim(),clientCity:t.clientCity.trim(),clientPostalCode:t.clientPostalCode.trim(),clientHousingType:((x=t.clientHousingType)==null?void 0:x.trim())||"",clientDoorCode:((g=t.clientDoorCode)==null?void 0:g.trim())||"",clientSiret:(N=t.clientSiret)==null?void 0:N.trim(),advisorName:((p=t.advisorName)==null?void 0:p.trim())||"MYCONFORT",products:n,totalHT:Math.round(i*100)/100,totalTTC:Math.round(o*100)/100,totalTVA:Math.round(l*100)/100,taxRate:t.taxRate,paymentMethod:t.paymentMethod.trim(),depositAmount:Math.round(m*100)/100,remainingAmount:Math.round(d*100)/100,deliveryMethod:(u=t.deliveryMethod)==null?void 0:u.trim(),deliveryNotes:(v=t.deliveryNotes)==null?void 0:v.trim(),invoiceNotes:(y=t.invoiceNotes)==null?void 0:y.trim(),termsAccepted:t.termsAccepted,signature:(S=t.signature)==null?void 0:S.trim(),pdfBase64:s,pdfSizeKB:r,generatedAt:new Date().toISOString(),generatedTimestamp:Date.now()};return console.group("✅ PAYLOAD NETTOYÉ - PRÊT POUR VALIDATION"),console.log("Payload nettoyé:",JSON.stringify(h,null,2)),console.groupEnd(),h}}class zt{static validateAndPrepare(t,s,r){try{console.log("🔐 VALIDATION DU PAYLOAD AVANT ENVOI N8N");const n=Gs.sanitizePayload(t,s,r),o=Ws.safeParse(n);return o.success?(console.log("✅ VALIDATION RÉUSSIE - Payload prêt pour envoi"),jt.logPayload(o.data),{isValid:!0,payload:o.data}):(console.error("❌ VALIDATION ÉCHOUÉE"),jt.logPayload(n,o.error),{isValid:!1,errors:o.error.issues.map(l=>`${l.path.join(".")}: ${l.message}`)})}catch(n){return console.error("❌ Erreur lors de la validation:",n),{isValid:!1,errors:[`Erreur de validation: ${n instanceof Error?n.message:"Erreur inconnue"}`]}}}}const Ys=({isOpen:a,onClose:t,invoice:s,onSuccess:r,onError:n})=>{var g;const[o,i]=f.useState(null),[l,m]=f.useState(!1),d=async()=>{var N,p,u;try{const v="JVBERi0xLjQKJcOkw7zDtsO4CjIgMCBvYmoKPDwKL0xlbmd0aCAzIDAgUgo+PgpzdHJlYW0K";console.log("🔍 GÉNÉRATION PAYLOAD DEBUG - DIAGNOSTIC COMPLET"),console.log("📋 Données invoice brutes:",{invoiceNumber:s.invoiceNumber,clientName:s.client.name,clientEmail:s.client.email,clientPhone:s.client.phone,products:s.products.length,totalProducts:s.products.reduce((b,j)=>b+j.quantity*j.priceTTC,0)});const S=zt.validateAndPrepare(s,v,150);i({validation:S,timestamp:new Date().toISOString(),invoiceData:s,rawPayloadSize:JSON.stringify(S.payload||{}).length,fieldMapping:{"app → webhook":{"client.phone → clientPhone":s.client.phone,"client.email → clientEmail":s.client.email,"calculated totalHT → totalHT":(N=S.payload)==null?void 0:N.totalHT,"calculated totalTTC → totalTTC":(p=S.payload)==null?void 0:p.totalTTC,"products.length → products":s.products.length}}}),S.isValid?r("✅ Payload généré et validé avec succès"):n(`❌ Erreurs de validation: ${(u=S.errors)==null?void 0:u.join(", ")}`)}catch(v){n(`❌ Erreur génération payload: ${v.message}`)}},h=async()=>{m(!0);try{const N=await Ne.testConnection();N.success?r(N.message):n(N.message)}catch(N){n(`❌ Erreur test connexion: ${N.message}`)}finally{m(!1)}},c=()=>{var N;(N=o==null?void 0:o.validation)!=null&&N.payload&&(navigator.clipboard.writeText(JSON.stringify(o.validation.payload,null,2)),r("📋 Payload copié dans le presse-papiers"))},x=()=>{if(o){const N=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),p=URL.createObjectURL(N),u=document.createElement("a");u.href=p,u.download=`payload-debug-${s.invoiceNumber}-${Date.now()}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(p),r("📥 Fichier de debug téléchargé")}};return a?e.jsx(je,{isOpen:a,onClose:t,title:"🐛 Debug Payload N8N",maxWidth:"max-w-4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(ke,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Debug Payload N8N"}),e.jsx("p",{className:"text-orange-100",children:"Validation et test du payload avant envoi"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:d,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg flex items-center space-x-2 font-semibold transition-all",children:[e.jsx(ke,{className:"w-5 h-5"}),e.jsx("span",{children:"Générer Payload Debug"})]}),e.jsxs("button",{onClick:h,disabled:l,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg flex items-center space-x-2 font-semibold transition-all",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:l?"Test...":"Test Connexion N8N"})]}),o&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:c,className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-3 rounded-lg flex items-center space-x-1 font-semibold transition-all",children:[e.jsx(Lt,{className:"w-4 h-4"}),e.jsx("span",{children:"Copier"})]}),e.jsxs("button",{onClick:x,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-3 rounded-lg flex items-center space-x-1 font-semibold transition-all",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:"Télécharger"})]})]})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${o.validation.isValid?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("h4",{className:`font-bold mb-2 ${o.validation.isValid?"text-green-800":"text-red-800"}`,children:o.validation.isValid?"✅ Validation Réussie":"❌ Erreurs de Validation"}),!o.validation.isValid&&o.validation.errors&&e.jsx("ul",{className:"list-disc ml-5 space-y-1 text-red-700",children:o.validation.errors.map((N,p)=>e.jsx("li",{className:"text-sm",children:N},p))})]}),o.validation.payload&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"📋 Payload Validé"}),e.jsx("pre",{className:"bg-white p-4 rounded border text-xs overflow-auto max-h-96 text-gray-800",children:JSON.stringify(o.validation.payload,null,2)})]}),o.validation.payload&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-800 mb-2",children:"📊 Statistiques Payload"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Taille JSON:"}),e.jsxs("div",{className:"text-blue-800",children:[JSON.stringify(o.validation.payload).length," ","caractères"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Produits:"}),e.jsx("div",{className:"text-blue-800",children:((g=o.validation.payload.products)==null?void 0:g.length)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Taille PDF:"}),e.jsxs("div",{className:"text-blue-800",children:[o.validation.payload.pdfSizeKB," KB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Signature:"}),e.jsx("div",{className:"text-blue-800",children:o.validation.payload.signature?"Oui":"Non"})]})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-yellow-800 mb-2",children:"💡 Instructions Debug"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-sm text-yellow-700",children:[e.jsx("li",{children:'Cliquez sur "Générer Payload Debug" pour valider la structure'}),e.jsx("li",{children:"Vérifiez que tous les champs obligatoires sont présents"}),e.jsx("li",{children:"Testez la connexion N8N pour vérifier l'accessibilité"}),e.jsx("li",{children:"Copiez le payload pour le tester dans Postman/cURL"}),e.jsx("li",{children:'Dans n8n, activez "Listen for test event" pour voir les données reçues'})]})]})]})}):null},$e=({title:a,icon:t,iconColor:s,bgColor:r,borderColor:n,children:o})=>e.jsxs("div",{className:`${r} ${n} border rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-full",children:e.jsx(t,{className:`w-5 h-5 ${s}`})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:a})]}),e.jsx("div",{className:"space-y-4",children:o})]}),Nt=Rt,Ue=[71,122,12],M=15,G={name:"MYCONFORT",address1:"88 avenue des Ternes",address2:"75017 Paris",phone:"+33 6 61 48 60 23",email:"htconfort@gmail.com",website:"htconfort.com",siret:"824 313 530 00027",iban:"FR76 1234 5678 9012 3456 7890 123",bic:"PSSTFRPPXXX"},Ks=[{title:"1. Objet",text:"Les présentes conditions régissent les ventes de MYCONFORT."},{title:"2. Produits",text:"Descriptions et caractéristiques indicatives ; tolérances d'usage."},{title:"3. Prix",text:"Prix TTC en euros, TVA 20 % ; offres valables dans la limite des stocks."},{title:"4. Commande",text:"Validation après paiement ou acompte ; confirmation par email."},{title:"5. Paiement",text:"CB Banque Populaire, virement, chèques ; pénalités de retard légales."},{title:"6. Acompte",text:"Acompte non remboursable sauf obligation légale ; solde à la livraison."},{title:"7. Livraison",text:"Délais indicatifs 48 h ouvrées ; pas de reprise d'anciens matelas."},{title:"8. Réception",text:"Réserves à formuler à la livraison ; défauts apparents sous 48 h."},{title:"9. Garantie",text:"Jusqu'à 15 ans selon référence ; exclusions: mauvaise utilisation/usure."},{title:"10. Retours",text:"Hors droit de rétractation légal non applicable aux biens personnalisés."},{title:"11. SAV",text:"Service client Saint-Hippolyte — htconfort@me.com — 06 61 48 60 23."},{title:"12. Données",text:"Traitements RGPD ; droit d'accès/rectification/suppression."},{title:"13. Force majeure",text:"Suspension/exonération en cas d'événement irrésistible et imprévisible."},{title:"14. Droit applicable",text:"Droit français ; tentative amiable avant toute action."},{title:"15. Juridiction",text:"Tribunaux compétents du ressort du siège social en cas d'échec amiable."}];async function Js(a){try{return new Promise((t,s)=>{const r=new Image;r.onload=()=>{try{const n=document.createElement("canvas"),o=n.getContext("2d"),i=300,l=150;let{width:m,height:d}=r;m>i&&(d=d*i/m,m=i),d>l&&(m=m*l/d,d=l),n.width=m,n.height=d,o.fillStyle="white",o.fillRect(0,0,m,d),o.drawImage(r,0,0,m,d);const h=n.toDataURL("image/jpeg",.8);console.log("🔧 Signature optimisée:",{originalSize:a.length,optimizedSize:h.length,reduction:`${((1-h.length/a.length)*100).toFixed(1)}%`,dimensions:`${m}x${d}px`}),t(h)}catch(n){console.warn("Signature optimization failed, using original:",n),t(a)}},r.onerror=()=>{console.warn("Failed to load signature for optimization, using original"),t(a)},r.src=a})}catch(t){return console.warn("Signature optimization error:",t),a}}async function Qs(a){try{const t=await fetch(a).then(s=>s.blob());return await new Promise((s,r)=>{const n=new Image;n.onload=()=>{try{const o=document.createElement("canvas"),i=o.getContext("2d"),l=200,m=100;let{width:d,height:h}=n;d>l&&(h=h*l/d,d=l),h>m&&(d=d*m/h,h=m),o.width=d,o.height=h,i.fillStyle="white",i.fillRect(0,0,d,h),i.drawImage(n,0,0,d,h);const c=o.toDataURL("image/jpeg",.7);console.log("🔧 Logo compressé:",{originalSize:t.size,compressedSize:c.length,reduction:`${((1-c.length/t.size)*100).toFixed(1)}%`,dimensions:`${d}x${h}px`}),s(c)}catch(o){console.warn("Logo compression failed, using original:",o);const i=new FileReader;i.onload=()=>s(i.result),i.onerror=()=>r(new Error("logo load error")),i.readAsDataURL(t)}},n.onerror=()=>r(new Error("logo load error")),n.src=URL.createObjectURL(t)})}catch(t){console.warn("Logo loading failed:",t);return}}function Ct(a,t){const s=a.internal.pageSize.getWidth(),r=a.internal.pageSize.getHeight()-10;a.setDrawColor(Ue[0],Ue[1],Ue[2]),a.setLineWidth(.4),a.line(M,r-5,s-M,r-5),a.setFont("helvetica","normal"),a.setFontSize(8),a.text(`${G.name} — ${G.address1}, ${G.address2} — ${G.email} — ${G.phone}`,M,r),a.text(`Page ${t} / 2`,s-M,r,{align:"right"})}const ct={async generateInvoicePDF(a,t,s){var D;const r=Xs(a),n=new We({unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),i=(s==null?void 0:s.logoUrl)||"/HT-Confort_Full_Green.png",l=await Qs(i);l&&n.addImage(l,"PNG",M,10,40,20),n.setFont("helvetica","bold"),n.setFontSize(16),n.text("FACTURE",o/2,20,{align:"center"}),n.setFont("helvetica","normal"),n.setFontSize(9);const m=[G.name,G.address1,G.address2,`Tél : ${G.phone}`,`Email : ${G.email}`,`Web : ${G.website}`,`SIRET : ${G.siret}`,`IBAN : ${G.iban}`,`BIC : ${G.bic}`];m.forEach((T,O)=>n.text(T,M,35+O*4.6)),n.setFont("helvetica","bold"),n.setFontSize(10),n.text(`Facture n° : ${r.invoiceNumber}`,M,35+m.length*4.6+6),n.setFont("helvetica","normal"),n.text(`Date : ${r.invoiceDate}`,M,35+m.length*4.6+12);const d=o-80;n.setFont("helvetica","bold"),n.text("Client",d,35),n.setFont("helvetica","normal"),n.setFontSize(9),[r.clientName||"—",r.clientAddress||"—",`${r.clientPostalCode??""} ${r.clientCity??""}`.trim()||"—",r.clientPhone?`Tél : ${r.clientPhone}`:"",r.clientEmail?`Email : ${r.clientEmail}`:""].filter(Boolean).forEach((T,O)=>n.text(T,d,40+O*4.6));const c=(r.products||[]).map(T=>{const O=T.name||T.category||"—",z=Number(T.quantity??0),L=Number(T.priceTTC??0),_=z*L;return[O,String(z),L.toFixed(2)+" €",_.toFixed(2)+" €"]});Nt(n,{startY:35+m.length*4.6+20,head:[["Désignation","Qté","PU TTC","Total TTC"]],body:c,theme:"grid",headStyles:{fillColor:Ue,textColor:255,fontStyle:"bold"},styles:{fontSize:9,cellPadding:2},margin:{left:M,right:M},columnStyles:{1:{halign:"center"},2:{halign:"right"},3:{halign:"right"}},didDrawPage:()=>{Ct(n,1)},rowPageBreak:"avoid",tableWidth:o-M*2});const x=((D=n.lastAutoTable)==null?void 0:D.finalY)??120;Nt(n,{startY:x+6,body:[["Total HT",`${r.montantHT.toFixed(2)} €`],[`TVA ${Math.round(r.taxRate)}%`,`${r.montantTVA.toFixed(2)} €`],["Total TTC",`${r.montantTTC.toFixed(2)} €`]],theme:"plain",styles:{fontSize:10,halign:"right"},columnStyles:{0:{halign:"left"}},margin:{left:o-100-M,right:M}});let g=n.lastAutoTable.finalY+8;if(r.paymentMethod){if(n.setFont("helvetica","bold"),n.text("Mode de règlement",M,g),n.setFont("helvetica","normal"),g+=5,n.text(r.paymentMethod,M,g),g+=4,r.nombreChequesAVenir&&r.nombreChequesAVenir>0&&r.montantRestant){const T=(r.montantRestant/r.nombreChequesAVenir).toFixed(2);n.setFont("helvetica","normal"),n.setFontSize(9),n.text(`• ${r.nombreChequesAVenir} chèques de ${T}€ chacun`,M+5,g+3),n.text(`• Montant total des chèques : ${r.montantRestant.toFixed(2)}€`,M+5,g+7),g+=10}g+=2}n.setFont("helvetica","bold"),n.text("Merci pour votre confiance 🙏",M,g),n.setFont("helvetica","normal"),n.setFontSize(9);const N=`Paiement par virement : IBAN ${G.iban} — BIC ${G.bic}. Indiquez le n° de facture ${r.invoiceNumber} en référence.`,p=n.splitTextToSize(N,o-M*2);if(n.text(p,M,g+5),r.signature&&r.isSigned){g+=20,n.setFont("helvetica","bold"),n.setFontSize(10),n.text("Signature client :",M,g);try{const T=await Js(r.signature);if(n.addImage(T,"JPEG",M,g+5,50,25),g+=30,r.signatureDate){n.setFont("helvetica","normal"),n.setFontSize(8);const O=new Date(r.signatureDate).toLocaleDateString("fr-FR");n.text(`Signé le ${O}`,M,g),g+=5}}catch{n.setFont("helvetica","normal"),n.setFontSize(9),n.text("✓ Signature électronique enregistrée",M,g+5),g+=15}}g+=10,n.setFont("helvetica","bold"),n.setFontSize(8),n.text("⚖️ INFORMATION LÉGALE - ARTICLE L224-59",M,g),n.setFont("helvetica","normal"),n.setFontSize(7);const v=n.splitTextToSize("« Avant la conclusion de tout contrat entre un consommateur et un professionnel à l'occasion d'une foire, d'un salon [...] le professionnel informe le consommateur qu'il ne dispose pas d'un délai de rétractation. »",o-M*2);n.text(v,M,g+4),n.addPage("a4","portrait"),n.setFont("helvetica","bold"),n.setFontSize(14),n.text("Conditions Générales de Vente",M,20);const y=(o-M*2-6)/2,S=M,b=M+y+6;let j=28,P=28;n.setFont("helvetica","normal"),n.setFontSize(9.2),Ks.forEach(T=>{const O=[`${T.title}`,T.text],z=n.splitTextToSize(O.join(" — "),y),L=4.4,_=z.length*L+2;if(j+_<285&&j<=P){n.setFont("helvetica","bold"),n.text(T.title,S,j),n.setFont("helvetica","normal");const V=n.splitTextToSize(T.text,y);n.text(V,S,j+5),j+=V.length*L+9}else{n.setFont("helvetica","bold"),n.text(T.title,b,P),n.setFont("helvetica","normal");const V=n.splitTextToSize(T.text,y);n.text(V,b,P+5),P+=V.length*L+9}}),Ct(n,2);const w=new Blob([n.output("arraybuffer")],{type:"application/pdf"}),F=w.size/(1024*1024);return console.log("📄 PDF généré:",{pages:2,size:`${F.toFixed(2)} MB`,sizeBytes:w.size,invoiceNumber:r.invoiceNumber,hasLogo:!!l,hasSignature:!!(r.signature&&r.isSigned)}),F>5&&(console.warn(`⚠️ PDF très volumineux (${F.toFixed(2)}MB) - Cela peut causer des problèmes d'envoi!`),console.warn("💡 Conseil: Vérifiez la taille des images (logo/signature) ou utilisez des formats plus compressés")),w},async generate(a,t){return this.generateInvoicePDF(a,void 0,t)}};function Xs(a){const t=(a.products||[]).map(s=>({name:s.name||s.designation||"Produit",designation:s.designation||s.name,quantity:Number(s.quantity)||1,priceTTC:Number(s.priceTTC)||0,discount:Number(s.discount)||0,discountType:s.discountType==="amount"?"amount":"percent",category:s.category||""}));return{invoiceNumber:String(a.invoiceNumber||"N/A"),invoiceDate:String(a.invoiceDate||new Date().toLocaleDateString("fr-FR")),clientName:String(a.clientName||"Client"),clientAddress:String(a.clientAddress||""),clientPostalCode:a.clientPostalCode?String(a.clientPostalCode):void 0,clientCity:a.clientCity?String(a.clientCity):void 0,clientPhone:a.clientPhone?String(a.clientPhone):void 0,clientEmail:a.clientEmail?String(a.clientEmail):void 0,products:t,montantHT:Number(a.montantHT)||0,montantTVA:Number(a.montantTVA)||0,montantTTC:Number(a.montantTTC)||0,taxRate:Number(a.taxRate)||20,paymentMethod:a.paymentMethod?String(a.paymentMethod):void 0,invoiceNotes:a.invoiceNotes?String(a.invoiceNotes):void 0,signature:a.signature?String(a.signature):void 0,isSigned:!!a.isSigned,signatureDate:a.signatureDate?String(a.signatureDate):void 0,nombreChequesAVenir:Number(a.nombreChequesAVenir)||0,montantRestant:Number(a.montantRestant)||0}}class $t{static async generateInvoicePDF(t){console.log("🎨 GÉNÉRATION PDF IDENTIQUE À L'EXEMPLE HTML FOURNI"),console.log("📄 PDF SERVICE - DONNÉES REÇUES:"),console.log("🔢 Numéro facture:",t.invoiceNumber),console.log("👤 Client:",t.clientName),console.log("🛒 Products originaux:",t.products),console.log("🛒 ANALYSE DÉTAILLÉE DES PRODUITS:"),!t.products||t.products.length===0?(console.error("❌ AUCUN PRODUIT REÇU PAR LE PDF SERVICE !"),console.error("🔍 Propriétés disponibles:",Object.keys(t))):t.products.forEach((n,o)=>{console.log(`🏷️ Produit ${o+1} reçu par PDF:`,{name:n.name,quantity:n.quantity,priceTTC:n.priceTTC,discount:n.discount,discountType:n.discountType,TOUTES_PROPRIETES:n})});const s=new We({unit:"mm",format:"a4",compress:!0}),r=this.convertInvoiceData(t);return this.addHeaderLikeHTML(s,r),this.addInvoiceInfoLikeHTML(s,r),this.addClientSectionLikeHTML(s,r),this.addLogisticsSectionLikeHTML(s,r),this.addPaymentSectionLikeHTML(s,r),this.addProductsSectionLikeHTML(s,r),this.addTotalsLikeHTML(s,r),this.addFooterLikeHTML(s),console.log("✅ PDF GÉNÉRÉ IDENTIQUE À L'EXEMPLE HTML"),s}static addHeaderLikeHTML(t,s){t.setFillColor(...this.COLORS.primary),t.rect(0,0,210,35,"F"),t.setTextColor(0,0,0),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("MyCoNfort",20,20),t.setTextColor(0,0,0),t.setFontSize(12),t.setFont("helvetica","normal"),t.text("Facturation professionnelle avec signature électronique",20,28),s.signature&&(t.setFillColor(255,255,255,.2),t.roundedRect(160,12,35,10,2,2,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("SIGNÉE",177,18,{align:"center"}))}static addInvoiceInfoLikeHTML(t,s){t.setFillColor(...this.COLORS.white),t.rect(0,35,210,40,"F"),t.setTextColor(...this.COLORS.dark),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("MyCoNfort",20,50),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("88 Avenue des Ternes",20,56),t.text("75017 Paris, France",20,61),t.text("SIRET: 824 313 530 00027",20,66),t.text("Tél: 04 68 50 41 45",20,71),t.setFontSize(12),t.setFont("helvetica","bold"),t.text(`N° Facture: ${s.invoiceNumber}`,140,50),t.text(`Date: ${new Date(s.invoiceDate).toLocaleDateString("fr-FR")}`,140,56),s.eventLocation&&t.text(`Lieu: ${s.eventLocation}`,140,62)}static addClientSectionLikeHTML(t,s){t.setFillColor(...this.COLORS.primary),t.rect(0,75,210,12,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("INFORMATIONS CLIENT",105,82,{align:"center"}),t.setFillColor(...this.COLORS.grayLight),t.rect(0,87,210,25,"F"),t.setTextColor(...this.COLORS.dark),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Nom complet*",20,95),t.setFont("helvetica","normal"),t.text(s.clientName,20,100),t.setFont("helvetica","bold"),t.text("Adresse*",60,95),t.setFont("helvetica","normal"),t.text(s.clientAddress,60,100),t.setFont("helvetica","bold"),t.text("Code postal*",120,95),t.setFont("helvetica","normal"),t.text(s.clientPostalCode,120,100),t.setFont("helvetica","bold"),t.text("Ville*",150,95),t.setFont("helvetica","normal"),t.text(s.clientCity,150,100),t.setFont("helvetica","bold"),t.text("Email*",180,95),t.setFont("helvetica","normal"),t.text(s.clientEmail,180,100),t.setFont("helvetica","bold"),t.text("Téléphone*",20,107),t.setFont("helvetica","normal"),t.text(s.clientPhone,50,107),s.clientDoorCode&&(t.setFont("helvetica","bold"),t.text("Code porte",120,107),t.setFont("helvetica","normal"),t.text(s.clientDoorCode,150,107))}static addLogisticsSectionLikeHTML(t,s){let r=115;t.setFillColor(...this.COLORS.blue),t.roundedRect(20,r,170,8,2,2,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("INFORMATIONS LOGISTIQUES",105,r+5,{align:"center"}),r+=12,s.deliveryMethod&&(t.setTextColor(...this.COLORS.dark),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("Mode de livraison:",20,r),t.setFont("helvetica","normal"),t.text(s.deliveryMethod,60,r),r+=8)}static addPaymentSectionLikeHTML(t,s){let r=135;t.setFillColor(...this.COLORS.primary),t.roundedRect(20,r,170,8,2,2,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("MODE DE REGLEMENT",105,r+5,{align:"center"}),r+=12,s.paymentMethod&&(t.setTextColor(...this.COLORS.dark),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("Méthode de paiement:",20,r),t.setFont("helvetica","normal"),t.text(s.paymentMethod,70,r),r+=8),t.setFont("helvetica","bold"),t.text("Signature client MyCoNfort:",20,r),s.signature&&(t.setTextColor(...this.COLORS.green),t.text("✓ Signature électronique enregistrée",80,r))}static addProductsSectionLikeHTML(t,s){let r=160;if(t.setFillColor(...this.COLORS.primary),t.rect(20,r,170,12,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Produits & Tarification",105,r+7,{align:"center"}),r+=20,s.signature){t.setTextColor(...this.COLORS.dark),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("SIGNATURE CLIENT",105,r,{align:"center"}),t.setDrawColor(...this.COLORS.grayBorder),t.setFillColor(...this.COLORS.grayLight),t.roundedRect(20,r+3,170,15,1,1,"FD");try{t.addImage(s.signature,"PNG",85,r+5,40,10,void 0,"FAST")}catch(o){console.warn("Erreur ajout signature:",o),t.setTextColor(153,153,153),t.setFontSize(8),t.text("[Signature électronique validée]",105,r+11,{align:"center"})}r+=25}console.log("📊 GÉNÉRATION TABLEAU PDF - data.items reçu:",s.items),console.log("📊 Nombre d'items pour le tableau:",s.items.length),s.items.forEach((o,i)=>{console.log(`📊 Item ${i+1} pour tableau PDF:`,{description:o.description,qty:o.qty,unitPriceHT:o.unitPriceHT,unitPriceTTC:o.unitPriceTTC,discount:o.discount,discountType:o.discountType,total:o.total,ITEM_COMPLET:o})});const n=s.items.map(o=>[o.qty.toString(),k(o.unitPriceHT),k(o.unitPriceTTC),o.discount>0?o.discountType==="percent"?`${o.discount}%`:k(o.discount):"-",k(o.total)]);console.log("📊 DONNÉES FORMATÉES POUR LE TABLEAU:",n),Rt(t,{startY:r,head:[["Quantité","PU HT","PU TTC","Remise","Total TTC"]],body:n,theme:"grid",headStyles:{fillColor:[...this.COLORS.primary],textColor:[...this.COLORS.white],fontSize:10,fontStyle:"bold",halign:"center",cellPadding:3},bodyStyles:{fontSize:9,cellPadding:3,textColor:[...this.COLORS.dark],halign:"center"},alternateRowStyles:{fillColor:[...this.COLORS.grayLight]},margin:{left:20,right:20}})}static addTotalsLikeHTML(t,s){const r=t.lastAutoTable.finalY+10;t.setTextColor(...this.COLORS.dark),t.setFontSize(12),t.setFont("helvetica","normal");let n=r+10;t.text("Total HT:",130,n),t.setFont("helvetica","bold"),t.text(k(s.totalHT),180,n,{align:"right"}),n+=8,t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(...this.COLORS.primary),t.text("TOTAL TTC:",130,n),t.text(k(s.totalTTC),180,n,{align:"right"}),s.depositAmount&&s.depositAmount>0&&(n+=12,t.setFont("helvetica","normal"),t.setFontSize(10),t.setTextColor(...this.COLORS.dark),t.text("Acompte versé:",130,n),t.setTextColor(...this.COLORS.blue),t.text(k(s.depositAmount),180,n,{align:"right"}),n+=6,t.setFont("helvetica","bold"),t.setTextColor(...this.COLORS.orange),t.text("RESTE À PAYER:",130,n),t.text(k(s.totalTTC-s.depositAmount),180,n,{align:"right"}))}static addFooterLikeHTML(t){const s=t.internal.pageSize.height;t.setFillColor(...this.COLORS.primary),t.rect(0,s-30,210,30,"F"),t.setTextColor(0,0,0),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("MyCoNfort",105,s-20,{align:"center"}),t.setTextColor(0,0,0),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("Merci pour votre confiance !",105,s-14,{align:"center"}),t.setTextColor(0,0,0),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Votre spécialiste en matelas et literie de qualité",105,s-10,{align:"center"}),t.text("88 Avenue des Ternes, 75017 Paris - Tél: 04 68 50 41 45",105,s-6,{align:"center"}),t.text("Email: myconfort@gmail.com - SIRET: 824 313 530 00027",105,s-2,{align:"center"})}static async getCompressedPDFForEmail(t){console.log("🗜️ GÉNÉRATION PDF COMPRESSÉ POUR ENVOI EMAIL (MAX 50KB)");try{const r=(await this.generateInvoicePDF(t)).output("blob"),n=Math.round(r.size/1024);if(console.log("📊 Taille PDF standard:",n,"KB"),n<=50)return console.log("✅ PDF déjà sous 50KB, aucune compression nécessaire"),{blob:r,sizeKB:n,compressed:!1};console.log("🔧 PDF trop volumineux, génération version compressée...");const i=(await this.generateCompressedPDF(t)).output("blob"),l=Math.round(i.size/1024);return console.log("📊 Taille PDF compressé:",l,"KB"),{blob:i,sizeKB:l,compressed:!0}}catch(s){throw console.error("❌ Erreur génération PDF compressé:",s),s}}static async generateCompressedPDF(t){const s=new We({unit:"mm",format:"a4",compress:!0}),r=this.convertInvoiceData(t);return this.addCompressedHeader(s,r),this.addCompressedContent(s,r),this.addCompressedFooter(s),s}static addCompressedHeader(t,s){t.setFillColor(...this.COLORS.primary),t.rect(10,10,190,15,"F"),t.setTextColor(0,0,0),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("MyCoNfort",15,20),t.setFontSize(10),t.text(`Facture: ${s.invoiceNumber}`,150,20)}static addCompressedContent(t,s){let r=35;t.setTextColor(...this.COLORS.dark),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("CLIENT:",15,r),t.setFont("helvetica","normal"),t.text(s.clientName,15,r+5),t.text(s.clientEmail,15,r+10),r+=20,t.setFont("helvetica","bold"),t.text("PRODUITS:",15,r),r+=5,s.items.forEach(n=>{t.setFont("helvetica","normal"),t.text(`${n.qty}x ${n.description} - ${k(n.total)}`,15,r),r+=5}),r+=10,t.setFont("helvetica","bold"),t.setFontSize(12),t.text(`TOTAL TTC: ${k(s.totalTTC)}`,15,r)}static addCompressedFooter(t){const s=t.internal.pageSize.height;t.setTextColor(0,0,0),t.setFontSize(8),t.text("MyCoNfort - Merci de votre confiance !",105,s-10,{align:"center"})}static convertInvoiceData(t){var m,d,h;console.log("🔍 CONVERTINVOICEDATA - Structure reçue:",{hasProducts:!!t.products,hasItems:!!t.items,hasProduits:!!t.produits,productsLength:((m=t.products)==null?void 0:m.length)||0,itemsLength:((d=t.items)==null?void 0:d.length)||0,produitsLength:((h=t.produits)==null?void 0:h.length)||0,STRUCTURE_COMPLETE:t});let s=[];t.products&&Array.isArray(t.products)&&t.products.length>0?(s=t.products,console.log("✅ Utilisation de invoice.products:",s)):t.items&&Array.isArray(t.items)&&t.items.length>0?(s=t.items,console.log("✅ Utilisation de invoice.items:",s)):t.produits&&Array.isArray(t.produits)&&t.produits.length>0?(s=t.produits,console.log("✅ Utilisation de invoice.produits:",s)):(console.warn("⚠️ Aucun tableau de produits trouvé dans la structure"),s=[]);const r=s.map((c,x)=>{console.log(`🏷️ Mapping produit ${x+1}:`,{name:c.name||c.description||c.titre||c.libelle,quantity:c.quantity||c.qty||c.quantite||1,priceTTC:c.priceTTC||c.price||c.prix||c.unitPrice||0,STRUCTURE_PRODUIT:c});const g=c.name||c.description||c.titre||c.libelle||"Produit sans nom",N=c.quantity||c.qty||c.quantite||1,p=c.priceTTC||c.price||c.prix||c.unitPrice||0,u=c.category||c.categorie||"",v=c.discount||c.remise||0,y=c.discountType||c.typeRemise||"percentage";return{description:g,category:u,qty:N,unitPriceHT:te(p,t.taxRate),unitPriceTTC:p,discount:v,discountType:y,total:q(N,p,v,y)}});console.log("✅ MAPPING TERMINÉ - Items générés pour le PDF:",r),console.log("📊 Résumé du mapping:",{nombreItems:r.length,totalCalculé:r.reduce((c,x)=>c+x.total,0),premiersItems:r.slice(0,3).map(c=>({description:c.description,qty:c.qty,unitPriceTTC:c.unitPriceTTC,total:c.total}))});const n=r.reduce((c,x)=>c+x.total,0),o=n/(1+t.taxRate/100),i=n-o,l=r.reduce((c,x)=>{const g=x.unitPriceTTC*x.qty;return c+(g-x.total)},0);return{clientName:t.clientName,clientAddress:t.clientAddress,clientCity:t.clientCity,clientPostalCode:t.clientPostalCode,clientPhone:t.clientPhone,clientEmail:t.clientEmail,clientHousingType:t.clientHousingType,clientDoorCode:t.clientDoorCode,clientSiret:t.clientSiret,invoiceNumber:t.invoiceNumber,invoiceDate:t.invoiceDate,eventLocation:t.eventLocation,items:r,totalHT:o,totalTTC:n,totalTVA:i,totalDiscount:l,taxRate:t.taxRate,notes:t.invoiceNotes,advisorName:t.advisorName,paymentMethod:t.paymentMethod,depositAmount:t.montantAcompte,montantRestant:n-(t.montantAcompte||0),signature:t.signature,deliveryMethod:t.deliveryMethod,deliveryNotes:t.deliveryNotes,nombreChequesAVenir:t.nombreChequesAVenir}}static async downloadPDF(t){const s=await this.generateInvoicePDF(t),r=`facture_${t.invoiceNumber}.pdf`;s.save(r)}static async getPDFBlob(t){return console.log("📎 GÉNÉRATION BLOB PDF IDENTIQUE À L'EXEMPLE HTML"),(await this.generateInvoicePDF(t)).output("blob")}}re($t,"COLORS",{primary:[104,159,56],primaryDark:[124,179,66],cream:[242,239,226],dark:[51,51,51],white:[255,255,255],grayLight:[248,248,248],grayBorder:[221,221,221],red:[220,38,38],orange:[255,140,0],blue:[25,118,210],green:[76,175,80]});const Zs=()=>{const a={invoiceNumber:"TEST-001",invoiceDate:"2025-01-30",eventLocation:"Paris",taxRate:20,clientName:"Client Test",clientEmail:"test@example.com",clientPhone:"0123456789",clientAddress:"123 Rue Test",clientPostalCode:"75001",clientCity:"Paris",clientHousingType:"Appartement",clientDoorCode:"",clientSiret:"",products:[{name:"Matelas Test",category:"Literie",quantity:1,priceTTC:999.99,priceHT:833.33,totalHT:833.33,totalTTC:999.99,discount:0,discountType:"percent"},{name:"Oreiller Test",category:"Accessoires",quantity:2,priceTTC:89.9,priceHT:74.92,totalHT:149.84,totalTTC:179.8,discount:10,discountType:"percent"}],montantHT:0,montantTTC:0,montantTVA:0,montantRemise:0,paymentMethod:"Test",montantAcompte:0,montantRestant:0,deliveryMethod:"",deliveryNotes:"",signature:"",isSigned:!1,invoiceNotes:"",advisorName:"Test",termsAccepted:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},t=async()=>{console.log("🧪 TEST DIAGNOSTIC PDF"),console.log("📋 Invoice de test:",a);try{await $t.downloadPDF(a),console.log("✅ PDF généré avec succès")}catch(s){console.error("❌ Erreur génération PDF:",s)}};return e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h2",{children:"🔬 Diagnostic PDF vs Aperçu"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"20px"},children:[e.jsxs("div",{style:{border:"2px solid #3B82F6",borderRadius:"8px",padding:"16px"},children:[e.jsx("h3",{children:"📱 APERÇU HTML (invoice.products directement)"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#3B82F6",color:"white"},children:[e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Produit"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Qté"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Prix TTC"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Remise"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Total"})]})}),e.jsx("tbody",{children:a.products.map((s,r)=>{const n=q(s.quantity,s.priceTTC,s.discount,s.discountType==="percent"?"percent":"fixed");return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:s.name}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center"},children:s.quantity}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right"},children:k(s.priceTTC)}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right"},children:s.discount>0?`${s.discount}${s.discountType==="percent"?"%":"€"}`:"-"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right",fontWeight:"bold"},children:k(n)})]},r)})})]}),e.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#EBF8FF",borderRadius:"4px"},children:[e.jsx("strong",{children:"Total calculé dans l'aperçu :"}),e.jsx("br",{}),k(a.products.reduce((s,r)=>s+q(r.quantity,r.priceTTC,r.discount,r.discountType==="percent"?"percent":"fixed"),0))]})]}),e.jsxs("div",{style:{border:"2px solid #EF4444",borderRadius:"8px",padding:"16px"},children:[e.jsx("h3",{children:"📄 PDF (via convertInvoiceData)"}),e.jsxs("p",{style:{color:"#6B7280",fontSize:"14px"},children:["Le PDF utilise convertInvoiceData() qui mappe invoice.products vers data.items.",e.jsx("br",{}),'Cliquez sur "Tester PDF" et regardez les logs de la console pour voir ce qui se passe.']}),e.jsx("button",{onClick:t,style:{background:"#EF4444",color:"white",border:"none",padding:"12px 24px",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:"🧪 Tester Génération PDF"}),e.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#FEF2F2",borderRadius:"4px"},children:[e.jsx("strong",{children:"Instructions :"}),e.jsx("br",{}),'1. Cliquez sur "Tester PDF"',e.jsx("br",{}),"2. Regardez les logs de la console",e.jsx("br",{}),"3. Comparez les montants dans le PDF généré",e.jsx("br",{}),"4. Si les montants diffèrent, le problème est dans convertInvoiceData()"]})]})]}),e.jsxs("div",{style:{background:"#F3F4F6",padding:"16px",borderRadius:"8px"},children:[e.jsx("h4",{children:"🔍 Structure de test utilisée :"}),e.jsx("pre",{style:{fontSize:"12px",overflow:"auto"},children:JSON.stringify(a.products,null,2)})]})]})},er=({invoice:a,onSuccess:t,onError:s})=>{const[r,n]=f.useState(null),[o,i]=f.useState(!1),[l,m]=f.useState("payload"),[d,h]=f.useState(!1),c=async()=>{var p,u,v;try{console.log("🔍 GÉNÉRATION PAYLOAD DEBUG - DIAGNOSTIC COMPLET");const y="JVBERi0xLjQKJcOkw7zDtsO4CjIgMCBvYmoKPDwKL0xlbmd0aCAzIDAgUgo+PgpzdHJlYW0K",S=150;console.group("📋 DONNÉES BRUTES INVOICE"),console.log("Invoice object:",{invoiceNumber:a.invoiceNumber,clientName:a.clientName,clientEmail:a.clientEmail,clientPhone:a.clientPhone,products:a.products.length,paymentMethod:a.paymentMethod,totalProducts:a.products.reduce((P,w)=>P+w.quantity*w.priceTTC,0)}),console.groupEnd();const b=zt.validateAndPrepare(a,y,S),j={timestamp:new Date().toISOString(),validation:b,rawInvoice:a,payloadSize:b.payload?JSON.stringify(b.payload).length:0,fieldMapping:{"clientName → clientName":a.clientName,"clientEmail → clientEmail":a.clientEmail,"clientPhone → clientPhone":a.clientPhone,"clientAddress → clientAddress":a.clientAddress,"products.length → products":a.products.length,"paymentMethod → paymentMethod":a.paymentMethod,"calculated totalHT":(p=b.payload)==null?void 0:p.totalHT,"calculated totalTTC":(u=b.payload)==null?void 0:u.totalTTC},requiredFieldsCheck:{clientEmail:!!a.clientEmail,clientPhone:!!a.clientPhone,clientName:!!a.clientName,invoiceNumber:!!a.invoiceNumber,products:a.products.length>0,paymentMethod:!!a.paymentMethod},stats:{jsonSize:b.payload?JSON.stringify(b.payload).length:0,productsCount:a.products.length,pdfSizeKB:S,hasSignature:!!a.signature,termsAccepted:a.termsAccepted}};n(j),b.isValid?t("✅ Payload généré et validé avec succès"):s(`❌ Erreurs de validation: ${(v=b.errors)==null?void 0:v.join(", ")}`)}catch(y){s(`❌ Erreur génération payload: ${y.message}`)}},x=async()=>{i(!0);try{const p=await Ne.testConnection();p.success?t(p.message):s(p.message)}catch(p){s(`❌ Erreur test connexion: ${p.message}`)}finally{i(!1)}},g=()=>{var p;(p=r==null?void 0:r.validation)!=null&&p.payload?(navigator.clipboard.writeText(JSON.stringify(r.validation.payload,null,2)),t("📋 Payload copié dans le presse-papiers")):s("❌ Aucun payload à copier. Générez d'abord le payload.")},N=()=>{if(r){const p=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),u=URL.createObjectURL(p),v=document.createElement("a");v.href=u,v.download=`debug-payload-${a.invoiceNumber}-${Date.now()}.json`,document.body.appendChild(v),v.click(),document.body.removeChild(v),URL.revokeObjectURL(u),t("📥 Fichier de debug téléchargé")}else s("❌ Aucune donnée de debug à télécharger")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-orange-100 p-2 rounded-full",children:e.jsx(ke,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Centre de Debug"}),e.jsx("p",{className:"text-gray-600",children:"Diagnostic et validation du payload N8N"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"Générer Payload"})]}),e.jsxs("button",{onClick:x,disabled:o,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{children:o?"Test...":"Test N8N"})]})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[{id:"payload",label:"Payload",icon:ht},{id:"connection",label:"Connexion",icon:gt},{id:"logs",label:"Logs",icon:me},{id:"pdf",label:"Test PDF",icon:at}].map(({id:p,label:u,icon:v})=>e.jsxs("button",{onClick:()=>m(p),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-md font-medium transition-all ${l===p?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(v,{className:"w-4 h-4"}),e.jsx("span",{children:u})]},p))}),e.jsxs("div",{className:"space-y-4",children:[l==="payload"&&e.jsx($e,{title:"Validation du Payload",icon:ht,iconColor:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${r.validation.isValid?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.validation.isValid?e.jsx(ve,{className:"w-5 h-5 text-green-500"}):e.jsx(mt,{className:"w-5 h-5 text-red-500"}),e.jsx("h4",{className:`font-bold ${r.validation.isValid?"text-green-800":"text-red-800"}`,children:r.validation.isValid?"Validation Réussie":"Erreurs de Validation"})]}),!r.validation.isValid&&r.validation.errors&&e.jsx("ul",{className:"list-disc ml-5 space-y-1 text-red-700",children:r.validation.errors.map((p,u)=>e.jsx("li",{className:"text-sm",children:p},u))})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"🗺️ Mapping des Champs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:Object.entries(r.fieldMapping).map(([p,u])=>{const v=u!=null&&u!=="";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:v?"text-green-600":"text-red-600",children:v?"✅":"❌"}),e.jsxs("span",{className:"font-medium",children:[p,":"]}),e.jsx("span",{className:"text-gray-600 truncate",children:typeof u=="string"&&u.length>20?`${u.substring(0,20)}...`:String(u||"MANQUANT")})]},p)})})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-yellow-800 mb-3",children:"⚠️ Champs Obligatoires"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:Object.entries(r.requiredFieldsCheck).map(([p,u])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:u?"text-green-600":"text-red-600",children:u?"✅":"❌"}),e.jsx("span",{className:u?"text-gray-700":"text-red-700 font-medium",children:p})]},p))})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:g,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(Lt,{className:"w-4 h-4"}),e.jsx("span",{children:"Copier Payload"})]}),e.jsxs("button",{onClick:N,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{children:"Télécharger Debug"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Aucun payload généré"}),e.jsx("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium",children:"Générer le Payload Debug"})]})}),l==="connection"&&e.jsx($e,{title:"Test de Connexion N8N",icon:gt,iconColor:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"Configuration Webhook"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"URL:"})," ","https://n8n.srv765811.hstgr.cloud/webhook/facture-universelle"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Méthode:"})," POST"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Content-Type:"})," application/json"]})]})]}),e.jsxs("button",{onClick:x,disabled:o,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",children:[e.jsx(Ye,{className:"w-5 h-5"}),e.jsx("span",{children:o?"Test en cours...":"Tester la Connexion N8N"})]})]})}),l==="logs"&&e.jsx($e,{title:"Logs de Debug",icon:me,iconColor:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-auto max-h-64",children:[e.jsx("div",{children:"📋 Console Logs (ouvrez la console du navigateur pour voir les logs détaillés)"}),e.jsx("div",{children:"🔍 Payload complet à envoyer: [Voir console]"}),e.jsx("div",{children:"⚠️ Champs manquants: [Voir console]"}),e.jsx("div",{children:"🗺️ Mapping des données: [Voir console]"}),e.jsx("div",{children:"📊 Statistiques payload: [Voir console]"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-800 mb-2",children:"💡 Instructions Debug"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-1 text-sm text-blue-700",children:[e.jsx("li",{children:"Ouvrez la console du navigateur (F12)"}),e.jsx("li",{children:"Générez un payload pour voir les logs détaillés"}),e.jsx("li",{children:"Vérifiez que tous les champs requis sont présents"}),e.jsx("li",{children:"Copiez le payload pour le tester dans Postman"}),e.jsx("li",{children:'Dans n8n, activez "Listen for test event" pour voir les données reçues'})]})]})]})}),l==="pdf"&&e.jsx($e,{title:"� Diagnostic PDF vs Aperçu",icon:at,iconColor:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-red-800 mb-2",children:"� Problème Identifié"}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Le PDF généré affiche des montants différents de l'aperçu HTML. Ce diagnostic compare les deux sources de données."}),e.jsxs("ul",{className:"list-disc ml-5 space-y-1 text-sm text-red-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Aperçu HTML :"})," Utilise"," ",e.jsx("code",{children:"invoice.products"})," directement"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Service PDF :"})," Utilise"," ",e.jsx("code",{children:"convertInvoiceData()"})," pour mapper les données"]}),e.jsx("li",{children:"Le problème est probablement dans le mapping des produits"})]})]}),e.jsx(Zs,{}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-800 mb-2",children:"💡 Instructions de Test"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-1 text-sm text-blue-700",children:[e.jsx("li",{children:"Comparez les montants dans les deux colonnes ci-dessus"}),e.jsx("li",{children:'Cliquez sur "Tester Génération PDF" (colonne droite)'}),e.jsx("li",{children:"Regardez les logs dans la console du navigateur (F12)"}),e.jsx("li",{children:"Vérifiez que le PDF téléchargé a les bons montants"}),e.jsxs("li",{children:["Si les montants diffèrent, le problème est dans"," ",e.jsx("code",{children:"convertInvoiceData()"})]})]})]})]})})]}),r&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"📊 Statistiques Debug"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.stats.jsonSize}),e.jsx("div",{className:"text-gray-600",children:"Caractères JSON"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.stats.productsCount}),e.jsx("div",{className:"text-gray-600",children:"Produits"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.stats.pdfSizeKB}),e.jsx("div",{className:"text-gray-600",children:"KB PDF"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.stats.hasSignature?"✅":"❌"}),e.jsx("div",{className:"text-gray-600",children:"Signature"})]})]})]})]})},tr=({isOpen:a,onClose:t,onSave:s})=>{const r=f.useRef(null),[n,o]=f.useState(!1),[i,l]=f.useState(null);f.useEffect(()=>{a&&r.current&&ds(()=>import("./ui-utils-Bfb2iWCB.js").then(h=>h.s),[]).then(h=>{const c=h.default,x=r.current,g=x.getBoundingClientRect();x.width=g.width*window.devicePixelRatio,x.height=g.height*window.devicePixelRatio,x.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);const p=new c(x,{backgroundColor:"rgb(255, 255, 255)",penColor:"rgb(0, 0, 0)",minWidth:1,maxWidth:3});l(p);const u=()=>o(!0),v=()=>o(!1);return x.addEventListener("mousedown",u),x.addEventListener("touchstart",u),x.addEventListener("mouseup",v),x.addEventListener("touchend",v),()=>{x.removeEventListener("mousedown",u),x.removeEventListener("touchstart",u),x.removeEventListener("mouseup",v),x.removeEventListener("touchend",v)}})},[a]);const m=()=>{i&&i.clear()},d=()=>{if(i&&!i.isEmpty()){const h=i.toDataURL();s(h),t()}else alert("Veuillez fournir une signature avant de valider.")};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-xl font-bold text-[#14281D]",children:"Signature du client"}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(fe,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"border-2 border-gray-300 rounded mb-4 bg-white",children:e.jsx("canvas",{ref:r,className:"w-full h-48 touch-none",style:{touchAction:"none"}})}),e.jsx("div",{className:"text-sm text-gray-600 mb-4 text-center",children:n?"Signature en cours...":"Signez dans la zone ci-dessus"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:m,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:"Effacer"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all",children:"Annuler"}),e.jsxs("button",{onClick:d,className:"bg-[#477A0C] hover:bg-[#3A6A0A] text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all",children:[e.jsx(us,{className:"w-4 h-4"}),e.jsx("span",{children:"Valider"})]})]})]})]})]})}):null},sr=({message:a,type:t,show:s,onClose:r})=>(Ve.useEffect(()=>{if(s){const n=setTimeout(r,3e3);return()=>clearTimeout(n)}},[s,r]),s?e.jsx("div",{className:`fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 transition-all duration-300 ${s?"translate-y-0 opacity-100":"translate-y-2 opacity-0"}`,children:e.jsxs("div",{className:`flex items-center space-x-2 px-6 py-4 rounded-lg shadow-xl border-2 max-w-md ${t==="success"?"bg-green-50 text-green-800 border-green-200":t==="error"?"bg-red-50 text-red-800 border-red-200":t==="warning"?"bg-orange-50 text-orange-800 border-orange-200":"bg-blue-50 text-blue-800 border-blue-200"}`,children:[t==="success"?e.jsx(ve,{className:"w-6 h-6 text-green-600"}):t==="error"?e.jsx(De,{className:"w-6 h-6 text-red-600"}):t==="warning"?e.jsx(mt,{className:"w-6 h-6 text-orange-600"}):e.jsx(xs,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"font-medium",children:a})]})}):null),Bt=a=>{localStorage.setItem("myconfortClients",JSON.stringify(a))},dt=()=>{const a=localStorage.getItem("myconfortClients");return a?JSON.parse(a):[]},rr=a=>{localStorage.setItem("myconfortInvoiceDraft",JSON.stringify(a))},nr=()=>{const a=localStorage.getItem("myconfortInvoiceDraft");return a?JSON.parse(a):null},ar=a=>{const t=dt(),s=t.findIndex(r=>r.email===a.email&&r.name===a.name);s>=0?t[s]={...t[s],...a}:t.push({...a,id:Date.now().toString(),createdAt:new Date().toISOString()}),Bt(t)},_t=a=>{localStorage.setItem("myconfortInvoices",JSON.stringify(a))},Pe=()=>{const a=localStorage.getItem("myconfortInvoices");return a?JSON.parse(a):[]},Ut=a=>{const t=Pe(),s=t.findIndex(r=>r.invoiceNumber===a.invoiceNumber);s>=0?t[s]={...a,updatedAt:new Date().toISOString()}:t.push({...a,createdAt:new Date().toISOString()}),_t(t)},or=a=>{const s=Pe().filter(r=>r.invoiceNumber!==a);_t(s)};function ir(){const a=Ie(),[t,s]=f.useState({invoiceNumber:it(),invoiceDate:new Date().toISOString().split("T")[0],eventLocation:"",taxRate:20,clientName:"",clientEmail:"",clientPhone:"",clientAddress:"",clientAddressLine2:"",clientPostalCode:"",clientCity:"",clientHousingType:"",clientDoorCode:"",clientSiret:"",products:[],montantHT:0,montantTTC:0,montantTVA:0,montantRemise:0,paymentMethod:"",montantAcompte:0,depositPaymentMethod:"",montantRestant:0,deliveryMethod:"",deliveryAddress:"",deliveryNotes:"",signature:"",isSigned:!1,signatureDate:void 0,invoiceNotes:"",advisorName:"",termsAccepted:!1,nombreChequesAVenir:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),[r,n]=f.useState([]),[o,i]=f.useState([]),[l,m]=f.useState(!1),[d,h]=f.useState(!1),[c,x]=f.useState(!1),[g,N]=f.useState(!1),[p,u]=f.useState(!1),[v,y]=f.useState(!1),[S,b]=f.useState(!1),[j,P]=f.useState(!1),[w,F]=f.useState(!1),[D,T]=f.useState(!0),[O,z]=f.useState({show:!1,message:"",type:"success"});f.useEffect(()=>{n(dt()),i(Pe());const A=nr();A&&(s(A),L("Brouillon chargé","success"));const E=setInterval(()=>{U()},6e4);return()=>clearInterval(E)},[]);const L=(A,E="success")=>{z({show:!0,message:A,type:E})},_=()=>{z(A=>({...A,show:!1}))},U=()=>{try{if(rr(t),t.clientName&&t.clientEmail){const A={name:t.clientName,address:t.clientAddress,postalCode:t.clientPostalCode,city:t.clientCity,phone:t.clientPhone,email:t.clientEmail},E=V(A);ar(E),n(dt())}L("Brouillon enregistré","success")}catch{L("Erreur lors de l'enregistrement","error")}},ee=()=>{try{if(!t.clientName||!t.clientEmail||t.products.length===0){L("Veuillez compléter les informations client et ajouter au moins un produit","error");return}Ut(t),i(Pe()),L(`Facture ${t.invoiceNumber} enregistrée avec succès`,"success")}catch{L("Erreur lors de l'enregistrement de la facture","error")}},V=A=>{console.log("🧹 NETTOYAGE DES DONNÉES CLIENT:",A);const E=X=>typeof X!="string"?"":X.replace(/[\\"]*/g,"").replace(/\s+/g," ").trim(),$={...A,name:E(A.name||""),address:E(A.address||""),addressLine2:E(A.addressLine2||""),postalCode:E(A.postalCode||""),city:E(A.city||""),phone:E(A.phone||""),email:E(A.email||""),housingType:E(A.housingType||""),doorCode:E(A.doorCode||""),siret:E(A.siret||"")};$.email&&!$.email.includes("@")&&console.warn("⚠️ Email invalide détecté:",$.email);const Y=["@","rue","avenue","boulevard"];return $.name&&Y.some(X=>$.name.toLowerCase().includes(X))&&console.warn("⚠️ Le nom contient des données suspectes:",$.name),console.log("✅ DONNÉES NETTOYÉES:",$),$},ue=()=>{const A=[];return(!t.invoiceDate||t.invoiceDate.trim()==="")&&A.push("Date de la facture obligatoire"),(!t.eventLocation||t.eventLocation.trim()==="")&&A.push("Lieu de l'événement obligatoire"),(!t.clientName||t.clientName.trim()==="")&&A.push("Nom complet du client obligatoire"),(!t.clientAddress||t.clientAddress.trim()==="")&&A.push("Adresse du client obligatoire"),(!t.clientPostalCode||t.clientPostalCode.trim()==="")&&A.push("Code postal du client obligatoire"),(!t.clientCity||t.clientCity.trim()==="")&&A.push("Ville du client obligatoire"),(!t.clientPhone||t.clientPhone.trim()==="")&&A.push("Téléphone du client obligatoire"),(!t.clientEmail||t.clientEmail.trim()==="")&&A.push("Email du client obligatoire"),t.clientEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.clientEmail)&&A.push("Format d'email invalide"),t.products.length===0&&A.push("Au moins un produit obligatoire"),{isValid:A.length===0,errors:A}},Oe=async()=>{console.log("🚀 DÉBUT GÉNÉRATION PDF AVEC SERVICE UNIFIÉ");try{const A=await ct.generateInvoicePDF(t),E=Math.round(A.size/1024);return console.log("🎉 PDF généré avec service unifié - Analyse:",{taille:E+"KB",pages:"2 pages (Facture + CGV)",source:"PDFService unifié (jsPDF + autotable)",format:"A4 professionnel",contientLogo:!0,contientCGV:!0}),A}catch(A){throw console.error("❌ Erreur lors de la génération PDF:",A),new Error(`Erreur génération PDF: ${(A==null?void 0:A.message)||"Erreur inconnue"}`)}},ae=async()=>{const A=ue();if(!A.isValid){L(`Impossible de télécharger le PDF. Champs obligatoires manquants: ${A.errors.join(", ")}`,"error");return}U(),ee(),L("Génération et téléchargement du PDF MYCONFORT en cours...","success");try{console.log("🔍 TÉLÉCHARGEMENT PDF - Utilisation du même PDF que webhook (HTML-based)");const E=await Oe();if(!E)throw new Error("Erreur lors de la génération du PDF");const $=URL.createObjectURL(E),Y=document.createElement("a");Y.href=$,Y.download=`facture-${t.invoiceNumber}.pdf`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL($);const X=Math.round(E.size/1024);console.log("✅ PDF téléchargé avec succès:",{fileName:`facture-${t.invoiceNumber}.pdf`,sizeKB:X,source:"generatePDFBlobFromPreview (HTML-based)",contientSignature:!!t.signature}),L(`PDF MYCONFORT téléchargé avec succès${t.signature?" (avec signature électronique)":""} - ${X}KB`,"success")}catch(E){console.error("❌ PDF download error:",E),L(`Erreur lors du téléchargement du PDF: ${(E==null?void 0:E.message)||"Erreur inconnue"}`,"error")}},xe=async()=>{const A=ue();if(!A.isValid){L(`Impossible d'envoyer le PDF. Champs obligatoires manquants: ${A.errors.join(", ")}`,"error");return}U(),ee(),L("📤 Préparation de l'envoi du PDF MYCONFORT...","success");try{console.log("🔍 DIAGNOSTIC AVANT GÉNÉRATION PDF");const E={...t,clientName:V({name:t.clientName}).name,clientAddress:V({address:t.clientAddress}).address,clientAddressLine2:V({addressLine2:t.clientAddressLine2}).addressLine2,clientCity:V({city:t.clientCity}).city,clientEmail:V({email:t.clientEmail}).email,clientPhone:V({phone:t.clientPhone}).phone};console.log("📋 Invoice data NETTOYÉ:",E),console.log("📋 Invoice data structure check:",{invoiceNumber:E.invoiceNumber,clientName:E.clientName,clientEmail:E.clientEmail,clientPhone:E.clientPhone,clientAddress:E.clientAddress,clientCity:E.clientCity,clientPostalCode:E.clientPostalCode,productsCount:E.products.length,paymentMethod:E.paymentMethod,montantAcompte:E.montantAcompte,advisorName:E.advisorName,eventLocation:E.eventLocation,taxRate:E.taxRate,termsAccepted:E.termsAccepted,totalCalculated:E.products.reduce((tt,Me)=>tt+Me.quantity*Me.priceTTC,0)});const $=await Oe();if(!$){console.error("❌ PDF Blob generation failed"),L("❌ Erreur lors de la génération du PDF","error");return}const Y=await new Promise((tt,Me)=>{const qe=new FileReader;qe.onload=()=>tt(qe.result.split(",")[1]),qe.onerror=()=>Me(new Error("Erreur conversion PDF en Base64")),qe.readAsDataURL($)}),X=Math.round($.size/1024);if(!E.clientEmail||E.clientEmail.trim()===""){L("❌ Email client obligatoire pour l'envoi N8N","error");return}if(!E.clientEmail.includes("@")){L("❌ Format d'email client invalide","error");return}console.log("📄 PDF généré:",{sizeKB:X,base64Length:Y.length,base64Preview:Y.substring(0,50)+"..."}),L("🔐 Validation et envoi vers N8N...","success");const Ce=await Ne.sendInvoiceToN8n(E,Y);if(Ce.success)L(Ce.message,"success");else throw new Error(Ce.message)}catch(E){const $=E instanceof Error?E.message:"Erreur inconnue";console.error("❌ Erreur envoi PDF via N8N:",E),L(`❌ Erreur d'envoi N8N: ${$}`,"error")}},pe=()=>{const A=ue();if(!A.isValid){L(`Impossible d'imprimer. Champs obligatoires manquants: ${A.errors.join(", ")}`,"error");return}U(),ee(),L("📄 Préparation impression A4 professionnelle (2 pages)...","success");try{const E=document.getElementById("invoice-preview-section");if(!E){L("❌ Aperçu de facture non trouvé","error");return}console.log("📄 IMPRESSION: Facture complète (2 pages), dimensions:",{width:E.offsetWidth,height:E.offsetHeight});const $=document.body.innerHTML,Y=document.title,X=`
        <style>
          @page {
            size: A4;
            margin: 0;
          }
          
          .page {
            width: 210mm;      /* Largeur A4 exacte */
            min-height: 297mm; /* Hauteur A4 exacte */
            padding: 15mm;     /* Marges uniformes */
            page-break-after: always;
            box-sizing: border-box;
            margin: 0 auto;
            background: white;
          }
          
          body { 
            font-family: 'Inter', Arial, sans-serif; 
            margin: 0; 
            padding: 0; 
            background: white; 
            font-size: 12px; 
            line-height: 1.4; 
            color: #2D3748;
          }
          
          /* Respecter les sauts de page originaux */
          div[style*="pageBreakBefore: 'always'"] {
            page-break-before: always !important;
          }
          
          /* Conserver les couleurs et styles originaux */
          .bg-\\[\\#477A0C\\] { background: #477A0C !important; }
          .bg-\\[\\#F2EFE2\\] { background: #F2EFE2 !important; }
          .bg-white { background: white !important; }
          .text-white { color: white !important; }
          
          /* Tailles de texte optimisées pour A4 */
          h1 { font-size: 18px !important; margin: 8px 0 !important; }
          h2 { font-size: 16px !important; margin: 6px 0 !important; }
          h3 { font-size: 14px !important; margin: 4px 0 !important; }
          p { margin: 4px 0 !important; font-size: 11px !important; }
          
          table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 8px 0 !important; 
            font-size: 10px !important; 
          }
          table th, table td { 
            border: 1px solid #ddd; 
            padding: 6px !important; 
            line-height: 1.3; 
          }
          table th { 
            background: #f5f5f5 !important; 
            font-weight: bold; 
          }
          
          /* Ajustements de mise en page pour A4 */
          .p-4, .p-6 { padding: 8px !important; }
          .mb-4, .mb-6 { margin-bottom: 8px !important; }
          .rounded-xl, .rounded-lg { border-radius: 8px !important; }
        </style>
      `;document.title="Impression Facture MyConfort - A4 Professionnel (2 pages)";const Ce=`
        <div class="page">
          ${E.outerHTML}
        </div>
      `;document.body.innerHTML=X+Ce,setTimeout(()=>{window.print(),setTimeout(()=>{document.body.innerHTML=$,document.title=Y,L("✅ Impression A4 terminée (format professionnel)","success")},1e3)},500)}catch(E){console.error("Erreur impression:",E),L("❌ Erreur lors de l'impression","error")}},C=A=>{ee(),L(A,"success")},I=A=>{L(A,"error")},R=A=>{console.log("🔍 CHARGEMENT CLIENT - Données brutes:",A);const E=V(A);s($=>({...$,clientName:E.name,clientAddress:E.address,clientAddressLine2:E.addressLine2,clientPostalCode:E.postalCode,clientCity:E.city,clientPhone:E.phone,clientEmail:E.email})),m(!1),L("Client chargé avec succès (données nettoyées)","success")},K=A=>{const E=r.filter(($,Y)=>Y!==A);n(E),Bt(E),L("Client supprimé","success")},H=A=>{s(A),L(`Facture ${A.invoiceNumber} chargée avec succès`,"success")},oe=A=>{const E=o[A];E&&(or(E.invoiceNumber),i(Pe()),L(`Facture ${E.invoiceNumber} supprimée`,"success"))},se=A=>{s(E=>({...E,signature:A})),L("Signature enregistrée - Facture prête pour envoi !","success")},W=()=>{window.confirm(`Créer une nouvelle facture ?

Les données actuelles seront perdues si elles ne sont pas sauvegardées.`)&&(s({invoiceNumber:it(),invoiceDate:new Date().toISOString().split("T")[0],eventLocation:"",taxRate:20,clientName:"",clientEmail:"",clientPhone:"",clientAddress:"",clientAddressLine2:"",clientPostalCode:"",clientCity:"",clientHousingType:"",clientDoorCode:"",clientSiret:"",products:[],montantHT:0,montantTTC:0,montantTVA:0,montantRemise:0,paymentMethod:"",montantAcompte:0,montantRestant:0,deliveryMethod:"",deliveryNotes:"",signature:"",isSigned:!1,signatureDate:"",invoiceNotes:"",advisorName:"",termsAccepted:!1,nombreChequesAVenir:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),L("✅ Nouvelle facture créée avec succès !","success"))},et=ue();return e.jsxs("div",{className:"min-h-screen font-['Inter'] text-gray-100",style:{backgroundColor:"#14281D"},children:[e.jsx(ws,{onShowClients:()=>m(!0),onShowInvoices:()=>h(!0),onShowProducts:()=>x(!0),onShowGoogleDrive:xe,onShowDebug:()=>P(!0),onGoToIpad:()=>a("/ipad?step=facture")}),e.jsxs("main",{className:"container mx-auto px-4 py-6",id:"invoice-content",children:[e.jsx("div",{className:"text-white rounded-xl shadow-xl p-6 mb-6",style:{background:"linear-gradient(135deg, #477A0C 0%, #5A8F0F 25%, #3A6A0A 50%, #6BA015 75%, #477A0C 100%)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx("span",{className:"text-2xl",children:"🌸"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"MYCONFORT"}),e.jsx("p",{className:"text-green-100",children:"Facturation professionnelle avec signature électronique"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-blue-100",children:"Statut de la facture"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[et.isValid?e.jsxs("div",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[e.jsx("span",{children:"✅"}),e.jsx("span",{children:"COMPLÈTE"})]}):e.jsxs("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[e.jsx("span",{children:"⚠️"}),e.jsx("span",{children:"INCOMPLÈTE"})]}),t.signature&&e.jsxs("div",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[e.jsx("span",{children:"🔒"}),e.jsx("span",{children:"SIGNÉE"})]}),e.jsxs("button",{onClick:W,className:"bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-semibold flex items-center space-x-2 transition-all hover:scale-105 shadow-md",title:"Créer une nouvelle facture",children:[e.jsx("span",{children:"📝"}),e.jsx("span",{children:"Nouvelle facture"})]})]})]})]})}),j&&e.jsx("div",{className:"mb-6",children:e.jsx(er,{invoice:t,onSuccess:C,onError:I})}),e.jsx(As,{invoice:t,onUpdate:A=>s(E=>({...E,...A}))}),e.jsx("div",{id:"client-section",children:e.jsx(Ss,{client:{name:t.clientName,address:t.clientAddress,addressLine2:t.clientAddressLine2,postalCode:t.clientPostalCode,city:t.clientCity,phone:t.clientPhone,email:t.clientEmail,housingType:t.clientHousingType,doorCode:t.clientDoorCode,siret:t.clientSiret||""},onUpdate:A=>s(E=>({...E,clientName:A.name,clientAddress:A.address,clientAddressLine2:A.addressLine2,clientPostalCode:A.postalCode,clientCity:A.city,clientPhone:A.phone,clientEmail:A.email,clientHousingType:A.housingType||"",clientDoorCode:A.doorCode||"",clientSiret:A.siret||""}))})}),e.jsx("div",{id:"products-section",children:e.jsx(Ls,{products:t.products,onUpdate:A=>s(E=>({...E,products:A})),taxRate:t.taxRate,invoiceNotes:t.invoiceNotes,onNotesChange:A=>s(E=>({...E,invoiceNotes:A})),acompteAmount:t.montantAcompte,onAcompteChange:A=>s(E=>({...E,montantAcompte:A})),paymentMethod:t.paymentMethod,onPaymentMethodChange:A=>s(E=>({...E,paymentMethod:A})),advisorName:t.advisorName,onAdvisorNameChange:A=>s(E=>({...E,advisorName:A})),termsAccepted:t.termsAccepted,onTermsAcceptedChange:A=>s(E=>({...E,termsAccepted:A})),signature:t.signature,onShowSignaturePad:()=>F(!0),nombreChequesAVenir:t.nombreChequesAVenir||0,onNombreChequesAVenirChange:A=>s(E=>({...E,nombreChequesAVenir:A}))})}),e.jsxs("div",{id:"delivery-section",className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsx("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"INFORMATIONS LOGISTIQUES"})}),e.jsxs("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"Mode de livraison"}),e.jsxs("select",{value:t.deliveryMethod,onChange:A=>s(E=>({...E,deliveryMethod:A.target.value})),className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold",children:[e.jsx("option",{value:"",children:"Sélectionner"}),e.jsx("option",{value:"Colissimo 48 heures",children:"Colissimo 48 heures"}),e.jsx("option",{value:"Livraison par transporteur",children:"Livraison par transporteur"}),e.jsx("option",{value:"Retrait en magasin",children:"Retrait en magasin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"Précisions de livraison"}),e.jsx("textarea",{value:t.deliveryNotes,onChange:A=>s(E=>({...E,deliveryNotes:A.target.value})),className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold h-20",placeholder:"Instructions spéciales, étage, code d'accès..."})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-black italic font-semibold",children:e.jsx("p",{children:"📦 Livraison estimée sous 48 heures. Les délais sont donnés à titre indicatif et ne sont pas contractuels."})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-[#477A0C] flex items-center",children:[e.jsx("span",{className:"mr-3",children:"📄"}),"APERÇU DE LA FACTURE"]}),e.jsx("button",{onClick:()=>T(!D),className:`px-4 py-2 rounded-lg font-semibold transition-all ${D?"bg-red-500 hover:bg-red-600 text-white":"bg-[#477A0C] hover:bg-green-700 text-white"}`,children:D?"Masquer l'aperçu 🌸":"Afficher l'aperçu 🌸"})]}),D&&e.jsx("div",{className:"border-2 border-[#477A0C] rounded-lg p-4 bg-gray-50",children:e.jsx("div",{id:"invoice-preview-section",className:"bg-white rounded-lg overflow-hidden",children:e.jsx("div",{className:"transition-all duration-500",children:e.jsx(Qe,{invoice:t})})})})]}),e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsx("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"ACTIONS PRINCIPALES"})}),e.jsx("div",{className:"bg-[#F2EFE2] rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"Email du destinataire"}),e.jsx("input",{value:t.clientEmail,onChange:A=>s(E=>({...E,clientEmail:A.target.value})),type:"email",className:"w-full md:w-64 border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold",placeholder:"client@email.com"})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>N(!0),className:"px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 bg-blue-600 hover:bg-blue-700 text-white",title:"Ouvrir l'aperçu de la facture et télécharger le PDF",children:[e.jsx("span",{children:"👁️"}),e.jsx("span",{children:"APERÇU & PDF"})]}),e.jsxs("button",{onClick:ee,disabled:!t.clientName||!t.clientEmail||t.products.length===0,className:`px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 disabled:hover:scale-100 ${t.clientName&&t.clientEmail&&t.products.length>0?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,title:t.clientName&&t.clientEmail&&t.products.length>0?"Enregistrer la facture dans l'onglet Factures":"Complétez les informations client et ajoutez au moins un produit",children:[e.jsx("span",{children:"💾"}),e.jsx("span",{children:"ENREGISTRER"})]}),e.jsxs("button",{onClick:pe,className:"px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 bg-orange-600 hover:bg-orange-700 text-white",title:"Imprimer la facture complète (2 pages : facture + conditions générales)",children:[e.jsx("span",{children:"🖨️"}),e.jsx("span",{children:"IMPRIMER (2 PAGES)"})]}),e.jsxs("button",{onClick:xe,className:"px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx("span",{children:"📧"}),e.jsx("span",{children:"ENVOYER PAR EMAIL/DRIVE"})]})]})]})})]})]}),e.jsx(Rs,{isOpen:l,onClose:()=>m(!1),clients:r,onLoadClient:R,onDeleteClient:K}),e.jsx(qs,{isOpen:d,onClose:()=>h(!1),invoices:o,onLoadInvoice:H,onDeleteInvoice:oe}),e.jsx(zs,{isOpen:c,onClose:()=>x(!1)}),e.jsx(Bs,{isOpen:g,onClose:()=>N(!1),invoice:t,onDownload:ae}),e.jsx(_s,{isOpen:p,onClose:()=>u(!1),onSuccess:C,onError:I}),e.jsx(Vs,{isOpen:v,onClose:()=>y(!1),onSuccess:C,onError:I}),e.jsx(Ys,{isOpen:S,onClose:()=>b(!1),invoice:t,onSuccess:C,onError:I}),j&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx("button",{onClick:()=>P(!1),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium",children:"Fermer Debug"})}),e.jsx(tr,{isOpen:w,onClose:()=>F(!1),onSave:se}),e.jsx(sr,{message:O.message,type:O.type,show:O.show,onClose:_}),e.jsx("div",{className:"fixed bottom-2 right-2 text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded",children:"v2025.07.27-15h00"})]})}const J=ps((a,t)=>({step:"facture",invoiceNumber:"",invoiceDate:"",eventLocation:"",isFairEvent:!1,client:{name:""},produits:[],paiement:{method:""},livraison:{},signature:{dataUrl:"",timestamp:""},signatureDataUrl:void 0,invoiceNotes:"",advisorName:"",termsAccepted:!0,completion:{completedStepIds:[]},steps:["facture","client","produits","paiement","livraison","signature","recap","nouvelles-commandes"],getCurrentStepIndex:()=>{const s=t();return s.steps.indexOf(s.step)},setStep:s=>a({step:s}),goNext:()=>{const s=t(),r=s.steps.indexOf(s.step),n=Math.min(r+1,s.steps.length-1),o=s.steps[n];o&&a({step:o})},goPrev:()=>{const s=t(),r=s.steps.indexOf(s.step),n=Math.max(r-1,0),o=s.steps[n];o&&a({step:o})},setInvoiceData:s=>a(r=>{const n=s.eventLocation??r.eventLocation,o=n?/foire|salon|exposition/i.test(n):!1;return{invoiceNumber:s.invoiceNumber??r.invoiceNumber,invoiceDate:s.invoiceDate??r.invoiceDate,eventLocation:n,isFairEvent:o}}),updateClient:s=>a(r=>({client:{...r.client,...s}})),updateEventLocation:s=>a(()=>({eventLocation:s,isFairEvent:/foire|salon|exposition/i.test(s)})),addProduit:s=>{const n=t().applyFairDiscountIfNeeded(s);a(o=>({produits:[...o.produits,n]}))},updateProduit:(s,r)=>a(n=>({produits:n.produits.map(o=>o.id===s?{...o,...r}:o)})),removeProduit:s=>a(r=>({produits:r.produits.filter(n=>n.id!==s)})),applyFairDiscountIfNeeded:s=>t().isFairEvent&&s.category==="Matelas"?{...s,discount:20,discountType:"percent"}:s,updatePaiement:s=>a(r=>({paiement:{...r.paiement,...s}})),updateLivraison:s=>a(r=>({livraison:{...r.livraison,...s}})),updateSignature:s=>a(r=>({signature:{...r.signature,...s}})),setSignature:s=>a({signatureDataUrl:s}),updateInvoiceNotes:s=>a({invoiceNotes:s}),updateAdvisorName:s=>a({advisorName:s}),setTermsAccepted:s=>a({termsAccepted:s}),reset:()=>a({step:"facture",invoiceNumber:"",invoiceDate:"",eventLocation:"",client:{name:""},produits:[],paiement:{method:""},livraison:{},signature:{dataUrl:"",timestamp:""},signatureDataUrl:void 0,invoiceNotes:"",advisorName:"",termsAccepted:!0,completion:{completedStepIds:[]}}),markStepDone:s=>a(r=>{var o;const n=new Set(((o=r.completion)==null?void 0:o.completedStepIds)??[]);return n.add(s),{completion:{completedStepIds:Array.from(n)}}}),resetCompletion:()=>a({completion:{completedStepIds:[]}}),syncFromMainInvoice:s=>{a({invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||"",eventLocation:s.eventLocation||"",client:{name:s.clientName||"",email:s.clientEmail||"",phone:s.clientPhone||"",address:s.clientAddress||"",addressLine2:s.clientAddressLine2||"",city:s.clientCity||"",postalCode:s.clientPostalCode||"",siret:s.clientSiret||"",housingType:s.clientHousingType||"",doorCode:s.clientDoorCode||""},produits:(s.products||[]).map(r=>({id:r.id||Math.random().toString(36),designation:r.designation||r.name||"",qty:r.quantity||r.qty||1,priceTTC:r.priceTTC||r.price||0,category:r.category||""})),paiement:{method:s.paymentMethod||"",depositAmount:s.montantAcompte||0,remainingAmount:s.montantRestant||0,nombreChequesAVenir:s.nombreChequesAVenir||0},livraison:{deliveryMethod:s.deliveryMethod||"",deliveryNotes:s.deliveryNotes||"",deliveryAddress:s.deliveryAddress||""},signatureDataUrl:s.signature||void 0,invoiceNotes:s.invoiceNotes||"",advisorName:s.advisorName||"",termsAccepted:s.termsAccepted||!0})},syncToMainInvoice:()=>{const s=t();return{invoiceNumber:s.invoiceNumber,invoiceDate:s.invoiceDate,eventLocation:s.eventLocation,clientName:s.client.name,clientEmail:s.client.email||"",clientPhone:s.client.phone||"",clientAddress:s.client.address||"",clientAddressLine2:s.client.addressLine2||"",clientCity:s.client.city||"",clientPostalCode:s.client.postalCode||"",clientSiret:s.client.siret||"",clientHousingType:s.client.housingType||"",clientDoorCode:s.client.doorCode||"",products:s.produits.map(r=>{const n=q(r.qty,r.priceTTC,r.discount||0,r.discountType||"percent");return{id:r.id,name:r.designation,designation:r.designation,quantity:r.qty,priceTTC:r.priceTTC,category:r.category||"",priceHT:+(r.priceTTC/1.2).toFixed(2),totalHT:+(n/1.2).toFixed(2),totalTTC:+n.toFixed(2),unitPrice:r.priceTTC,discount:r.discount||0,discountType:r.discountType||"percent",isPickupOnSite:r.isPickupOnSite}}),paymentMethod:(()=>{const r=s.paiement.method,n=s.paiement.depositAmount||0,o=s.paiement.nombreChequesAVenir||0,i=s.produits.reduce((l,m)=>{const d=q(m.qty,m.priceTTC,m.discount||0,m.discountType||"percent");return l+d},0);if(r==="Chèque à venir"&&o>0){const l=Math.round((i-n)/o);return`Chèque à venir (${o} chèques de ${l}€ + acompte ${n.toFixed(2)}€)`}if(r!=null&&r.startsWith("Alma")&&s.paiement.nombreFoisAlma){const l=Math.round((i-n)/s.paiement.nombreFoisAlma);return`${r} (${s.paiement.nombreFoisAlma} fois de ${l}€ + acompte ${n.toFixed(2)}€)`}return n>0&&r!=="Chèque à venir"&&!(r!=null&&r.startsWith("Alma"))?`${r} (acompte ${n.toFixed(2)}€)`:r||""})(),montantAcompte:s.paiement.depositAmount||0,depositPaymentMethod:s.paiement.depositPaymentMethod||"",montantRestant:s.paiement.remainingAmount||0,nombreChequesAVenir:s.paiement.nombreChequesAVenir||0,deliveryMethod:s.livraison.deliveryMethod||"",deliveryAddress:s.livraison.deliveryAddress||"",deliveryNotes:s.livraison.deliveryNotes||"",montantTTC:s.produits.reduce((r,n)=>{const o=q(n.qty,n.priceTTC,n.discount||0,n.discountType||"percent");return r+o},0),montantHT:s.produits.reduce((r,n)=>{const o=q(n.qty,n.priceTTC,n.discount||0,n.discountType||"percent");return r+o/1.2},0),montantTVA:s.produits.reduce((r,n)=>{const o=q(n.qty,n.priceTTC,n.discount||0,n.discountType||"percent"),i=o/1.2;return r+(o-i)},0),signature:s.signature.dataUrl||"",isSigned:!!s.signature.dataUrl,signatureDate:s.signature.dataUrl?s.signature.timestamp||new Date().toISOString():void 0,invoiceNotes:s.invoiceNotes||"",advisorName:s.advisorName||"",termsAccepted:s.termsAccepted}},setPaymentStatus:s=>a(r=>({paiement:{...r.paiement,paymentStatus:s}})),setPaymentData:s=>a(r=>({paiement:{...r.paiement,...s}})),clearPaymentData:()=>a(s=>({paiement:{...s.paiement,paymentStatus:"idle",paymentId:void 0,orderId:void 0,checkoutUrl:void 0,paymentError:void 0}}))})),Tt=()=>typeof performance<"u"?performance.now():Date.now();function lr({enabled:a=!0,axis:t="both",threshold:s=60,velocity:r=.2,preventScrollOnX:n=!0,onSwipe:o,onSwipeLeft:i,onSwipeRight:l,onSwipeUp:m,onSwipeDown:d}={}){const h=f.useRef(0),c=f.useRef(0),x=f.useRef(0),g=f.useRef(!1);f.useEffect(()=>{if(!a)return;const N=v=>{var S;if(!((S=v.touches)!=null&&S.length))return;const y=v.touches[0];h.current=y.clientX,c.current=y.clientY,x.current=Tt(),g.current=!0},p=v=>{g.current&&n&&(t==="x"||t==="both")&&v.preventDefault()},u=v=>{var T;if(!g.current)return;g.current=!1;const y=(T=v.changedTouches)==null?void 0:T[0];if(!y)return;const S=Tt()-x.current,b=y.clientX-h.current,j=y.clientY-c.current,P=Math.abs(b),w=Math.abs(j),F=P>=w?P:w,D=S>0?F/S:0;if(!(F<s||D<r)){if((t==="x"||t==="both")&&P>=w){b<0?(o==null||o("left"),i==null||i()):(o==null||o("right"),l==null||l());return}(t==="y"||t==="both")&&w>P&&(j<0?(o==null||o("up"),m==null||m()):(o==null||o("down"),d==null||d()))}};return document.addEventListener("touchstart",N,{passive:!0}),document.addEventListener("touchmove",p,{passive:!n}),document.addEventListener("touchend",u,{passive:!0}),()=>{document.removeEventListener("touchstart",N),document.removeEventListener("touchmove",p),document.removeEventListener("touchend",u)}},[a,t,s,r,n,o,i,l,m,d])}function cr(a){const{enabled:t=!0,threshold:s=60,velocity:r=.2,preventScrollOnX:n=!0,onNext:o,onPrev:i}=a||{};lr({enabled:t,axis:"x",threshold:s,velocity:r,preventScrollOnX:n,onSwipeLeft:()=>o==null?void 0:o(),onSwipeRight:()=>i==null?void 0:i()})}function Ht({children:a}){const{goNext:t,goPrev:s,getCurrentStepIndex:r,steps:n=[],completion:o}=J(),[i,l]=f.useState(!1),[m,d]=f.useState(!1),h=r(),c=f.useMemo(()=>new Set((o==null?void 0:o.completedStepIds)??[]),[o==null?void 0:o.completedStepIds]),x=(g,N)=>c.has(g)?"done":N===h?"current":"todo";return cr({onNext:()=>t(),onPrev:()=>s(),threshold:56,velocity:.15,preventScrollOnX:!0}),e.jsxs("div",{className:"w-full h-dvh bg-gray-300 flex items-center justify-center overflow-hidden p-4",children:[m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-myconfort-blue border-opacity-70 bg-white/80 shadow-2xl"})}),e.jsxs("div",{className:"w-[950px] h-[650px] bg-myconfort-cream border-6 border-black rounded-lg shadow-2xl overflow-hidden relative",children:[e.jsx("button",{onClick:()=>l(!i),className:"absolute top-2 right-2 w-6 h-6 bg-black/70 hover:bg-black text-white rounded-full text-xs font-bold z-50 flex items-center justify-center transition-all",title:i?"Masquer les infos":"Afficher les infos iPad",children:i?"×":"i"}),i&&e.jsxs("div",{className:"absolute top-10 right-2 bg-black/90 text-white text-xs p-3 rounded-lg z-40 max-w-[200px]",children:[e.jsx("div",{className:"font-mono mb-1",children:"iPad 1024×768"}),e.jsx("div",{className:"text-white/80",children:"Mode paysage optimisé"}),e.jsx("div",{className:"text-white/80",children:"Swipe ← → pour naviguer"})]}),e.jsxs("header",{className:"w-full px-3 py-1 flex items-center justify-between border-b border-myconfort-dark/10",children:[e.jsxs("h1",{className:"text-xs font-medium text-myconfort-dark",children:["Wizard iPad — Étape ",Math.min(h+1,n.length),"/",n.length||0]}),e.jsx("nav",{className:"flex gap-1",children:n.map((g,N)=>{const p=x(g,N),u="h-1 w-3 rounded-full",v=p==="done"?"bg-myconfort-green":p==="current"?"bg-myconfort-blue":"bg-myconfort-dark/20";return e.jsx("span",{className:`${u} ${v}`,"aria-label":`${g} - ${p}`},g)})})]}),e.jsx("main",{className:"w-full h-[calc(768px-32px)]",children:a})]})]})}function dr({onNext:a,onQuit:t}){const{invoiceNumber:s,invoiceDate:r,eventLocation:n,advisorName:o,setInvoiceData:i,updateAdvisorName:l,updateEventLocation:m}=J(),[d,h]=f.useState(!1),[c,x]=f.useState(!1);f.useEffect(()=>{const S=new Date().toISOString().split("T")[0];s||i({invoiceNumber:it()}),r||i({invoiceDate:S})},[s,r,i]);const g=()=>{!n||n.trim()===""||!o||o.trim()===""||a()},N=n&&n.trim()!=="",p=!n||n.trim()==="",u=o&&o.trim()!=="",v=!o||o.trim()==="",y=N&&u;return e.jsxs("div",{className:"max-w-6xl mx-auto py-2 relative",children:[e.jsxs("div",{className:"bg-[#477A0C] rounded-lg shadow-lg p-4 mb-4 border border-gray-100",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#F2EFE2] mb-3 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-2 rounded-full font-bold text-xl",children:"📋 INFORMATIONS FACTURE"})}),e.jsx("div",{className:"bg-[#F2EFE2] rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-bold text-black mb-2",children:e.jsx("strong",{children:"MYCONFORT"})}),e.jsx("p",{className:"text-black font-semibold text-sm",children:e.jsx("strong",{children:"88 Avenue des Ternes"})}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"75017 Paris, France"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"SIRET: 824 313 530 00027"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"Tél: 04 68 50 41 45"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"Email: myconfort@gmail.com"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"Site web: https://www.htconfort.com"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-bold text-black text-sm",children:"Facture n°:"}),e.jsx("input",{value:s,type:"text",className:"border-2 border-[#477A0C] rounded-lg px-3 py-2 text-base font-mono text-black bg-white focus:border-[#F55D3E] focus:ring-1 focus:ring-[#89BBFE] transition-all font-bold",readOnly:!0})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("label",{className:"font-bold text-black text-sm",children:["Date: ",e.jsx("span",{className:"text-green-600",children:"✓ Auto"})]}),e.jsx("input",{value:r,onChange:S=>i({invoiceDate:S.target.value}),type:"date",className:"border-2 border-green-500 rounded-lg px-3 py-2 text-sm text-black bg-green-50 focus:ring-1 focus:ring-green-300 transition-all font-bold"}),e.jsx("p",{className:"text-green-600 text-xs font-semibold",children:"✅ Date remplie automatiquement"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("label",{className:"font-bold text-black text-sm",children:["Lieu de l'événement: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:n,onChange:S=>{m(S.target.value),h(!0)},type:"text",required:!0,className:`w-full border-2 rounded-lg px-3 py-2 text-sm text-black bg-white focus:ring-1 transition-all font-bold ${p&&d?"border-red-500 focus:border-red-500 focus:ring-red-200":N?"border-green-500 focus:border-green-600 focus:ring-green-200 bg-green-50":"border-red-500 focus:border-red-500 focus:ring-red-200"}`,placeholder:"Ex: Salon de l'habitat Paris, Maison du client, etc."}),p?e.jsx("p",{className:"text-red-600 text-xs font-bold flex items-center",children:"⚠️ Le lieu de l'événement est obligatoire pour continuer"}):e.jsx("p",{className:"text-green-600 text-xs font-bold flex items-center",children:"✅ Lieu renseigné - Vous pouvez continuer"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("label",{className:"font-bold text-black text-sm",children:["Conseiller/Vendeuse: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:o,onChange:S=>{l(S.target.value),x(!0)},type:"text",required:!0,className:`w-full border-2 rounded-lg px-3 py-2 text-sm text-black bg-white focus:ring-1 transition-all font-bold ${v&&c?"border-red-500 focus:border-red-500 focus:ring-red-200":u?"border-green-500 focus:border-green-600 focus:ring-green-200 bg-green-50":"border-red-500 focus:border-red-500 focus:ring-red-200"}`,placeholder:"Ex: Marie Dupont, Jean Martin, etc."}),v?e.jsx("p",{className:"text-red-600 text-xs font-bold flex items-center",children:"⚠️ Le nom du conseiller est obligatoire pour continuer"}):e.jsx("p",{className:"text-green-600 text-xs font-bold flex items-center",children:"✅ Conseiller renseigné - Vous pouvez continuer"})]})]})]})})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6 mb-4",children:[e.jsx("button",{onClick:t,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-xl text-lg transition-all transform hover:scale-105 shadow-lg",children:"← Quitter"}),e.jsx("button",{onClick:g,disabled:!y,className:`px-6 py-3 font-bold rounded-xl text-lg transition-all transform shadow-lg ${y?"bg-[#477A0C] hover:bg-[#3A6A0A] text-white hover:scale-105":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:y?"✅ Suivant: Client →":p&&v?"🚫 Remplir lieu et conseiller":p?"🚫 Remplir le lieu d'abord":"🚫 Remplir le conseiller d'abord"})]})]})}function mr({onNext:a,onPrev:t}){var x,g,N,p,u,v,y,S;const{client:s,updateClient:r}=J(),n=f.useRef(null),[o,i]=f.useState(!1);f.useEffect(()=>{var b;(b=n.current)==null||b.focus()},[]);const l=(b,j)=>r({[b]:j}),m={name:(((x=s.name)==null?void 0:x.trim().length)||0)>2,email:!!((g=s.email)!=null&&g.includes("@")),phone:(((N=s.phone)==null?void 0:N.trim().length)||0)>0,address:(((p=s.address)==null?void 0:p.trim().length)||0)>0,city:(((u=s.city)==null?void 0:u.trim().length)||0)>0,postalCode:(((v=s.postalCode)==null?void 0:v.trim().length)||0)>0,housingType:(((y=s.housingType)==null?void 0:y.trim().length)||0)>0,doorCode:(((S=s.doorCode)==null?void 0:S.trim().length)||0)>0||s.doorCode==="Pas de digicode"},d=b=>!o||m[b],h=m.name&&m.email&&m.phone&&m.address&&m.city&&m.postalCode&&m.housingType&&m.doorCode,c=()=>{i(!0),h&&a()};return e.jsx("div",{className:"min-h-screen w-full bg-myconfort-cream",style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},children:e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 pt-6 pb-6",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-myconfort-dark/10 mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-myconfort-dark font-manrope",children:"👤 Informations Client"}),e.jsxs("p",{className:"text-lg text-gray-600",children:["Étape 2/7 • Tous les champs"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})," = obligatoire"]})]}),e.jsx("div",{className:"px-4",children:e.jsxs("form",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(Le,{className:"w-4 h-4 text-myconfort-green"})," Nom complet"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{ref:n,type:"text",value:s.name||"",onChange:b=>l("name",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("name")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"Nom et prénom",required:!0}),!d("name")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Le nom doit faire plus de 2 caractères."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(Ft,{className:"w-4 h-4 text-myconfort-green"})," Email"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"email",value:s.email||"",onChange:b=>l("email",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("email")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"example@gmail.com",required:!0}),!d("email")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Adresse email valide requise."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(hs,{className:"w-4 h-4 text-myconfort-green"})," Téléphone"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"tel",value:s.phone||"",onChange:b=>l("phone",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("phone")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"06 12 34 56 78",required:!0}),!d("phone")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Numéro de téléphone requis."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(kt,{className:"w-4 h-4 text-myconfort-green"})," Adresse"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"text",value:s.address||"",onChange:b=>l("address",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("address")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"123 rue de la Paix",required:!0}),!d("address")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(bt,{className:"w-4 h-4 text-gray-400"})," Adresse 2 (optionnel)"]}),e.jsx("input",{type:"text",value:s.addressLine2||"",onChange:b=>l("addressLine2",b.target.value),className:"w-full px-3 py-2 text-base border-2 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none",placeholder:"Bâtiment, étage, etc."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(bt,{className:"w-4 h-4 text-myconfort-green"})," Ville"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"text",value:s.city||"",onChange:b=>l("city",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("city")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"Paris",required:!0}),!d("city")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(At,{className:"w-4 h-4 text-myconfort-green"})," Code postal"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s.postalCode||"",onChange:b=>l("postalCode",b.target.value),onFocus:b=>{b.target.style.fontSize="16px",b.target.style.webkitUserSelect="text",b.target.style.userSelect="text"},onTouchStart:b=>b.preventDefault(),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("postalCode")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,style:{WebkitAppearance:"none",WebkitUserSelect:"text",userSelect:"text",touchAction:"manipulation"},placeholder:"75001",required:!0}),!d("postalCode")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(It,{className:"w-4 h-4 text-myconfort-green"})," Type de logement ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsxs("select",{value:s.housingType||"",onChange:b=>l("housingType",b.target.value),onFocus:b=>{b.target.style.fontSize="16px",b.target.style.webkitUserSelect="none",b.target.style.userSelect="none"},className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none cursor-pointer ${d("housingType")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,style:{WebkitAppearance:"none",touchAction:"manipulation"},required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner..."}),e.jsx("option",{value:"Appartement",children:"Appartement"}),e.jsx("option",{value:"Maison",children:"Maison"}),e.jsx("option",{value:"Bureau",children:"Bureau"})]}),!d("housingType")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(gs,{className:"w-4 h-4 text-myconfort-green"})," Code porte"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s.doorCode==="Pas de digicode"?"":s.doorCode||"",onChange:b=>l("doorCode",b.target.value),onFocus:b=>{b.target.style.fontSize="16px",b.target.style.webkitUserSelect="text",b.target.style.userSelect="text"},disabled:s.doorCode==="Pas de digicode",className:`flex-1 px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${s.doorCode==="Pas de digicode"?"bg-gray-100 text-gray-500 border-gray-200":d("doorCode")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,style:{WebkitAppearance:"none",WebkitUserSelect:s.doorCode==="Pas de digicode"?"none":"text",userSelect:s.doorCode==="Pas de digicode"?"none":"text",touchAction:"manipulation"},placeholder:"A1234B"}),e.jsx("button",{type:"button",onClick:()=>l("doorCode",s.doorCode==="Pas de digicode"?"":"Pas de digicode"),className:`px-3 py-2 text-base font-medium rounded-lg border-2 transition-colors min-h-[40px] cursor-pointer select-none ${s.doorCode==="Pas de digicode"?"bg-myconfort-coral text-white border-myconfort-coral":"bg-gray-100 text-myconfort-dark border-gray-200 hover:bg-gray-200"}`,style:{WebkitUserSelect:"none",userSelect:"none",touchAction:"manipulation"},children:s.doorCode==="Pas de digicode"?"Annuler":"Pas de code"})]}),!d("doorCode")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:'Saisir un code ou choisir "Pas de code".'})]})]})]})}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6 mb-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-xl text-lg transition-all transform hover:scale-105 shadow-lg",children:"← Précédent"}),e.jsx("button",{type:"button",onClick:c,className:`px-12 py-4 font-bold rounded-xl text-lg transition-all transform shadow-lg ${h?"bg-myconfort-green hover:bg-myconfort-green/90 text-white hover:scale-105":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:h?"✅ Suivant →":"🚫 Compléter les champs"})]})]})})}const Ae=a=>{var t;return typeof a=="string"?a:((t=a==null?void 0:a.toString)==null?void 0:t.call(a))??""},Be=a=>{const t=Ae(a).trim();if(t==="")return{raw:"",clean:"",number:null};const s=t.replace(/\s+/g,"").replace(",","."),r=Number(s);return{raw:t,clean:s,number:Number.isFinite(r)?r:null}};function ie({value:a,onChange:t,min:s,max:r,placeholder:n,className:o="",step:i="0.01",disabled:l=!1,autoFocus:m=!1,"aria-label":d}){const[h,c]=f.useState(()=>Ae(a||"0"));f.useEffect(()=>{c(Ae(a||"0"))},[a]);const x=f.useCallback(u=>{const{number:v}=Be(u);if(v===null)return u;let y=v;return s!==void 0&&y<s&&(y=s),r!==void 0&&y>r&&(y=r),y!==v?String(y):u},[s,r]),g=f.useCallback(u=>{var b;const v=u.nativeEvent,y=u.currentTarget,S=Ae(v.data||"");if((b=v.inputType)!=null&&b.startsWith("insert")&&/^[0-9.,]$/.test(S)&&y.value==="0"){u.preventDefault();const{clean:j}=Be(S),P=x(j);c(P),t(P)}},[x,t]),N=f.useCallback(u=>{var F;const v=Ae(((F=u.target)==null?void 0:F.value)||"");if(v===""){c("0"),t("0");return}const y=v.startsWith("."),S=v.startsWith(",");if(y||S){const D=`0${S?v.replace(",","."):v}`,{number:T}=Be(D);if(T===null)return;const O=String(T),z=x(O);c(z),t(z);return}const{clean:b,number:j}=Be(v);if(j===null&&b!==""){c(b);return}const P=j!==null?String(j):b,w=x(P);c(w),t(w)},[x,t]),p=f.useCallback(u=>{u.target.select()},[]);return e.jsx("input",{type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",enterKeyHint:"done",value:h,onChange:N,onBeforeInput:g,onFocus:p,placeholder:n,className:`
        border-2 rounded-lg px-3 py-2 text-sm font-medium
        focus:ring-1 transition-all
        ${o}
      `.trim(),disabled:l,autoFocus:m,autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-label":d,step:i})}const ur=[...Ee,"Diverse"];function xr({onNext:a,onPrev:t}){const{produits:s,addProduit:r,updateProduit:n,removeProduit:o}=J(),[i,l]=f.useState({category:"",designation:"",qty:1,priceTTC:0,discount:0,discountType:"percent"}),m=20,d=s.length>0&&s.every(u=>u.isPickupOnSite!==void 0),h=f.useMemo(()=>!i.category||i.category==="Diverse"?[]:Se.filter(u=>u.category===i.category),[i.category]),c=f.useMemo(()=>{const u=s.reduce((b,j)=>b+q(Number(j.qty||0),Number(j.priceTTC||0),Number(j.discount||0),j.discountType||"percent"),0),v=s.reduce((b,j)=>{const P=q(Number(j.qty||0),Number(j.priceTTC||0),Number(j.discount||0),j.discountType||"percent");return b+te(P,m)},0),y=u-v,S=s.reduce((b,j)=>{const P=Number(j.qty||0)*Number(j.priceTTC||0),w=q(Number(j.qty||0),Number(j.priceTTC||0),Number(j.discount||0),j.discountType||"percent");return b+(P-w)},0);return{totalHT:v,totalTTC:u,totalTVA:y,totalRemise:S}},[s,m]),x=u=>{l(v=>({...v,category:u,designation:"",priceTTC:0}))},g=u=>{const v=h.find(y=>y.name===u);v&&l(y=>({...y,designation:v.name,priceTTC:v.priceTTC}))},N=()=>{if(!i.category.trim()||!i.designation.trim()||i.qty<=0||i.priceTTC<=0){alert("Veuillez remplir tous les champs obligatoires");return}const u=crypto.randomUUID();r({id:u,designation:i.designation.trim(),category:i.category,qty:Number(i.qty||1),priceTTC:Number(i.priceTTC||0),discount:Number(i.discount||0),discountType:i.discountType,isPickupOnSite:void 0}),l({category:"",designation:"",qty:1,priceTTC:0,discount:0,discountType:"percent"})},p=()=>{if(s.length===0){alert("Veuillez ajouter au moins un produit avant de continuer.");return}const u=s.filter(v=>v.isPickupOnSite===void 0);if(u.length>0){alert(`Veuillez définir le mode de livraison pour tous les produits.
${u.length} produit(s) sans mode de livraison défini.`);return}a()};return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"px-4 py-1 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark font-manrope",children:"📦 Produits & Services"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Étape 3/7 • Ajoutez les produits avec quantités et prix"})]}),e.jsxs("div",{className:"flex-1 px-4 py-2 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-myconfort-dark/10 mb-2",children:[e.jsx("h3",{className:"text-base font-medium text-myconfort-dark font-manrope mb-2",children:"➕ Ajouter un produit"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Catégorie ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsxs("select",{value:i.category,onChange:u=>x(u.target.value),className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green",children:[e.jsx("option",{value:"",children:"Sélectionner une catégorie"}),ur.map(u=>e.jsx("option",{value:u,children:u},u))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Produit ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),i.category==="Diverse"?e.jsx("input",{type:"text",placeholder:"Saisir le nom du produit...",value:i.designation,onChange:u=>l(v=>({...v,designation:u.target.value})),disabled:!i.category,className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green disabled:bg-gray-100 disabled:text-gray-500"}):e.jsxs("select",{value:i.designation,onChange:u=>g(u.target.value),disabled:!i.category,className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green disabled:bg-gray-100 disabled:text-gray-500",children:[e.jsx("option",{value:"",children:i.category?"Sélectionner un produit":"Sélectionner une catégorie d'abord"}),h.map(u=>e.jsx("option",{value:u.name,children:u.name},u.name))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Qté ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx(ie,{value:i.qty,onChange:u=>l(v=>({...v,qty:Number(u)||1})),min:1,className:"w-full text-myconfort-dark border-gray-200 hover:border-myconfort-green focus:border-myconfort-green","aria-label":"Quantité"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Prix TTC (€) ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx(ie,{value:i.priceTTC,onChange:u=>l(v=>({...v,priceTTC:Number(u)||0})),min:0,step:"0.01",className:"w-full text-myconfort-dark border-gray-200 hover:border-myconfort-green focus:border-myconfort-green","aria-label":"Prix TTC en euros"})]}),e.jsxs("div",{className:"space-y-1 col-span-2",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-gray-600 font-manrope",children:["Remise (optionnel)",i.discount>0&&e.jsx("span",{className:"text-myconfort-green ml-1 font-bold",children:"✓"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{value:i.discountType,onChange:u=>l(v=>({...v,discountType:u.target.value})),className:"w-12 px-1 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green",children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"€"})]}),e.jsx(ie,{value:i.discount,onChange:u=>l(v=>({...v,discount:Number(u)||0})),min:0,step:"0.01",placeholder:"0",className:"flex-1 text-myconfort-dark border-gray-200 hover:border-myconfort-green focus:border-myconfort-green","aria-label":"Montant de la remise"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-transparent",children:"Action"}),e.jsx("button",{onClick:N,disabled:!i.category||!i.designation||i.qty<=0||i.priceTTC<=0,className:`w-full px-3 py-2 rounded-lg text-sm font-medium font-manrope text-white transition-all min-h-[40px] ${!i.category||!i.designation||i.qty<=0||i.priceTTC<=0?"bg-myconfort-coral hover:bg-myconfort-coral/90":"bg-myconfort-green hover:bg-myconfort-green/90 shadow-lg"}`,children:"Ajouter"})]})]})]}),e.jsx("div",{className:"flex-1 bg-white rounded-lg border border-myconfort-dark/10 overflow-hidden",children:e.jsx("div",{className:"overflow-auto h-full",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-myconfort-green text-white sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-sm font-medium font-manrope",children:"PRODUIT"}),e.jsx("th",{className:"px-1 py-2 text-center text-sm font-medium font-manrope",children:"Qté"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"PU HT"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"PU TTC"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"Remise"}),e.jsx("th",{className:"px-1 py-2 text-center text-sm font-medium font-manrope",children:"Livraison"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"Total TTC"}),e.jsx("th",{className:"px-1 py-2 text-center text-sm font-medium font-manrope",children:"Actions"})]})}),e.jsxs("tbody",{children:[s.map((u,v)=>{const y=te(Number(u.priceTTC||0),m),S=q(Number(u.qty||0),Number(u.priceTTC||0),Number(u.discount||0),u.discountType||"percent");return e.jsxs("tr",{className:`border-b border-gray-100 ${v%2===0?"bg-gray-50":"bg-white"}`,children:[e.jsxs("td",{className:"px-2 py-2",children:[e.jsx("div",{className:"text-sm font-medium font-manrope text-myconfort-dark",children:u.designation}),e.jsx("div",{className:"text-xs text-gray-600",children:u.category||"Non définie"})]}),e.jsx("td",{className:"px-1 py-2 text-center",children:e.jsx(ie,{value:u.qty,onChange:b=>n(u.id,{qty:Number(b)||1}),min:1,className:"w-12 text-center text-myconfort-dark border-gray-200 hover:border-myconfort-green focus:border-myconfort-green","aria-label":"Quantité"})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsxs("div",{className:"text-sm font-medium font-manrope text-myconfort-dark",children:[y.toFixed(2)," €"]})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsx(ie,{value:u.priceTTC,onChange:b=>n(u.id,{priceTTC:Number(b)||0}),min:0,step:"0.01",className:"w-16 text-right text-myconfort-dark border-gray-200 hover:border-myconfort-green focus:border-myconfort-green","aria-label":"Prix TTC"})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{className:`w-8 px-1 py-1 text-xs border rounded font-manrope transition-colors duration-150 focus:outline-none focus:ring-0 ${(u.discount||0)>0?"border-myconfort-coral bg-red-50 text-red-700 focus:border-myconfort-coral":"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"}`,value:u.discountType||"percent",onChange:b=>n(u.id,{discountType:b.target.value}),children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"€"})]}),e.jsx(ie,{value:u.discount||0,onChange:b=>n(u.id,{discount:Number(b)||0}),min:0,step:"0.01",placeholder:"0",className:`w-10 text-right text-xs ${(u.discount||0)>0?"border-myconfort-coral bg-red-50 text-red-700 focus:border-myconfort-coral":"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"}`,"aria-label":"Remise"})]})}),e.jsx("td",{className:"px-1 py-2 text-center",children:e.jsxs("select",{className:`w-16 px-1 py-1 text-xs font-medium border rounded font-manrope transition-colors duration-150 focus:outline-none focus:ring-0 ${u.isPickupOnSite===void 0?"border-yellow-500 bg-yellow-100 text-yellow-800 focus:border-yellow-600":u.isPickupOnSite?"border-myconfort-green bg-green-100 text-green-800 focus:border-myconfort-green":"border-myconfort-coral bg-red-100 text-red-800 focus:border-myconfort-coral"}`,value:u.isPickupOnSite===void 0?"":u.isPickupOnSite?"emporter":"livrer",onChange:b=>{b.target.value===""?n(u.id,{isPickupOnSite:void 0}):n(u.id,{isPickupOnSite:b.target.value==="emporter"})},children:[e.jsx("option",{value:"",className:"text-black font-medium",children:"⚠️ À choisir"}),e.jsx("option",{value:"livrer",className:"text-black font-medium",children:"📦 À livrer"}),e.jsx("option",{value:"emporter",className:"text-black font-medium",children:"🚗 Emporter"})]})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsxs("div",{className:"text-sm font-bold text-myconfort-green font-manrope",children:[S.toFixed(2)," €"]})}),e.jsx("td",{className:"px-1 py-2 text-center",children:e.jsx("button",{onClick:()=>o(u.id),className:"w-6 h-6 rounded bg-myconfort-coral text-white font-bold hover:bg-red-600 transition-all font-manrope text-xs",title:"Supprimer",children:"✕"})})]},u.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-6 py-8 text-gray-500 text-center text-sm font-manrope",colSpan:8,children:"Aucun produit pour l'instant. Utilisez le formulaire ci-dessus pour ajouter des produits."})})]}),s.length>0&&e.jsx("tfoot",{className:"bg-myconfort-cream sticky bottom-0",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 text-right font-bold text-xs text-myconfort-dark font-manrope",colSpan:6,children:e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsxs("span",{children:["HT: ",c.totalHT.toFixed(2),"€"]}),e.jsxs("span",{children:["TVA (",m,"%): ",c.totalTVA.toFixed(2),"€"]}),c.totalRemise>0&&e.jsxs("span",{className:"text-red-600",children:["Remise: -",c.totalRemise.toFixed(2),"€"]})]})}),e.jsx("td",{className:"px-1 py-1 text-right font-bold text-sm text-myconfort-green font-manrope",children:e.jsxs("strong",{children:["TTC: ",c.totalTTC.toFixed(2)," €"]})}),e.jsx("td",{})]})})]})})})]}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:t,className:"px-6 py-3 rounded-full bg-white border-2 border-gray-300 text-base font-medium font-manrope text-myconfort-dark hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl",children:"← Précédent"}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"bg-white px-3 py-1 rounded-full shadow-lg mb-1",children:e.jsx("div",{className:"text-xs text-gray-500 font-manrope",children:"Étape 3/7"})})}),e.jsx("button",{onClick:p,disabled:!d,className:`px-6 py-3 rounded-full text-base font-medium font-manrope transition-all shadow-lg hover:shadow-xl ${d?"bg-myconfort-green text-white hover:bg-myconfort-green/90":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:d?"Suivant →":"⚠️ Produits requis"})]})]})}function Xe({leftLabel:a,onLeft:t,rightLabel:s,onRight:r,rightDisabled:n,className:o,maxWidth:i="max-w-6xl"}){const d=e.jsx("div",{className:"fixed left-0 right-0 bottom-0 z-[9999]",style:{paddingBottom:"max(env(safe-area-inset-bottom, 16px), 16px)"},children:e.jsx("div",{className:`mx-auto w-full ${i} px-6`,children:e.jsxs("div",{className:`rounded-2xl border bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 shadow-lg
                      flex items-center justify-between gap-3 px-4 ${o||""}`,style:{height:88,willChange:"transform"},children:[e.jsx("button",{type:"button",onClick:t,className:"px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-xl text-lg transition",children:a}),s?e.jsx("button",{type:"button",onClick:n?void 0:r,disabled:n,className:`px-12 py-4 font-bold rounded-xl text-lg shadow-lg transition
                          ${n?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-myconfort-green hover:bg-myconfort-green/90 text-white"}`,children:s}):null]})})});return typeof window<"u"?bs.createPortal(d,document.body):d}function pr({onNext:a,onPrev:t}){const{paiement:s,updatePaiement:r,produits:n}=J(),[o,i]=f.useState(!1),[l,m]=f.useState(!1),d=(n??[]).reduce((b,j)=>b+q((j==null?void 0:j.qty)||0,(j==null?void 0:j.priceTTC)||0,(j==null?void 0:j.discount)||0,(j==null?void 0:j.discountType)||"fixed"),0),[h,c]=f.useState((s==null?void 0:s.method)||""),[x,g]=f.useState((s==null?void 0:s.depositAmount)||0),N=Math.max(0,d-(Number.isFinite(x)?x:0)),p=!!h&&x>=0&&x<=d,u=b=>{r({...s,...b,method:b.method??h,depositAmount:b.depositAmount??x})},S="calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)";return o?e.jsx(hr,{totalAmount:d,acompte:x,onBack:()=>i(!1),onSelect:b=>{const j=`Alma ${b}x`;c(j),u({method:j,depositAmount:x,almaInstallments:b}),i(!1)}}):l?e.jsx(gr,{totalAmount:d,acompte:x,defaultCount:Math.min(Math.max((s==null?void 0:s.chequesCount)||3,2),10),defaultNotes:(s==null?void 0:s.notes)||"",onBack:()=>m(!1),onComplete:b=>{c("Chèque à venir"),u({method:"Chèque à venir",depositAmount:x,chequesCount:b.count,chequeAmount:b.amount,notes:b.notes}),r({method:"Chèque à venir",depositAmount:x,nombreChequesAVenir:b.count,note:b.notes}),m(!1)}}):e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"💳 Mode de Règlement"}),e.jsxs("p",{className:"text-myconfort-dark/70 text-sm",children:["Étape 4/7 • Total : ",d.toFixed(2),"€ TTC"]})]}),e.jsxs("div",{className:"px-6 py-4",style:{paddingBottom:S},children:[e.jsx("div",{className:"bg-myconfort-green/10 p-4 rounded-xl border border-myconfort-green/30 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-myconfort-dark",children:[d.toFixed(2),"€"]}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Total TTC"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-myconfort-blue",children:[x.toFixed(2),"€"]}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Acompte"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[N.toFixed(2),"€"]}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Reste à payer"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-myconfort-dark mb-2",children:"Acompte (€) *"}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[20,30,40,50].map(b=>{const j=Math.round(d*b/100);return e.jsxs("button",{type:"button",onClick:()=>g(j),className:"px-3 py-2 bg-myconfort-blue/20 hover:bg-myconfort-blue/30 rounded-lg text-sm font-medium transition-colors",children:[b,"% (",j,"€)"]},b)})}),e.jsx(ie,{value:x,onChange:b=>g(Number(b)||0),min:0,max:d,placeholder:"0",className:"w-full text-xl font-bold border-gray-300 focus:border-myconfort-green bg-white shadow-sm text-center","aria-label":"Montant de l'acompte"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(ge,{active:h==="Espèces",title:"Espèces",subtitle:"Paiement comptant",emoji:"💵",onClick:()=>{c("Espèces"),u({method:"Espèces",depositAmount:x})}}),e.jsx(ge,{active:h==="Virement",title:"Virement",subtitle:"Banque à banque",emoji:"🏦",onClick:()=>{c("Virement"),u({method:"Virement",depositAmount:x})}}),e.jsx(ge,{active:h==="Carte Bleue",title:"Carte bleue",subtitle:"CB comptant",emoji:"💳",onClick:()=>{c("Carte Bleue"),u({method:"Carte Bleue",depositAmount:x})}}),e.jsx(ge,{active:h==null?void 0:h.startsWith("Alma"),title:h!=null&&h.startsWith("Alma")?h:"Alma",subtitle:h!=null&&h.startsWith("Alma")?"Configuré ✓":"2x, 3x ou 4x →",custom:e.jsx("img",{src:ut,alt:"Alma",className:"h-6"}),onClick:()=>i(!0)}),e.jsx(ge,{active:h==="Chèque au comptant",title:"Chèque (comptant)",subtitle:"Remis à la commande",emoji:"🧾",onClick:()=>{c("Chèque au comptant"),u({method:"Chèque au comptant",depositAmount:x})}}),e.jsx(ge,{active:h==="Chèque à venir",title:"Chèques à venir",subtitle:h==="Chèque à venir"&&(s!=null&&s.nombreChequesAVenir)?`${s.nombreChequesAVenir} chèques de ${(N/(s.nombreChequesAVenir||1)).toFixed(2)}€ chacun`:h==="Chèque à venir"?`${(s==null?void 0:s.chequesCount)||3} chèques × ${((s==null?void 0:s.chequeAmount)||0).toFixed(2)}€`:"Planifier le paiement échelonné →",emoji:"📄",highlight:"amber",onClick:()=>m(!0)})]})]}),e.jsx(Xe,{leftLabel:"← Précédent",onLeft:t,rightLabel:"Suivant →",onRight:p?a:()=>{},rightDisabled:!p})]})}function ge({active:a,title:t,subtitle:s,emoji:r,custom:n,onClick:o,highlight:i}){const l=i==="amber"?"border-amber-500 bg-amber-50 shadow-lg":"border-myconfort-green bg-myconfort-green/10 shadow-lg";return e.jsx("button",{type:"button",onClick:o,className:`p-3 rounded-xl border-2 transition-all w-full text-left ${a?l:"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n||e.jsx("span",{className:"text-xl",children:r}),e.jsx("div",{className:"font-semibold text-sm",children:t})]}),e.jsx("div",{className:"text-xs text-gray-600",children:s})]})})}function hr({totalAmount:a,acompte:t,onBack:s,onSelect:r}){const n=Math.max(0,a-t),l="calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)",m=[{times:2,label:"2 fois",fee:"1.5%",amount:n/2},{times:3,label:"3 fois",fee:"2.5%",amount:n/3},{times:4,label:"4 fois",fee:"3.5%",amount:n/4}];return e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:ut,alt:"Alma",className:"h-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"Paiement Alma"}),e.jsxs("p",{className:"text-myconfort-dark/70 text-sm",children:["Reste à payer : ",n.toFixed(2),"€"]})]})]})}),e.jsx("div",{className:"px-6 py-6",style:{paddingBottom:l},children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:m.map(d=>e.jsx("button",{type:"button",onClick:()=>r(d.times),className:"w-full p-6 bg-white rounded-xl border-2 border-gray-300 hover:border-myconfort-green hover:shadow-lg transition-all text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xl font-bold text-myconfort-dark",children:["Alma ",d.label]}),e.jsxs("div",{className:"text-myconfort-dark/70",children:["Frais : ",d.fee," • ",d.amount.toFixed(2),"€ / mois"]})]}),e.jsx("div",{className:"text-3xl",children:"→"})]})},d.times))})}),e.jsx(Xe,{leftLabel:"← Retour",onLeft:s})]})}function gr({totalAmount:a,acompte:t,defaultCount:s=3,defaultNotes:r="",onBack:n,onComplete:o}){const i=Math.max(0,a-t),[l,m]=f.useState(s),[d,h]=f.useState(r),c=Math.floor(i/l),x=i-c*l,g=l>=2&&l<=10&&c>0,u="calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)",v=Array.from({length:9},(y,S)=>S+2);return e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-amber-500/30 bg-amber-50",children:[e.jsx("h1",{className:"text-2xl font-bold text-amber-700",children:"📄 Chèques à venir"}),e.jsxs("p",{className:"text-amber-700/80 text-sm",children:["Reste à payer : ",i.toFixed(2),"€"]})]}),e.jsxs("div",{className:"px-6 py-6 space-y-6",style:{paddingBottom:u},children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:v.map(y=>e.jsxs("button",{type:"button",onClick:()=>m(y),className:`px-3 py-2 rounded-lg text-sm font-bold transition-colors ${l===y?"bg-amber-500 text-white shadow-md":"bg-white border border-amber-500/40 text-amber-700 hover:bg-amber-50"}`,children:[y,"x"]},y))}),e.jsx("div",{className:"text-sm text-amber-800 mt-2",children:"Choisissez le nombre de chèques (2 à 10)"})]}),e.jsx("div",{className:"bg-white p-4 rounded-xl border border-amber-500/30",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-amber-700",children:[c,"€"]}),e.jsx("div",{className:"text-sm text-amber-800/80",children:"Montant par chèque"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-amber-700",children:x>0?`+${x}€`:"✓ Exact"}),e.jsx("div",{className:"text-sm text-amber-800/80",children:x>0?"À ajouter sur le 1er chèque":"Répartition parfaite"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-amber-800 mb-2",children:"Notes (optionnel)"}),e.jsx("textarea",{value:d,onChange:y=>h(y.target.value),rows:3,placeholder:"Ex : premier chèque à l'installation, suivants tous les 30 jours…",className:"w-full px-4 py-3 border-2 border-amber-500/30 rounded-xl focus:border-amber-500 focus:outline-none bg-white shadow-sm resize-none"})]})]}),e.jsx(Xe,{leftLabel:"← Retour",onLeft:n,rightLabel:"Confirmer →",onRight:g?()=>o({count:l,amount:c,notes:d}):()=>{},rightDisabled:!g,className:"border-amber-500/30 bg-amber-50/95 supports-[backdrop-filter]:bg-amber-50/80"})]})}function br({onNext:a,onPrev:t}){const{livraison:s,updateLivraison:r,produits:n,client:o}=J(),[i,l]=f.useState(!1),m=n.filter(c=>!c.isPickupOnSite),d=n.filter(c=>c.isPickupOnSite),h=!!(s.deliveryMethod&&s.deliveryMethod.trim().length>0);return i?e.jsx(fr,{produitsALivrer:m,produitsAEmporter:d,client:o,livraison:s,updateLivraison:r,onBack:()=>l(!1),onComplete:()=>{l(!1),h&&a()}}):e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"🚚 Modalités de Livraison"}),e.jsxs("p",{className:"text-myconfort-dark/70 text-sm",children:["Étape 5/7 • ",m.length," produits à livrer,"," ",d.length," à emporter"]})]}),e.jsx("button",{type:"button",onClick:a,className:"bg-[#477A0C] hover:bg-[#5A8F0F] text-white px-6 py-3 rounded-xl text-lg font-bold shadow-lg border-2 border-[#477A0C] transition-all",children:"Suivant →"})]})}),e.jsxs("div",{className:"flex-1 px-6 py-4 flex flex-col justify-start",children:[e.jsx("div",{className:"bg-myconfort-green/10 p-4 rounded-xl border border-myconfort-green/30 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-green",children:m.length}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"À livrer"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-blue",children:d.length}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"À emporter"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-lg font-medium text-myconfort-dark mb-4",children:"Mode de livraison *"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("button",{onClick:()=>r({deliveryMethod:"Livraison Colissimo"}),className:`p-4 rounded-xl border-2 transition-all text-left ${s.deliveryMethod==="Livraison Colissimo"?"border-myconfort-green bg-myconfort-green/10 shadow-lg":"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-myconfort-dark",children:"� Livraison Colissimo"}),e.jsx("div",{className:"text-sm text-gray-600",children:"48 heures • Poids inférieur à 5 kg"})]}),s.deliveryMethod==="Livraison Colissimo"&&e.jsx("div",{className:"text-myconfort-green text-xl",children:"✓"})]})}),e.jsx("button",{onClick:()=>r({deliveryMethod:"Livraison France Express"}),className:`p-4 rounded-xl border-2 transition-all text-left ${s.deliveryMethod==="Livraison France Express"?"border-myconfort-green bg-myconfort-green/10 shadow-lg":"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-myconfort-dark",children:"⚡ Livraison par transporteur France Express"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Date à définir dans les détails du planning"})]}),s.deliveryMethod==="Livraison France Express"&&e.jsx("div",{className:"text-myconfort-green text-xl",children:"✓"})]})}),e.jsx("button",{onClick:()=>r({deliveryMethod:"Retrait sur stand"}),className:`p-4 rounded-xl border-2 transition-all text-left ${s.deliveryMethod==="Retrait sur stand"?"border-myconfort-green bg-myconfort-green/10 shadow-lg":"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-myconfort-dark",children:"🏪 Retrait sur stand"}),e.jsx("div",{className:"text-sm text-gray-600",children:"À la fin de l'événement"})]}),s.deliveryMethod==="Retrait sur stand"&&e.jsx("div",{className:"text-myconfort-green text-xl",children:"✓"})]})})]})]}),e.jsx("div",{className:"h-32"})]}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:t,className:"px-6 py-3 rounded-full bg-white border-2 border-gray-300 text-base font-medium font-manrope text-myconfort-dark hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl",children:"← Précédent"}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"bg-white px-3 py-1 rounded-full shadow-lg mb-1",children:e.jsx("div",{className:"text-xs text-gray-500 font-manrope",children:"Étape 5/7"})})}),e.jsx("button",{onClick:h?a:void 0,disabled:!h,className:`px-6 py-3 rounded-full text-base font-medium font-manrope transition-all shadow-lg hover:shadow-xl ${h?"bg-myconfort-green text-white hover:bg-myconfort-green/90":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:h?"Suivant →":"⚠️ Mode requis"})]})]})}function fr({produitsALivrer:a,produitsAEmporter:t,client:s,livraison:r,updateLivraison:n,onBack:o,onComplete:i}){const[l,m]=f.useState(!1),[d,h]=f.useState(r.deliveryAddress||""),[c,x]=f.useState(r.deliveryNotes||""),g=()=>{n({deliveryAddress:l?d:s.address,deliveryNotes:c}),i()};return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"📦 Détails de Livraison"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"Configuration complète de la livraison"})]}),e.jsx("div",{className:"flex-1 px-6 py-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-300",children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-3",children:"📊 Répartition des produits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-600",children:["À livrer (",a.length,")"]}),a.map((N,p)=>e.jsxs("div",{className:"text-gray-600",children:["• ",N.designation," (x",N.qty,")"]},p))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-green-600",children:["À emporter (",t.length,")"]}),t.map((N,p)=>e.jsxs("div",{className:"text-gray-600",children:["• ",N.designation," (x",N.qty,")"]},p))]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-300",children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-3",children:"📍 Adresse de livraison"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:!l,onChange:()=>m(!1),className:"w-4 h-4"}),e.jsxs("span",{children:["Adresse du client: ",s.address||"Non renseignée"]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:l,onChange:()=>m(!0),className:"w-4 h-4"}),e.jsx("span",{children:"Adresse différente"})]}),l&&e.jsx("textarea",{value:d,onChange:N=>h(N.target.value),placeholder:"Saisir l'adresse de livraison...",rows:3,className:"w-full p-3 border rounded-lg"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-300",children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-3",children:"📝 Instructions de livraison"}),e.jsx("textarea",{value:c,onChange:N=>x(N.target.value),placeholder:"Ex: Livraison entre 9h-12h, sonner à l'interphone, étage sans ascenseur...",rows:4,className:"w-full p-3 border rounded-lg resize-none"})]})]})}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:o,className:"px-6 py-3 rounded-full bg-white border-2 border-gray-300 text-base font-medium font-manrope text-myconfort-dark hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl",children:"← Retour"}),e.jsx("button",{onClick:g,className:"px-6 py-3 rounded-full bg-myconfort-green text-white text-base font-medium font-manrope transition-all shadow-lg hover:shadow-xl hover:bg-myconfort-green/90",children:"Valider →"})]})]})}function vr(a){const t=new Ts(a,{throttle:8,minWidth:1.5,maxWidth:4,penColor:"#111827",backgroundColor:"rgb(255,255,255)",velocityFilterWeight:.7,minDistance:2,dotSize:1.5}),s=Math.max(window.devicePixelRatio||1,1),{offsetWidth:r,offsetHeight:n}=a;if(r>0&&n>0){a.width=r*s,a.height=n*s;const o=a.getContext("2d");o&&(o.scale(s,s),o.lineCap="round",o.lineJoin="round",o.globalCompositeOperation="source-over",o.save(),o.fillStyle="#FFFFFF",o.fillRect(0,0,r,n),o.restore())}return t.__repaintBackground=function(){const o=a.getContext("2d");if(o){const{offsetWidth:i,offsetHeight:l}=a;o.save(),o.fillStyle="#FFFFFF",o.fillRect(0,0,i,l),o.restore()}},t.clear(),t}async function yr(a){const t=new Date().toISOString(),s=a.toDataURL("image/png"),n=await(await fetch(s)).blob();return{pngDataUrl:s,blob:n,timestamp:t}}function jr({onSigned:a,onPrevious:t,onDrawingStart:s,onDrawingEnd:r,className:n}){const o=f.useRef(null),[i,l]=f.useState(null),[m,d]=f.useState(!1),[h,c]=f.useState(!1),x=f.useRef(s),g=f.useRef(r);f.useEffect(()=>{x.current=s},[s]),f.useEffect(()=>{g.current=r},[r]),f.useEffect(()=>{if(!o.current)return;const u=vr(o.current);u.addEventListener("beginStroke",()=>{var b;(b=x.current)==null||b.call(x),d(!0)}),u.addEventListener("endStroke",()=>{var b;(b=g.current)==null||b.call(g),d(!u.isEmpty())});const v=()=>{setTimeout(()=>{const b=u.isEmpty();d(!b)},50)};o.current.addEventListener("pointerup",v),o.current.addEventListener("touchend",v),o.current.addEventListener("mouseup",v),l(u);const y=()=>{o.current&&(o.current.removeEventListener("pointerup",v),o.current.removeEventListener("touchend",v),o.current.removeEventListener("mouseup",v))},S=()=>{if(!o.current)return;const b=u.toData(),j=Math.max(window.devicePixelRatio||1,1),{offsetWidth:P,offsetHeight:w}=o.current;if(P===0||w===0)return;o.current.width=P*j,o.current.height=w*j;const F=o.current.getContext("2d");if(F&&(F.scale(j,j),F.save(),F.fillStyle="#FFFFFF",F.fillRect(0,0,P,w),F.restore()),u.__repaintBackground&&u.__repaintBackground(),u.clear(),b.length>0)try{u.fromData(b)}catch{}d(!u.isEmpty())};return S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S),y()}},[]);const N=()=>{i==null||i.clear(),d(!1)},p=async()=>{if(!(!i||i.isEmpty()||h))try{c(!0);const{pngDataUrl:u,timestamp:v}=await yr(i);a==null||a(u,v)}finally{c(!1)}};return e.jsxs("div",{className:`flex flex-col gap-3 ${n||""}`,children:[e.jsx("div",{className:"rounded-2xl border-2 border-myconfort-dark/20 bg-white shadow-sm p-2",children:e.jsxs("div",{className:"h-[280px] w-full relative",children:[e.jsx("canvas",{ref:o,className:"h-full w-full rounded-xl bg-white",style:{touchAction:"none",overscrollBehavior:"contain",WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},onTouchStart:u=>u.stopPropagation(),onTouchMove:u=>u.stopPropagation(),onTouchEnd:u=>u.stopPropagation(),onContextMenu:u=>u.preventDefault()}),!m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none text-gray-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"✍️"}),e.jsx("div",{className:"text-sm font-medium",children:"Signez dans cette zone"}),e.jsx("div",{className:"text-xs mt-1",children:"Compatible Apple Pencil et doigt"})]})})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-800 min-h-[56px] font-semibold",children:"← Précédent"}),e.jsx("button",{onClick:N,className:"px-4 py-2 rounded-xl bg-myconfort-blue/20 hover:bg-myconfort-blue/30 min-h-[56px] font-semibold",children:"Effacer"}),e.jsx("button",{onClick:p,disabled:!m||h,className:`px-4 py-2 rounded-xl min-h-[56px] font-semibold
            ${!m||h?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-myconfort-green text-white hover:opacity-90"}`,children:h?"💾 Sauvegarde…":"Enregistrer la signature"})]})]})}function Nr({onNext:a,onPrev:t}){const{signature:s,updateSignature:r,termsAccepted:n,setTermsAccepted:o}=J(),[i,l]=f.useState(!1),[m,d]=f.useState(!1),[h,c]=f.useState(!1),x=f.useCallback(()=>{},[]),g=f.useCallback(()=>{},[]),N=async(u,v)=>{try{c(!0),r({dataUrl:u,timestamp:v}),await new Promise(y=>setTimeout(y,100)),c(!1)}catch(y){console.error("Erreur sauvegarde signature:",y),c(!1)}},p=()=>{!(s!=null&&s.dataUrl)||h||(d(!0),setTimeout(()=>{a()},500))};return i?e.jsx(Cr,{termsAccepted:n,setTermsAccepted:o,onBack:()=>l(!1),onAccept:()=>{o(!0),l(!1)}}):e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"✍️ Signature du Client"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"Étape 6/8 • Signature obligatoire pour finaliser"})]}),e.jsxs("div",{className:"flex-1 px-6 py-4 flex flex-col",children:[e.jsx("div",{className:"flex-1 bg-white rounded-xl border-2 border-gray-300 p-4 mb-4",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-myconfort-dark",children:"📝 Signez dans la zone ci-dessous"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Utilisez votre doigt ou un stylet"})]}),e.jsxs("div",{className:"flex-1 min-h-[200px]",children:[e.jsx(jr,{onSigned:N,onDrawingStart:x,onDrawingEnd:g}),e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("button",{onClick:t,disabled:h,className:"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-800 min-h-[56px] font-semibold",children:"← Précédent"}),e.jsx("button",{onClick:p,disabled:!(s!=null&&s.dataUrl)||!n||h||m,className:`px-4 py-2 rounded-xl min-h-[56px] font-semibold
                    ${!(s!=null&&s.dataUrl)||!n||h||m?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-myconfort-green text-white hover:opacity-90"}`,children:m?"🔄 Traitement...":h?"💾 Sauvegarde...":s!=null&&s.dataUrl?n?"Suivant →":"Acceptez conditions":"Signez d'abord"})]})]})]})}),e.jsxs("div",{className:"space-y-3",children:[(s==null?void 0:s.dataUrl)&&e.jsx("div",{className:"bg-myconfort-green/10 p-3 rounded-xl border border-myconfort-green/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-myconfort-green",children:m?"🔄 Passage à l'étape suivante...":"✓ Signature enregistrée"}),e.jsx("div",{className:"text-xs text-myconfort-dark/70",children:s.timestamp&&new Date(s.timestamp).toLocaleString()})]}),e.jsx("img",{src:s.dataUrl,alt:"Signature",className:"h-12 w-24 object-contain border rounded"})]})}),e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-xl border border-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"terms",checked:n,onChange:u=>o(u.target.checked),className:"w-5 h-5 text-myconfort-green"}),e.jsx("label",{htmlFor:"terms",className:"text-sm font-medium text-myconfort-dark",children:"J'accepte les conditions générales"})]}),e.jsx("button",{onClick:()=>l(!0),className:`px-3 py-1 bg-myconfort-blue/20 hover:bg-myconfort-blue/30 
                         rounded-lg text-sm font-medium transition-colors`,children:"📋 Lire"})]})]})]})]})}function Cr({termsAccepted:a,setTermsAccepted:t,onBack:s,onAccept:r}){return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"📋 Conditions Générales de Vente"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"MyConfort - Conditions à accepter"})]}),e.jsx("div",{className:"flex-1 px-6 py-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-300 space-y-4 text-sm leading-relaxed",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"1. OBJET"}),e.jsx("p",{className:"text-gray-700",children:"Les présentes conditions générales de vente régissent les relations contractuelles entre MyConfort et ses clients dans le cadre de la vente de produits et services de confort thermique, isolation et équipements énergétiques."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"2. COMMANDES"}),e.jsx("p",{className:"text-gray-700",children:"Toute commande implique l'acceptation pleine et entière des présentes conditions. Les commandes ne sont définitives qu'après acceptation par MyConfort et encaissement de l'acompte convenu."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"3. PRIX ET PAIEMENT"}),e.jsx("p",{className:"text-gray-700",children:"Les prix s'entendent TTC. Un acompte est exigé à la commande. Le solde est payable selon les modalités convenues (comptant, échelonné, ou lors de la livraison). Tout retard de paiement entraîne des pénalités de 3 fois le taux légal."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"4. LIVRAISON ET INSTALLATION"}),e.jsx("p",{className:"text-gray-700",children:"Les délais de livraison sont donnés à titre indicatif. MyConfort s'engage à respecter au mieux ces délais mais ne pourra être tenu responsable des retards dus aux fournisseurs ou à des circonstances exceptionnelles."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"5. GARANTIES"}),e.jsx("p",{className:"text-gray-700",children:"MyConfort garantit ses produits selon les conditions du fabricant. La garantie main d'œuvre est de 2 ans à compter de la réception des travaux. Cette garantie ne couvre pas l'usure normale, les dommages dus à un mauvais usage ou à un défaut d'entretien."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"6. DROIT DE RÉTRACTATION"}),e.jsx("p",{className:"text-gray-700",children:"Conformément au Code de la consommation, le client dispose d'un délai de 14 jours pour exercer son droit de rétractation, sauf pour les produits personnalisés ou les services déjà exécutés avec accord express du client."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"7. DONNÉES PERSONNELLES"}),e.jsx("p",{className:"text-gray-700",children:"Les données personnelles collectées sont nécessaires au traitement de la commande et à la gestion de la relation commerciale. Elles ne sont pas transmises à des tiers sans consentement. Le client dispose d'un droit d'accès, de rectification et de suppression."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"8. JURIDICTION"}),e.jsx("p",{className:"text-gray-700",children:"Tout litige sera soumis aux tribunaux compétents du ressort du siège social de MyConfort. Le droit français s'applique exclusivement."})]}),e.jsx("div",{className:"border-t pt-4 mt-6",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["MyConfort - Siège social: [Adresse] - RCS: [Numéro] - TVA: [Numéro]",e.jsx("br",{}),"Conditions générales mises à jour le 24 août 2025"]})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-myconfort-dark/10",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:n=>t(n.target.checked),className:"w-5 h-5 text-myconfort-green"}),e.jsx("span",{className:"font-medium text-myconfort-dark",children:"J'ai lu et j'accepte les conditions générales"})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:s,className:`px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 
                       font-bold rounded-xl text-lg transition-all transform hover:scale-105
                       min-h-[56px]`,children:"← Retour"}),e.jsx("button",{onClick:a?r:void 0,disabled:!a,className:`px-12 py-4 font-bold rounded-xl text-lg transition-all transform 
                        shadow-lg min-h-[56px] ${a?"bg-myconfort-green hover:bg-myconfort-green/90 text-white hover:scale-105":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:a?"Accepter et continuer →":"Cochez pour accepter les conditions"})]})]})]})}function Tr({onNext:a,onPrev:t}){const{client:s,produits:r,paiement:n,livraison:o,invoiceNumber:i,invoiceDate:l,eventLocation:m,signature:d,termsAccepted:h,advisorName:c}=J(),[x,g]=f.useState(!1),[N,p]=f.useState(!1),[u,v]=f.useState([]),y=f.useMemo(()=>{let T=0;const O=r.map(_=>{const U=q(_.qty||0,_.priceTTC||0,_.discount||0,_.discountType||"fixed");return T+=U,{..._,lineTotal:U}}),z=(n==null?void 0:n.depositAmount)||0,L=Math.max(0,T-z);return{details:O,subtotal:T,acompte:z,reste:L,total:T}},[r,n]),S=f.useMemo(()=>({invoiceNumber:i,invoiceDate:l,eventLocation:m||"",clientName:s.name||"",clientEmail:s.email||"",clientPhone:s.phone||"",clientAddress:s.address||"",clientAddressLine2:s.addressLine2||"",clientPostalCode:s.postalCode||"",clientCity:s.city||"",clientHousingType:s.housingType||"",clientDoorCode:s.doorCode||"",clientSiret:s.siret||"",products:r.map(T=>({id:T.id,name:T.designation,category:T.category||"",quantity:T.qty,priceHT:T.priceTTC/1.2,priceTTC:T.priceTTC,discount:T.discount,discountType:T.discountType,totalHT:T.qty*T.priceTTC/1.2-(T.discountType==="fixed"?T.discount:T.qty*T.priceTTC/1.2*T.discount/100),totalTTC:T.qty*T.priceTTC-(T.discountType==="fixed"?T.discount:T.qty*T.priceTTC*T.discount/100),isPickupOnSite:T.isPickupOnSite})),montantHT:y.subtotal/1.2,montantTTC:y.subtotal,montantTVA:y.subtotal-y.subtotal/1.2,montantRemise:0,taxRate:20,paymentMethod:(n==null?void 0:n.method)||"",montantAcompte:(n==null?void 0:n.depositAmount)||0,depositPaymentMethod:(n==null?void 0:n.depositPaymentMethod)||"",montantRestant:y.reste,nombreChequesAVenir:(n==null?void 0:n.nombreChequesAVenir)||0,deliveryMethod:(o==null?void 0:o.deliveryMethod)||"",deliveryAddress:(o==null?void 0:o.deliveryAddress)||"",deliveryNotes:(o==null?void 0:o.deliveryNotes)||"",signature:(d==null?void 0:d.dataUrl)||"",isSigned:!!(d!=null&&d.dataUrl),signatureDate:(d==null?void 0:d.timestamp)||"",invoiceNotes:"",advisorName:c||"",termsAccepted:h||!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),[i,l,m,s,r,n,o,d,h,c,y]),b=async()=>{try{p(!0),Ut(S),v(T=>[...T,`Facture ${S.invoiceNumber} enregistrée`])}catch(T){console.error("Erreur sauvegarde:",T)}finally{p(!1)}},j=async()=>{try{p(!0);const T=await ct.generateInvoicePDF(S),O=URL.createObjectURL(T);if(!window.open(O,"_blank")){const L=document.createElement("a");L.href=O,L.download=`facture-${S.invoiceNumber}.pdf`,L.click(),URL.revokeObjectURL(O)}v(L=>[...L,`PDF facture ${S.invoiceNumber} ouvert pour impression`])}catch(T){console.error("Erreur impression:",T)}finally{p(!1)}},P=async()=>{try{p(!0);const T=await ct.generateInvoicePDF(S),O=new FileReader,z=await new Promise((L,_)=>{O.onload=()=>{const ee=O.result.split(",")[1];L(ee)},O.onerror=_,O.readAsDataURL(T)});await Ne.sendInvoiceToN8n(S,z),v(L=>[...L,`Facture ${S.invoiceNumber} envoyée par email`])}catch(T){console.error("Erreur envoi:",T)}finally{p(!1)}},w=u.some(T=>T.includes("enregistrée")),F=u.some(T=>T.includes("envoyée par email")),D=u.some(T=>T.includes("ouvert pour impression"));return x?e.jsx("div",{className:"h-full flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-2xl shadow-lg max-w-md",children:[e.jsx("div",{className:"animate-spin text-5xl mb-4",children:"⏳"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"Finalisation en cours..."}),e.jsx("p",{className:"text-gray-600",children:"Génération de la facture"})]})}):e.jsxs("div",{className:"min-h-screen flex flex-col bg-[#F2EFE2] overflow-hidden",children:[e.jsx("header",{className:"sticky top-0 z-30 bg-white/90 backdrop-blur border-b shadow-sm flex-shrink-0",children:e.jsx("div",{className:"p-3",children:e.jsxs("h1",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:["📄 Récapitulatif Final",e.jsxs("span",{className:"text-lg font-normal text-blue-600",children:["#",i]})]})})}),e.jsx("main",{className:"flex-1 overflow-y-auto overscroll-contain",children:e.jsxs("div",{className:"p-4 pb-32 max-w-5xl mx-auto",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"📋 Facture"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Numéro :"}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date :"}),e.jsx("span",{className:"font-medium",children:l})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Lieu :"}),e.jsx("span",{className:"font-medium",children:m})]}),c&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Conseiller :"}),e.jsx("span",{className:"font-medium",children:c})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"👤 Client"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Nom :"}),e.jsx("span",{className:"font-medium",children:s.name||"Non renseigné"})]}),s.email&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email :"}),e.jsx("span",{className:"font-medium text-xs",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Tél :"}),e.jsx("span",{className:"font-medium",children:s.phone})]}),s.address&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Adresse :"}),e.jsx("span",{className:"font-medium text-xs",children:s.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"💳 Paiement"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Mode :"}),e.jsx("span",{className:"font-medium",children:(n==null?void 0:n.method)||"Non défini"})]}),(n==null?void 0:n.depositAmount)&&n.depositAmount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Acompte :"}),e.jsxs("span",{className:"font-medium text-green-600",children:[n.depositAmount.toFixed(2)," €"]})]}),(n==null?void 0:n.nombreChequesAVenir)&&n.nombreChequesAVenir>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Chèques à venir :"}),e.jsxs("span",{className:"font-medium",children:[n.nombreChequesAVenir," chèques de ",(y.reste/n.nombreChequesAVenir).toFixed(2)," €"]})]}),(n==null?void 0:n.nombreChequesAVenir)&&n.nombreChequesAVenir>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Montant total des chèques :"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[y.reste.toFixed(2)," €"]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsxs("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:["📦 Produits (",r.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:y.details.map((T,O)=>{var z;return e.jsx("div",{className:"border-b border-gray-100 pb-2 last:border-b-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("div",{className:"font-medium text-sm text-gray-800 truncate",children:T.designation}),e.jsxs("div",{className:"text-xs text-gray-500",children:[T.qty," × ",(z=T.priceTTC)==null?void 0:z.toFixed(2),"€",T.isPickupOnSite?" 📦":" 🚚"]})]}),e.jsxs("div",{className:"font-medium text-sm text-gray-800",children:[T.lineTotal.toFixed(2),"€"]})]})},O)})}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 text-sm text-green-600",children:[e.jsx("span",{children:"Remise effectuée 20% :"}),e.jsxs("span",{children:["-",(y.total*.2).toFixed(2)," €"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-800",children:"Total TTC :"}),e.jsxs("span",{className:"font-bold text-xl text-blue-600",children:[y.total.toFixed(2)," €"]})]}),y.acompte>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:"Acompte versé :"}),e.jsxs("span",{children:["-",y.acompte.toFixed(2)," €"]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-orange-600 mt-1",children:[e.jsx("span",{children:"Reste à régler :"}),e.jsxs("span",{children:[y.reste.toFixed(2)," €"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"🚚 Livraison"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Mode :"}),e.jsx("span",{className:"font-medium",children:(o==null?void 0:o.deliveryMethod)||"Non défini"})]}),(o==null?void 0:o.deliveryNotes)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Notes :"}),e.jsx("p",{className:"text-xs text-gray-800 mt-1",children:o.deliveryNotes})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"✍️ Signature & CGV"}),e.jsx("div",{className:"flex items-center justify-between",children:d!=null&&d.dataUrl?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-12 bg-gray-100 rounded border flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:d.dataUrl,alt:"Signature",className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"text-green-600 font-medium",children:"✅ Signée"}),d.timestamp&&e.jsx("div",{className:"text-gray-500",children:new Date(d.timestamp).toLocaleString()})]})]}):e.jsx("div",{className:"text-orange-600 text-sm",children:"⚠️ Signature manquante"})}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:`text-sm font-medium ${h?"text-green-600":"text-orange-600"}`,children:h?"✅ CGV acceptées":"⚠️ CGV non acceptées"})})]})]})]})]})}),e.jsx("footer",{className:`
          fixed bottom-0 left-0 right-0 z-40
          bg-white/95 backdrop-blur border-t border-[#477A0C]/20
          shadow-lg p-4
          supports-[padding:max(0px)]:pb-[env(safe-area-inset-bottom)]
        `,children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[(!w||!F)&&e.jsx("div",{className:"mb-4 p-3 bg-orange-100 border border-orange-300 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-800 text-center",children:["⚠️ ",e.jsx("strong",{children:"Enregistrer"})," et ",e.jsx("strong",{children:"Envoyer"})," sont obligatoires pour continuer"]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsxs("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-colors px-4 py-3 flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"←"}),e.jsx("div",{className:"text-xs",children:"Retour"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:b,disabled:N,className:"w-full bg-[#477A0C] hover:bg-[#3A6A0A] disabled:bg-gray-400 text-white rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"💾"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Enregistrer"}),e.jsx("div",{className:"text-xs opacity-80",children:"Facture"})]})]}),!w&&e.jsx("div",{className:"absolute -top-2 -left-2 bg-red-500 text-white text-xs px-1 py-0.5 rounded-full font-bold",children:"!"}),w&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"✓"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:j,disabled:N,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"🖨️"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Imprimer"}),e.jsx("div",{className:"text-xs opacity-80",children:"PDF A4"})]})]}),D&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"✓"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:P,disabled:N||!s.email,className:"w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"📧"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Envoyer"}),e.jsx("div",{className:"text-xs opacity-80",children:"Email"})]})]}),!F&&e.jsx("div",{className:"absolute -top-2 -left-2 bg-red-500 text-white text-xs px-1 py-0.5 rounded-full font-bold",children:"!"}),F&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"✓"})]}),e.jsxs("button",{onClick:()=>{w&&F&&(window.location.href="/ipad?step=facture")},disabled:!w||!F,className:`rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px] ${w&&F?"bg-[#477A0C] hover:bg-[#3A6A0A] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx("span",{className:"text-lg mb-1",children:"🆕"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Nouvelle"}),e.jsx("div",{className:"text-xs opacity-80",children:"Commande"})]})]})]}),N&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white px-4 py-2 rounded-lg border",children:[e.jsx("div",{className:"animate-spin text-[#477A0C]",children:"⏳"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Traitement en cours..."})]})})]})})]})}function wr({onPrev:a}){const{reset:t,setStep:s}=J(),[r,n]=f.useState(!1),o=async()=>{n(!0),setTimeout(()=>{t(),s("facture"),n(!1)},1e3)};return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"🎯 Nouvelles Commandes"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"Étape 8/8 • Terminer et recommencer"})]}),e.jsx("div",{className:"flex-1 px-6 py-8 flex flex-col justify-center items-center",children:r?e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-myconfort-green mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-myconfort-dark mb-2",children:"🔄 Réinitialisation en cours..."}),e.jsx("p",{className:"text-myconfort-dark/70",children:"Préparation d'une nouvelle commande"})]})]}):e.jsxs("div",{className:"max-w-2xl text-center space-y-8",children:[e.jsx("div",{className:"w-24 h-24 bg-myconfort-green/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx("div",{className:"text-4xl",children:"✅"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-myconfort-dark",children:"Commande terminée !"}),e.jsx("p",{className:"text-lg text-myconfort-dark/70",children:"Votre facture a été enregistrée avec succès. Vous pouvez maintenant créer une nouvelle commande."})]}),e.jsxs("div",{className:"bg-myconfort-green/5 p-6 rounded-xl border border-myconfort-green/20",children:[e.jsx("h3",{className:"text-lg font-bold text-myconfort-dark mb-4",children:"📊 Résumé de cette session"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-green",children:"1"}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Facture créée"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-blue",children:"7"}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Étapes complétées"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"3"}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Actions réalisées"})]})]})]}),e.jsx("button",{onClick:o,className:`w-full max-w-md px-8 py-6 bg-myconfort-green hover:bg-myconfort-green/90 
                         text-white font-bold rounded-xl text-xl shadow-lg transition-all 
                         transform hover:scale-105 mx-auto block`,children:"🚀 Créer une nouvelle commande"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:`px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 
                           font-medium rounded-lg transition-all`,children:"🔄 Recharger l'application"}),e.jsx("button",{onClick:()=>window.open("/","_blank"),className:`px-6 py-3 bg-myconfort-blue hover:bg-myconfort-blue/90 text-white 
                           font-medium rounded-lg transition-all`,children:"🏠 Accueil (nouvel onglet)"})]})]})}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:a,disabled:r,className:`px-8 py-4 font-bold rounded-xl text-lg transition-all shadow-lg min-h-[56px] ${r?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-800 transform hover:scale-105"}`,children:"← Retour au récap"}),e.jsx("div",{className:"px-4 py-4 text-sm text-myconfort-dark/60 flex items-center",children:"Fin du processus de commande"})]})]})}const Fe=["facture","client","produits","paiement","livraison","signature","recap","nouvelles-commandes"];function Ar(){const a=Ie(),{search:t}=fs(),s=new URLSearchParams(t).get("step")||"facture",r=J(m=>m.setStep),n=J(m=>m.step);f.useEffect(()=>{r(s)},[s,r]);const[o,i]=f.useState(window.innerWidth>window.innerHeight?"landscape":"portrait");f.useEffect(()=>{const m=()=>{i(window.innerWidth>window.innerHeight?"landscape":"portrait")};return window.addEventListener("resize",m),window.addEventListener("orientationchange",m),()=>{window.removeEventListener("resize",m),window.removeEventListener("orientationchange",m)}},[]);const l=o==="portrait";return e.jsx("div",{className:"fixed inset-0 bg-white overflow-hidden",style:{width:"100vw",height:"100dvh",paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",paddingLeft:"env(safe-area-inset-left, 0px)",paddingRight:"env(safe-area-inset-right, 0px)"},children:l?e.jsx("div",{className:"w-full h-full flex items-center justify-center p-8 text-center bg-gradient-to-br from-[#477A0C] to-[#5A8F0F]",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-2xl max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"📱"}),e.jsx("h1",{className:"text-2xl font-bold text-[#477A0C] mb-4",children:"Tourne l'iPad en paysage"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"Le mode iPad MyConfort est optimisé pour l'orientation paysage afin de profiter pleinement de l'interface tactile."}),e.jsx("div",{className:"mt-6 p-3 bg-green-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-800 font-medium",children:"🔄 Rotation automatique activée"})})]})}):e.jsx(Ht,{children:e.jsx(Sr,{step:n,onGo:m=>{const d=Fe.indexOf(n),h=Fe[d+(m==="next"?1:-1)];h&&a(`/ipad?step=${h}`)},onQuit:()=>a("/")})})})}function Sr({step:a,onGo:t,onQuit:s}){const r=Fe.indexOf(a),n=r===0,o=r===Fe.length-1,{invoiceNumber:i,invoiceDate:l,eventLocation:m,client:d,produits:h,paiement:c}=J(),x=f.useCallback(()=>{var v,y,S,b,j,P,w,F;let p=!0,u="";switch(a){case"facture":i.trim()?l?m.trim()||(u="Le lieu de l'événement est obligatoire",p=!1):(u="La date de facture est obligatoire",p=!1):(u="Le numéro de facture est obligatoire",p=!1);break;case"client":!((v=d.name)!=null&&v.trim())||d.name.trim().length<3?(u="Le nom du client est obligatoire (minimum 3 caractères)",p=!1):!((y=d.email)!=null&&y.trim())||!d.email.includes("@")?(u="Un email valide est obligatoire",p=!1):(S=d.phone)!=null&&S.trim()?(b=d.address)!=null&&b.trim()?(j=d.city)!=null&&j.trim()?(P=d.postalCode)!=null&&P.trim()?(w=d.housingType)!=null&&w.trim()?!((F=d.doorCode)!=null&&F.trim())&&d.doorCode!=="Pas de digicode"&&(u='Le code porte/digicode est obligatoire (ou cochez "Pas de digicode")',p=!1):(u="Le type de logement est obligatoire",p=!1):(u="Le code postal est obligatoire",p=!1):(u="La ville du client est obligatoire",p=!1):(u="L'adresse du client est obligatoire",p=!1):(u="Le téléphone du client est obligatoire",p=!1);break;case"produits":h.length===0?(u="Au moins un produit est obligatoire",p=!1):h.some(D=>D.isPickupOnSite===void 0)&&(u="Veuillez définir le mode de livraison pour tous les produits",p=!1);break;case"paiement":c.method||(u="Veuillez sélectionner un mode de paiement",p=!1);break}return{isValid:p,errorMessage:u}},[a,i,l,m,d.name,d.email,d.phone,d.address,d.city,d.postalCode,d.housingType,d.doorCode,h,c]),g=f.useCallback(()=>{const{isValid:p,errorMessage:u}=x();p?t("next"):alert(u)},[x,t]),N=f.useMemo(()=>{const p={onNext:g,onPrev:()=>t("prev"),onQuit:s,isFirstStep:n,isLastStep:o};switch(a){case"facture":return e.jsx(dr,{...p});case"client":return e.jsx(mr,{...p});case"produits":return e.jsx(xr,{...p});case"paiement":return e.jsx(pr,{...p});case"livraison":return e.jsx(br,{...p});case"signature":return e.jsx(Nr,{...p});case"recap":return e.jsx(Tr,{...p});case"nouvelles-commandes":return e.jsx(wr,{...p});default:return e.jsx("div",{children:"Étape inconnue"})}},[a,t,s,n,o,g]);return e.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"h-7 flex items-center justify-between px-3 bg-gradient-to-r from-[#477A0C] to-[#5A8F0F] text-white text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-sm",children:"🌸"}),e.jsx("span",{className:"font-medium truncate",children:Er(a)})]}),e.jsx("button",{onClick:s,className:"bg-white/20 hover:bg-white/30 px-2 py-0.5 rounded text-xs transition-all",children:"Quitter"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:N}),e.jsxs("div",{className:"h-12 bg-white border-t border-gray-200 flex items-center justify-between px-3",children:[e.jsx("div",{className:"flex items-center",children:!n&&e.jsx("button",{onClick:()=>t("prev"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all min-h-[32px]",children:"← Précédent"})}),e.jsx("div",{className:"flex gap-0.5",children:Fe.map((p,u)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${u===r?"bg-[#477A0C]":u<r?"bg-green-400":"bg-gray-300"}`},u))}),e.jsx("div",{className:"flex items-center",children:!o&&e.jsx("button",{onClick:g,className:"px-4 py-2 bg-[#477A0C] hover:bg-[#5A8F0F] text-white rounded-lg text-sm font-medium transition-all shadow-sm min-h-[32px]",children:"Suivant →"})})]})]})}function Er(a){switch(a){case"facture":return"Facture";case"client":return"Client";case"produits":return"Produits";case"paiement":return"Paiement";case"livraison":return"Livraison";case"signature":return"Signature";case"recap":return"Récap";case"nouvelles-commandes":return"Nouvelles commandes";default:return"Étape"}}const Pr=({label:a="Retour",onBack:t,className:s="",showIcon:r=!0})=>{const n=Ie(),o=()=>{t?t():n(-1)};return e.jsxs("button",{onClick:o,className:`
        flex items-center gap-3 px-4 py-3 min-h-[56px]
        text-lg font-medium text-myconfort-dark
        bg-white border border-gray-200 rounded-lg
        hover:bg-gray-50 active:bg-gray-100
        transition-colors duration-150
        touch-manipulation
        ${s}
      `,type:"button","aria-label":`${a} à la page précédente`,children:[r&&e.jsx(ye,{size:24,className:"text-myconfort-green flex-shrink-0"}),e.jsx("span",{className:"font-manrope",children:a})]})};function wt(){const{getCurrentStepIndex:a,steps:t,goNext:s,goPrev:r}=J(),n=a(),o=t[n]||"step";return e.jsx(Ht,{children:e.jsxs("div",{className:"h-full w-full p-6 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Pr,{}),e.jsx("span",{className:"text-sm text-myconfort-dark/70",children:"Gesture: swipe gauche/droite"})]}),e.jsxs("section",{className:"flex-1 rounded-2xl bg-white shadow-sm border p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-myconfort-dark capitalize",children:o}),e.jsxs("p",{className:"mt-2 text-myconfort-dark/70",children:['Écran placeholder pour "',o,'".']})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-xl bg-myconfort-blue/20 hover:bg-myconfort-blue/30",children:"Précédent"}),e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 rounded-xl bg-myconfort-green text-white hover:opacity-90",children:"Suivant"})]})]})})}function Fr(){const a=Ie(),[t]=Ot();return f.useEffect(()=>{const s=setTimeout(()=>{a("/")},5e3);return()=>clearTimeout(s)},[a]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-6",children:"✅"}),e.jsx("h1",{className:"text-2xl font-bold text-green-800 mb-4",children:"Paiement réussi !"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Votre paiement a été traité avec succès. Vous allez recevoir un email de confirmation."}),e.jsxs("div",{className:"space-y-4",children:[t.get("amount")&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-700",children:"Montant"}),e.jsxs("div",{className:"text-xl font-bold text-green-800",children:[t.get("amount")," €"]})]}),t.get("transaction_id")&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Transaction ID"}),e.jsx("div",{className:"text-sm font-mono text-gray-800",children:t.get("transaction_id")})]})]}),e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsx("button",{onClick:()=>a("/"),className:"w-full bg-[#477A0C] hover:bg-[#3A6A0A] text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:"Retour à l'accueil"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Redirection automatique dans 5 secondes..."})]})]})})}function kr(){const a=Ie(),[t]=Ot(),{setPaymentStatus:s,setStep:r,setPaymentData:n}=J(),[o,i]=f.useState(15),l=t.get("orderId");return f.useEffect(()=>{s("cancelled"),n({paymentError:"Paiement annulé par l'utilisateur"});const m=setInterval(()=>{i(d=>d<=1?(clearInterval(m),r("paiement"),a("/ipad"),0):d-1)},1e3);return()=>clearInterval(m)},[s,n,r,a]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-100 flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-12 max-w-2xl w-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-8",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-4xl font-bold text-red-600 mb-4",children:"❌ Paiement Annulé"}),e.jsxs("p",{className:"text-xl text-gray-600 mb-8",children:["Le paiement pour la commande ",e.jsxs("strong",{children:["#",l]})," a été annulé."]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6 mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Pas de problème !"}),e.jsxs("ul",{className:"text-blue-700 space-y-2 text-left",children:[e.jsx("li",{children:"💡 Vos données ont été sauvegardées"}),e.jsx("li",{children:"🔄 Vous pouvez réessayer le paiement"}),e.jsx("li",{children:"💬 Ou choisir un autre mode de paiement"})]})]}),e.jsxs("p",{className:"text-gray-500 mb-6",children:["Retour au paiement dans"," ",e.jsx("span",{className:"font-bold text-red-600",children:o})," ","secondes..."]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>{r("paiement"),a("/ipad")},className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl",children:"← Retour au paiement"}),e.jsx("button",{onClick:()=>a("/"),className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl",children:"🏠 Accueil"})]})]})})}const Dr=()=>/iPad|Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,Ze=({isOpen:a,title:t,onClose:s,onSave:r,children:n,saveLabel:o="Valider"})=>{if(f.useEffect(()=>{if(!a)return;const l=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=l}},[a]),!a)return null;const i=Dr();return e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[1000] flex items-stretch justify-center bg-black/30",children:e.jsxs("div",{className:`bg-white shadow-xl flex flex-col w-full ${i?"h-full max-w-full":"h-[90vh] max-w-3xl"} rounded-none md:rounded-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition-colors",onClick:s,children:"Annuler"}),r&&e.jsx("button",{className:"px-4 py-2 rounded-lg bg-[#477A0C] text-white hover:bg-[#3A6A0A] font-medium transition-colors",onClick:r,children:o})]})]}),e.jsx("div",{className:"p-4 overflow-auto grow",children:n}),e.jsx("div",{className:"pb-safe-area-inset-bottom"})]})})},Lr=({isOpen:a,initial:t,onCancel:s,onSave:r})=>{const[n,o]=f.useState(t),i=f.useRef(null);f.useEffect(()=>{o(t)},[t,a]),f.useEffect(()=>{a&&i.current&&setTimeout(()=>{var m;return(m=i.current)==null?void 0:m.focus()},100)},[a]);const l=()=>{if(!n.clientName.trim()||!n.clientEmail.trim()){alert("Nom et email sont obligatoires");return}r(n)};return e.jsx(Ze,{isOpen:a,title:"✏️ Client — Édition plein écran",onClose:s,onSave:l,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nom complet *"}),e.jsx("input",{ref:i,className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientName,onChange:m=>o({...n,clientName:m.target.value}),placeholder:"Nom et prénom du client"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Email *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"email",value:n.clientEmail,onChange:m=>o({...n,clientEmail:m.target.value}),placeholder:"email@example.com"})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Adresse (ligne 1) *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientAddress,onChange:m=>o({...n,clientAddress:m.target.value}),placeholder:"Numéro et nom de rue"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Adresse (ligne 2)"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.addressLine2||"",onChange:m=>o({...n,addressLine2:m.target.value}),placeholder:"Complément d'adresse (optionnel)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Code postal *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientPostalCode,onChange:m=>o({...n,clientPostalCode:m.target.value}),placeholder:"75000"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ville *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientCity,onChange:m=>o({...n,clientCity:m.target.value}),placeholder:"Paris"})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Téléphone *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientPhone,onChange:m=>o({...n,clientPhone:m.target.value}),placeholder:"06 12 34 56 78"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Code porte"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientDoorCode||"",onChange:m=>o({...n,clientDoorCode:m.target.value}),placeholder:"A123B"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Type logement"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientHousingType||"",onChange:m=>o({...n,clientHousingType:m.target.value}),children:[e.jsx("option",{value:"",children:"Choisir..."}),e.jsx("option",{value:"Appartement",children:"Appartement"}),e.jsx("option",{value:"Maison",children:"Maison"}),e.jsx("option",{value:"Studio",children:"Studio"}),e.jsx("option",{value:"Loft",children:"Loft"}),e.jsx("option",{value:"Bureau",children:"Bureau"}),e.jsx("option",{value:"Commerce",children:"Commerce"})]})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"SIRET (professionnel)"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientSiret||"",onChange:m=>o({...n,clientSiret:m.target.value}),placeholder:"12345678901234"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"💡 Astuce iPad :"}),` Les champs marqués d'un * sont obligatoires. Touchez "Enregistrer" pour sauvegarder et revenir à la facture.`]})]})})},Rr=({isOpen:a,initial:t,onCancel:s,onSave:r})=>{const[n,o]=f.useState(t);f.useEffect(()=>{o(t.length>0?t:[i()])},[t,a]);const i=()=>({name:"",price:0,quantity:1,category:"Climatisation",discount:0,discountType:"percentage"}),l=()=>{o([...n,i()])},m=x=>{n.length>1&&o(n.filter((g,N)=>N!==x))},d=(x,g)=>{o(n.map((N,p)=>p===x?{...N,...g}:N))},h=()=>n.reduce((x,g)=>{const N=g.price*g.quantity,p=g.discountType==="percentage"?N*(g.discount/100):g.discount;return x+(N-p)},0),c=()=>{const x=n.filter(g=>g.name.trim()&&g.price>0);if(x.length===0){alert("Ajoutez au moins un produit valide");return}r(x)};return e.jsx(Ze,{isOpen:a,title:"🛒 Produits — Édition plein écran",onClose:s,onSave:c,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-6",children:[n.map((x,g)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["Produit ",g+1]}),n.length>1&&e.jsx("button",{onClick:()=>m(g),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Re,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nom du produit *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:x.name,onChange:N=>d(g,{name:N.target.value}),placeholder:"Ex: Climatisation réversible"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Catégorie"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:x.category,onChange:N=>d(g,{category:N.target.value}),children:[e.jsx("option",{value:"Climatisation",children:"Climatisation"}),e.jsx("option",{value:"Chauffage",children:"Chauffage"}),e.jsx("option",{value:"Ventilation",children:"Ventilation"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"}),e.jsx("option",{value:"Installation",children:"Installation"}),e.jsx("option",{value:"Autre",children:"Autre"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Prix unitaire HT *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"0",step:"0.01",value:x.price,onChange:N=>d(g,{price:parseFloat(N.target.value)||0}),placeholder:"0.00"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quantité *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"1",value:x.quantity,onChange:N=>d(g,{quantity:parseInt(N.target.value)||1})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Sous-total HT"}),e.jsxs("div",{className:"border border-gray-200 rounded-lg px-4 py-3 bg-gray-100 text-base",children:[(x.price*x.quantity).toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Remise"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"0",step:"0.01",value:x.discount,onChange:N=>d(g,{discount:parseFloat(N.target.value)||0}),placeholder:"0"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Type de remise"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:x.discountType,onChange:N=>d(g,{discountType:N.target.value}),children:[e.jsx("option",{value:"percentage",children:"Pourcentage (%)"}),e.jsx("option",{value:"fixed",children:"Montant fixe (€)"})]})]})]}),x.discount>0&&e.jsxs("div",{className:"text-sm text-gray-600 bg-white p-3 rounded border",children:[e.jsxs("div",{children:["Sous-total : ",(x.price*x.quantity).toFixed(2)," €"]}),e.jsxs("div",{children:["Remise : -",x.discountType==="percentage"?`${x.discount}% (${(x.price*x.quantity*(x.discount/100)).toFixed(2)} €)`:`${x.discount.toFixed(2)} €`]}),e.jsxs("div",{className:"font-medium text-[#477A0C]",children:["Total ligne :"," ",(x.price*x.quantity-(x.discountType==="percentage"?x.price*x.quantity*(x.discount/100):x.discount)).toFixed(2)," ","€ HT"]})]})]},g)),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 py-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-[#477A0C] hover:text-[#477A0C] transition-colors",children:[e.jsx(He,{size:20}),"Ajouter un produit"]}),e.jsxs("div",{className:"bg-[#477A0C] text-white p-4 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold",children:["Total HT : ",h().toFixed(2)," €"]}),e.jsxs("div",{className:"text-sm opacity-90",children:["TVA 20% : ",(h()*.2).toFixed(2)," €"]}),e.jsxs("div",{className:"text-xl font-bold",children:["Total TTC : ",(h()*1.2).toFixed(2)," €"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"💡 Astuce iPad :"})," Touchez les champs pour les modifier. Utilisez le bouton + pour ajouter des produits et la corbeille pour les supprimer."]})]})})},Ir=({isOpen:a,initial:t,onCancel:s,onSave:r})=>{const[n,o]=f.useState(t),i=f.useRef(null);f.useEffect(()=>{o(t)},[t,a]),f.useEffect(()=>{a&&i.current&&setTimeout(()=>{var m;return(m=i.current)==null?void 0:m.focus()},100)},[a]);const l=()=>{r(n)};return e.jsx(Ze,{isOpen:a,title:"📝 Notes — Édition plein écran",onClose:s,onSave:l,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Notes générales"}),e.jsx("textarea",{ref:i,className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[200px] resize-y",value:n.notes,onChange:m=>o({...n,notes:m.target.value}),placeholder:`Ajoutez ici toutes les informations importantes sur cette intervention...

Exemples :
• Accès au logement
• Particularités techniques
• Demandes spécifiques du client
• Points d'attention`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n.notes.length," caractères • Visible sur la facture"]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Notes publiques (facture)"}),e.jsx("textarea",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[120px] resize-y",value:n.publicNotes||"",onChange:m=>o({...n,publicNotes:m.target.value}),placeholder:`Notes qui apparaîtront sur la facture client...

Exemples :
• Conditions de garantie
• Instructions d'utilisation
• Prochaine maintenance recommandée`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(n.publicNotes||"").length," caractères • Visible par le client"]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Notes internes (privées)"}),e.jsx("textarea",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[120px] resize-y",value:n.internalNotes||"",onChange:m=>o({...n,internalNotes:m.target.value}),placeholder:`Notes internes, non visibles par le client...

Exemples :
• Problèmes rencontrés
• Temps passé
• Matériel utilisé
• Points à retenir pour la prochaine fois`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(n.internalNotes||"").length," caractères • Usage interne uniquement"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-2",children:"💡 Modèles de notes"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("button",{onClick:()=>o({...n,publicNotes:`Garantie 2 ans pièces et main d'œuvre.
Maintenance recommandée tous les 6 mois.
Manuel d'utilisation remis au client.`}),className:"block w-full text-left p-2 bg-white rounded hover:bg-blue-50 transition-colors",children:[e.jsx("strong",{children:"Garantie standard"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Garantie 2 ans, maintenance, manuel..."})]}),e.jsxs("button",{onClick:()=>o({...n,notes:`Intervention réalisée selon les normes en vigueur.
Client satisfait de la prestation.
Aucun problème particulier signalé.`}),className:"block w-full text-left p-2 bg-white rounded hover:bg-blue-50 transition-colors",children:[e.jsx("strong",{children:"Intervention standard"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Notes d'intervention classique..."})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"📱 Aide iPad :"})," Les zones de texte s'agrandissent automatiquement. Utilisez les modèles ci-dessus pour gagner du temps. Les notes publiques apparaîtront sur la facture client."]})]})})},Or=({isOpen:a,initial:t,totalAmount:s,onCancel:r,onSave:n})=>{const[o,i]=f.useState(t);f.useEffect(()=>{i(t)},[t,a]);const l=()=>s-o.acompte,m=()=>{const x=l();return o.nombreCheques===0?0:Math.floor(x/o.nombreCheques)},d=()=>{const x=[],g=[20,25,30,40,50];for(const N of g){const p=Math.round(s*N/100),u=s-p,v=Math.floor(u/o.nombreCheques),y=u%o.nombreCheques;x.push({pourcentage:N,acompte:p,montantParCheque:v,modulo:y,quality:y===0?"excellent":y<=2?"bon":"moyen"})}return x.sort((N,p)=>N.modulo-p.modulo)},h=x=>{i({...o,acompte:x})},c=()=>{if(o.paymentMethod==="cheque"&&o.nombreCheques>10){alert("Maximum 10 chèques autorisés");return}n(o)};return e.jsx(Ze,{isOpen:a,title:"💳 Paiement — Édition plein écran",onClose:r,onSave:c,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#477A0C] text-white p-4 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold",children:["Total facture : ",s.toFixed(2)," € TTC"]}),e.jsx("div",{className:"text-sm opacity-90",children:"TVA 20% incluse"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Mode de paiement principal"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{value:"cheque",label:"📝 Chèque(s)",desc:"Paiement par chèque(s)"},{value:"cash",label:"💸 Espèces",desc:"Paiement comptant"},{value:"transfer",label:"🏪 Virement",desc:"Virement bancaire"},{value:"alma",label:"💳 Alma",desc:"Paiement en plusieurs fois"}].map(x=>e.jsxs("button",{onClick:()=>i({...o,paymentMethod:x.value}),className:`p-4 border-2 rounded-lg text-left transition-all ${o.paymentMethod===x.value?"border-[#477A0C] bg-[#477A0C]/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium",children:x.label}),e.jsx("div",{className:"text-sm text-gray-600",children:x.desc})]},x.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Acompte à l'installation"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"0",max:s,step:"10",value:o.acompte,onChange:x=>i({...o,acompte:parseFloat(x.target.value)||0}),placeholder:"0"})]}),o.paymentMethod==="cheque"&&e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nombre de chèques (max 10)"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"1",max:"10",value:o.nombreCheques,onChange:x=>i({...o,nombreCheques:parseInt(x.target.value)||1})})]})]}),o.paymentMethod==="cheque"&&o.nombreCheques>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:`✨ Suggestions d'acomptes "magiques" (chèques ronds)`}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:d().slice(0,4).map((x,g)=>e.jsxs("button",{onClick:()=>h(x.acompte),className:`p-3 bg-white rounded border text-left hover:border-blue-300 transition-colors ${x.quality==="excellent"?"ring-1 ring-green-300":""}`,children:[e.jsxs("div",{className:"font-medium text-blue-800",children:[x.pourcentage,"% = ",x.acompte,"€"]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[o.nombreCheques," × ",x.montantParCheque,"€",x.modulo>0&&` + ${x.modulo}€`,x.quality==="excellent"&&" 🎯"]})]},g))})]}),o.acompte>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"📊 Récapitulatif paiement"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Acompte installation :"}),e.jsxs("span",{className:"font-medium",children:[o.acompte.toFixed(2)," €"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Reste à payer :"}),e.jsxs("span",{className:"font-medium",children:[l().toFixed(2)," €"]})]}),o.paymentMethod==="cheque"&&o.nombreCheques>0&&e.jsxs("div",{className:"flex justify-between border-t pt-1",children:[e.jsxs("span",{children:[o.nombreCheques," chèques de :"]}),e.jsxs("span",{className:"font-medium",children:[m().toFixed(2)," € chacun"]})]})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Notes sur le paiement"}),e.jsx("textarea",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[100px] resize-y",value:o.notes||"",onChange:x=>i({...o,notes:x.target.value}),placeholder:"Instructions particulières, dates de chèques, conditions spéciales..."})]}),e.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"💡 Aide iPad :"})," Utilisez les suggestions d'acomptes magiques pour obtenir des chèques avec des montants ronds (sans centimes). Maximum 10 chèques autorisés."]})]})})};function _e(a){const[t,s]=f.useState(a),[r,n]=f.useState(!1),o=f.useCallback(m=>{s(d=>({...d,...m})),n(!0)},[]),i=f.useCallback(()=>n(!1),[]),l=f.useCallback(m=>{s(m),n(!1)},[]);return{value:t,setValue:s,open:r,start:o,close:i,apply:l}}const Mr=()=>{const[a,t]=f.useState({clientName:"Jean Dupont",clientEmail:"jean.dupont@email.com",clientAddress:"123 Rue de la Paix",clientPostalCode:"75001",clientCity:"Paris",clientPhone:"06 12 34 56 78",clientDoorCode:"A123B",clientHousingType:"Appartement",clientSiret:"",addressLine2:"Bâtiment A, 3ème étage",notes:"Intervention de maintenance climatisation",publicNotes:"Garantie 2 ans pièces et main d'œuvre",internalNotes:"Client très satisfait, RDV maintenance dans 6 mois"}),[s,r]=f.useState([{name:"Climatisation réversible Samsung",price:1200,quantity:1,category:"Climatisation",discount:10,discountType:"percentage"},{name:"Installation et mise en service",price:300,quantity:1,category:"Installation",discount:0,discountType:"percentage"}]),[n,o]=f.useState({paymentMethod:"cheque",acompte:300,nombreCheques:3,chequeDates:[],chequeMontants:[],notes:"Acompte à l'installation, solde en 3 chèques"}),i=_e({clientName:a.clientName,clientEmail:a.clientEmail,clientAddress:a.clientAddress,clientPostalCode:a.clientPostalCode,clientCity:a.clientCity,clientPhone:a.clientPhone,clientDoorCode:a.clientDoorCode,clientHousingType:a.clientHousingType,clientSiret:a.clientSiret,addressLine2:a.addressLine2}),l=_e(s),m=_e({notes:a.notes,publicNotes:a.publicNotes,internalNotes:a.internalNotes}),d=_e(n),h=p=>{t(u=>({...u,...p})),i.apply(p)},c=p=>{r(p),l.apply(p)},x=p=>{t(u=>({...u,notes:p.notes,publicNotes:p.publicNotes||"",internalNotes:p.internalNotes||""})),m.apply(p)},g=p=>{o(p),d.apply(p)},N=()=>s.reduce((p,u)=>{const v=u.price*u.quantity,y=u.discountType==="percentage"?v*(u.discount/100):u.discount;return p+(v-y)},0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"🎯 iPad Wizard - Démonstration"}),e.jsx("p",{className:"text-gray-600",children:"Touchez les blocs ci-dessous pour les éditer en plein écran (optimisé iPad)"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>i.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"text-[#477A0C]",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Client"})]}),e.jsx(de,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:a.clientName}),e.jsx("div",{className:"text-gray-600",children:a.clientEmail}),e.jsx("div",{className:"text-gray-600",children:a.clientPhone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:a.clientAddress}),a.addressLine2&&e.jsx("div",{className:"text-gray-600",children:a.addressLine2}),e.jsxs("div",{className:"text-gray-600",children:[a.clientPostalCode," ",a.clientCity]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>l.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"text-[#477A0C]",size:20}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Produits (",s.length,")"]})]}),e.jsx(de,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-2",children:[s.map((p,u)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:p.name}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["x",p.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[(p.price*p.quantity).toFixed(2)," €"]}),p.discount>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["-",p.discountType==="percentage"?`${p.discount}%`:`${p.discount}€`]})]})]},u)),e.jsxs("div",{className:"border-t pt-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Total HT"}),e.jsxs("span",{children:[N().toFixed(2)," €"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-[#477A0C]",children:[e.jsx("span",{children:"Total TTC"}),e.jsxs("span",{children:[(N()*1.2).toFixed(2)," €"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>d.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"text-[#477A0C]",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Paiement"})]}),e.jsx(de,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Mode :"}),e.jsx("span",{children:n.paymentMethod==="cheque"?"📝 Chèque(s)":n.paymentMethod==="cash"?"💸 Espèces":n.paymentMethod==="transfer"?"🏪 Virement":"💳 Alma"})]}),n.acompte>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Acompte :"}),e.jsxs("span",{children:[n.acompte.toFixed(2)," €"]})]}),n.paymentMethod==="cheque"&&n.nombreCheques>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Solde :"}),e.jsxs("span",{children:[n.nombreCheques," chèques"]})]}),n.notes&&e.jsxs("div",{className:"text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Notes :"})," ",n.notes]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>m.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"text-[#477A0C]",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notes"})]}),e.jsx(de,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Générales:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.notes})]}),a.publicNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Publiques:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.publicNotes})]}),a.internalNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Internes:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.internalNotes})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-blue-800 font-medium mb-1",children:"📱 Mode iPad Wizard activé"}),e.jsx("div",{className:"text-blue-600 text-sm",children:"Sur iPad, les éditeurs s'ouvrent en plein écran pour une saisie confortable. Sur desktop, ils s'ouvrent en modal large."})]})]}),e.jsx(Lr,{isOpen:i.open,initial:i.value,onCancel:i.close,onSave:h}),e.jsx(Rr,{isOpen:l.open,initial:l.value,onCancel:l.close,onSave:c}),e.jsx(Ir,{isOpen:m.open,initial:m.value,onCancel:m.close,onSave:x}),e.jsx(Or,{isOpen:d.open,initial:d.value,totalAmount:N()*1.2,onCancel:d.close,onSave:g})]})};function qr(){return e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10 bg-white",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"🔧 Test Footer Flottant"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"Test de visibilité des boutons sur iPad Safari"})]}),e.jsxs("div",{className:"px-6 py-8 space-y-6",style:{paddingBottom:"calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)"},children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-myconfort-dark",children:"Instructions de test :"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-myconfort-dark/80",children:[e.jsx("li",{children:'Vérifiez que vous voyez les boutons "Précédent" et "Suivant" en bas'}),e.jsx("li",{children:"Faites défiler jusqu'en bas pour confirmer qu'ils restent visibles"}),e.jsx("li",{children:"Testez que les boutons réagissent au touch"}),e.jsx("li",{children:"Vérifiez qu'il n'y a pas de masquage par le safe-area"})]})]}),e.jsxs("div",{className:"bg-myconfort-green/10 p-6 rounded-xl border border-myconfort-green/30",children:[e.jsx("h3",{className:"text-lg font-bold text-myconfort-dark mb-2",children:"Configuration actuelle :"}),e.jsxs("ul",{className:"space-y-1 text-sm text-myconfort-dark/70",children:[e.jsx("li",{children:"• Viewport : viewport-fit=cover"}),e.jsx("li",{children:"• Wrapper : min-h-[100svh] overflow-x-hidden"}),e.jsx("li",{children:"• Footer : z-[9999] fixed + Portal"}),e.jsx("li",{children:"• Safe-area : max(env(safe-area-inset-bottom, 16px), 16px)"}),e.jsx("li",{children:"• Content padding : calc(88px + safe-area + 16px)"})]})]}),Array.from({length:10},(r,n)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsxs("h4",{className:"font-semibold",children:["Section ",n+1]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Contenu de test pour vérifier le scroll et l'affichage du footer. Les boutons doivent rester visibles en permanence."})]},n)),e.jsxs("div",{className:"bg-red-50 border border-red-200 p-6 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-bold text-red-700 mb-2",children:"🚨 Si vous ne voyez pas les boutons :"}),e.jsxs("ul",{className:"space-y-1 text-sm text-red-600",children:[e.jsx("li",{children:"1. Problème Safari iPad (zoom, orientation, etc.)"}),e.jsx("li",{children:"2. Problème CSS safe-area non supporté"}),e.jsx("li",{children:"3. Problème z-index ou Portal"}),e.jsx("li",{children:"4. Problème viewport fit ou configuration"})]})]})]}),e.jsx(Xe,{leftLabel:"← Précédent",onLeft:()=>alert("Bouton Précédent fonctionne !"),rightLabel:"Suivant →",onRight:()=>alert("Bouton Suivant fonctionne !")})]})}function zr(){const{n:a}=js(),t=Number(a),s=Number.isFinite(t)?Math.min(Math.max(t,1),7):1;return e.jsx(ot,{to:`/wizard/step/${s}`,replace:!0})}function $r(){return e.jsxs("div",{children:[e.jsxs("div",{className:"fixed bottom-2 right-2 bg-black/20 text-white text-xs px-2 py-1 rounded backdrop-blur-sm font-mono z-50",children:["build: ","dev"]}),e.jsx(vs,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(ys,{children:[e.jsx(Z,{path:"/",element:e.jsx(ir,{})}),e.jsx(Z,{path:"/wizard",element:e.jsx(wt,{})}),e.jsx(Z,{path:"/wizard/:step",element:e.jsx(wt,{})}),e.jsx(Z,{path:"/wizard/step/0",element:e.jsx(ot,{to:"/wizard/step/7",replace:!0})}),e.jsx(Z,{path:"/wizard/step/8",element:e.jsx(ot,{to:"/wizard/step/7",replace:!0})}),e.jsx(Z,{path:"/wizard/step/:n",element:e.jsx(zr,{})}),e.jsx(Z,{path:"/ipad",element:e.jsx(Ar,{})}),e.jsx(Z,{path:"/wizard-demo",element:e.jsx(Mr,{})}),e.jsx(Z,{path:"/payment/success",element:e.jsx(Fr,{})}),e.jsx(Z,{path:"/payment/cancel",element:e.jsx(kr,{})}),e.jsx(Z,{path:"/debug-footer",element:e.jsx(qr,{})})]})})]})}class Br extends f.Component{constructor(s){super(s);re(this,"handleReset",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});re(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){this.setState({errorInfo:r}),console.error("🚨 ErrorBoundary a capturé une erreur:",{error:s.message,stack:s.stack,componentStack:r.componentStack,timestamp:new Date().toISOString()})}render(){return this.state.hasError?this.props.fallback||e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center",children:[e.jsx("div",{className:"bg-red-100 p-4 rounded-full w-16 h-16 mx-auto mb-6 flex items-center justify-center",children:e.jsx(mt,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Oups ! Une erreur s'est produite"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"L'application a rencontré un problème inattendu. Ne vous inquiétez pas, vos données sont sauvegardées."}),!1,e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsxs("button",{onClick:this.handleReset,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsx("span",{children:"Réessayer"})]}),e.jsxs("button",{onClick:this.handleReload,className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[e.jsx(It,{className:"w-4 h-4"}),e.jsx("span",{children:"Recharger"})]})]}),e.jsx("div",{className:"mt-6 text-sm text-gray-500",children:e.jsx("p",{children:"Si le problème persiste, contactez le support technique."})})]})}):this.props.children}}console.log("### BUILD LIVE ###",new Date().toISOString());window.addEventListener("error",a=>console.error("[GLOBAL ERROR]",a.message));window.addEventListener("unhandledrejection",a=>console.error("[UNHANDLED]",a.reason));Cs(document.getElementById("root")).render(e.jsx(f.StrictMode,{children:e.jsx(Br,{children:e.jsx($r,{})})}));
