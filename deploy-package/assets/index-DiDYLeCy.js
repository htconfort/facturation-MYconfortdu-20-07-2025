var zt=Object.defineProperty;var $t=(a,t,s)=>t in a?zt(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s;var oe=(a,t,s)=>$t(a,typeof t!="symbol"?t+"":t,s);import{r as f,j as e,B as Bt,P as ge,A as _t,U as Ut,a as Pe,T as Ht,L as Vt,C as fe,b as Fe,c as tt,d as ke,S as Wt,e as Be,f as ce,g as De,h as Ce,E as st,H as vt,i as Ze,k as Gt,l as Yt,m as Kt,X as be,n as jt,o as ye,p as Nt,R as _e,q as Ct,s as Jt,M as Tt,t as wt,u as rt,F as Qt,v as de,w as dt,x as At,y as Ue,z as Xt,D as He,G as Ge,W as Zt,I as es,J as Ve,K as mt,N as Q,O as $,Q as ts,V as ss,_ as rs,Y as St,Z as Et,$ as ut,a0 as xt,a1 as Pt,a2 as ns,a3 as as,a4 as os,a5 as is,a6 as Le,a7 as ls,a8 as cs,a9 as pt,aa as ds,ab as ms,ac as us,ad as xs,ae as Ft,af as ps,ag as hs,ah as Z,ai as nt,aj as gs,ak as bs}from"./vendor-CIfSZzI1.js";import{S as fs}from"./ui-utils-Bfb2iWCB.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const ys=({onShowClients:a,onShowInvoices:t,onShowProducts:s,onShowGoogleDrive:r,onShowDebug:n,onGoToIpad:o,invoiceNumber:i,clientName:l,canSendToDrive:m=!1})=>{const[d,h]=f.useState(!1),[c,u]=f.useState("idle"),g=async()=>{if(m){h(!0),u("idle");try{await r(),u("success"),setTimeout(()=>u("idle"),3e3)}catch{u("error"),setTimeout(()=>u("idle"),3e3)}finally{h(!1)}}},v=()=>m?c==="success"?"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white":c==="error"?"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white":"bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white":"bg-gray-400 cursor-not-allowed px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md text-white opacity-60",x=()=>d?e.jsx(Vt,{size:18,className:"animate-spin"}):c==="success"?e.jsx(fe,{size:18}):c==="error"?e.jsx(Fe,{size:18}):e.jsx(tt,{size:18}),p=()=>d?"Envoi...":c==="success"?"‚úÖ Envoy√©":c==="error"?"‚ùå Erreur":"üì§ Drive",N=()=>{if(!m)return"Compl√©tez les champs obligatoires pour envoyer vers Google Drive";if(d)return"Envoi en cours vers Google Drive...";if(c==="success")return"PDF envoy√© avec succ√®s vers Google Drive";if(c==="error")return"Erreur lors de l'envoi vers Google Drive";const y=[];return i&&y.push(`Facture: ${i}`),l&&y.push(`Client: ${l}`),`Envoyer la facture vers Google Drive${y.length>0?` (${y.join(", ")})`:""}`};return e.jsx("header",{className:"bg-gradient-to-r from-[#477A0C] to-[#5A8F0F] shadow-xl sticky top-0 z-40",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(Bt,{className:"w-6 h-6 text-[#F2EFE2]"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-extrabold tracking-tight text-[#F2EFE2]",children:"MYCONFORT"}),e.jsx("p",{className:"text-[#F2EFE2]/80 text-sm font-medium",children:"Facturation professionnelle avec signature √©lectronique"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:space-x-4",children:[e.jsxs("button",{onClick:s,className:"bg-[#F2EFE2] hover:bg-white px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-black",title:"G√©rer les produits",children:[e.jsx(ge,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Produits"})]}),e.jsxs("button",{onClick:t,className:"bg-[#14281D] hover:bg-[#0F1F15] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-[#F2EFE2]",title:"Voir toutes les factures",children:[e.jsx(_t,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Factures"})]}),e.jsxs("button",{onClick:a,className:"bg-[#D68FD6] hover:bg-[#C67FC6] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-[#14281D]",title:"G√©rer les clients",children:[e.jsx(Ut,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Clients"})]}),n&&e.jsxs("button",{onClick:n,className:"bg-[#F59E0B] hover:bg-[#D97706] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-[#14281D]",title:"Centre de d√©bogage N8N",children:[e.jsx(Pe,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Debug"})]}),o&&e.jsxs("button",{onClick:o,className:"bg-[#3B82F6] hover:bg-[#2563EB] px-3 md:px-4 py-2 md:py-3 rounded-lg flex items-center space-x-2 font-bold shadow-md transition-all hover:scale-105 text-white",title:"Mode iPad tactile optimis√©",children:[e.jsx(Ht,{size:18}),e.jsx("span",{className:"hidden md:inline",children:"Mode iPad"})]}),e.jsxs("button",{onClick:g,disabled:!m||d,className:v(),title:N(),children:[x(),e.jsx("span",{className:"hidden md:inline",children:p()})]})]})]})})},vs=({invoice:a,onUpdate:t})=>e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 border border-gray-100 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsx("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"INFORMATIONS FACTURE"})}),e.jsx("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-black mb-2",children:e.jsx("strong",{children:"MYCONFORT"})}),e.jsx("p",{className:"text-black font-semibold",children:e.jsx("strong",{children:"88 Avenue des Ternes"})}),e.jsx("p",{className:"text-black font-semibold",children:"75017 Paris, France"}),e.jsx("p",{className:"text-black font-semibold",children:"SIRET: 824 313 530 00027"}),e.jsx("p",{className:"text-black font-semibold",children:"T√©l: 04 68 50 41 45"}),e.jsx("p",{className:"text-black font-semibold",children:"Email: myconfort@gmail.com"}),e.jsx("p",{className:"text-black font-semibold",children:"Site web: https://www.htconfort.com"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-black",children:"Facture n¬∞:"}),e.jsx("input",{value:a.invoiceNumber,type:"text",className:"border-2 border-[#477A0C] rounded-lg px-4 py-2 w-32 text-right font-mono text-black bg-white focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all font-bold",readOnly:!0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-bold text-black",children:["Date: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.invoiceDate,onChange:s=>t({invoiceDate:s.target.value}),type:"date",required:!0,className:`border-2 rounded-lg px-4 py-2 text-black bg-white focus:ring-2 focus:ring-[#89BBFE] transition-all font-bold ${!a.invoiceDate||a.invoiceDate.trim()===""?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`})]}),(!a.invoiceDate||a.invoiceDate.trim()==="")&&e.jsx("p",{className:"text-red-600 text-xs font-semibold",children:"‚ö†Ô∏è La date de la facture est obligatoire"}),e.jsxs("div",{children:[e.jsxs("label",{className:"block font-bold mb-1 text-black",children:["Lieu de l'√©v√©nement: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.eventLocation,onChange:s=>t({eventLocation:s.target.value}),type:"text",required:!0,className:`w-full border-2 rounded-lg px-4 py-2 text-black bg-white focus:ring-2 focus:ring-[#89BBFE] transition-all font-bold ${!a.eventLocation||a.eventLocation.trim()===""?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`,placeholder:"Lieu obligatoire (ex: Salon de l'habitat Paris)"}),(!a.eventLocation||a.eventLocation.trim()==="")&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Le lieu de l'√©v√©nement est obligatoire"})]})]})]})})]}),js=({client:a,onUpdate:t})=>{const s=(o,i)=>{t({...a,[o]:i})},r=o=>!o||o.trim()==="",n=o=>`w-full border-2 rounded-lg px-4 py-3 focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-semibold ${r(o)?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`;return e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsxs("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:[e.jsx(ke,{className:"mr-3 text-xl"}),e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-4 py-2 rounded-full font-bold",children:"INFORMATIONS CLIENT"})]}),e.jsxs("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Nom complet ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.name,onChange:o=>s("name",o.target.value),type:"text",required:!0,className:n(a.name),placeholder:"Nom complet obligatoire"}),r(a.name)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Le nom complet est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Adresse ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.address,onChange:o=>s("address",o.target.value),type:"text",required:!0,className:n(a.address),placeholder:"Adresse obligatoire"}),r(a.address)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è L'adresse est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Code postal ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.postalCode,onChange:o=>s("postalCode",o.target.value),type:"text",required:!0,className:n(a.postalCode),placeholder:"Code postal obligatoire"}),r(a.postalCode)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Le code postal est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Ville ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.city,onChange:o=>s("city",o.target.value),type:"text",required:!0,className:n(a.city),placeholder:"Ville obligatoire"}),r(a.city)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è La ville est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Type de logement ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:a.housingType||"",onChange:o=>s("housingType",o.target.value),required:!0,className:n(a.housingType),children:[e.jsx("option",{value:"",children:"S√©lectionner obligatoirement"}),e.jsx("option",{value:"Maison",children:"Maison"}),e.jsx("option",{value:"Appartement",children:"Appartement"})]}),r(a.housingType)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Le type de logement est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Code porte / √©tage ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.doorCode||"",onChange:o=>s("doorCode",o.target.value),type:"text",required:!0,className:n(a.doorCode),placeholder:"Code porte/√©tage obligatoire"}),r(a.doorCode)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Le code porte/√©tage est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["T√©l√©phone ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.phone,onChange:o=>s("phone",o.target.value),type:"tel",required:!0,className:n(a.phone),placeholder:"T√©l√©phone obligatoire"}),r(a.phone)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Le t√©l√©phone est obligatoire"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black mb-1 font-bold",children:["Email ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:a.email,onChange:o=>s("email",o.target.value),type:"email",required:!0,className:n(a.email),placeholder:"Email obligatoire"}),r(a.email)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è L'email est obligatoire"}),a.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è Format d'email invalide"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"SIRET (si applicable)"}),e.jsx("input",{value:a.siret||"",onChange:o=>s("siret",o.target.value),type:"text",className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-semibold",placeholder:"SIRET (optionnel)"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-red-800 text-sm font-semibold",children:["‚ö†Ô∏è ",e.jsx("span",{className:"text-red-600",children:"*"})," Tous les champs marqu√©s d'un ast√©risque rouge sont obligatoires pour pouvoir √©diter la facture."]})})]})]})},we=[{category:"Matelas",name:"MATELAS BAMBOU 70 x 190",priceTTC:900,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 80 x 200",priceTTC:1050,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 90 x 190",priceTTC:1110,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 90 x 200",priceTTC:1150,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 120 x 190",priceTTC:1600,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 140 x 190",priceTTC:1800,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 140 x 200",priceTTC:1880,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 160 x 200",priceTTC:2100,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 180 x 200",priceTTC:2200,autoCalculateHT:!0},{category:"Matelas",name:"MATELAS BAMBOU 200 x 200",priceTTC:2300,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 70 x 190",priceTTC:220,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 80 x 200",priceTTC:280,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 90 x 190",priceTTC:310,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 90 x 200",priceTTC:320,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 120 x 190",priceTTC:420,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 140 x 190",priceTTC:440,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 160 x 200",priceTTC:490,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 180 x 200",priceTTC:590,autoCalculateHT:!0},{category:"Sur-matelas",name:"SURMATELAS BAMBOU 200 x 200",priceTTC:630,autoCalculateHT:!0},{category:"Couettes",name:"Couette 220x240",priceTTC:300,autoCalculateHT:!0},{category:"Couettes",name:"Couette 240 x 260",priceTTC:350,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Douceur",priceTTC:80,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Thalasso",priceTTC:60,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Dual",priceTTC:60,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Panama",priceTTC:70,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Papillon",priceTTC:80,autoCalculateHT:!0},{category:"Oreillers",name:"Oreiller Flocon",priceTTC:50,autoCalculateHT:!0},{category:"Oreillers",name:"Pack de 2 oreillers (thal et dual)",priceTTC:100,autoCalculateHT:!0},{category:"Oreillers",name:"Pack 2 Dual",priceTTC:100,autoCalculateHT:!0},{category:"Oreillers",name:"Pack 2 Thalasso",priceTTC:100,autoCalculateHT:!0},{category:"Oreillers",name:"Pack oreiller 2 douceur",priceTTC:150,autoCalculateHT:!0},{category:"Oreillers",name:"Pack deux oreillers papillon",priceTTC:150,autoCalculateHT:!0},{category:"Oreillers",name:"Pack de deux oreillers Panama",priceTTC:130,autoCalculateHT:!0},{category:"Oreillers",name:"Pack deux oreillers flocons",priceTTC:90,autoCalculateHT:!0},{category:"Oreillers",name:"Traversin 140",priceTTC:140,autoCalculateHT:!0},{category:"Oreillers",name:"Traversin 160",priceTTC:160,autoCalculateHT:!0},{category:"Oreillers",name:"Pack divers",price:0,priceTTC:0,autoCalculateHT:!1},{category:"Plateau",name:"PLATEAU PRESTIGE 70 x 190",priceTTC:70,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 80 x 200",priceTTC:80,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 90 x 190",priceTTC:100,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 90 x 200",priceTTC:110,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 120 x 190",priceTTC:160,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 140 x 190",priceTTC:180,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 140 x 200",priceTTC:190,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 160 x 200",priceTTC:210,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 180 x 200",priceTTC:220,autoCalculateHT:!0},{category:"Plateau",name:"PLATEAU PRESTIGE 200 x 200",priceTTC:230,autoCalculateHT:!0},{category:"Accessoires",name:"Le r√©gule jambes",priceTTC:70,autoCalculateHT:!0},{category:"Accessoires",name:"Prot√®ge-matelas",price:0,priceTTC:0,autoCalculateHT:!1},{category:"Accessoires",name:"Housse de couette",price:0,priceTTC:0,autoCalculateHT:!1},{category:"Accessoires",name:"Taie d'oreiller",price:0,priceTTC:0,autoCalculateHT:!1}],Ae=["Matelas","Sur-matelas","Couettes","Oreillers","Plateau","Accessoires"],F=a=>typeof a!="number"||isNaN(a)?"0,00 ‚Ç¨":Number(a).toLocaleString("fr-FR",{style:"currency",currency:"EUR",minimumFractionDigits:2,maximumFractionDigits:2}),te=(a,t)=>a/(1+t/100),q=(a,t,s,r)=>{let n=t*a;return s>0&&(r==="percent"?n-=n*(s/100):n-=s*a),Math.max(0,n)};let et=0;const at=a=>{const t=Date.now(),s=new Date().getFullYear();if(t-et<5e3)return console.log("‚ö†Ô∏è G√©n√©ration bloqu√©e - trop rapide apr√®s la pr√©c√©dente"),Ns();const r=localStorage.getItem("lastInvoiceNumber")||`${s}-000`;try{const n=parseInt(r.split("-")[1])||0,o=`${s}-${String(n+1).padStart(3,"0")}`;return localStorage.setItem("lastInvoiceNumber",o),et=t,console.log(`üî¢ G√©n√©ration facture [${a||"direct"}]: ${r} ‚Üí ${o}`),o}catch{const o=`${s}-001`;return localStorage.setItem("lastInvoiceNumber",o),et=t,console.log(`üî¢ Fallback g√©n√©ration facture [direct]: ${o}`),o}},Ns=()=>{const t=new Date().getFullYear(),s=localStorage.getItem("lastInvoiceNumber")||`${t}-000`;try{const r=parseInt(s.split("-")[1])||0;return`${t}-${String(r+1).padStart(3,"0")}`}catch{return`${t}-001`}};function Te(a,t){if(t<=0||a<=0)return{acompte:0,montantCheque:0,nbCheques:0,totalTTC:a,economieTemps:"‚ùå Configuration invalide"};const s=Math.floor(a/t);let r=a-s*t;const n=Math.ceil(a*.15);if(r<n){r=n;const i=a-r,l=Math.floor(i/t),m=i-l*t;m>0&&(r=r+m);const d=`‚ú® ${t} ch√®ques de ${l}‚Ç¨ pile + acompte 15% minimum (${Math.round(r/a*100)}%)`;return{acompte:Math.round(r*100)/100,montantCheque:l,nbCheques:t,totalTTC:a,economieTemps:d}}const o=r>0?`‚ú® ${t} ch√®ques de ${s}‚Ç¨ pile (gain de temps √©norme !)`:`üéØ D√©j√† optimal ! ${t} ch√®ques de ${s}‚Ç¨ exactement`;return{acompte:Math.round(r*100)/100,montantCheque:s,nbCheques:t,totalTTC:a,economieTemps:o}}function Cs(a){if(a.nbCheques<=0)return"";const{acompte:t,montantCheque:s,nbCheques:r,totalTTC:n}=a;return t===0?`üéØ Parfait ! ${r} ch√®ques de ${s}‚Ç¨ exactement = ${n}‚Ç¨`:`üí° Suggestion optimale : Acompte de ${t}‚Ç¨ + ${r} ch√®ques de ${s}‚Ç¨ chacun = ${n}‚Ç¨ total`}function Ts(a,t){if(!t||a<=0)return"";const s=a*8,r=Math.round(s/60*10)/10;return r<1?`‚è±Ô∏è Gain estim√© : ${s}s d'√©criture √©conomis√©es`:`‚è±Ô∏è Gain estim√© : ~${r} min d'√©criture √©conomis√©es (${a} ch√®ques sans centimes)`}function ws(a,t){return t<=0?!1:a/t%1!==0}Te(1840,9),Te(1500,10),Te(2157.89,8),Te(1737,10);const As=({product:a,productIndex:t,onStatusChange:s,disabled:r=!1})=>{const n=[{value:"pending",label:"‚è≥ En attente",color:"#FF9800",bgColor:"#FFF3E0"},{value:"delivered",label:"‚úÖ Emport√©",color:"#4CAF50",bgColor:"#E8F5E8"},{value:"to_deliver",label:"üì¶ √Ä livrer",color:"#2196F3",bgColor:"#E3F2FD"},{value:"cancelled",label:"‚ùå Annul√©",color:"#f44336",bgColor:"#FFEBEE"}],o=n.find(i=>i.value===a.statut_livraison)||n[0];return e.jsxs("div",{className:"delivery-status-selector",children:[e.jsx("label",{htmlFor:`status-${t}`,className:"status-label",children:"Statut de livraison :"}),e.jsx("select",{id:`status-${t}`,value:a.statut_livraison,onChange:i=>s(t,i.target.value),disabled:r,className:"status-select",style:{backgroundColor:o.bgColor,color:o.color,borderColor:o.color},children:n.map(i=>e.jsx("option",{value:i.value,children:i.label},i.value))}),e.jsx("div",{className:"status-indicator",style:{color:o.color},children:o.label})]})},Me=({status:a,size:t="medium"})=>{const r={pending:{icon:"‚è≥",label:"En attente",color:"#FF9800",bg:"#FFF3E0"},delivered:{icon:"‚úÖ",label:"Emport√©",color:"#4CAF50",bg:"#E8F5E8"},to_deliver:{icon:"üì¶",label:"√Ä livrer",color:"#2196F3",bg:"#E3F2FD"},cancelled:{icon:"‚ùå",label:"Annul√©",color:"#f44336",bg:"#FFEBEE"}}[a],n=`status-badge-${t}`;return e.jsxs("span",{className:`status-badge ${n}`,style:{backgroundColor:r.bg,color:r.color,border:`1px solid ${r.color}40`},children:[e.jsx("span",{className:"status-icon",children:r.icon}),e.jsx("span",{className:"status-text",children:r.label})]})},Ss=({products:a})=>{const t=a.reduce((m,d)=>{const h=d.statut_livraison||"pending";return m[h]=(m[h]||0)+1,m},{}),s=a.length,r=t.delivered||0,n=t.pending||0,o=t.to_deliver||0,i=t.cancelled||0,l=s>0?Math.round((r+i)/s*100):0;return s===0?null:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-blue-800 mb-3 flex items-center",children:"üìä R√©sum√© des statuts de livraison"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mb-1",children:[e.jsx("span",{children:"Progression globale"}),e.jsxs("span",{children:[l,"% termin√©"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-blue-500 h-3 rounded-full transition-all duration-300",style:{width:`${l}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[n>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-orange-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Me,{status:"pending"}),e.jsx("span",{className:"text-lg font-bold text-orange-600",children:n})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"En attente"})]}),o>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Me,{status:"to_deliver"}),e.jsx("span",{className:"text-lg font-bold text-blue-600",children:o})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"√Ä livrer"})]}),r>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Me,{status:"delivered"}),e.jsx("span",{className:"text-lg font-bold text-green-600",children:r})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Emport√©"})]}),i>0&&e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-red-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Me,{status:"cancelled"}),e.jsx("span",{className:"text-lg font-bold text-red-600",children:i})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Annul√©"})]})]}),n>0&&e.jsxs("div",{className:"mt-3 p-2 bg-orange-100 border border-orange-300 rounded text-sm text-orange-700",children:["‚ö†Ô∏è ",n," produit(s) en attente de traitement"]}),n===0&&o===0&&s>0&&e.jsx("div",{className:"mt-3 p-2 bg-green-100 border border-green-300 rounded text-sm text-green-700",children:"‚úÖ Tous les produits ont √©t√© trait√©s !"})]})};class kt{static async notifyStatusChange(t,s,r,n){try{const o=await fetch(this.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({invoiceNumber:t,productName:s,newStatus:r,oldStatus:n,timestamp:new Date().toISOString(),source:"facturation-app"})});if(!o.ok)throw new Error(`HTTP Error: ${o.status}`);const i=await o.json();return console.log("‚úÖ Statut notifi√© avec succ√®s:",i),!0}catch(o){return console.error("‚ùå Erreur notification statut:",o),!1}}}oe(kt,"webhookUrl","https://n8n.srv765811.hstgr.cloud/webhook/sync/status-update");const ct="/assets/Alma_orange-CdugUa7W.png",Es=({products:a,onUpdate:t,taxRate:s,invoiceNotes:r,onNotesChange:n,acompteAmount:o,onAcompteChange:i,paymentMethod:l,onPaymentMethodChange:m,advisorName:d,onAdvisorNameChange:h,termsAccepted:c,onTermsAcceptedChange:u,signature:g,onShowSignaturePad:v,nombreChequesAVenir:x,onNombreChequesAVenirChange:p,invoiceNumber:N})=>{const[y,P]=f.useState({category:"",name:"",quantity:1,unitPrice:0,priceTTC:0}),[b,C]=f.useState(null),E=f.useMemo(()=>we.filter(j=>j.category===y.category),[y.category]),A=f.useMemo(()=>{const j=a.reduce((se,W)=>se+W.quantity*te(W.priceTTC,s),0),R=a.reduce((se,W)=>se+q(W.quantity,W.priceTTC,W.discount,W.discountType),0),I=a.reduce((se,W)=>{const Qe=W.priceTTC*W.quantity,w=q(W.quantity,W.priceTTC,W.discount,W.discountType);return se+(Qe-w)},0),K=Number(o||0),H=Math.max(0,R-K),ae=Number(x||0);return{subtotal:j,totalWithTax:R,totalDiscount:I,taxAmount:R-R/(1+s/100),totalPercu:K,totalARecevoir:Math.max(0,R-K),montantParCheque:H&&ae?H/ae:0,totalCheques:H&&ae?H:0}},[a,s,o,x]),k=f.useMemo(()=>{if(x<=0||A.totalWithTax<=0)return null;const j=Te(A.totalWithTax,x),R=ws(A.totalWithTax,x),I=Ts(x,R);return{...j,message:Cs(j),gainTemps:I,estBenefique:R,acompteActuel:o||0,peutOptimiser:R&&j.acompte!==(o||0)}},[A.totalWithTax,x,o]);f.useEffect(()=>{const j=l&&(l.toLowerCase().includes("ch√®que")||l.toLowerCase().includes("cheque"));j&&x>0&&!c&&u(!0),l==="Ch√®ques √† venir"&&(x===0||x===null)&&B(9),j&&x>0&&k&&k.estBenefique&&k.peutOptimiser&&i(k.acompte)},[l,x,k==null?void 0:k.acompte,k==null?void 0:k.estBenefique,k==null?void 0:k.peutOptimiser,i,c,u]),f.useEffect(()=>{if(l==="Virement"&&(x>0&&p(0),A.totalWithTax>0)){const j=Math.round(A.totalWithTax*.2*100)/100;o!==j&&i(j)}},[l,A.totalWithTax,x,o,p,i]),f.useEffect(()=>{l==="Alma"&&(x===0||x===null||x>4)&&p(3)},[l,x,p]);const D=()=>!l||l.trim()==="",T=()=>c===!0,O=()=>`w-full border-2 rounded-lg px-4 py-3 focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold ${D()?"border-red-500 focus:border-red-500":"border-[#477A0C] focus:border-[#F55D3E]"}`,U=j=>{const R=j.target.value.replace(/^0+/,"");i(Number(R||"0"))},L=j=>{const R=j.target.value.replace(/^0+/,"");p(Number(R||"0"))},B=j=>{p(j)},_=j=>{P({...y,category:j,name:"",unitPrice:0,priceTTC:0})},ee=j=>{const R=we.find(I=>I.name===j);R&&P({...y,name:j,priceTTC:R.priceTTC,unitPrice:R.autoCalculateHT?te(R.priceTTC,s):R.price||0})},V=j=>{P({...y,priceTTC:j,unitPrice:te(j,s)})},me=()=>{if(!y.name||y.quantity<=0||y.priceTTC<=0){alert("Veuillez remplir tous les champs obligatoires");return}const j=we.find(H=>H.name===y.name),R=y.category==="Diverse",I={id:Date.now().toString(),name:y.name,category:y.category,quantity:y.quantity,unitPrice:y.unitPrice,priceHT:te(y.priceTTC,s),priceTTC:y.priceTTC,discount:0,discountType:"percent",totalHT:te(y.priceTTC,s)*y.quantity,totalTTC:y.priceTTC*y.quantity,autoCalculateHT:R?!1:(j==null?void 0:j.autoCalculateHT)||!1,isPickupOnSite:!1,statut_livraison:"pending"},K=a.findIndex(H=>H.name===I.name&&Math.abs(H.priceTTC-I.priceTTC)<.01);if(K>=0){const H=[...a];H[K].quantity+=I.quantity,t(H)}else t([...a,I]);P({category:"",name:"",quantity:1,unitPrice:0,priceTTC:0})},Ie=j=>{if(window.confirm("√ätes-vous s√ªr de vouloir supprimer ce produit ?")){const R=a.filter((I,K)=>K!==j);t(R)}},ne=(j,R)=>{const I=[...a];I[j]={...I[j],...R},R.priceTTC&&I[j].autoCalculateHT&&(I[j].unitPrice=te(R.priceTTC,s)),t(I)},ue=j=>{C(j)},xe=()=>{C(null)};return e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsxs("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:[e.jsx(Wt,{className:"mr-3 text-xl"}),e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"PRODUITS & TARIFICATION"})]}),e.jsxs("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:[e.jsxs("div",{className:"mb-6 bg-white rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-2 mb-2",children:[e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Cat√©gorie"}),e.jsxs("select",{value:y.category,onChange:j=>_(j.target.value),className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 bg-white font-bold focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",children:[e.jsx("option",{value:"",children:"S√©lectionner"}),Ae.map(j=>e.jsx("option",{value:j,children:j},j))]})]}),e.jsxs("div",{className:"md:col-span-4",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Produit"}),y.category==="Diverse"?e.jsx("input",{type:"text",value:y.name,onChange:j=>P({...y,name:j.target.value}),placeholder:"Saisir le nom du produit...",className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 bg-white font-bold focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",disabled:!y.category}):e.jsxs("select",{value:y.name,onChange:j=>ee(j.target.value),className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 bg-white font-bold focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",disabled:!y.category,children:[e.jsx("option",{value:"",children:y.category?"S√©lectionner un produit":"S√©lectionner une cat√©gorie d'abord"}),E.map(j=>e.jsx("option",{value:j.name,children:j.name},j.name))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Quantit√©"}),e.jsx("input",{value:y.quantity,onChange:j=>P({...y,quantity:parseInt(j.target.value)||1}),type:"number",min:"1",className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",onFocus:j=>j.target.select(),onTouchStart:j=>j.currentTarget.select()})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Prix TTC"}),e.jsx("input",{value:y.priceTTC,onChange:j=>V(parseFloat(j.target.value)||0),type:"number",step:"0.01",min:"0",className:"w-full border-2 border-[#477A0C] rounded-lg px-3 py-2 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all text-black",onFocus:j=>j.target.select(),onTouchStart:j=>j.currentTarget.select()})]}),e.jsx("div",{className:"md:col-span-1 flex items-end",children:e.jsx("button",{onClick:me,className:"w-full bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg transition-colors flex items-center justify-center",title:"Ajouter le produit",children:e.jsx(Be,{className:"w-4 h-4"})})})]}),y.priceTTC>0&&e.jsx("div",{className:"mt-2 text-sm text-black",children:e.jsxs("span",{className:"font-semibold",children:["Prix HT calcul√©: ",F(y.unitPrice)]})})]}),a.length>0&&e.jsx(Ss,{products:a}),e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#477A0C] text-[#F2EFE2]",children:[e.jsx("th",{className:"border border-[#477A0C] px-4 py-3 text-left font-extrabold",children:"PRODUIT"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-center font-bold",children:"STATUT DE LIVRAISON"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-center font-bold",children:"Quantit√©"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"PU HT"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"PU TTC"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"Remise"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-right font-bold",children:"Total TTC"}),e.jsx("th",{className:"border border-[#477A0C] px-3 py-2 text-center font-bold",children:"Actions"})]})}),e.jsxs("tbody",{children:[a.map((j,R)=>e.jsxs("tr",{className:"bg-white",children:[e.jsxs("td",{className:"border border-gray-300 px-3 py-2",children:[e.jsx("div",{className:"font-bold text-black",children:j.name}),j.category&&e.jsx("div",{className:"text-xs text-gray-600",children:j.category})]}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsx(As,{product:{nom:j.name,quantite:j.quantity,prix_ttc:j.priceTTC,total_ttc:q(j.quantity,j.priceTTC,j.discount,j.discountType),categorie:j.category||"",remise:j.discount,type_remise:j.discountType,statut_livraison:j.statut_livraison||"pending",emporte:j.isPickupOnSite},productIndex:R,onStatusChange:async(I,K)=>{const H=a[I],ae=H.statut_livraison;if(ne(I,{statut_livraison:K,isPickupOnSite:K==="delivered"}),N&&H.name)try{await kt.notifyStatusChange(N,H.name,K,ae)}catch(se){console.warn("‚ö†Ô∏è Notification N8N √©chou√©e, mais le changement local est conserv√©:",se)}}})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:b===R?e.jsx("input",{type:"number",min:"1",value:j.quantity,onChange:I=>ne(R,{quantity:parseInt(I.target.value)||1}),className:"w-16 text-center border border-gray-300 rounded px-1 py-1 text-black",onBlur:xe,onKeyPress:I=>I.key==="Enter"&&xe(),onFocus:I=>I.target.select(),onTouchStart:I=>I.currentTarget.select(),autoFocus:!0}):e.jsx("span",{className:"font-bold cursor-pointer hover:bg-gray-100 px-2 py-1 rounded text-black",onClick:()=>ue(R),children:j.quantity})}),e.jsxs("td",{className:"border border-gray-300 px-3 py-2 text-right",children:[e.jsx("div",{className:"font-bold text-black",children:F(te(j.priceTTC,s))}),e.jsx("div",{className:"text-xs text-gray-600",children:"HT"})]}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-right",children:b===R?e.jsx("input",{type:"number",step:"0.01",min:"0",value:j.priceTTC,onChange:I=>ne(R,{priceTTC:parseFloat(I.target.value)||0}),className:"w-20 text-right border border-gray-300 rounded px-1 py-1 text-black",onBlur:xe,onKeyPress:I=>I.key==="Enter"&&xe(),onFocus:I=>I.target.select(),onTouchStart:I=>I.currentTarget.select()}):e.jsxs("div",{className:"cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>ue(R),children:[e.jsx("div",{className:"font-bold text-black",children:F(j.priceTTC)}),e.jsx("div",{className:"text-xs text-gray-600",children:"TTC"})]})}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 bg-[#F55D3E] bg-opacity-20",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsxs("select",{value:j.discountType,onChange:I=>ne(R,{discountType:I.target.value}),className:"border border-gray-300 rounded px-1 py-1 text-xs w-12 text-black",children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"‚Ç¨"})]}),e.jsx("input",{value:j.discount,onChange:I=>ne(R,{discount:parseFloat(I.target.value)||0}),type:"number",step:"0.01",min:"0",className:"w-16 border border-gray-300 rounded px-1 py-1 text-right text-black",onFocus:I=>I.target.select(),onTouchStart:I=>I.currentTarget.select()})]})}),e.jsxs("td",{className:"border border-gray-300 px-3 py-2 text-right font-bold",children:[e.jsx("span",{className:"text-black",children:F(q(j.quantity,j.priceTTC,j.discount,j.discountType))}),j.discount>0&&e.jsxs("div",{className:"text-xs text-gray-600",children:["(-",j.discountType==="percent"?`${j.discount}%`:F(j.discount),")"]})]}),e.jsx("td",{className:"border border-gray-300 px-3 py-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-1",children:[e.jsx("button",{onClick:()=>ue(R),className:"text-white bg-blue-500 hover:bg-blue-600 p-1 rounded transition-all",title:"Modifier",children:e.jsx(ce,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>Ie(R),className:"text-white bg-red-500 hover:bg-red-600 p-1 rounded transition-all",title:"Supprimer",children:e.jsx(De,{className:"w-3 h-3"})})]})})]},j.id||R)),a.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"border border-gray-300 px-3 py-4 text-center text-gray-500",children:e.jsx("span",{className:"text-black font-bold",children:"Aucun produit ajout√©"})})})]})]})})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-[#FFE4B5] rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"bg-[#477A0C] text-[#F2EFE2] p-2 rounded-full mr-3",children:e.jsx(ce,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-black font-bold text-lg",children:"REMARQUES"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-black font-semibold mb-2",children:"Notes de facture"}),e.jsx("textarea",{value:r,onChange:j=>n(j.target.value),className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 h-24 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black",placeholder:"Notes ou remarques sur la facture..."})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-300 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(Ce,{className:"w-5 h-5 text-purple-600 mr-2"}),e.jsx("h4",{className:"font-bold text-purple-800 bg-[#F55D3E] text-white px-4 py-2 rounded-lg border-2 border-[#F55D3E]",children:"TOTAL √Ä RECEVOIR"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-purple-700 font-semibold mb-1 flex items-center",children:[e.jsx(st,{className:"w-4 h-4 mr-1"}),"Total √† recevoir (‚Ç¨) - Calcul√© automatiquement"]}),e.jsx("input",{type:"text",value:F(A.totalARecevoir),readOnly:!0,className:"w-full border-2 border-[#F55D3E] rounded-lg px-3 py-2 bg-[#F55D3E] text-white font-bold cursor-not-allowed",placeholder:"Calcul√© automatiquement : Total TTC - Acompte"}),e.jsxs("div",{className:"text-xs text-purple-600 mt-1",children:['‚ú® Synchronis√© avec "TOTAUX & ACOMPTE" (',F(A.totalWithTax)," -"," ",F(Number(o||0)),")"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-purple-700 font-semibold mb-1 flex items-center",children:[e.jsx(vt,{className:"w-4 h-4 mr-1"}),l==="Alma"?"Nombre de paiements ALMA":"Nombre de ch√®ques (√† venir)"]}),e.jsx("input",{type:"number",min:"0",step:"1",placeholder:"0",value:x||0,onChange:L,className:"w-full border-2 border-purple-300 rounded-lg px-3 py-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all bg-white text-purple-800 font-bold",onFocus:j=>j.target.select(),onTouchStart:j=>j.currentTarget.select()})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-purple-700 font-semibold mb-1 flex items-center",children:[e.jsx(Ze,{className:"w-4 h-4 mr-1"}),l==="Alma"?"Montant par paiement (calcul√©)":"Montant par ch√®que (calcul√©)"]}),e.jsx("input",{type:"text",value:A.montantParCheque>0?F(A.montantParCheque):"",readOnly:!0,className:"w-full border-2 border-purple-300 rounded-lg px-3 py-2 bg-purple-100 text-purple-800 font-bold cursor-not-allowed",placeholder:"Calcul√© automatiquement"})]})]}),A.totalARecevoir>0&&Number(x)>0&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-100 border border-purple-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-purple-700 font-semibold",children:"Calcul automatique :"}),e.jsx("span",{className:"text-purple-800 font-bold text-lg",children:F(A.montantParCheque)})]}),e.jsxs("div",{className:"text-xs text-purple-600",children:[F(A.totalARecevoir)," √∑"," ",x," ",l==="Alma"?"paiement":"ch√®que",Number(x)>1?"s":""," ="," ",F(A.montantParCheque)," par"," ",l==="Alma"?"paiement":"ch√®que"]}),e.jsx("div",{className:"mt-2 p-2 bg-green-100 border border-green-300 rounded",children:e.jsxs("div",{className:"text-sm text-green-800 font-semibold",children:["‚úÖ Total ",l==="Alma"?"ALMA":"des ch√®ques"," ",": ",F(A.totalCheques)]})})]}),e.jsxs("div",{className:"mt-3 p-3 bg-green-50 border border-green-200 rounded text-xs text-green-700",children:["‚ú® ",e.jsx("strong",{children:"Synchronisation automatique :"}),' Le "Total √† recevoir" est automatiquement calcul√© (Total TTC - Acompte) et synchronis√© avec le bloc "TOTAUX & ACOMPTE". Saisissez uniquement le nombre'," ",l==="Alma"?"de paiements ALMA":"de ch√®ques"," ","pour calculer automatiquement le montant par"," ",l==="Alma"?"paiement":"ch√®que","."]})]})]}),e.jsxs("div",{className:"bg-[#89BBFE] rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"bg-[#477A0C] text-[#F2EFE2] p-2 rounded-full mr-3",children:e.jsx(Ze,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-black font-bold text-lg",children:"TOTAUX & ACOMPTE"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between border-b border-gray-300 pb-2",children:[e.jsx("span",{className:"font-semibold text-black",children:"Total HT:"}),e.jsx("span",{className:"font-semibold text-black",children:F(A.subtotal)})]}),e.jsxs("div",{className:"flex justify-between border-b border-gray-300 pb-2",children:[e.jsxs("span",{className:"font-semibold text-black",children:["TVA (",s,"%):"]}),e.jsx("span",{className:"font-semibold text-black",children:F(A.taxAmount)})]}),A.totalDiscount>0&&e.jsxs("div",{className:"flex justify-between text-red-600 border-b border-gray-300 pb-2",children:[e.jsx("span",{className:"font-semibold",children:"Remise totale:"}),e.jsxs("span",{className:"font-semibold",children:["-",F(A.totalDiscount)]})]}),e.jsxs("div",{className:"flex justify-between bg-[#477A0C] text-[#F2EFE2] p-3 rounded-lg shadow-md",children:[e.jsx("span",{className:"font-bold text-lg",children:"Total TTC:"}),e.jsx("span",{className:"font-bold text-xl",children:F(A.totalWithTax)})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4 mt-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(st,{className:"w-5 h-5 text-blue-600 mr-2"}),e.jsx("h4",{className:"font-bold text-blue-800",children:"GESTION ACOMPTE"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-blue-700 font-semibold mb-1 flex items-center",children:["Acompte vers√© (‚Ç¨)",k&&k.estBenefique&&o===k.acompte&&e.jsxs("span",{className:"ml-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full flex items-center",children:[e.jsx(Gt,{className:"w-3 h-3 mr-1"}),"Proposition automatique"]})]}),k&&k.estBenefique&&o===k.acompte&&e.jsx("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"text-xs text-blue-700 flex items-center",children:[e.jsx("span",{className:"mr-1",children:"üí°"}),e.jsx("strong",{children:"Proposition automatique"})," : Vous pouvez modifier ce montant si n√©cessaire"]})}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:A.totalWithTax,placeholder:"0.00",value:o!=null&&o!==0?o:"",onChange:U,className:`w-full border-2 rounded-lg px-4 py-2 focus:ring-2 transition-all bg-white text-blue-800 font-bold ${k&&k.estBenefique&&o===k.acompte?"border-green-400 focus:border-green-500 focus:ring-green-200 bg-green-50":"border-blue-300 focus:border-blue-500 focus:ring-blue-200"}`,onFocus:j=>j.target.select(),onTouchStart:j=>j.currentTarget.select()}),k&&k.estBenefique&&o===k.acompte&&e.jsxs("div",{className:"mt-2 p-3 bg-green-100 border border-green-300 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-green-800 mb-2",children:[e.jsx(Yt,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{className:"font-semibold",children:["üéØ Proposition optimale : ",k.nbCheques," ","ch√®ques de ",k.montantCheque,"‚Ç¨ pile"]})]}),k.gainTemps&&e.jsx("div",{className:"text-xs text-green-700 mb-2",children:k.gainTemps}),e.jsxs("div",{className:"text-xs text-green-600 bg-green-50 p-2 rounded border border-green-200",children:["‚úèÔ∏è ",e.jsx("strong",{children:"Modifiable :"})," Vous pouvez ajuster ce montant selon les besoins du client"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-green-100 border border-green-300 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(Kt,{className:"w-4 h-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-green-700 font-semibold text-sm",children:"Total per√ßu"})]}),e.jsx("div",{className:"text-green-800 font-bold text-lg",children:F(A.totalPercu)})]}),e.jsxs("div",{className:"bg-[#F55D3E] border-2 border-[#F55D3E] rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[e.jsx(Ze,{className:"w-4 h-4 text-white mr-1"}),e.jsx("span",{className:"text-white font-semibold text-sm",children:"Total √† recevoir"})]}),e.jsx("div",{className:"text-white font-bold text-lg",children:F(A.totalARecevoir)})]})]}),A.totalWithTax>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"Progression du paiement"}),e.jsxs("span",{children:[Math.round(Number(o||0)/A.totalWithTax*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-blue-500 h-3 rounded-full transition-all duration-300",style:{width:`${Math.min(Number(o||0)/A.totalWithTax*100,100)}%`}})})]})]})]}),l==="Virement"&&e.jsxs("div",{className:"bg-gradient-to-r from-orange-50 to-red-50 border-2 border-[#F55D3E] rounded-lg p-3 mt-4",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-[#F55D3E] mr-2"}),e.jsx("h4",{className:"font-bold text-black text-sm",children:"RELEV√â D'IDENTIT√â BANCAIRE (RIB)"})]}),e.jsxs("div",{className:"bg-white border-2 border-[#F55D3E] rounded-lg p-3",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("h5",{className:"font-bold text-black text-sm",children:"MYCONFORT"}),e.jsx("p",{className:"text-xs text-black",children:"Coordonn√©es bancaires pour virement"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"Titulaire du compte"}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded px-2 py-1 text-xs font-medium text-black",children:"MYCONFORT SARL"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"Banque"}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded px-2 py-1 text-xs font-medium text-black",children:"BANQUE POPULAIRE DU SUD"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"IBAN"}),e.jsx("div",{className:"bg-[#F55D3E] bg-opacity-10 border-2 border-[#F55D3E] rounded px-2 py-1 text-xs font-bold text-black",children:"FR76 1660 7000 1708 1216 3980 964"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-semibold text-black mb-1",children:"BIC/SWIFT"}),e.jsx("div",{className:"bg-gray-50 border border-gray-300 rounded px-2 py-1 text-xs font-medium text-black",children:"CCBPFRPPPPG"})]})]})]}),e.jsx("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-300 rounded-lg",children:e.jsxs("div",{className:"flex items-center text-xs text-black",children:[e.jsx("div",{className:"bg-blue-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-xs font-bold mr-2 flex-shrink-0",children:"i"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-black",children:"Instructions de virement :"}),e.jsxs("p",{className:"text-xs mt-1 text-black",children:["‚Ä¢ Montant √† virer :"," ",e.jsx("strong",{children:F(A.totalARecevoir)}),e.jsx("br",{}),"‚Ä¢ Merci d'indiquer votre nom et num√©ro de facture en r√©f√©rence",e.jsx("br",{}),"‚Ä¢ Le RIB sera automatiquement joint √† la facture par email"]})]})]})})]})]}),A.totalCheques>0&&e.jsxs("div",{className:"bg-[#F55D3E] border-2 border-[#F55D3E] rounded-lg p-3 mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"w-4 h-4 text-white mr-2"}),e.jsx("span",{className:"text-white font-semibold",children:l==="Alma"?"Total ALMA :":"Total √† recevoir:"})]}),e.jsx("span",{className:"text-white font-bold",children:F(A.totalCheques)})]}),e.jsx("div",{className:"text-xs text-white opacity-90 mt-1",children:l==="Alma"?`${x} paiement${Number(x)>1?"s":""} de ${F(A.montantParCheque)} chacun (ALMA)`:`${x} ch√®que${Number(x)>1?"s":""} de ${F(A.montantParCheque)} chacun (√† venir)`}),l==="Alma"&&e.jsx("div",{className:"flex justify-center mt-3",children:e.jsx("img",{src:ct,alt:"Alma",className:"h-8 opacity-90 hover:opacity-100 transition-opacity"})})]})]})]}),e.jsxs("div",{className:"bg-[#FFE4B5] rounded-lg p-4 border-2 border-[#477A0C]",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("div",{className:"bg-[#477A0C] text-[#F2EFE2] p-2 rounded-full mr-3",children:e.jsx(Ce,{className:"w-5 h-5"})}),e.jsx("h3",{className:"text-black font-bold text-lg",children:"MODE DE R√àGLEMENT"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-black font-semibold mb-1",children:["M√©thode de paiement ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("select",{value:l,onChange:j=>m(j.target.value),required:!0,className:O(),children:[e.jsx("option",{value:"",children:"S√©lectionner obligatoirement"}),e.jsx("option",{value:"Ch√®ques √† venir",children:"Ch√®ques √† venir"}),e.jsx("option",{value:"Virement",children:"Virement bancaire"}),e.jsx("option",{value:"Carte Bleue",children:"Carte Bleue"}),e.jsx("option",{value:"Esp√®ces",children:"Esp√®ces"}),e.jsx("option",{value:"Alma",children:"Alma (paiement en plusieurs fois)"}),e.jsx("option",{value:"PayPal",children:"PayPal"}),e.jsx("option",{value:"Ch√®que",children:"Ch√®que"}),e.jsx("option",{value:"Acompte",children:"Acompte"})]}),l==="Ch√®ques √† venir"&&e.jsxs("div",{className:"mt-3 p-3 bg-purple-50 border border-purple-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:!0,readOnly:!0,className:"form-checkbox h-4 w-4 text-purple-600 rounded"}),e.jsx("span",{className:"text-purple-700 font-semibold",children:"Nombre de fois :"})]}),e.jsxs("select",{value:x||9,onChange:j=>B(Number(j.target.value)),className:"w-full border-2 border-purple-300 rounded-lg px-3 py-2 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 transition-all bg-white text-purple-800 font-bold",children:[e.jsx("option",{value:9,children:"9 ch√®ques"}),e.jsx("option",{value:8,children:"8 ch√®ques"}),e.jsx("option",{value:7,children:"7 ch√®ques"}),e.jsx("option",{value:6,children:"6 ch√®ques"}),e.jsx("option",{value:5,children:"5 ch√®ques"}),e.jsx("option",{value:4,children:"4 ch√®ques"}),e.jsx("option",{value:3,children:"3 ch√®ques"}),e.jsx("option",{value:2,children:"2 ch√®ques"})]}),e.jsx("div",{className:"text-xs text-purple-600 mt-1",children:'üéØ Le nombre de ch√®ques sera automatiquement appliqu√© dans "Ch√®ques √† venir"'})]}),l==="Alma"&&e.jsxs("div",{className:"mt-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("label",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",checked:!0,readOnly:!0,className:"form-checkbox h-4 w-4 text-orange-600 rounded"}),e.jsx("span",{className:"text-orange-700 font-semibold",children:"Paiement en plusieurs fois :"})]}),e.jsxs("select",{value:x||3,onChange:j=>B(Number(j.target.value)),className:"w-full border-2 border-orange-300 rounded-lg px-3 py-2 focus:border-orange-500 focus:ring-2 focus:ring-orange-200 transition-all bg-white text-orange-800 font-bold",children:[e.jsx("option",{value:2,children:"2 fois (sans frais)"}),e.jsx("option",{value:3,children:"3 fois (sans frais)"}),e.jsx("option",{value:4,children:"4 fois (sans frais)"})]}),e.jsxs("div",{className:"text-xs text-orange-600 mt-1",children:["üí≥ Le paiement ALMA sera divis√© en"," ",x||3," fois"]})]}),D()&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-semibold",children:"‚ö†Ô∏è La m√©thode de paiement est obligatoire"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black font-semibold mb-1",children:"Conseiller(e)"}),e.jsx("input",{value:d,onChange:j=>h(j.target.value),type:"text",className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold",placeholder:"Nom du conseiller"})]}),e.jsxs("div",{className:`bg-gradient-to-r from-green-50 to-emerald-50 border-2 rounded-lg p-4 ${T()?"border-green-300":"border-red-300"}`,children:[e.jsxs("label",{className:"flex items-start",children:[e.jsx("input",{checked:c,onChange:j=>u(j.target.checked),type:"checkbox",required:!0,className:`form-checkbox h-5 w-5 rounded focus:ring-2 mr-3 mt-0.5 ${T()?"text-[#477A0C] focus:ring-[#477A0C]":"text-red-500 focus:ring-red-500"}`}),e.jsxs("span",{className:`font-semibold ${T()?"text-black":"text-red-600"}`,children:["J'ai lu et j'accepte les conditions g√©n√©rales de vente"," ",e.jsx("span",{className:"text-red-600",children:"*"})]})]}),T()?e.jsxs("div",{className:"mt-2 flex items-center text-green-700",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"text-sm font-semibold",children:"‚úÖ Conditions accept√©es"}),l&&(l.toLowerCase().includes("ch√®que")||l.toLowerCase().includes("cheque"))&&x>0&&e.jsx("span",{className:"ml-2 bg-purple-100 text-purple-700 px-2 py-1 rounded-full text-xs font-bold",children:"üöÄ Auto-valid√©"})]}):e.jsx("div",{className:"mt-2 text-red-600 text-xs font-semibold",children:"‚ö†Ô∏è L'acceptation des conditions g√©n√©rales de vente est obligatoire"})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-4",children:[e.jsxs("label",{className:"block text-black font-semibold mb-2 flex items-center",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Signature client MYCONFORT"]}),e.jsx("div",{className:"border-2 border-dashed border-[#477A0C] rounded h-20 flex items-center justify-center bg-white hover:bg-gray-50 transition-colors",children:g?e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-green-600 font-semibold flex items-center justify-center space-x-1",children:[e.jsx("span",{children:"üîí"}),e.jsx("span",{children:"Signature √©lectronique enregistr√©e"})]}),e.jsx("div",{className:"mt-2 h-12 flex items-center justify-center",children:e.jsx("img",{src:g,alt:"Signature",className:"max-h-full max-w-full"})}),e.jsx("button",{onClick:v,className:"text-sm text-blue-600 hover:text-blue-800 underline mt-2 px-3 py-1 bg-blue-100 rounded-lg transition-colors",children:"‚úèÔ∏è Modifier la signature"})]}):e.jsxs("button",{onClick:v,className:"text-black hover:text-[#477A0C] font-semibold flex items-center space-x-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:[e.jsx("span",{children:"‚úçÔ∏è"}),e.jsx("span",{children:"Cliquer pour signer √©lectroniquement"})]})}),e.jsx("div",{className:"mt-3 text-xs text-blue-600",children:g?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"‚úÖ Signature valide et s√©curis√©e"}),e.jsxs("span",{className:"text-gray-500",children:["Sign√©e le ",new Date().toLocaleDateString("fr-FR")]})]}):e.jsx("div",{className:"text-orange-600",children:"‚ö†Ô∏è Signature recommand√©e pour valider la commande"})})]}),e.jsx("div",{className:`p-3 rounded-lg border-2 ${!D()&&T()?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:e.jsx("div",{className:"text-sm font-semibold",children:!D()&&T()?e.jsxs("div",{className:"text-green-800 flex items-center",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"‚úÖ Tous les champs obligatoires sont remplis"]}):e.jsxs("div",{className:"text-red-800",children:["‚ö†Ô∏è Champs obligatoires manquants :",e.jsxs("ul",{className:"list-disc list-inside mt-1 text-xs",children:[D()&&e.jsx("li",{children:"M√©thode de paiement"}),!T()&&e.jsx("li",{children:"Acceptation des conditions g√©n√©rales"})]})]})})})]})]})]})]})},ve=({isOpen:a,onClose:t,title:s,children:r,maxWidth:n="max-w-4xl"})=>a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:`bg-white rounded-lg shadow-xl p-6 w-full ${n} max-h-[80vh] overflow-auto`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-[#14281D]",children:s}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(be,{className:"w-6 h-6"})})]}),r]})}):null,Ps=({isOpen:a,onClose:t,clients:s,onLoadClient:r,onDeleteClient:n})=>{const o=i=>{window.confirm("√ätes-vous s√ªr de vouloir supprimer ce client ?")&&n(i)};return e.jsxs(ve,{isOpen:a,onClose:t,title:"Liste des Clients",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#477A0C] text-[#F2EFE2]",children:[e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Nom"}),e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Email"}),e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"T√©l√©phone"}),e.jsx("th",{className:"border px-4 py-2 text-left font-bold",children:"Adresse"}),e.jsx("th",{className:"border px-4 py-2 text-center font-bold",children:"Actions"})]})}),e.jsxs("tbody",{children:[s.map((i,l)=>e.jsxs("tr",{className:"bg-white hover:bg-gray-50",children:[e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-bold",children:i.name})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-semibold",children:i.email})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-semibold",children:i.phone})}),e.jsx("td",{className:"border px-4 py-2",children:e.jsx("span",{className:"text-black font-semibold",children:`${i.address}, ${i.postalCode} ${i.city}`})}),e.jsx("td",{className:"border px-4 py-2 text-center",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsxs("button",{onClick:()=>{r(i),t()},className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded flex items-center space-x-1 font-semibold",children:[e.jsx(jt,{className:"w-4 h-4"}),e.jsx("span",{children:"Charger"})]}),e.jsxs("button",{onClick:()=>o(l),className:"bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded flex items-center space-x-1 font-semibold",children:[e.jsx(De,{className:"w-4 h-4"}),e.jsx("span",{children:"Supprimer"})]})]})})]},i.id||l)),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"border px-4 py-4 text-center",children:e.jsx("span",{className:"text-black font-bold",children:"Aucun client enregistr√©"})})})]})]})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:t,className:"bg-[#477A0C] hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-bold shadow-lg transition-all hover:scale-105",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Retour"})]})})]})},Fs=()=>e.jsxs("div",{className:"conditions-generales",children:[e.jsx("div",{className:"conditions-header",children:e.jsx("h1",{style:{textAlign:"center",color:"#477A0C",marginBottom:"15px",fontSize:"18px"},children:"CONDITIONS G√âN√âRALES DE VENTE"})}),e.jsxs("div",{className:"conditions-content",style:{fontSize:"9px",lineHeight:"1.3",columns:"2",columnGap:"15px"},children:[e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 1 - Livraison"}),e.jsx("p",{children:"Une fois la commande exp√©di√©e, vous serez contact√© par SMS ou mail pour programmer la livraison en fonction de vos disponibilit√©s (√† la journ√©e ou demi-journ√©e). Le transporteur livre le produit au pas de porte ou en bas de l'immeuble. Veuillez v√©rifier que les dimensions du produit permettent son passage dans les escaliers, couloirs et portes. Aucun service d'installation ou de reprise de l'ancienne literie n'est pr√©vu."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 2 - D√©lais de Livraison"}),e.jsx("p",{children:"Les d√©lais de livraison sont donn√©s √† titre indicatif et ne constituent pas un engagement ferme. En cas de retard, aucune indemnit√© ou annulation ne sera accept√©e, notamment en cas de force majeure. Nous d√©clinons toute responsabilit√© en cas de d√©lai d√©pass√©."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 3 - Risques de Transport"}),e.jsx("p",{children:"Les marchandises voyagent aux risques du destinataire. En cas d'avarie ou de perte, il appartient au client de faire les r√©serves n√©cessaires obligatoire sur le bordereau du transporteur. En cas de non-respect de cette obligation on ne peut pas se retourner contre le transporteur."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 4 - Acceptation des Conditions"}),e.jsx("p",{children:"Toute livraison implique l'acceptation des pr√©sentes conditions. Le transporteur livre √† l'adresse indiqu√©e sans monter les √©tages. Le client est responsable de v√©rifier et d'accepter les marchandises lors de la livraison."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 5 - R√©clamations"}),e.jsx("p",{children:"Les r√©clamations concernant la qualit√© des marchandises doivent √™tre formul√©es par √©crit dans les huit jours suivant la livraison, par lettre recommand√©e avec accus√© de r√©ception."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 6 - Retours"}),e.jsx("p",{children:"Aucun retour de marchandises ne sera accept√© sans notre accord √©crit pr√©alable. Cet accord n'implique aucune reconnaissance."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 7 - Tailles des Matelas"}),e.jsx("p",{children:"Les dimensions des matelas peuvent varier de +/- 5 cm en raison de la thermosensibilit√© des mousses visco√©lastiques. Les tailles standards sont donn√©es √† titre indicatif et ne constituent pas une obligation contractuelle. Les matelas sur mesure doivent inclure les sp√©cifications exactes du cadre de lit."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 8 - Odeur des Mat√©riaux"}),e.jsx("p",{children:"Les mousses visco√©lastiques naturelles (√† base d'huile de ricin) et les mat√©riaux de conditionnement peuvent √©mettre une l√©g√®re odeur qui dispara√Æt apr√®s d√©ballage. Cela ne constitue pas un d√©faut."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 9 - R√®glements et Remises"}),e.jsx("p",{children:"Sauf accord express, aucun rabais ou escompte ne sera appliqu√© pour paiement comptant. La garantie couvre les mousses, mais pas les textiles et accessoires."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 10 - Paiement"}),e.jsx("p",{children:"Les factures sont payables par ch√®que, virement, carte bancaire ou esp√®ce √† r√©ception."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 11 - P√©nalit√©s de Retard"}),e.jsx("p",{children:"En cas de non-paiement, une majoration de 10% avec un minimum de 300 ‚Ç¨ sera appliqu√©e, sans pr√©judice des int√©r√™ts de retard. Nous nous r√©servons le droit de r√©silier la vente sans sommation."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 12 - Exigibilit√© en Cas de Non-Paiement"}),e.jsx("p",{children:"Le non-paiement d'une √©ch√©ance rend imm√©diatement exigible le solde de toutes les √©ch√©ances √† venir."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 13 - Livraison Incompl√®te ou Non-Conforme"}),e.jsx("p",{children:"En cas de livraison endommag√©e ou non conforme, mentionnez-le sur le bon de livraison et refusez le produit. Si l'erreur est constat√©e apr√®s le d√©part du transporteur, contactez-nous sous 72h ouvrables."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 14 - Litiges"}),e.jsx("p",{children:"Tout litige sera de la comp√©tence exclusive du Tribunal de Commerce de Perpignan ou du tribunal comp√©tent du prestataire."})]}),e.jsxs("div",{className:"condition-section",style:{marginBottom:"8px",breakInside:"avoid"},children:[e.jsx("h3",{style:{color:"#477A0C",fontSize:"10px",marginBottom:"3px",fontWeight:"bold"},children:"Art. 15 - Horaires de Livraison"}),e.jsx("p",{children:"Les livraisons sont effectu√©es du lundi au vendredi (hors jours f√©ri√©s). Une personne majeure doit √™tre pr√©sente √† l'adresse lors de la livraison. Toute modification d'adresse apr√®s commande doit √™tre signal√©e imm√©diatement √† myconfort66@gmail.com."})]})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"15px",fontSize:"8px",fontStyle:"italic"},children:"Les pr√©sentes Conditions g√©n√©rales ont √©t√© mises √† jour le 23 ao√ªt 2024"})]}),Ye=f.forwardRef(({invoice:a,className:t=""},s)=>{const r=a.products.reduce((d,h)=>d+q(h.quantity,h.priceTTC,h.discount,h.discountType==="percent"?"percent":"fixed"),0),n=a.montantAcompte||0,o=r-n,i=r/(1+a.taxRate/100),l=r-i,m=a.products.reduce((d,h)=>{const c=h.priceTTC*h.quantity,u=q(h.quantity,h.priceTTC,h.discount,h.discountType==="percent"?"percent":"fixed");return d+(c-u)},0);return e.jsx("div",{ref:s,id:"facture-apercu-modern",className:`modern-invoice ${t}`,style:{fontFamily:"'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",lineHeight:1.4,color:"#2D3748",background:"#ffffff",minHeight:"100vh",padding:"0",margin:"0"},children:e.jsxs("div",{style:{maxWidth:"100%",margin:"0",background:"white",overflow:"hidden",minHeight:"297mm",pageBreakAfter:"always",display:"flex",flexDirection:"column"},children:[e.jsx("header",{style:{background:"#477A0C",color:"white",padding:"20px 30px",borderBottom:"3px solid #3a6509",flexShrink:0},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"28px",fontWeight:"bold",margin:"0 0 8px 0",letterSpacing:"1px"},children:"MYCONFORT"}),e.jsx("p",{style:{fontSize:"14px",margin:"0",color:"#E2E8F0",fontWeight:"normal"},children:"Votre sp√©cialiste literie de qualit√©"})]}),a.signature&&e.jsxs("div",{style:{background:"#F5E6D3",padding:"8px 16px",border:"2px solid #D4A574",fontSize:"12px",fontWeight:"bold",display:"flex",alignItems:"center",gap:"6px",color:"#2D3748"},children:[e.jsx("span",{style:{color:"#477A0C"},children:"‚úì"}),"FACTURE SIGN√âE"]})]})}),e.jsxs("div",{style:{padding:"40px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"40px",marginBottom:"40px"},children:[e.jsxs("div",{style:{background:"#F2EFE2",padding:"24px",border:"2px solid #E2E8F0"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 16px 0",color:"#2D3748"},children:"MYCONFORT"}),e.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#4A5568"},children:[e.jsx("div",{style:{marginBottom:"4px"},children:"üìç 88 Avenue des Ternes"}),e.jsx("div",{style:{marginBottom:"4px"},children:"75017 Paris, France"}),e.jsx("div",{style:{marginBottom:"4px"},children:"üè¢ SIRET: 824 313 530 00027"}),e.jsx("div",{style:{marginBottom:"4px"},children:"üìû T√©l: 04 68 50 41 45"}),e.jsx("div",{style:{marginBottom:"4px"},children:"‚úâÔ∏è myconfort@gmail.com"}),e.jsx("div",{children:"üåê https://www.htconfort.com"})]})]}),e.jsxs("div",{style:{textAlign:"right"},children:[e.jsxs("div",{style:{background:"#477A0C",color:"white",padding:"24px",marginBottom:"20px"},children:[e.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 12px 0"},children:"FACTURE"}),e.jsxs("div",{style:{fontSize:"16px"},children:["N¬∞ ",a.invoiceNumber]})]}),e.jsxs("div",{style:{fontSize:"14px",color:"#4A5568",lineHeight:"1.8"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Date:"})," ",new Date(a.invoiceDate).toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),a.eventLocation&&e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Lieu:"})," ",a.eventLocation]})]})]})]}),e.jsxs("div",{style:{marginBottom:"24px",background:"#FEF2F2",padding:"12px",border:"1px solid #EF4444",fontSize:"11px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px",color:"#B91C1C",fontSize:"12px"},children:"‚öñÔ∏è INFORMATION L√âGALE - ARTICLE L224-59"}),e.jsx("div",{style:{lineHeight:"1.4",color:"#2D3748",fontStyle:"italic"},children:"¬´ Avant la conclusion de tout contrat entre un consommateur et un professionnel √† l'occasion d'une foire, d'un salon [...] le professionnel informe le consommateur qu'il ne dispose pas d'un d√©lai de r√©tractation. ¬ª"})]}),e.jsxs("div",{style:{marginBottom:"24px",background:"#F2EFE2",padding:"20px",border:"2px solid #E2E8F0"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 20px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"üë§ INFORMATIONS CLIENT"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"16px",fontSize:"14px"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Nom:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientName})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Adresse:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientAddress})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Code postal:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientPostalCode})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Ville:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientCity})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Code porte:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientDoorCode||"Non sp√©cifi√©"})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"Email:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientEmail})]}),e.jsxs("div",{children:[e.jsx("strong",{style:{color:"#2D3748"},children:"T√©l√©phone:"}),e.jsx("div",{style:{marginTop:"2px",color:"#2D3748"},children:a.clientPhone})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"24px"},children:[e.jsxs("div",{style:{background:"#F2EFE2",padding:"20px",border:"2px solid #E2E8F0"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"üí≥ MODE DE R√àGLEMENT"}),e.jsx("div",{style:{fontSize:"14px",color:"#2D3748"},children:a.paymentMethod||"Non sp√©cifi√©"})]}),e.jsxs("div",{style:{background:"#F2EFE2",padding:"20px",border:"2px solid #E2E8F0"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"üöö LIVRAISON"}),e.jsx("div",{style:{fontSize:"14px",color:"#2D3748",marginBottom:"8px"},children:a.deliveryMethod||"Non sp√©cifi√©"}),e.jsx("div",{style:{fontSize:"12px",color:"#6B7280",fontStyle:"italic"},children:"Livraison r√©alis√©e au pied de l'immeuble ou au portail"})]})]}),e.jsxs("div",{style:{marginBottom:"24px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"600",margin:"0 0 16px 0",color:"#2D3748",display:"flex",alignItems:"center",gap:"8px"},children:"üõèÔ∏è PRODUITS & TARIFICATION"}),e.jsx("div",{style:{overflow:"hidden",border:"2px solid #E2E8F0"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#477A0C",color:"white"},children:[e.jsx("th",{style:{padding:"16px",textAlign:"left",fontWeight:"bold"},children:"Produit"}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"bold"},children:"Emport√©"}),e.jsx("th",{style:{padding:"16px",textAlign:"center",fontWeight:"bold"},children:"Qt√©"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"bold"},children:"Prix unitaire"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"bold"},children:"Remise"}),e.jsx("th",{style:{padding:"16px",textAlign:"right",fontWeight:"bold"},children:"Total TTC"})]})}),e.jsx("tbody",{children:a.products.map((d,h)=>{const c=q(d.quantity,d.priceTTC,d.discount,d.discountType==="percent"?"percent":"fixed");return e.jsxs("tr",{style:{borderBottom:"1px solid #e2e8f0",background:h%2===0?"#F8FAFC":"white"},children:[e.jsxs("td",{style:{padding:"16px"},children:[e.jsx("div",{style:{fontWeight:"500",marginBottom:"4px"},children:d.name}),d.category&&e.jsx("div",{style:{fontSize:"12px",color:"#6B7280"},children:d.category})]}),e.jsx("td",{style:{padding:"16px",textAlign:"center",fontWeight:"500"},children:e.jsx("span",{style:{fontSize:"12px",padding:"4px 8px",borderRadius:"12px",background:d.isPickupOnSite?"#4ADE80":"#EF4444",color:"white",fontWeight:"bold"},children:d.isPickupOnSite?"üì¶ Emport√©":"üöõ √Ä livrer"})}),e.jsx("td",{style:{padding:"16px",textAlign:"center",fontWeight:"500"},children:d.quantity}),e.jsx("td",{style:{padding:"16px",textAlign:"right"},children:F(d.priceTTC)}),e.jsx("td",{style:{padding:"16px",textAlign:"right"},children:d.discount>0?e.jsxs("span",{style:{color:"#dc2626"},children:["-",d.discount,d.discountType==="percent"?"%":"‚Ç¨"]}):"-"}),e.jsx("td",{style:{padding:"16px",textAlign:"right",fontWeight:"600"},children:F(c)})]},h)})})]})})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:"24px",marginBottom:"24px",alignItems:"flex-start"},children:[a.signature&&e.jsxs("div",{style:{background:"#F0FDF4",padding:"24px",border:"2px solid #22C55E"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 16px 0",color:"#15803D",display:"flex",alignItems:"center",gap:"8px"},children:"‚úçÔ∏è SIGNATURE CLIENT"}),e.jsx("div",{style:{background:"white",padding:"16px",borderRadius:"4px",border:"1px solid #22c55e",textAlign:"center",minHeight:"80px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("img",{src:a.signature,alt:"Signature √©lectronique",style:{maxHeight:"60px",maxWidth:"200px"}})}),e.jsx("div",{style:{textAlign:"center",marginTop:"12px",fontSize:"14px",color:"#15803d",fontWeight:"500"},children:"‚úì Signature √©lectronique enregistr√©e"})]}),e.jsxs("div",{style:{minWidth:"320px",background:"white",border:"2px solid #E2E8F0",overflow:"hidden"},children:[m>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9"},children:[e.jsx("span",{children:"Sous-total:"}),e.jsx("span",{children:F(r+m)})]}),m>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9",color:"#dc2626"},children:[e.jsx("span",{children:"Remise totale:"}),e.jsxs("span",{children:["-",F(m)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9"},children:[e.jsx("span",{children:"Total HT:"}),e.jsx("span",{children:F(i)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9"},children:[e.jsxs("span",{children:["TVA (",a.taxRate,"%):"]}),e.jsx("span",{children:F(l)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"16px 20px",fontSize:"18px",fontWeight:"bold",background:"#477A0C",color:"white"},children:[e.jsx("span",{children:"TOTAL TTC:"}),e.jsx("span",{children:F(r)})]}),n>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"12px 20px",fontSize:"14px",borderBottom:"1px solid #f1f5f9",background:"#fef3c7"},children:[e.jsx("span",{children:"Acompte vers√©:"}),e.jsxs("span",{children:["-",F(n)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",padding:"16px 20px",fontSize:"16px",fontWeight:"600",background:"#F55D3E",color:"#2D3748"},children:[e.jsx("span",{children:"MONTANT RESTANT:"}),e.jsx("span",{children:F(o)})]})]})]})]}),a.invoiceNotes&&e.jsxs("div",{style:{background:"#FFFBEB",padding:"16px",border:"2px solid #F59E0B",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#92400E",display:"flex",alignItems:"center",gap:"8px"},children:"üìù NOTES"}),e.jsx("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#2D3748"},children:a.invoiceNotes})]}),e.jsxs("div",{style:{background:"#F2EFE2",padding:"16px",border:"2px solid #477A0C",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 12px 0",color:"#477A0C",display:"flex",alignItems:"center",gap:"8px"},children:"üí∞ R√àGLEMENTS ET MODE DE PAIEMENT"}),e.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#14281D"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Adresse pour r√®glements :"})," SAV MYCONFORT ‚Ä¢ 8 rue du Gr√©gal ‚Ä¢ 66510 Saint-Hippolyte"]}),a.paymentMethod&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("strong",{children:"Mode de r√®glement :"})," ",a.paymentMethod]}),a.nombreChequesAVenir&&a.nombreChequesAVenir>0&&e.jsxs("div",{style:{marginTop:"12px",padding:"12px",background:"white",borderRadius:"6px",border:"2px solid #477A0C"},children:[e.jsxs("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#477A0C",marginBottom:"8px",textAlign:"center"},children:["üìÖ ",a.nombreChequesAVenir," ch√®que",a.nombreChequesAVenir>1?"s":""," √† venir"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginTop:"12px",fontSize:"13px"},children:[e.jsxs("div",{style:{padding:"8px",background:"#F2EFE2",borderRadius:"4px",border:"1px solid #477A0C"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#477A0C"},children:"üí∞ Acompte vers√©"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#14281D"},children:F(n)}),e.jsxs("div",{style:{fontSize:"11px",color:"#477A0C"},children:["(",(n/r*100).toFixed(1),"% du total)"]})]}),e.jsxs("div",{style:{padding:"8px",background:"#F2EFE2",borderRadius:"4px",border:"1px solid #477A0C"},children:[e.jsx("div",{style:{fontWeight:"bold",color:"#477A0C"},children:"üìã Reste √† percevoir"}),e.jsx("div",{style:{fontSize:"16px",fontWeight:"bold",color:"#14281D"},children:F(o)}),e.jsxs("div",{style:{fontSize:"11px",color:"#477A0C"},children:["R√©parti sur ",a.nombreChequesAVenir," ch√®que",a.nombreChequesAVenir>1?"s":""]})]})]}),e.jsxs("div",{style:{marginTop:"12px",padding:"10px",background:"#477A0C",borderRadius:"4px",color:"white",textAlign:"center"},children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px"},children:"üí≥ Montant par ch√®que"}),e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",marginTop:"4px"},children:F(o/a.nombreChequesAVenir)}),e.jsxs("div",{style:{fontSize:"11px",marginTop:"2px",opacity:.9},children:[F(o)," √∑"," ",a.nombreChequesAVenir," ="," ",F(o/a.nombreChequesAVenir)," ","par ch√®que"]})]})]})]})]}),e.jsxs("div",{style:{background:"#F8FAFC",padding:"16px",border:"2px solid #E2E8F0",marginBottom:"20px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"bold",margin:"0 0 16px 0",color:"#2D3748"},children:"üìã CONDITIONS G√âN√âRALES"}),e.jsx(Fs,{})]})]}),e.jsxs("footer",{style:{background:"#477A0C",color:"white",padding:"32px 40px",textAlign:"center"},children:[e.jsx("h3",{style:{fontSize:"24px",fontWeight:"700",margin:"0 0 12px 0",letterSpacing:"-0.025em"},children:"MYCONFORT"}),e.jsx("p",{style:{fontSize:"16px",margin:"0 0 16px 0",opacity:.9},children:"Merci pour votre confiance !"}),e.jsxs("div",{style:{fontSize:"14px",opacity:.8,lineHeight:"1.6"},children:[e.jsx("div",{style:{marginBottom:"4px"},children:"Votre sp√©cialiste en matelas et literie de qualit√©"}),e.jsx("div",{style:{marginBottom:"4px"},children:"88 Avenue des Ternes, 75017 Paris - T√©l: 04 68 50 41 45"}),e.jsx("div",{children:"Email: myconfort@gmail.com - SIRET: 824 313 530 00027"})]})]})]})})});Ye.displayName="InvoicePreviewModern";class ks{static async printInvoice(t){try{const s=window.open("","_blank");if(!s){alert("Impossible d'ouvrir la fen√™tre d'impression. Veuillez autoriser les pop-ups.");return}const r=this.generateCompactPrint(t);s.document.write(r),s.document.close(),s.onload=()=>{setTimeout(()=>{s.print(),setTimeout(()=>{s.close()},1e3)},500)}}catch(s){console.error("Erreur impression:",s),alert("Erreur lors de l'impression de la facture")}}static generateCompactPrint(t){const s=t.products.map(r=>{const n=q(r.quantity,r.priceTTC,r.discount,r.discountType),o=r.discount>0?r.discountType==="percent"?`-${r.discount}%`:`-${F(r.discount)}`:"";return`
        <tr>
          <td>${r.name}</td>
          <td style="text-align: center;">${r.quantity}</td>
          <td style="text-align: right;">${F(r.priceTTC)}</td>
          <td style="text-align: center;">${o||"-"}</td>
          <td style="text-align: right; font-weight: bold;">${F(n)}</td>
        </tr>
      `}).join("");return`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Facture ${t.invoiceNumber}</title>
        <meta charset="UTF-8">
        <style>
          @page {
            size: A4;
            margin: 10mm;
          }
          
          * {
            box-sizing: border-box;
          }
          
          body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 0; 
            background: white; 
            font-size: 11px;
            line-height: 1.2;
            color: #000;
          }
          
          .invoice-page {
            width: 100%;
            max-width: none;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
          }

          /* En-t√™te compact */
          .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            padding-bottom: 12px;
            border-bottom: 2px solid #477A0C;
            flex-shrink: 0;
          }

          .company-info {
            flex: 1;
          }

          .company-name {
            font-size: 22px;
            font-weight: bold;
            color: #477A0C;
            margin-bottom: 6px;
          }

          .company-details {
            font-size: 12px;
            color: #000;
            line-height: 1.3;
          }

          .invoice-info {
            text-align: right;
            flex: 1;
          }

          .invoice-title {
            background: #477A0C;
            color: white;
            margin: 0;
            padding: 12px 16px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 4px;
          }

          .invoice-number {
            color: #000;
            margin-top: 8px;
            font-weight: bold;
            font-size: 14px;
          }

          /* Section client compact */
          .client-section {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            margin-top: 18px;
          }

          .client-info {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #477A0C;
            flex: 1;
            margin-right: 10px;
          }

          .client-info h3 {
            margin: 0 0 6px 0;
            color: #000;
            font-size: 14px;
            font-weight: bold;
          }

          .delivery-info {
            background: #e8f5e8;
            padding: 8px;
            border-radius: 4px;
            border-left: 3px solid #28a745;
            flex: 1;
          }

          .delivery-info h3 {
            margin: 0 0 6px 0;
            color: #000;
            font-size: 14px;
            font-weight: bold;
          }

          /* Tableau compact */
          .table-container {
            flex-grow: 1;
            margin: 12px 0;
            min-height: 200px;
          }

          table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
            font-size: 12px;
          }

          th {
            background: #477A0C;
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 12px;
          }

          td {
            padding: 6px 10px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
            color: #000;
          }

          td:first-child {
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            color: #000;
          }

          tr:nth-child(even) {
            background-color: #f9f9f9;
          }

          /* Totaux et paiement en ligne - OPTIMIS√â */
          .footer-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 8px;
            gap: 8px;
            flex-shrink: 0;
          }

          .totals-section {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            min-width: 180px;
          }

          .totals-section h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 12px;
            font-weight: bold;
          }

          .total-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
            font-size: 10px;
            color: #000;
          }

          .total-final {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            font-size: 12px;
            color: #000;
            border-top: 1px solid #477A0C;
            padding-top: 2px;
            margin-top: 2px;
          }

          .payment-signature {
            flex: 1;
            display: flex;
            gap: 8px;
          }

          .payment-info, .signature-section {
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            flex: 1;
          }

          .payment-info h3, .signature-section h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 12px;
            font-weight: bold;
          }

          .signature-box {
            border: 1px dashed #ccc;
            min-height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-size: 9px;
            margin-top: 4px;
            position: relative;
            overflow: hidden;
          }
          
          .signature-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 3px;
          }
          
          .signature-text {
            color: #666;
            font-style: italic;
            font-size: 9px;
          }
          }

          /* Styles RIB pour virement bancaire */
          .rib-section {
            margin-top: 8px;
            padding: 6px;
            background: #e1f5fe;
            border: 1px solid #2563eb;
            border-radius: 4px;
          }

          .rib-info {
            font-size: 9px;
            line-height: 1.3;
            color: #000;
          }

          /* Notes compactes */
          .notes-compact {
            margin-top: 8px;
            font-size: 8px;
            color: #666;
            text-align: center;
            border-top: 1px solid #eee;
            padding-top: 6px;
            margin-bottom: 8px;
          }

          /* Information l√©gale - COMPACTE */
          .legal-info {
            margin-top: 8px;
            font-size: 10px;
            color: #000;
            text-align: center;
            border: 1px solid #477A0C;
            background: #f8f9fa;
            padding: 6px;
            border-radius: 4px;
            margin-bottom: 8px;
          }

          .legal-info h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 11px;
            font-weight: bold;
          }

          .legal-info p {
            margin: 0;
            font-weight: bold;
            line-height: 1.2;
          }

          /* Espace flexible pour expansion tableau - R√âDUIT */
          .flexible-space {
            flex-grow: 1;
            min-height: 5px;
          }

          /* Footer l√©gal - COMPACT */
          .footer-legal {
            margin-top: 4px;
            border-top: 1px solid #477A0C;
            padding-top: 4px;
            font-size: 7px;
            background: #f8f9fa;
            padding: 4px;
            border-radius: 4px;
            flex-shrink: 0;
          }

          .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 8px;
          }

          .footer-left {
            flex: 1;
          }

          .footer-left p {
            margin: 0 0 2px 0;
            line-height: 1.1;
            text-align: justify;
          }

          /* Footer final - COMPACT */
          .final-footer {
            margin-top: 4px;
            padding-top: 2px;
            border-top: 1px solid #477A0C;
            font-size: 6px;
            text-align: center;
            color: #000;
            flex-shrink: 0;
          }

          .final-footer p {
            margin: 0;
            line-height: 1.1;
          }

          /* Statuts de livraison */
          .delivery-status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 9px;
            font-weight: bold;
            color: white;
          }

          .status-emporte { background-color: #28a745; }
          .status-a-livrer { background-color: #ffc107; color: #000; }

          /* Conditions G√©n√©rales de Vente - COMPACTES */
          .cgv-section {
            margin-top: auto;
            border-top: 1px solid #477A0C;
            padding-top: 4px;
            flex-shrink: 0;
          }

          .cgv-section h3 {
            margin: 0 0 4px 0;
            color: #000;
            font-size: 8px;
            font-weight: bold;
            text-align: center;
            text-transform: uppercase;
          }

          .cgv-content {
            display: flex;
            gap: 8px;
            font-size: 6px;
            line-height: 1.0;
            color: #000;
          }

          .cgv-column {
            flex: 1;
          }

          .cgv-content p {
            margin: 0 0 2px 0;
            text-align: justify;
            color: #000;
          }

          .cgv-content strong {
            color: #000;
            font-size: 6.5px;
          }

          @media print {
            body { margin: 0; padding: 0; }
            .invoice-page { height: auto; min-height: 0; }
            @page { margin: 12mm; }
          }
        </style>
      </head>
      <body>
        <div class="invoice-page">
          <!-- En-t√™te -->
          <div class="header">
            <div class="company-info">
              <div class="company-name">MYCONFORT</div>
              <div class="company-details">
                88 Avenue des Ternes, 75017 Paris<br>
                SIRET: 824 313 530 00027<br>
                T√©l: 04 68 50 41 45 | Email: myconfort@gmail.com
              </div>
            </div>
            <div class="invoice-info">
              <h1 class="invoice-title">FACTURE</h1>
              <div class="invoice-number">
                N¬∞ ${t.invoiceNumber}<br>
                Date: ${new Date(t.invoiceDate).toLocaleDateString("fr-FR")}
              </div>
            </div>
          </div>

          <!-- Section client et livraison -->
          <div class="client-section">
            <div class="client-info">
              <h3>FACTUR√â √Ä :</h3>
              <strong>${t.clientName}</strong><br>
              ${t.clientAddress}<br>
              ${t.clientPostalCode} ${t.clientCity}<br>
              T√©l: ${t.clientPhone}<br>
              Email: ${t.clientEmail}
            </div>
            <div class="delivery-info">
              <h3>LIVRAISON :</h3>
              Mode: Livraison par transporteur France Express CXI<br>
              ${t.deliveryNotes?`Notes: ${t.deliveryNotes}`:""}
            </div>
          </div>

          <!-- Tableau des produits -->
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th style="width: 60%;">D√©signation</th>
                  <th style="width: 8%; text-align: center;">Qt√©</th>
                  <th style="width: 12%; text-align: right;">Prix Unit.</th>
                  <th style="width: 8%; text-align: center;">Remise</th>
                  <th style="width: 12%; text-align: right;">Total</th>
                </tr>
              </thead>
              <tbody>
                ${s}
              </tbody>
            </table>
          </div>

          <!-- Footer avec totaux, paiement et signature -->
          <div class="footer-section">
            <div class="payment-signature">
              <div class="payment-info">
                <h3>PAIEMENT</h3>
                <div>Mode: ${t.paymentMethod}</div>
                ${t.montantAcompte>0?`<div>Acompte: ${F(t.montantAcompte)}</div>`:""}
                ${t.montantRestant>0?`<div><strong>Reste √† payer: ${F(t.montantRestant)}</strong></div>`:""}
                
                ${t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`
                <!-- RIB pour Virement Bancaire -->
                <div class="rib-section">
                  <h4 style="margin: 8px 0 4px 0; font-size: 11px; font-weight: bold; color: #2563eb;">COORDONN√âES BANCAIRES</h4>
                  <div class="rib-info">
                    <div style="font-size: 9px; line-height: 1.3;">
                      <div><strong>B√©n√©ficiaire:</strong> MYCONFORT</div>
                      <div><strong>IBAN:</strong> FR76 1660 7000 1708 1216 3980 964</div>
                      <div><strong>BIC:</strong> CCBPFRPPPPG</div>
                      <div><strong>Banque:</strong> Banque Populaire du Sud</div>
                      <div style="margin-top: 4px; font-style: italic; color: #666;">
                        Merci d'indiquer le num√©ro de facture en r√©f√©rence
                      </div>
                    </div>
                  </div>
                </div>
                `:""}
              </div>
              <div class="signature-section">
                <h3>SIGNATURE CLIENT</h3>
                <div class="signature-box">
                  ${t.signature&&t.signature.trim()!==""?`<img src="${t.signature}" alt="Signature client" class="signature-image" />`:'<span class="signature-text">Signature requise</span>'}
                </div>
              </div>
            </div>
            
            <div class="totals-section">
              <h3>TOTAUX</h3>
              <div class="total-line">
                <span>Total HT:</span>
                <span>${F(t.montantHT)}</span>
              </div>
              <div class="total-line">
                <span>TVA (${t.taxRate}%):</span>
                <span>${F(t.montantTVA)}</span>
              </div>
              <div class="total-final">
                <span>TOTAL TTC:</span>
                <span>${F(t.montantTTC)}</span>
              </div>
            </div>
          </div>

          <!-- Information l√©gale -->
          <div class="legal-info">
            <h3>‚öñÔ∏è INFORMATION L√âGALE - ARTICLE L224-59</h3>
            <p><strong>¬´ Avant la conclusion de tout contrat entre un consommateur et un professionnel √† l'occasion d'une foire, d'un salon [...] le professionnel informe le consommateur qu'il ne dispose pas d'un d√©lai de r√©tractation. ¬ª</strong></p>
          </div>

          <!-- Espace flexible pour expansion tableau -->
          <div class="flexible-space"></div>

          <!-- Footer l√©gal -->
          <div class="footer-legal">
            <div class="footer-content">
              <div class="footer-left">
                <p><strong>‚úÖ Conditions g√©n√©rales accept√©es</strong></p>
                <p><strong>RETARD DE PAIEMENT :</strong> Toute somme non pay√©e √† l'√©ch√©ance porte de plein droit int√©r√™t √† au moins 4 fois le taux d'int√©r√™t l√©gal. Une indemnit√© forfaitaire de 40 ‚Ç¨ pour frais de recouvrement sera due en cas de retard de paiement (article L441-3 du Code du commerce).</p>
              </div>
            </div>
          </div>

          <!-- Conditions G√©n√©rales de Vente -->
          <div class="cgv-section">
            <h3>CONDITIONS G√âN√âRALES DE VENTE</h3>
            <div class="cgv-content">
              <div class="cgv-column">
                <p><strong>Art. 1 - Livraison</strong><br>
                Une fois la commande exp√©di√©e, vous serez contact√© par SMS ou mail pour programmer la livraison. Le transporteur livre au pas de porte. V√©rifiez les dimensions pour le passage. Aucun service d'installation pr√©vu.</p>
                
                <p><strong>Art. 2 - D√©lais de Livraison</strong><br>
                D√©lais indicatifs, pas d'engagement ferme. En cas de retard, aucune indemnit√©. D√©clinons toute responsabilit√© en cas de force majeure.</p>
                
                <p><strong>Art. 3 - Risques de Transport</strong><br>
                Marchandises aux risques du destinataire. R√©serves obligatoires sur bordereau transporteur en cas d'avarie.</p>
                
                <p><strong>Art. 4 - Acceptation</strong><br>
                Livraison implique acceptation des conditions. Transporteur livre sans monter √©tages. Client responsable v√©rification.</p>
                
                <p><strong>Art. 5 - R√©clamations</strong><br>
                R√©clamations qualit√© par √©crit sous 8 jours, lettre recommand√©e avec AR.</p>
                
                <p><strong>Art. 6 - Retours</strong><br>
                Aucun retour sans accord √©crit pr√©alable. Accord n'implique aucune reconnaissance.</p>
                
                <p><strong>Art. 7 - Tailles Matelas</strong><br>
                Dimensions +/- 5 cm possibles (thermosensibilit√© mousses). Tailles indicatives. Matelas sur mesure : sp√©cifications exactes requises.</p>
                
                <p><strong>Art. 8 - Odeur Mat√©riaux</strong><br>
                Mousses naturelles peuvent √©mettre l√©g√®re odeur qui dispara√Æt. Ne constitue pas d√©faut.</p>
              </div>
              
              <div class="cgv-column">
                <p><strong>Art. 9 - R√®glements</strong><br>
                Sauf accord express, aucun rabais pour paiement comptant. Garantie mousses, pas textiles/accessoires.</p>
                
                <p><strong>Art. 10 - Paiement</strong><br>
                Factures payables par ch√®que, virement, carte bancaire ou esp√®ce √† r√©ception.</p>
                
                <p><strong>Art. 11 - P√©nalit√©s Retard</strong><br>
                Non-paiement : majoration 10% min. 300‚Ç¨, int√©r√™ts de retard. Droit de r√©siliation sans sommation.</p>
                
                <p><strong>Art. 12 - Exigibilit√©</strong><br>
                Non-paiement √©ch√©ance rend exigible solde toutes √©ch√©ances √† venir.</p>
                
                <p><strong>Art. 13 - Livraison Non-Conforme</strong><br>
                Livraison endommag√©e : mentionner sur bon, refuser produit. Erreur constat√©e apr√®s : contact sous 72h ouvrables.</p>
                
                <p><strong>Art. 14 - Litiges</strong><br>
                Comp√©tence exclusive Tribunal Commerce Perpignan ou tribunal du prestataire.</p>
                
                <p><strong>Art. 15 - Horaires Livraison</strong><br>
                Lundi-vendredi hors f√©ri√©s. Personne majeure pr√©sente obligatoire. Modification adresse : myconfort66@gmail.com.</p>
              </div>
            </div>
          </div>

          <!-- Footer final - R√©serve de propri√©t√© -->
          <div class="final-footer">
            <p><strong>R√âSERVE DE PROPRI√âT√â :</strong> Toutes nos marchandises restent propri√©t√© jusqu'au paiement complet du prix convenu. D√®s l'exp√©dition, l'acheteur restera gardien des dites marchandises et assumera le risque de conservation.</p>
          </div>
        </div>
      </body>
      </html>
    `}}const Ds=({isOpen:a,onClose:t,invoice:s})=>{if(!a)return null;const r=async()=>{try{await ks.printInvoice(s)}catch(n){console.error("Erreur impression:",n),alert("Erreur lors de l'impression de la facture")}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[95vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("button",{onClick:t,className:"bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded flex items-center space-x-2",title:"Retour",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Retour"})]}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-800",children:["Aper√ßu - ",s.invoiceNumber]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:r,className:"bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm flex items-center space-x-1",title:"Imprimer",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{children:"Imprimer"})]}),e.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white p-2 rounded",title:"Fermer",children:e.jsx(be,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"overflow-auto max-h-[calc(95vh-80px)] p-6 bg-gray-50",children:e.jsx(Ye,{invoice:s})})]})})},Ls=({isOpen:a,onClose:t,invoices:s,onDeleteInvoice:r,onLoadInvoice:n})=>{const[o,i]=f.useState(""),[l,m]=f.useState("date"),[d,h]=f.useState("desc"),[c,u]=f.useState("all"),[g,v]=f.useState(null),[x,p]=f.useState(!1),N=_e.useMemo(()=>s.filter(A=>{const k=A.invoiceNumber.toLowerCase().includes(o.toLowerCase())||A.clientName.toLowerCase().includes(o.toLowerCase())||A.clientEmail.toLowerCase().includes(o.toLowerCase())||A.eventLocation&&A.eventLocation.toLowerCase().includes(o.toLowerCase()),D=c==="all"||c==="signed"&&A.signature||c==="unsigned"&&!A.signature;return k&&D}).sort((A,k)=>{let D=0;switch(l){case"date":D=new Date(A.invoiceDate).getTime()-new Date(k.invoiceDate).getTime();break;case"number":D=A.invoiceNumber.localeCompare(k.invoiceNumber);break;case"client":D=A.clientName.localeCompare(k.clientName);break;case"amount":const T=A.products.reduce((B,_)=>B+q(_.quantity,_.priceTTC,_.discount,_.discountType),0),O=k.products.reduce((B,_)=>B+q(_.quantity,_.priceTTC,_.discount,_.discountType),0);D=T-O;break;case"eventLocation":const U=A.eventLocation||"",L=k.eventLocation||"";D=U.localeCompare(L);break}return d==="asc"?D:-D}),[s,o,l,d,c]),y=E=>{v(E),p(!0)},P=(E,A)=>{window.confirm(`√ätes-vous s√ªr de vouloir supprimer la facture ${A.invoiceNumber} ?

Cette action est irr√©versible.`)&&r(E)},b=E=>{window.confirm(`Charger la facture ${E.invoiceNumber} ?

Les donn√©es actuelles seront remplac√©es par cette facture.`)&&(n(E),t())},C=E=>E.products.reduce((A,k)=>A+q(k.quantity,k.priceTTC,k.discount,k.discountType),0);return a?e.jsxs(e.Fragment,{children:[e.jsx(ve,{isOpen:a,onClose:t,title:"üìã Toutes les Factures MYCONFORT",maxWidth:"max-w-7xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ct,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Rechercher facture, client, lieu...",value:o,onChange:E=>i(E.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold"})]}),e.jsxs("select",{value:l,onChange:E=>m(E.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold",children:[e.jsx("option",{value:"date",children:"Trier par date"}),e.jsx("option",{value:"number",children:"Trier par num√©ro"}),e.jsx("option",{value:"client",children:"Trier par client"}),e.jsx("option",{value:"amount",children:"Trier par montant"}),e.jsx("option",{value:"eventLocation",children:"Trier par lieu d'√©v√©nement"})]}),e.jsxs("select",{value:d,onChange:E=>h(E.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold",children:[e.jsx("option",{value:"desc",children:"D√©croissant"}),e.jsx("option",{value:"asc",children:"Croissant"})]}),e.jsxs("select",{value:c,onChange:E=>u(E.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black bg-white font-semibold",children:[e.jsx("option",{value:"all",children:"Toutes les factures"}),e.jsx("option",{value:"signed",children:"Factures sign√©es"}),e.jsx("option",{value:"unsigned",children:"En attente de signature"})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse bg-white rounded-lg overflow-hidden shadow-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#477A0C] text-[#F2EFE2]",children:[e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"N¬∞ Facture"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Date"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Client"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Email"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-left font-bold",children:"Lieu d'√©v√©nement"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-right font-bold",children:"Montant TTC"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-bold",children:"Statut"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-bold",children:"Email"}),e.jsx("th",{className:"border border-gray-300 px-4 py-3 text-center font-bold",children:"Actions"})]})}),e.jsxs("tbody",{children:[N.map((E,A)=>{const k=C(E),D=s.findIndex(T=>T.invoiceNumber===E.invoiceNumber&&T.invoiceDate===E.invoiceDate);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"border border-gray-300 px-4 py-3",children:[e.jsx("div",{className:"font-bold text-[#477A0C]",children:E.invoiceNumber}),E.products.length>0&&e.jsxs("div",{className:"text-xs text-gray-600 font-semibold",children:[E.products.length," produit",E.products.length>1?"s":""]})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Jt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-black font-semibold",children:new Date(E.invoiceDate).toLocaleDateString("fr-FR")})]})}),e.jsxs("td",{className:"border border-gray-300 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ke,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-bold text-black",children:E.clientName})]}),E.clientCity&&e.jsx("div",{className:"text-xs text-gray-600 font-semibold",children:E.clientCity})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Tt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-black font-semibold",children:E.clientEmail})]})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(wt,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-black font-semibold",children:E.eventLocation||e.jsx("span",{className:"text-gray-400 italic",children:"Non sp√©cifi√©"})})]})}),e.jsxs("td",{className:"border border-gray-300 px-4 py-3 text-right",children:[e.jsx("div",{className:"font-bold text-lg text-[#477A0C]",children:F(k)}),E.montantAcompte>0&&e.jsxs("div",{className:"text-xs text-orange-600 font-bold",children:["Acompte: ",F(E.montantAcompte)]})]}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:E.signature?e.jsxs("div",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold flex items-center justify-center space-x-1",children:[e.jsx("span",{children:"üîí"}),e.jsx("span",{children:"Sign√©e"})]}):e.jsx("div",{className:"bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs font-semibold",children:"En attente"})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3 text-center",children:E.emailSent?e.jsxs("div",{className:"flex flex-col items-center space-y-1",children:[e.jsx("span",{className:"text-2xl",title:"Email envoy√© avec succ√®s",children:"‚úÖ"}),E.emailSentDate&&e.jsx("span",{className:"text-xs text-green-600 font-semibold",children:new Date(E.emailSentDate).toLocaleDateString("fr-FR")})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-2xl",title:"Email non envoy√©",children:"‚ùå"}),e.jsx("span",{className:"text-xs text-red-600 font-semibold",children:"Non envoy√©"})]})}),e.jsx("td",{className:"border border-gray-300 px-4 py-3",children:e.jsxs("div",{className:"flex justify-center space-x-2",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-blue-600 font-medium mb-1",children:"Voir"}),e.jsx("button",{onClick:()=>y(E),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded transition-all",title:"Aper√ßu de la facture",children:e.jsx(rt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-purple-600 font-medium mb-1",children:"Charger"}),e.jsx("button",{onClick:()=>b(E),className:"bg-purple-500 hover:bg-purple-600 text-white p-2 rounded transition-all",title:"Charger cette facture pour modification",children:e.jsx(jt,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-xs text-red-600 font-medium mb-1",children:"Supprimer"}),e.jsx("button",{onClick:()=>P(D,E),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded transition-all",title:"Supprimer cette facture",children:e.jsx(De,{className:"w-4 h-4"})})]})]})})]},`${E.invoiceNumber}-${A}`)}),N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"border border-gray-300 px-4 py-8 text-center",children:o||c!=="all"?e.jsxs("div",{children:[e.jsx(Qt,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-black font-bold",children:"Aucune facture ne correspond aux crit√®res de recherche"})]}):e.jsxs("div",{children:[e.jsx(de,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-black font-bold",children:"Aucune facture enregistr√©e"}),e.jsx("p",{className:"text-sm mt-1 text-gray-600 font-semibold",children:"Les factures seront automatiquement sauvegard√©es"})]})})})]})]})}),N.length>0&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"text-sm text-black font-bold",children:[e.jsx("strong",{children:N.length})," facture",N.length>1?"s":""," affich√©e",N.length>1?"s":"",o&&` pour "${o}"`,c!=="all"&&` (${c==="signed"?"sign√©es":"en attente"})`]})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsxs("button",{onClick:t,className:"bg-[#477A0C] hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center space-x-2 font-bold shadow-lg transition-all hover:scale-105",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Retour"})]})})]})}),g&&e.jsx(Ds,{isOpen:x,onClose:()=>{p(!1),v(null)},invoice:g})]}):null},Is=({isOpen:a,onClose:t})=>{const[s,r]=f.useState(we),[n,o]=f.useState(""),[i,l]=f.useState(""),[m,d]=f.useState(null),[h,c]=f.useState(!1),[u,g]=f.useState({category:"",name:"",priceTTC:0,autoCalculateHT:!0}),v=_e.useMemo(()=>s.filter(C=>{const E=C.name.toLowerCase().includes(n.toLowerCase())||C.category.toLowerCase().includes(n.toLowerCase()),A=i===""||C.category===i;return E&&A}),[s,n,i]),x=_e.useMemo(()=>{const C={};return v.forEach(E=>{C[E.category]||(C[E.category]=[]),C[E.category].push(E)}),C},[v]),p=()=>{if(!u.name||!u.category||u.priceTTC<=0){alert("Veuillez remplir tous les champs obligatoires");return}const C=[...s,{...u}];r(C),g({category:"",name:"",priceTTC:0,autoCalculateHT:!0}),c(!1)},N=(C,E)=>{const A=[...s];A[C]=E,r(A),d(null)},y=C=>{const E=s[C];if(window.confirm(`√ätes-vous s√ªr de vouloir supprimer "${E.name}" ?`)){const A=s.filter((k,D)=>D!==C);r(A)}},P=C=>{d(C)},b=()=>{d(null)};return a?e.jsxs(ve,{isOpen:a,onClose:t,title:"",maxWidth:"max-w-6xl",children:[e.jsx("div",{className:"flex justify-between items-center mb-6 pb-4 border-b-2 border-[#477A0C]",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:t,className:"bg-[#477A0C] hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-bold shadow-lg transition-all hover:scale-105",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Retour"})]}),e.jsxs("h3",{className:"text-2xl font-bold text-[#477A0C] flex items-center space-x-2",children:[e.jsx(ge,{className:"w-6 h-6"}),e.jsx("span",{children:"Gestion des Produits MYCONFORT"})]})]})}),e.jsxs("div",{className:"space-y-6",style:{backgroundColor:"#F2EFE2",color:"#000000"},children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 p-4 rounded-lg",style:{backgroundColor:"#F2EFE2"},children:[e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Total Produits"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1 text-black",children:s.length})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(dt,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Cat√©gories"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1 text-black",children:Ae.length})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(st,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Prix Moyen"})]}),e.jsx("div",{className:"text-lg font-bold mt-1 text-black",children:F(s.reduce((C,E)=>C+E.priceTTC,0)/s.length||0)})]}),e.jsxs("div",{className:"bg-white border-2 border-gray-300 p-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ge,{className:"w-5 h-5 text-black"}),e.jsx("span",{className:"font-bold text-black",children:"Matelas"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1 text-black",children:s.filter(C=>C.category==="Matelas").length})]})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-300",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ct,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-black w-4 h-4"}),e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",value:n,onChange:C=>o(C.target.value),className:"w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-black bg-white"})]}),e.jsxs("select",{value:i,onChange:C=>l(C.target.value),className:"w-full px-3 py-2 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-black bg-white",children:[e.jsx("option",{value:"",children:"Toutes les cat√©gories"}),Ae.map(C=>e.jsx("option",{value:C,children:C},C))]}),e.jsxs("button",{onClick:()=>c(!h),className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-bold transition-all",children:[e.jsx(Be,{className:"w-4 h-4"}),e.jsx("span",{children:"Ajouter un produit"})]})]})}),h&&e.jsxs("div",{className:"bg-white p-6 rounded-lg border-2 border-green-300",children:[e.jsxs("h3",{className:"text-lg font-bold text-black mb-4 flex items-center space-x-2",children:[e.jsx(Be,{className:"w-5 h-5"}),e.jsx("span",{children:"Ajouter un nouveau produit"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Cat√©gorie*"}),e.jsxs("select",{value:u.category,onChange:C=>g({...u,category:C.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-3 py-2 text-black bg-white focus:border-blue-500",children:[e.jsx("option",{value:"",children:"S√©lectionner"}),Ae.map(C=>e.jsx("option",{value:C,children:C},C))]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Nom du produit*"}),e.jsx("input",{type:"text",value:u.name,onChange:C=>g({...u,name:C.target.value}),className:"w-full border-2 border-gray-300 rounded-lg px-3 py-2 text-black bg-white focus:border-blue-500",placeholder:"Ex: MATELAS BAMBOU 140 x 190"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black font-bold mb-1",children:"Prix TTC*"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:u.priceTTC,onChange:C=>g({...u,priceTTC:parseFloat(C.target.value)||0}),className:"w-full border-2 border-gray-300 rounded-lg px-3 py-2 text-black bg-white focus:border-blue-500",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-4",children:[e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:u.autoCalculateHT||!1,onChange:C=>g({...u,autoCalculateHT:C.target.checked}),className:"form-checkbox h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-black font-semibold",children:"Calcul automatique HT"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:p,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center space-x-1 font-bold",children:[e.jsx(At,{className:"w-4 h-4"}),e.jsx("span",{children:"Ajouter"})]}),e.jsx("button",{onClick:()=>c(!1),className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-bold",children:"Annuler"})]})]})]}),e.jsx("div",{className:"space-y-6",children:Object.keys(x).length===0?e.jsxs("div",{className:"bg-white p-8 rounded-lg border-2 border-gray-300 text-center",children:[e.jsx(ge,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-black font-bold",children:"Aucun produit trouv√©"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Modifiez vos crit√®res de recherche ou ajoutez un nouveau produit"})]}):Object.entries(x).map(([C,E])=>e.jsxs("div",{className:"bg-white rounded-lg border-2 border-gray-300 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-100 px-4 py-3 border-b border-gray-300",children:e.jsxs("h3",{className:"text-lg font-bold text-black flex items-center space-x-2",children:[e.jsx(dt,{className:"w-5 h-5"}),e.jsx("span",{children:C}),e.jsx("span",{className:"bg-blue-500 text-white px-2 py-1 rounded-full text-xs",children:E.length})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b border-gray-300",children:[e.jsx("th",{className:"px-4 py-3 text-left font-bold text-black",children:"Nom du produit"}),e.jsx("th",{className:"px-4 py-3 text-right font-bold text-black",children:"Prix TTC"}),e.jsx("th",{className:"px-4 py-3 text-center font-bold text-black",children:"Calcul HT"}),e.jsx("th",{className:"px-4 py-3 text-center font-bold text-black",children:"Actions"})]})}),e.jsx("tbody",{children:E.map((A,k)=>{const D=s.findIndex(T=>T.name===A.name&&T.category===A.category);return e.jsxs("tr",{className:"border-b border-gray-200 hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:m===D?e.jsx("input",{type:"text",value:A.name,onChange:T=>{const O={...A,name:T.target.value};N(D,O)},className:"w-full border border-gray-300 rounded px-2 py-1 text-black bg-white",onBlur:b,onKeyPress:T=>T.key==="Enter"&&b(),autoFocus:!0}):e.jsx("div",{className:"font-semibold text-black cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>P(D),children:A.name})}),e.jsx("td",{className:"px-4 py-3 text-right",children:m===D?e.jsx("input",{type:"number",step:"0.01",min:"0",value:A.priceTTC,onChange:T=>{const O={...A,priceTTC:parseFloat(T.target.value)||0};N(D,O)},className:"w-24 border border-gray-300 rounded px-2 py-1 text-right text-black bg-white",onBlur:b,onKeyPress:T=>T.key==="Enter"&&b()}):e.jsx("div",{className:"font-bold text-green-600 cursor-pointer hover:bg-gray-100 px-2 py-1 rounded",onClick:()=>P(D),children:F(A.priceTTC)})}),e.jsx("td",{className:"px-4 py-3 text-center",children:A.autoCalculateHT?e.jsx("span",{className:"bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-semibold",children:"Auto"}):e.jsx("span",{className:"bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs font-semibold",children:"Manuel"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex justify-center space-x-1",children:[e.jsx("button",{onClick:()=>P(D),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded transition-all",title:"Modifier",children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>y(D),className:"bg-red-500 hover:bg-red-600 text-white p-2 rounded transition-all",title:"Supprimer",children:e.jsx(De,{className:"w-4 h-4"})})]})})]},`${A.category}-${k}`)})})]})})]},C))}),v.length>0&&e.jsx("div",{className:"bg-white p-4 rounded-lg border-2 border-gray-300",children:e.jsxs("div",{className:"text-sm text-black font-semibold",children:[e.jsx("strong",{children:v.length})," produit",v.length>1?"s":""," affich√©",v.length>1?"s":"",n&&` pour "${n}"`,i&&` dans la cat√©gorie "${i}"`]})}),e.jsx("div",{className:"bg-blue-50 border-2 border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-semibold",children:"Gestion des produits MYCONFORT"}),e.jsxs("p",{className:"mt-1",children:["‚Ä¢ Cliquez sur un nom ou prix pour le modifier directement",e.jsx("br",{}),"‚Ä¢ Les modifications sont automatiquement sauvegard√©es",e.jsx("br",{}),"‚Ä¢ Le calcul HT automatique utilise le taux de TVA de la facture",e.jsx("br",{}),"‚Ä¢ Les nouveaux produits seront disponibles dans le catalogue"]})]})]})})]})]}):null};class Rs{static async printInvoice(t){try{const s=window.open("","_blank");if(!s){alert("Impossible d'ouvrir la fen√™tre d'impression. Veuillez autoriser les pop-ups.");return}const r=t.products.reduce((o,i)=>o+q(i.quantity,i.priceTTC,i.discount,i.discountType),0),n=this.generateModernPrint(t,r);s.document.write(n),s.document.close(),s.onload=()=>{setTimeout(()=>{s.print(),setTimeout(()=>{s.close()},1e3)},500)}}catch(s){console.error("Erreur impression:",s),alert("Erreur lors de l'impression de la facture")}}static generateModernPrint(t,s){return`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Facture ${t.invoiceNumber}</title>
        <meta charset="UTF-8">
        <style>
          body { 
            font-family: 'Arial', sans-serif; 
            margin: 0; 
            padding: 0; 
            background: white; 
            font-size: 13px;
            line-height: 1.4;
          }
          
          .page {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 15mm;
            box-sizing: border-box;
            page-break-after: always;
          }
          
          .page:last-child {
            page-break-after: avoid;
          }

          .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #477A0C;
          }

          .company-info {
            flex: 1;
          }

          .company-name {
            font-size: 22px;
            font-weight: bold;
            color: #477A0C;
            margin-bottom: 8px;
          }

          .company-details {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
          }

          .invoice-title {
            text-align: right;
            flex: 1;
          }

          .invoice-title h1 {
            background: #477A0C;
            color: white;
            margin: 0;
            padding: 15px 20px;
            font-size: 20px;
            font-weight: bold;
            border-radius: 8px;
          }

          .invoice-number {
            color: #477A0C;
            margin-top: 8px;
            font-weight: bold;
            font-size: 14px;
          }

          .client-info {
            background: #d4edda;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #477A0C;
          }

          .client-info h3 {
            margin: 0 0 10px 0;
            color: #477A0C;
            font-size: 14px;
            font-weight: bold;
          }

          .table-container {
            margin: 20px 0;
          }

          table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            border: 1px solid #ddd;
          }

          th {
            background: #477A0C;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: bold;
            font-size: 12px;
          }

          td {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            font-size: 12px;
          }

          tr:nth-child(even) {
            background-color: #f9f9f9;
          }

          .discount-badge {
            background: #dc3545;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
          }

          /* Styles pour les nouvelles sections */
          .payment-method-section, .deposit-section, .notes-section {
            margin-top: 20px;
            padding: 12px 15px;
            border-radius: 6px;
            border-left: 4px solid;
            margin-bottom: 15px;
          }

          .payment-method-section {
            background: #E8F5E8;
            border-left-color: #477A0C;
          }

          .deposit-section {
            background: #FFF4E6;
            border-left-color: #FF8C00;
          }

          .notes-section {
            background: #F0F8FF;
            border-left-color: #4A90E2;
          }

          .section-header {
            font-weight: bold;
            font-size: 12px;
            color: #14281D;
            margin-bottom: 8px;
          }

          .payment-badge {
            font-size: 12px;
            color: #477A0C;
            font-weight: bold;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #477A0C;
            display: inline-block;
          }

          /* Styles RIB pour virement bancaire */
          .rib-section {
            margin-top: 8px;
            padding: 8px;
            background: #e1f5fe;
            border: 1px solid #2563eb;
            border-radius: 4px;
          }

          .rib-header {
            font-size: 11px;
            font-weight: bold;
            color: #2563eb;
            margin-bottom: 6px;
          }

          .rib-info {
            font-size: 10px;
            line-height: 1.4;
            color: #000;
          }

          .rib-info div {
            margin-bottom: 2px;
          }

          .deposit-amount {
            font-size: 14px;
            color: #FF8C00;
            font-weight: bold;
          }

          .deposit-percentage {
            font-size: 10px;
            margin-left: 5px;
          }

          .note-item {
            font-size: 11px;
            color: #14281D;
            line-height: 1.4;
            margin-bottom: 8px;
          }

          .note-item:last-child {
            margin-bottom: 0;
          }

          .totals {
            margin-top: 30px;
            text-align: right;
          }

          .total-line {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
          }

          .total-final {
            background: #477A0C;
            color: white;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin-top: 10px;
          }

          .remaining-amount {
            background: #F55D3E;
            color: white;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin-top: 10px;
          }

          .footer-section {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
          }

          .signature-section {
            width: 300px;
            text-align: center;
          }

          .signature-box {
            border: 2px solid #477A0C;
            height: 120px;
            margin: 10px 0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: #f8f9fa;
          }

          .signature-image {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
          }

          .law-article {
            background: #fff3cd;
            border: 2px solid #dc3545;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 11px;
            color: #721c24;
            text-align: center;
            font-weight: bold;
          }

          .info-section {
            flex: 1;
            margin-right: 20px;
          }

          .info-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #477A0C;
          }

          .info-label {
            font-weight: bold;
            color: #477A0C;
            font-size: 12px;
          }

          .cgv-page {
            page-break-before: always;
          }

          .cgv-title {
            color: #477A0C;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #477A0C;
            padding-bottom: 10px;
          }

          .cgv-content {
            font-size: 11px;
            line-height: 1.5;
            text-align: justify;
          }

          .cgv-section {
            margin-bottom: 15px;
          }

          .cgv-section h4 {
            color: #477A0C;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: bold;
          }

          @media print {
            body { 
              background: white; 
              font-size: 12px;
            }
            
            .page {
              width: auto;
              min-height: auto;
              margin: 0;
              padding: 10mm;
              page-break-after: always;
            }
            
            .page:last-child {
              page-break-after: avoid;
            }
          }
        </style>
      </head>
      <body>
        <!-- PAGE 1: FACTURE -->
        <div class="page">
          <!-- En-t√™te -->
          <div class="header">
            <div class="company-info">
              <div class="company-name">HT CONFORT</div>
              <div class="company-details">
                Sp√©cialiste climatisation et chauffage<br>
                123 Rue de la Climatisation<br>
                75000 PARIS<br>
                T√©l: 01 23 45 67 89<br>
                Email: contact@htconfort.fr<br>
                SIRET: 123 456 789 00012 | TVA: FR12345678901
              </div>
            </div>
            <div class="invoice-title">
              <h1>FACTURE</h1>
              <div class="invoice-number">N¬∞ ${t.invoiceNumber}</div>
              <div style="font-size: 12px; color: #666; margin-top: 5px;">
                Date: ${new Date(t.invoiceDate).toLocaleDateString("fr-FR")}
              </div>
            </div>
          </div>

          <!-- Informations client -->
          <div class="client-info">
            <h3>FACTURER √Ä:</h3>
            <strong>${t.clientName}</strong><br>
            ${t.clientAddress}<br>
            ${t.clientPostalCode} ${t.clientCity}<br>
            ${t.clientEmail?`Email: ${t.clientEmail}<br>`:""}
            ${t.clientPhone?`T√©l: ${t.clientPhone}<br>`:""}
          </div>

          <!-- Tableau des produits -->
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>D√©signation</th>
                  <th style="width: 80px;">Qt√©</th>
                  <th style="width: 100px;">Prix HT</th>
                  <th style="width: 100px;">Prix TTC</th>
                  <th style="width: 80px;">Remise</th>
                  <th style="width: 120px;">Total TTC</th>
                </tr>
              </thead>
              <tbody>
                ${t.products.map(r=>{const n=q(r.quantity,r.priceTTC,r.discount,r.discountType),o=r.discount>0?`<span class="discount-badge">${r.discount}${r.discountType==="percent"?"%":"‚Ç¨"}</span>`:"-";return`
                    <tr>
                      <td>
                        <strong>${r.name}</strong>
                      </td>
                      <td>${r.quantity}</td>
                      <td>${F(r.priceTTC/1.2)}</td>
                      <td>${F(r.priceTTC)}</td>
                      <td>${o}</td>
                      <td><strong>${F(n)}</strong></td>
                    </tr>
                  `}).join("")}
              </tbody>
            </table>
          </div>

          <!-- Section Taux d'Acompte - EN 2√®me POSITION POUR MOBILE -->
          ${t.montantAcompte>0?`
            <div class="deposit-section">
              <div class="section-header">üí∞ Acompte vers√©:</div>
              <div class="deposit-amount">
                ${F(t.montantAcompte)}
                <span class="deposit-percentage">(${(t.montantAcompte/s*100).toFixed(1)}% du total)</span>
              </div>
            </div>
          `:""}

          <!-- Section Remarques - EN 3√®me POSITION POUR MOBILE -->
          ${t.invoiceNotes||t.deliveryNotes?`
            <div class="notes-section">
              <div class="section-header">üìù Remarques:</div>
              ${t.invoiceNotes?`
                <div class="note-item">
                  <strong>Notes g√©n√©rales:</strong> ${t.invoiceNotes}
                </div>
              `:""}
              ${t.deliveryNotes?`
                <div class="note-item">
                  <strong>Livraison par transporteur France Express CXI:</strong> ${t.deliveryNotes}
                </div>
              `:`
                <div class="note-item">
                  <strong>Livraison:</strong> Livraison par transporteur France Express CXI
                </div>
              `}
            </div>
          `:""}

          <!-- Section Mode de R√®glement - EN 4√®me POSITION POUR MOBILE -->
          ${t.paymentMethod?`
            <div class="payment-method-section">
              <div class="section-header">üí≥ Mode de r√®glement:</div>
              <div class="payment-badge">${t.paymentMethod}</div>
              
              ${t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`
                <!-- RIB pour Virement Bancaire -->
                <div class="rib-section">
                  <div class="rib-header">üìã Coordonn√©es bancaires pour virement</div>
                  <div class="rib-info">
                    <div><strong>B√©n√©ficiaire:</strong> MYCONFORT</div>
                    <div><strong>IBAN:</strong> FR76 1660 7000 1708 1216 3980 964</div>
                    <div><strong>BIC:</strong> CCBPFRPPPPG</div>
                    <div><strong>Banque:</strong> Banque Populaire du Sud</div>
                    <div style="margin-top: 4px; font-style: italic; color: #666; font-size: 10px;">
                      Merci d'indiquer le num√©ro de facture en r√©f√©rence
                    </div>
                  </div>
                </div>
              `:""}
            </div>
          `:""}

          <!-- Totaux -->
          <div class="totals">
            <div class="total-line">
              <span>Total HT:</span>
              <span>${F(s/1.2)}</span>
            </div>
            <div class="total-line">
              <span>TVA (20%):</span>
              <span>${F(s*.2/1.2)}</span>
            </div>
            <div class="total-final">
              <div class="total-line" style="border: none; color: white;">
                <span>TOTAL TTC:</span>
                <span>${F(s)}</span>
              </div>
            </div>
            ${t.montantAcompte>0?`
              <div class="remaining-amount">
                <div class="total-line" style="border: none; color: #F55D3E; font-weight: bold; font-size: 16px;">
                  <span>Reste √† payer:</span>
                  <span>${F(s-t.montantAcompte)}</span>
                </div>
              </div>
            `:""}
          </div>

          <!-- Section footer avec informations et signature -->
          <div class="footer-section">
            <div class="info-section">
              ${t.eventLocation?`
                <div class="info-item">
                  <div class="info-label">LIEU D'INTERVENTION:</div>
                  ${t.eventLocation}
                </div>
              `:""}
              
              ${t.eventLocation?`
                <div class="info-item">
                  <div class="info-label">DATE D'INTERVENTION:</div>
                  ${new Date(t.invoiceDate).toLocaleDateString("fr-FR")}
                </div>
              `:""}

              <div class="info-item">
                <div class="info-label">CONDITIONS DE PAIEMENT:</div>
                Paiement √† r√©ception de facture<br>
                En cas de retard, p√©nalit√©s de 3% par mois
              </div>
            </div>

            <div class="signature-section">
              <div style="font-weight: bold; color: #477A0C; margin-bottom: 10px;">
                Signature du client
              </div>
              <div class="signature-box">
                ${t.signature?`<img src="${t.signature}" alt="Signature client" class="signature-image" />`:'<span style="color: #999; font-style: italic;">Signature requise</span>'}
              </div>
              <div style="font-size: 11px; color: #666;">
                Bon pour accord et ex√©cution
              </div>

              <!-- Article de loi -->
              <div class="law-article">
                ‚öñÔ∏è Article L.441-6 du Code de commerce ‚öñÔ∏è<br>
                Facturation imm√©diate obligatoire pour les prestations de services
              </div>
            </div>
          </div>
        </div>

        <!-- PAGE 2: CONDITIONS G√âN√âRALES -->
        <div class="page cgv-page">
          <div class="cgv-title">CONDITIONS G√âN√âRALES DE VENTE</div>
          
          <div class="cgv-content">
            <div class="cgv-section">
              <h4>1. OBJET</h4>
              <p>Les pr√©sentes conditions g√©n√©rales de vente r√©gissent les relations contractuelles entre HT CONFORT et ses clients pour la fourniture et l'installation d'√©quipements de climatisation et de chauffage.</p>
            </div>

            <div class="cgv-section">
              <h4>2. PRIX ET PAIEMENT</h4>
              <p>Les prix sont exprim√©s en euros TTC. Le paiement est exigible √† r√©ception de facture. En cas de retard de paiement, des p√©nalit√©s de retard au taux de 3% par mois sont automatiquement appliqu√©es, ainsi qu'une indemnit√© forfaitaire pour frais de recouvrement de 40‚Ç¨.</p>
            </div>

            <div class="cgv-section">
              <h4>3. D√âLAIS D'EX√âCUTION</h4>
              <p>Les d√©lais d'intervention sont donn√©s √† titre indicatif. Un retard dans l'ex√©cution ne peut donner lieu √† annulation de la commande, p√©nalit√©s ou dommages-int√©r√™ts.</p>
            </div>

            <div class="cgv-section">
              <h4>4. GARANTIES</h4>
              <p>Nous garantissons nos installations contre tout vice de fabrication pendant 2 ans √† compter de la r√©ception des travaux. Cette garantie ne couvre pas l'usure normale, les dommages r√©sultant d'un mauvais usage ou d'un d√©faut d'entretien.</p>
            </div>

            <div class="cgv-section">
              <h4>5. RESPONSABILIT√â</h4>
              <p>Notre responsabilit√© est limit√©e au montant de la facture. Nous ne saurions √™tre tenus responsables des dommages indirects ou immat√©riels.</p>
            </div>

            <div class="cgv-section">
              <h4>6. PROPRI√âT√â</h4>
              <p>Les √©quipements livr√©s demeurent notre propri√©t√© jusqu'au paiement int√©gral du prix. En cas de non-paiement, nous nous r√©servons le droit de reprendre les √©quipements install√©s.</p>
            </div>

            <div class="cgv-section">
              <h4>7. DROIT DE R√âTRACTATION</h4>
              <p>Conform√©ment √† l'article L.121-21 du Code de la consommation, le client dispose d'un d√©lai de 14 jours pour exercer son droit de r√©tractation, sauf exceptions pr√©vues par la loi.</p>
            </div>

            <div class="cgv-section">
              <h4>8. LITIGES</h4>
              <p>Tout litige relatif √† l'interpr√©tation ou √† l'ex√©cution des pr√©sentes conditions g√©n√©rales sera de la comp√©tence exclusive des tribunaux de Paris. Le droit fran√ßais est seul applicable.</p>
            </div>

            <div class="cgv-section">
              <h4>9. DONN√âES PERSONNELLES</h4>
              <p>Les donn√©es personnelles collect√©es sont trait√©es conform√©ment au RGPD. Elles sont utilis√©es uniquement dans le cadre de la relation commerciale et ne sont pas transmises √† des tiers.</p>
            </div>

            <div class="cgv-section">
              <h4>10. ACCEPTATION</h4>
              <p>La signature du pr√©sent devis/facture emporte acceptation pleine et enti√®re des pr√©sentes conditions g√©n√©rales de vente.</p>
            </div>
          </div>

          <div style="text-align: center; margin-top: 30px; padding-top: 20px; border-top: 2px solid #477A0C; color: #477A0C; font-weight: bold;">
            HT CONFORT - Votre sp√©cialiste climatisation et chauffage<br>
            <span style="font-size: 11px; color: #666;">Conditions g√©n√©rales disponibles sur demande | Version du ${new Date().toLocaleDateString("fr-FR")}</span>
          </div>
        </div>
      </body>
      </html>
    `}static async generateInvoicePdf(t,s={includeSignature:!0,format:"a4"}){var d,h,c,u,g,v,x,p,N,y,P,b;const r=new Ue({unit:"pt",format:s.format==="compact"?[595,420]:"a4"}),n="#477A0C",o="#14281D";let i=50;const l=50,m=r.internal.pageSize.getWidth();if(r.setFontSize(24),r.setTextColor(n),r.text("MYCONFORT",l,i),r.setFontSize(12),r.setTextColor(o),r.text("Votre sp√©cialiste literie et confort",l,i+20),i+=60,r.setFontSize(16),r.setTextColor(o),r.text(`Facture N¬∞ ${t.invoiceNumber||"XXX"}`,l,i),r.setFontSize(10),r.text(`Date: ${new Date(t.invoiceDate||Date.now()).toLocaleDateString("fr-FR")}`,m-150,i),i+=40,t.client&&(r.setFontSize(12),r.setTextColor(n),r.text("FACTURER √Ä:",l,i),i+=20,r.setFontSize(10),r.setTextColor(o),(t.client.name||t.client.nom)&&(r.text(`${t.client.name||t.client.nom} ${t.client.prenom||""}`,l,i),i+=15),t.client.email&&(r.text(t.client.email,l,i),i+=15),(t.client.address||(d=t.client.adresse)!=null&&d.rue)&&(r.text(t.client.address||((h=t.client.adresse)==null?void 0:h.rue)||"",l,i),i+=15),t.client.city||(c=t.client.adresse)!=null&&c.ville)){const C=t.client.postalCode||((u=t.client.adresse)==null?void 0:u.codePostal)||"",E=t.client.city||((g=t.client.adresse)==null?void 0:g.ville)||"";r.text(`${C} ${E}`,l,i),i+=15}if(i+=20,t.produits&&t.produits.length>0){const C=t.produits.map(D=>[D.designation||D.nom||"",D.qty||D.quantite||1,`${(D.priceTTC||D.prixUnitaire||0).toFixed(2)} ‚Ç¨`,`${((D.qty||D.quantite||1)*(D.priceTTC||D.prixUnitaire||0)/1).toFixed(2)} ‚Ç¨`]);r.autoTable({head:[["D√©signation","Qt√©","Prix unitaire","Total"]],body:C,startY:i,margin:{left:l,right:l},styles:{fontSize:9,cellPadding:8},headStyles:{fillColor:[71,122,12],textColor:255,fontStyle:"bold"},alternateRowStyles:{fillColor:[248,250,252]}}),i=r.lastAutoTable.finalY+20;const E=t.produits.reduce((D,T)=>D+(T.qty||T.quantite||1)*(T.priceTTC||T.prixUnitaire||0)/1.2,0),A=t.produits.reduce((D,T)=>D+(T.qty||T.quantite||1)*(T.priceTTC||T.prixUnitaire||0),0),k=A-E;r.setFontSize(10),r.text(`Total HT: ${E.toFixed(2)} ‚Ç¨`,m-200,i),i+=15,r.text(`TVA (20%): ${k.toFixed(2)} ‚Ç¨`,m-200,i),i+=15,r.setFontSize(12),r.setTextColor(n),r.text(`Total TTC: ${A.toFixed(2)} ‚Ç¨`,m-200,i),i+=30}if((v=t.paiement)!=null&&v.method&&(r.setFontSize(10),r.setTextColor(o),r.text(`Mode de paiement: ${t.paiement.method}`,l,i),i+=15,t.paiement.depositAmount>0&&(r.text(`Acompte: ${t.paiement.depositAmount.toFixed(2)} ‚Ç¨`,l,i),i+=15),t.paiement.remainingAmount>0&&(r.text(`Restant d√ª: ${t.paiement.remainingAmount.toFixed(2)} ‚Ç¨`,l,i),i+=15),i+=20),s.includeSignature&&((x=t.signature)!=null&&x.clientSignature||(p=t.signature)!=null&&p.technicienSignature)){if(i>r.internal.pageSize.getHeight()-200&&(r.addPage(),i=50),r.setFontSize(12),r.setTextColor(n),r.text("SIGNATURES",l,i),i+=30,(N=t.signature)!=null&&N.clientSignature){r.setFontSize(10),r.setTextColor(o),r.text("Signature client:",l,i),i+=10;try{r.addImage(t.signature.clientSignature,"PNG",l,i,200,60,"","FAST")}catch(C){console.warn("Erreur lors de l'ajout de la signature client:",C),r.text("Signature non disponible (format invalide)",l,i+30)}i+=80}if((y=t.signature)!=null&&y.technicienSignature){r.setFontSize(10),r.setTextColor(o),r.text("Signature responsable:",l,i),i+=10;try{r.addImage(t.signature.technicienSignature,"PNG",l,i,200,60,"","FAST")}catch(C){console.warn("Erreur lors de l'ajout de la signature responsable:",C),r.text("Signature non disponible (format invalide)",l,i+30)}i+=80}(P=t.signature)!=null&&P.lieu&&(r.text(`Lieu: ${t.signature.lieu}`,l,i),i+=15),(b=t.signature)!=null&&b.dateSignature&&r.text(`Date de signature: ${new Date(t.signature.dateSignature).toLocaleString("fr-FR")}`,l,i)}return r}static async exportInvoicePdf(t,s,r){try{const o=(await this.generateInvoicePdf(t,r)).output("blob");Xt.saveAs(o,s||`facture_${(t==null?void 0:t.invoiceNumber)||"sans_num"}.pdf`)}catch(n){throw console.error("Erreur lors de l'export PDF:",n),new Error("Impossible de g√©n√©rer le PDF")}}}const Os=({isOpen:a,onClose:t,invoice:s,onDownload:r})=>{const[n,o]=f.useState(!1),[i,l]=f.useState(""),[m,d]=f.useState(null),[h,c]=f.useState(null),u=f.useCallback(()=>{d(null),c(null),o(!1),l(""),t()},[t]);f.useEffect(()=>{if(m){const N=setTimeout(()=>{d(null)},5e3);return()=>clearTimeout(N)}},[m]),f.useEffect(()=>{const N=y=>{y.key==="Escape"&&a&&u()};if(a)return document.addEventListener("keydown",N),()=>document.removeEventListener("keydown",N)},[a,u]);const g=async()=>{try{o(!0),l("G√©n√©ration du PDF en cours..."),await r(),d("PDF t√©l√©charg√© avec succ√®s !")}catch(N){console.error("Erreur t√©l√©chargement:",N),c(N instanceof Error?N.message:"Erreur lors du t√©l√©chargement")}finally{o(!1),l("")}},v=async()=>{try{await Rs.printInvoice(s)}catch(N){console.error("Erreur impression:",N),alert("Erreur lors de l'impression de la facture")}},x=({error:N,onDismiss:y})=>e.jsx("div",{className:"no-print bg-red-50 border-l-4 border-red-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Fe,{className:"w-5 h-5 text-red-400 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-red-800",children:"Erreur"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:N})]}),e.jsx("button",{onClick:y,className:"ml-3 text-red-400 hover:text-red-600 transition-colors",children:e.jsx(be,{className:"w-4 h-4"})})]})}),p=({message:N,onDismiss:y})=>e.jsx("div",{className:"no-print bg-green-50 border-l-4 border-green-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-800",children:"Succ√®s"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:N})]}),e.jsx("button",{onClick:y,className:"ml-3 text-green-400 hover:text-green-600 transition-colors",children:e.jsx(be,{className:"w-4 h-4"})})]})});return a?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#477A0C] to-[#5A8F0F] text-white px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(de,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Aper√ßu PDF - Facture ",s.invoiceNumber]}),e.jsx("p",{className:"text-sm opacity-90",children:"Style: üé® MODERNE"})]})]}),e.jsx("button",{onClick:u,className:"text-white/80 hover:text-white hover:bg-white/20 p-2 rounded-lg transition-all",children:e.jsx(be,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"px-6 pt-4",children:[h&&e.jsx(x,{error:h,onDismiss:()=>c(null)}),m&&e.jsx(p,{message:m,onDismiss:()=>d(null)}),n&&e.jsx("div",{className:"no-print bg-blue-50 border-l-4 border-blue-400 p-4 mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(He,{className:"w-5 h-5 text-blue-600 animate-spin mr-3"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-800",children:"En cours..."}),e.jsx("p",{className:"text-sm text-blue-700",children:i})]})]})})]}),e.jsxs("div",{className:"no-print px-6 py-4 bg-gray-50 border-b flex flex-wrap gap-3",children:[e.jsxs("button",{onClick:u,className:"flex items-center space-x-2 bg-[#477A0C] hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",title:"Retour au formulaire principal",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Retour"})]}),e.jsxs("button",{onClick:g,disabled:n,className:"flex items-center space-x-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[n?e.jsx(He,{className:"w-4 h-4 animate-spin"}):e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{children:"T√©l√©charger PDF"})]}),e.jsxs("button",{onClick:v,disabled:n,className:"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{children:"Imprimer"})]})]}),e.jsx("div",{className:"overflow-auto max-h-[60vh] bg-gray-100 p-6",children:e.jsx("div",{className:"bg-white shadow-lg rounded-lg mx-auto",style:{width:"210mm",minHeight:"297mm"},children:e.jsx(Ye,{invoice:s})})})]})}):null},Ms=({isOpen:a,onClose:t,onSuccess:s})=>a?e.jsx(ve,{isOpen:a,onClose:t,title:"G√©n√©ration de PDF - Guide d'utilisation",maxWidth:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-600 to-emerald-600 text-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(de,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Guide de g√©n√©ration PDF"}),e.jsx("p",{className:"text-green-100",children:"Cr√©ez et partagez vos factures facilement"})]})]}),e.jsx("p",{className:"mt-2 text-sm text-green-100",children:"Ce guide vous explique comment g√©n√©rer et partager vos factures au format PDF."})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Comment g√©n√©rer un PDF :"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-gray-700",children:[e.jsx("li",{children:"Remplissez toutes les informations de la facture (client, produits, etc.)"}),e.jsxs("li",{children:["Cliquez sur le bouton"," ",e.jsx("strong",{children:'"G√©n√©rer et t√©l√©charger le PDF"'})," dans la section principale"]}),e.jsx("li",{children:"Le PDF sera automatiquement t√©l√©charg√© sur votre appareil"}),e.jsxs("li",{children:["Pour pr√©visualiser avant de t√©l√©charger, utilisez le bouton"," ",e.jsx("strong",{children:'"APER√áU & PDF"'})]})]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-3",children:"Comment partager votre facture :"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-purple-700",children:[e.jsxs("li",{children:["Cliquez sur ",e.jsx("strong",{children:'"APER√áU & PDF"'})," pour ouvrir la pr√©visualisation"]}),e.jsxs("li",{children:["Dans la fen√™tre de pr√©visualisation, utilisez le bouton"," ",e.jsx("strong",{children:'"Partager Aper√ßu"'})]}),e.jsx("li",{children:"Vous pouvez √©galement envoyer le PDF t√©l√©charg√© par email manuellement"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Fonctionnalit√©s disponibles :"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm text-blue-700",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"G√©n√©ration PDF haute qualit√©"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"T√©l√©chargement direct"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"Pr√©visualisation avant t√©l√©chargement"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"Impression directe"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"Signature √©lectronique"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{}),e.jsx("span",{children:"Gestion des acomptes"})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium",children:"Fermer"}),e.jsxs("button",{onClick:()=>{s("‚úÖ Guide consult√© avec succ√®s ! Vous pouvez maintenant g√©n√©rer vos PDF."),t()},className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2",children:[e.jsx(Ge,{className:"w-5 h-5"}),e.jsx("span",{children:"Compris, g√©n√©rer mes PDF"})]})]})]})}):null,pe=()=>e.jsx("svg",{className:"w-4 h-4 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),Dt=(a,t,s=0,r="")=>{const n=a.reduce((m,d)=>{const h=q(d.quantity,d.priceTTC,d.discount,d.discountType),c=h/(1+t/100),g=d.priceTTC*d.quantity-h;return{totalHT:m.totalHT+c,totalTTC:m.totalTTC+h,totalDiscount:m.totalDiscount+g}},{totalHT:0,totalTTC:0,totalDiscount:0}),o=n.totalTTC-n.totalHT;let i;return["esp√®ces","carte bleue","carte bancaire","virement","carte"].includes(r.toLowerCase().trim())&&s===0?i=0:i=Math.max(0,n.totalTTC-s),{montantHT:n.totalHT,montantTTC:n.totalTTC,montantTVA:o,montantRemise:n.totalDiscount,montantAcompte:s,montantRestant:i}},re={WEBHOOK_URL:"https://n8n.srv765811.hstgr.cloud/webhook-test/facture-universelle",FOLDER_ID:"1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-"},ie=class ie{static getInstance(){return ie.instance||(ie.instance=new ie),ie.instance}static async uploadPDFToGoogleDrive(t,s){try{console.log("üöÄ UPLOAD PDF VERS GOOGLE DRIVE VIA n8n");const r=await this.blobToBase64(s),n=Dt(t.products,t.taxRate||20,t.montantAcompte||0,t.paymentMethod||""),o=n.montantTTC,i=n.montantAcompte,l=n.montantRestant,m={nom_facture:`Facture_MYCONFORT_${t.invoiceNumber}`,fichier_facture:r.split(",")[1],date_creation:new Date().toISOString(),numero_facture:t.invoiceNumber,date_facture:t.invoiceDate,montant_ttc:o,acompte:i,montant_restant:l,"Nom du client":t.clientName,client_email:t.clientEmail,client_telephone:t.clientPhone,adresse_client:`${t.clientAddress}, ${t.clientPostalCode} ${t.clientCity}`,mode_paiement:t.paymentMethod||"Non sp√©cifi√©",signature:t.isSigned?"Oui":"Non",signature_image:t.signature||"",conseiller:t.advisorName||"MYCONFORT",lieu_evenement:t.eventLocation||"Non sp√©cifi√©",nombre_produits:t.products.length,produits:t.products.map(c=>`${c.quantity}x ${c.name}`).join(", "),dossier_id:re.FOLDER_ID};console.log("üì§ Envoi des donn√©es vers n8n pour upload Google Drive...");const d=new AbortController,h=setTimeout(()=>{d.abort()},3e4);try{const c=re.WEBHOOK_URL;console.log(`üì° Envoi vers: ${c}`);const u=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(m),signal:d.signal});if(clearTimeout(h),!u.ok){let g="";switch(u.status){case 404:g="Webhook n8n introuvable (404). V√©rifiez que l'URL est correcte et que le workflow n8n est actif.";break;case 500:g="Erreur serveur n8n (500). V√©rifiez la configuration de votre workflow n8n.";break;case 403:g="Acc√®s refus√© (403). V√©rifiez les permissions de votre webhook n8n.";break;case 400:g="Requ√™te invalide (400). V√©rifiez la configuration de votre webhook n8n.";break;default:g=`Erreur HTTP ${u.status}: ${u.statusText}`}throw new Error(g)}return console.log("‚úÖ PDF envoy√© avec succ√®s vers Google Drive via n8n"),!0}catch(c){throw clearTimeout(h),c.name==="AbortError"?new Error("Timeout: Le webhook n8n ne r√©pond pas dans les temps. V√©rifiez que votre instance n8n est active et accessible."):c.message.includes("Failed to fetch")?new Error(`Impossible de se connecter au webhook n8n. V√©rifiez que:
‚Ä¢ L'URL est correcte
‚Ä¢ Votre instance n8n est en ligne
‚Ä¢ Le workflow est actif
‚Ä¢ Il n'y a pas de probl√®me de r√©seau`):c.message.includes("CORS")?new Error("Erreur CORS: Le webhook n8n doit autoriser les requ√™tes depuis votre domaine. V√©rifiez la configuration CORS de votre instance n8n."):c}}catch(r){throw console.error("‚ùå Erreur lors de l'upload vers Google Drive:",r),r}}static async blobToBase64(t){return new Promise((s,r)=>{const n=new FileReader;n.onloadend=()=>{typeof n.result=="string"?s(n.result):r(new Error("Erreur de conversion blob vers base64"))},n.onerror=r,n.readAsDataURL(t)})}static async testGoogleDriveIntegration(){try{console.log("üß™ TEST DE L'INT√âGRATION GOOGLE DRIVE VIA n8n");const t=this.getConfig(),s=t.webhookUrl,r=t.folderId;if(!s||s.trim()==="")return{success:!1,message:"‚ùå URL du webhook n8n non configur√©e. Veuillez saisir une URL valide."};try{new URL(s)}catch{return{success:!1,message:"‚ùå URL du webhook n8n invalide. Veuillez v√©rifier le format de l'URL."}}if(!r||r.trim()==="")return{success:!1,message:"‚ùå ID du dossier Google Drive non configur√©. Veuillez saisir un ID de dossier valide."};console.log(`üîó Test de connectivit√© vers: ${s}`);const n=new Blob(["Test PDF content for Google Drive integration"],{type:"application/pdf"}),i={nom_facture:"Test_Integration_n8n_GoogleDrive",fichier_facture:(await this.blobToBase64(n)).split(",")[1],date_creation:new Date().toISOString(),test:!0,dossier_id:r},l=new AbortController,m=setTimeout(()=>{l.abort()},3e4);try{const d=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i),signal:l.signal});if(clearTimeout(m),!d.ok){let c="";switch(d.status){case 404:c="Webhook n8n introuvable (404). V√©rifiez que l'URL est correcte et que le workflow n8n est actif.";break;case 500:c="Erreur serveur n8n (500). V√©rifiez la configuration de votre workflow n8n.";break;case 403:c="Acc√®s refus√© (403). V√©rifiez les permissions de votre webhook n8n.";break;case 400:c="Requ√™te invalide (400). V√©rifiez la configuration de votre webhook n8n.";break;default:c=`Erreur HTTP ${d.status}: ${d.statusText}`}return{success:!1,message:`‚ùå ${c}`}}let h;try{const c=await d.text();c?h=JSON.parse(c):h={message:"R√©ponse vide du webhook"}}catch{h={message:"Webhook a r√©pondu avec succ√®s"}}return console.log("‚úÖ Test r√©ussi:",h),{success:!0,message:`‚úÖ Test d'int√©gration Google Drive r√©ussi ! Le webhook n8n a r√©pondu correctement. Le fichier test devrait √™tre upload√© dans le dossier ${r}.`}}catch(d){return clearTimeout(m),d.name==="AbortError"?{success:!1,message:"‚ùå Timeout: Le webhook n8n ne r√©pond pas dans les temps. V√©rifiez que votre instance n8n est active et accessible."}:d.message.includes("Failed to fetch")?{success:!1,message:`‚ùå Impossible de se connecter au webhook n8n. V√©rifiez que:
‚Ä¢ L'URL est correcte
‚Ä¢ Votre instance n8n est en ligne
‚Ä¢ Le workflow est actif
‚Ä¢ Il n'y a pas de probl√®me de r√©seau ou de pare-feu
‚Ä¢ Le serveur n8n accepte les requ√™tes HTTPS`}:d.message.includes("CORS")?{success:!1,message:"‚ùå Erreur CORS: Le webhook n8n doit autoriser les requ√™tes depuis votre domaine. V√©rifiez la configuration CORS de votre instance n8n."}:{success:!1,message:`‚ùå Erreur de connexion: ${d.message||"Erreur inconnue"}`}}}catch(t){return console.error("‚ùå Erreur test int√©gration Google Drive:",t),{success:!1,message:`‚ùå Erreur inattendue lors du test: ${t.message||"Erreur inconnue"}`}}}static updateWebhookConfig(t,s){t&&localStorage.setItem("n8n_webhook_url",t),s&&localStorage.setItem("google_drive_folder_id",s);const r=localStorage.getItem("n8n_webhook_url"),n=localStorage.getItem("google_drive_folder_id");r&&(re.WEBHOOK_URL=r),n&&(re.FOLDER_ID=n)}static getConfig(){const t=localStorage.getItem("n8n_webhook_url"),s=localStorage.getItem("google_drive_folder_id");return t&&(re.WEBHOOK_URL=t),s&&(re.FOLDER_ID=s),{webhookUrl:re.WEBHOOK_URL,folderId:re.FOLDER_ID}}};oe(ie,"instance");let We=ie;const le=class le{constructor(){oe(this,"config");this.config=this.loadConfig(),this.validateConfig()}static getInstance(){return le.instance||(le.instance=new le),le.instance}loadConfig(){return{googleDrive:{apiKey:"",clientId:"",mainFolderId:""},n8n:{webhookUrl:"https://n8n.srv765811.hstgr.cloud/webhook/facture-universelle",secret:void 0},company:{name:"HT CONFORT",phone:"+33 X XX XX XX XX",email:"contact@htconfort.com",address:"Adresse √† configurer",siret:"SIRET √† configurer"},pdf:{quality:parseFloat(void 0)||.8,maxSizeMB:parseInt(void 0)||5,compression:!1},app:{debugMode:!1,consoleLogs:!1,autoSaveInterval:parseInt(void 0)||6e4,maxProductsPerInvoice:parseInt(void 0)||50,defaultTaxRate:parseFloat(void 0)||20,currency:"EUR"},backup:{enabled:!1,intervalHours:parseInt(void 0)||24}}}validateConfig(){this.config.googleDrive.apiKey&&this.config.googleDrive.clientId,this.config.n8n.webhookUrl}get googleDrive(){return this.config.googleDrive}get n8n(){return this.config.n8n}get company(){return this.config.company}get pdf(){return this.config.pdf}get app(){return this.config.app}get backup(){return this.config.backup}isGoogleDriveConfigured(){return!!(this.config.googleDrive.apiKey&&this.config.googleDrive.clientId)}isN8NConfigured(){return!!this.config.n8n.webhookUrl}getConfigStatus(){return[{service:"Google Drive",configured:this.isGoogleDriveConfigured(),required:!1},{service:"N8N Webhook",configured:this.isN8NConfigured(),required:!0}]}logConfig(){this.config.app.debugMode&&this.config.app.consoleLogs&&(console.group("üîß Configuration Application"),console.log("Google Drive configur√©:",this.isGoogleDriveConfigured()),console.log("N8N configur√©:",this.isN8NConfigured()),console.log("Mode debug:",this.config.app.debugMode),console.log("Sauvegarde auto:",this.config.backup.enabled),console.groupEnd())}};oe(le,"instance");let ot=le;const qs=ot.getInstance();class zs{static getWebhookUrl(t="webhook/facture-universelle"){console.log("üîç WebhookUrlHelper - Environment check:",{isProd:!0,hostname:window.location.hostname,willUseProxy:!0});{const s=`/api/n8n/${t}`;return console.log("‚úÖ Using proxy URL:",s),s}}static getDirectUrl(t="webhook/facture-universelle"){const s=qs.n8n.webhookUrl;return s.includes(t)?s:`${s.replace(/\/$/,"")}/${t}`}static isUsingProxy(){return!0}static getDebugInfo(){return{environment:"production",usingProxy:this.isUsingProxy(),webhookUrl:this.getWebhookUrl(),directUrl:this.getDirectUrl()}}}class je{static get WEBHOOK_URL(){const t=zs.getWebhookUrl("webhook/facture-universelle");return console.log("üîó N8nWebhookService - Using webhook URL:",t),t}static async sendInvoiceToN8n(t,s){try{console.log("üöÄ DIAGNOSTIC COMPLET AVANT ENVOI N8N"),console.log("üîß Cr√©ation payload avec structure valid√©e du commit e54c7f9...");const r=Dt(t.products,t.taxRate||20,t.montantAcompte||0,t.paymentMethod||""),n=r.montantTTC,o=r.montantAcompte,i=r.montantRestant,l={nom_facture:`Facture_MYCONFORT_${t.invoiceNumber}`,fichier_facture:s,date_creation:new Date().toISOString(),type_document_email:"Bon de commande",type_document_pdf:"Facture",numero_bon_commande:t.invoiceNumber,objet_email:`Bon de commande n¬∞ ${t.invoiceNumber}`,titre_email:`Votre bon de commande n¬∞ ${t.invoiceNumber}`,numero_facture:t.invoiceNumber,date_facture:t.invoiceDate,montant_ttc:n,acompte:o,montant_restant:i,montant_ht:t.montantHT||0,montant_tva:t.montantTVA||0,montant_remise:t.montantRemise||0,taux_tva:t.taxRate||20,nom_du_client:t.clientName,email_client:t.clientEmail,telephone_client:t.clientPhone,adresse_client:`${t.clientAddress}, ${t.clientPostalCode} ${t.clientCity}`,client_adresse_rue:t.clientAddress,client_code_postal:t.clientPostalCode,client_ville:t.clientCity,client_type_logement:t.clientHousingType||"",client_code_porte:t.clientDoorCode||"",client_siret:t.clientSiret||"",mode_paiement:t.paymentMethod||"Non sp√©cifi√©",signature:t.isSigned?"Oui":"Non",signature_presente:t.isSigned?"Oui":"Non",signature_image:t.signature||"",date_signature:t.signatureDate||"",methode_livraison:t.deliveryMethod||"",notes_livraison:t.deliveryNotes||"",nombre_cheques:t.nombreChequesAVenir||0,montant_par_cheque:t.nombreChequesAVenir&&t.nombreChequesAVenir>0&&i>0?(i/t.nombreChequesAVenir).toFixed(2):"",est_paiement_alma:t.paymentMethod&&t.paymentMethod.includes("ALMA"),nombre_paiements_alma:t.paymentMethod&&t.paymentMethod.includes("ALMA")&&t.nombreChequesAVenir||0,montant_par_paiement_alma:t.paymentMethod&&t.paymentMethod.includes("ALMA")&&t.nombreChequesAVenir&&t.nombreChequesAVenir>0&&i>0?(i/t.nombreChequesAVenir).toFixed(2):"",mode_paiement_avec_details:(!o||o===0)&&(!t.nombreChequesAVenir||t.nombreChequesAVenir===0)?`Montant √† r√©gler : ${n.toFixed(2)}‚Ç¨ par ${t.paymentMethod||"Non sp√©cifi√©"}`:t.paymentMethod&&t.paymentMethod.includes("ALMA")&&t.nombreChequesAVenir&&t.nombreChequesAVenir>0?`${t.paymentMethod} - ${t.nombreChequesAVenir} paiement${t.nombreChequesAVenir>1?"s":""} de ${i>0?(i/t.nombreChequesAVenir).toFixed(2):"0.00"}‚Ç¨ chacun`:t.nombreChequesAVenir&&t.nombreChequesAVenir>0?`${t.paymentMethod||"Ch√®ques √† venir"} - ${t.nombreChequesAVenir} ch√®que${t.nombreChequesAVenir>1?"s":""} √† venir de ${i>0?(i/t.nombreChequesAVenir).toFixed(2):"0.00"}‚Ç¨ chacun`:`Montant restant : ${i.toFixed(2)}‚Ç¨ par ${t.paymentMethod||"Non sp√©cifi√©"}`,afficher_rib:t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement"),rib_html:t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`<div style="margin-top: 20px; padding: 15px; background-color: #e1f5fe; border: 1px solid #2563eb; border-radius: 8px;">
               <h3 style="margin: 0 0 10px 0; color: #2563eb; font-size: 14px;">üìã Coordonn√©es bancaires pour votre virement</h3>
               <div style="font-size: 12px; line-height: 1.4;">
                 <div><strong>B√©n√©ficiaire :</strong> MYCONFORT</div>
                 <div><strong>IBAN :</strong> FR76 1660 7000 1708 1216 3980 964</div>
                 <div><strong>BIC :</strong> CCBPFRPPPPG</div>
                 <div><strong>Banque :</strong> Banque Populaire du Sud</div>
                 <div style="margin-top: 8px; font-style: italic; color: #666;">
                   Merci d'indiquer le num√©ro de facture <strong>${t.invoiceNumber}</strong> en r√©f√©rence de votre virement.
                 </div>
               </div>
             </div>`:"",rib_texte:t.paymentMethod&&t.paymentMethod.toLowerCase().includes("virement")?`COORDONN√âES BANCAIRES POUR VIREMENT

B√©n√©ficiaire : MYCONFORT
IBAN : FR76 1660 7000 1708 1216 3980 964
BIC : CCBPFRPPPPG
Banque : Banque Populaire du Sud

Merci d'indiquer le num√©ro de facture ${t.invoiceNumber} en r√©f√©rence de votre virement.`:"",notes_facture:t.invoiceNotes||"",conseiller:t.advisorName||"MYCONFORT",lieu_evenement:t.eventLocation||"Non sp√©cifi√©",conditions_acceptees:t.termsAccepted?"Oui":"Non",date_creation_facture:t.createdAt||new Date().toISOString(),date_modification_facture:t.updatedAt||new Date().toISOString(),produits_html:t.products.map(c=>{const u=c.quantity*c.priceTTC;return`<li><strong>${c.name}</strong><br>
                   Quantit√©: ${c.quantity} √ó ${c.priceTTC.toFixed(2)}‚Ç¨ = <strong>${u.toFixed(2)}‚Ç¨</strong>
                   ${c.discount>0?`<br><em>Remise: -${c.discount}${c.discountType==="percent"?"%":"‚Ç¨"}</em>`:""}
                   </li>`}).join(""),liste_produits_email:t.products.map(c=>{const u=c.quantity*c.priceTTC;return`‚Ä¢ ${c.name} - Quantit√©: ${c.quantity} - Prix unitaire: ${c.priceTTC.toFixed(2)}‚Ç¨ - Total: ${u.toFixed(2)}‚Ç¨`}).join(`
`),noms_produits_string:t.products.map(c=>c.name).join(", "),resume_produits:t.products.length===1?t.products[0].name:`${t.products[0].name} et ${t.products.length-1} autre${t.products.length>2?"s":""} produit${t.products.length>2?"s":""}`,produits_noms:t.products.map(c=>c.name),produits_categories:t.products.map(c=>c.category||""),produits_quantites:t.products.map(c=>c.quantity),produits_prix_unitaires:t.products.map(c=>c.priceTTC.toFixed(2)),produits_prix_ht_unitaires:t.products.map(c=>c.priceHT.toFixed(2)),produits_remises:t.products.map(c=>c.discount||0),produits_types_remises:t.products.map(c=>c.discountType||"fixed"),produits_totaux:t.products.map(c=>(c.quantity*c.priceTTC).toFixed(2)),produits_totaux_ht:t.products.map(c=>(c.quantity*c.priceHT).toFixed(2)),produits_statuts_livraison:t.products.map(c=>c.isPickupOnSite?"emporte":"a_livrer"),nombre_produits:t.products.length,nombre_produits_a_livrer:t.products.filter(c=>!c.isPickupOnSite).length,nombre_produits_emportes:t.products.filter(c=>c.isPickupOnSite).length,noms_produits_a_livrer:t.products.filter(c=>!c.isPickupOnSite).map(c=>c.name).join(", "),noms_produits_emportes:t.products.filter(c=>c.isPickupOnSite).map(c=>c.name).join(", "),a_une_livraison:t.products.some(c=>!c.isPickupOnSite)?"Oui":"Non",a_des_produits_emportes:t.products.some(c=>c.isPickupOnSite)?"Oui":"Non",produits:t.products.map(c=>({nom:c.name,quantite:c.quantity,prix_ttc:c.priceTTC,prix_ht:c.priceHT,total_ttc:c.quantity*c.priceTTC,total_ht:c.quantity*c.priceHT,categorie:c.category||"Non sp√©cifi√©e",statut_livraison:c.isPickupOnSite?"emporte":"a_livrer",remise:c.discount||0,type_remise:c.discountType||"fixed"})),produits_text:t.products.map(c=>`${c.quantity}x ${c.name}`).join(", "),dossier_id:"1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-"};console.log("üì¶ Payload N8N pr√©par√© (structure e54c7f9):",{...l,fichier_facture:`[${s.length} caract√®res Base64]`}),console.group("üó∫Ô∏è MAPPING WEBHOOK N8N - STRUCTURE FONCTIONNELLE e54c7f9"),console.log("üéØ URL Webhook:",this.WEBHOOK_URL),console.log("üìä Taille payload:",JSON.stringify(l).length,"caract√®res");const m={nom_facture:l.nom_facture,numero_facture:l.numero_facture,nom_du_client:l.nom_du_client,email_client:l.email_client,montant_ttc:l.montant_ttc,montant_ht:l.montant_ht,montant_tva:l.montant_tva,montant_remise:l.montant_remise,taux_tva:l.taux_tva,acompte:l.acompte,montant_restant:l.montant_restant,telephone_client:l.telephone_client,client_adresse_rue:l.client_adresse_rue,client_code_postal:l.client_code_postal,client_ville:l.client_ville,client_type_logement:l.client_type_logement,client_code_porte:l.client_code_porte,client_siret:l.client_siret||"Non renseign√©",mode_paiement:l.mode_paiement,signature_presente:l.signature_presente,signature_image:l.signature_image?"Incluse (base64)":"Non disponible",date_signature:l.date_signature||"Non sign√©",methode_livraison:l.methode_livraison||"Non sp√©cifi√©e",notes_livraison:l.notes_livraison||"Aucune",nombre_cheques:l.nombre_cheques,montant_par_cheque:l.montant_par_cheque||"Non applicable",mode_paiement_avec_details:l.mode_paiement_avec_details,notes_facture:l.notes_facture||"Aucune",conseiller:l.conseiller,lieu_evenement:l.lieu_evenement,conditions_acceptees:l.conditions_acceptees,"produits_html (longueur)":`${l.produits_html.length} chars`,"liste_produits_email (longueur)":`${l.liste_produits_email.length} chars`,noms_produits_string:`"${l.noms_produits_string}"`,resume_produits:`"${l.resume_produits}"`,"produits_noms (nombre)":`${l.produits_noms.length} items`,"produits_categories (nombre)":`${l.produits_categories.length} items`,"produits_quantites (nombre)":`${l.produits_quantites.length} items`,"produits_prix_ht_unitaires (nombre)":`${l.produits_prix_ht_unitaires.length} items`,nombre_produits:l.nombre_produits,"fichier_facture (taille)":`${s.length} chars`};Object.entries(m).forEach(([c,u])=>{const g=u!=null&&u!=="";console.log(`${g?"‚úÖ":"‚ùå"} ${c}:`,typeof u=="string"&&u.length>30?`${u.substring(0,30)}...`:u)}),console.groupEnd();const d=new AbortController,h=setTimeout(()=>{d.abort()},this.TIMEOUT_MS);try{console.log("üì§ ENVOI EN COURS VERS N8N...");const c=await fetch(this.WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","User-Agent":"MYCONFORT-Invoice-System/1.0"},body:JSON.stringify(l),mode:"cors",signal:d.signal});clearTimeout(h);const u=await c.text();let g;try{g=JSON.parse(u)}catch{g={message:u}}if(console.group("üì• R√âPONSE N8N"),console.log("üî¢ Status:",c.status),console.log("üìÑ Headers:",Object.fromEntries(c.headers.entries())),console.log("üìã Body:",g),c.ok?console.log("‚úÖ WEBHOOK N8N A RE√áU LE PAYLOAD AVEC SUCC√àS"):(console.error("‚ùå WEBHOOK N8N A REJET√â LE PAYLOAD"),console.error("üîç V√©rifiez le workflow n8n et les champs attendus")),console.groupEnd(),!c.ok){const x=`‚ùå Erreur HTTP ${c.status}: ${u}`;return console.error(x),{success:!1,message:x,response:g,payload:l}}const v=`‚úÖ Facture ${l.numero_facture} envoy√©e avec succ√®s vers n8n`;return console.log(v),{success:!0,message:v,response:g,payload:l}}catch(c){if(clearTimeout(h),c instanceof Error&&c.name==="AbortError"){const g=`‚ùå Timeout: n8n ne r√©pond pas dans les ${this.TIMEOUT_MS/1e3}s`;return console.error(g),{success:!1,message:g,payload:l}}if(c instanceof Error&&(c.message.includes("CORS")||c.message.includes("Failed to fetch"))){console.warn("‚ö†Ô∏è Erreur CORS d√©tect√©e, tentative avec mode no-cors...");try{return await fetch(this.WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l),mode:"no-cors"}),console.log("‚úÖ Envoi no-cors r√©ussi (pas de r√©ponse lisible)"),{success:!0,message:"‚úÖ Envoi r√©ussi via mode no-cors (CORS configur√© c√¥t√© N8N requis pour les r√©ponses)",response:{note:"Mode no-cors utilis√© - r√©ponse non lisible"},payload:l}}catch(g){console.error("‚ùå √âchec m√™me avec no-cors:",g)}}const u=`‚ùå Erreur r√©seau: ${c instanceof Error?c.message:String(c)}`;return console.error(u),{success:!1,message:u,payload:l}}}catch(r){const n=`‚ùå Erreur inattendue: ${r instanceof Error?r.message:String(r)}`;return console.error(n,r),{success:!1,message:n}}}static async testConnection(){try{console.log("üß™ TEST DE CONNECTIVIT√â N8N");const t=Date.now(),s={test:!0,timestamp:new Date().toISOString(),source:"MYCONFORT-Test"},r=new AbortController,n=setTimeout(()=>{r.abort()},1e4);try{const o=await fetch(this.WEBHOOK_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s),signal:r.signal});clearTimeout(n);const i=Date.now()-t;if(o.ok){const l=`‚úÖ n8n accessible (${i}ms)`;return console.log(l),{success:!0,message:l,responseTime:i}}else{const l=`‚ùå n8n r√©pond avec erreur ${o.status}`;return console.error(l),{success:!1,message:l,responseTime:i}}}catch(o){return clearTimeout(n),o instanceof Error&&o.name==="AbortError"?{success:!1,message:"‚ùå Timeout: n8n ne r√©pond pas"}:{success:!1,message:`‚ùå Erreur de connexion: ${o instanceof Error?o.message:String(o)}`}}}catch(t){return{success:!1,message:`‚ùå Erreur test: ${t instanceof Error?t.message:String(t)}`}}}}oe(je,"TIMEOUT_MS",3e4);const $s=({isOpen:a,onClose:t,onSuccess:s,onError:r})=>{const[n,o]=f.useState("https://n8n.srv765811.hstgr.cloud/webhook-test/facture-myconfort"),[i,l]=f.useState("1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-"),[m,d]=f.useState(!1),[h,c]=f.useState(!1),[u,g]=f.useState(null),[v,x]=f.useState("unknown");f.useEffect(()=>{if(a){const P=We.getConfig();o(P.webhookUrl),l(P.folderId),g(null),p()}},[a]);const p=()=>(navigator.onLine?x("online"):x("offline"),window.addEventListener("online",()=>x("online")),window.addEventListener("offline",()=>x("offline")),()=>{window.removeEventListener("online",()=>x("online")),window.removeEventListener("offline",()=>x("offline"))}),N=()=>{d(!0);try{if(!n.trim()){r("‚ùå L'URL du webhook n8n est requise"),d(!1);return}if(!i.trim()){r("‚ùå L'ID du dossier Google Drive est requis"),d(!1);return}try{new URL(n)}catch{r("‚ùå L'URL du webhook n8n n'est pas valide"),d(!1);return}We.updateWebhookConfig(n,i),s("‚úÖ Configuration Google Drive mise √† jour avec succ√®s !"),d(!1)}catch(P){r(`‚ùå Erreur lors de l'enregistrement: ${P.message}`),d(!1)}},y=async()=>{if(v==="offline"){r("‚ùå Vous √™tes hors ligne. Veuillez v√©rifier votre connexion internet.");return}c(!0),g(null);try{const P=await je.testConnection();g(P),P.success?s(P.message):r(P.message)}catch(P){const b=`‚ùå Erreur lors du test: ${P.message||"Erreur inconnue"}`;g({success:!1,message:b}),r(b)}finally{c(!1)}};return a?e.jsx(ve,{isOpen:a,onClose:t,title:"Configuration Google Drive",maxWidth:"max-w-2xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(tt,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Int√©gration Google Drive"}),e.jsx("p",{className:"text-blue-100",children:"Sauvegardez automatiquement vos factures dans Google Drive"})]})]}),e.jsx("p",{className:"mt-2 text-sm text-blue-100",children:"Cette int√©gration permet d'envoyer automatiquement vos factures PDF vers Google Drive via n8n."})]}),v==="offline"&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Zt,{className:"w-5 h-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-red-700",children:"Vous √™tes actuellement hors ligne"}),e.jsx("p",{className:"text-sm text-red-600",children:"Veuillez v√©rifier votre connexion internet pour utiliser cette fonctionnalit√©"})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"URL du Webhook n8n *"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(tt,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("input",{type:"text",value:n,onChange:P=>o(P.target.value),placeholder:"https://n8n.srv765811.hstgr.cloud/webhook-test/facture-myconfort",className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"URL du webhook n8n qui recevra les donn√©es de la facture"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-medium mb-1",children:"ID du Dossier Google Drive *"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(es,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsx("input",{type:"text",value:i,onChange:P=>l(P.target.value),placeholder:"1hZsPW8TeZ6s3AlLesb1oLQNbI3aJY3p-",className:"w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-black",required:!0})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ID du dossier Google Drive o√π seront stock√©es les factures"})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-blue-800 mb-2",children:"Comment configurer l'int√©gration :"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-sm text-blue-700",children:[e.jsx("li",{children:"Cr√©ez un workflow dans n8n avec un webhook comme d√©clencheur"}),e.jsx("li",{children:"Ajoutez un module Google Drive pour uploader un fichier"}),e.jsx("li",{children:"Copiez l'URL du webhook n8n et collez-la ci-dessus"}),e.jsx("li",{children:"Cr√©ez un dossier dans Google Drive et copiez son ID"}),e.jsx("li",{children:"Testez la connexion pour v√©rifier que tout fonctionne"})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"R√©solution des probl√®mes courants :"}),e.jsxs("ul",{className:"list-disc ml-5 space-y-2 text-sm text-yellow-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:'Erreur "Failed to fetch"'})," - V√©rifiez que votre instance n8n est en ligne et accessible"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erreur CORS"})," - Configurez votre n8n pour accepter les requ√™tes de votre domaine"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erreur 404"})," - V√©rifiez que l'URL du webhook est correcte et que le workflow est actif"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Timeout"})," - V√©rifiez la connectivit√© r√©seau et que n8n r√©pond dans un d√©lai raisonnable"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Erreur HTTPS"})," - Assurez-vous que votre navigateur accepte les requ√™tes vers le serveur n8n"]})]})]}),u&&e.jsx("div",{className:`p-4 rounded-lg ${u.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-start space-x-2",children:[u.success?e.jsx(fe,{className:"w-5 h-5 text-green-500 mt-0.5 flex-shrink-0"}):e.jsx(Fe,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${u.success?"text-green-700":"text-red-700"}`,children:u.success?"‚úÖ Test r√©ussi !":"‚ùå Test √©chou√©"}),e.jsx("div",{className:`text-sm mt-1 ${u.success?"text-green-600":"text-red-600"}`,children:u.message.split(`
`).map((P,b)=>e.jsx("div",{className:b>0?"mt-1":"",children:P.startsWith("‚Ä¢")?e.jsx("div",{className:"ml-2",children:P}):P},b))})]})]})}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("button",{onClick:t,disabled:m||h,className:"px-4 py-2 text-gray-600 hover:text-gray-800 font-medium disabled:opacity-50",children:"Fermer"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:y,disabled:!n.trim()||!i.trim()||m||h||v==="offline",className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:h?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Test en cours..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Tester la connexion"})]})}),e.jsx("button",{onClick:N,disabled:!n.trim()||!i.trim()||m,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Enregistrement..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(At,{className:"w-5 h-5"}),e.jsx("span",{children:"Enregistrer"})]})})]})]})]})}):null},Bs=mt({invoiceNumber:$().min(1,"Num√©ro de facture obligatoire"),invoiceDate:$().min(1,"Date de facture obligatoire"),eventLocation:$().min(1,"Lieu d'√©v√©nement obligatoire"),clientName:$().min(1,"Nom client obligatoire"),clientEmail:$().email("Email client invalide"),clientPhone:$().min(1,"T√©l√©phone client obligatoire"),clientAddress:$().min(1,"Adresse client obligatoire"),clientCity:$().min(1,"Ville client obligatoire"),clientPostalCode:$().min(1,"Code postal client obligatoire"),clientHousingType:$().min(1,"Type de logement obligatoire"),clientDoorCode:$().min(1,"Code porte obligatoire"),clientSiret:$().optional(),advisorName:$().min(1,"Nom conseiller obligatoire"),products:ss(mt({name:$().min(1,"Nom produit obligatoire"),category:$().min(1,"Cat√©gorie produit obligatoire"),quantity:Q().min(1,"Quantit√© doit √™tre >= 1"),unitPriceHT:Q().min(0,"Prix HT doit √™tre >= 0"),unitPriceTTC:Q().min(0,"Prix TTC doit √™tre >= 0"),discount:Q().min(0,"Remise doit √™tre >= 0"),discountType:rs(["percent","fixed"]),totalTTC:Q().min(0,"Total TTC doit √™tre >= 0")})).min(1,"Au moins un produit obligatoire"),totalHT:Q().min(0,"Total HT doit √™tre >= 0"),totalTTC:Q().min(0,"Total TTC doit √™tre >= 0"),totalTVA:Q().min(0,"Total TVA doit √™tre >= 0"),taxRate:Q().min(0,"Taux TVA doit √™tre >= 0"),paymentMethod:$().min(1,"M√©thode de paiement obligatoire"),depositAmount:Q().min(0,"Montant acompte doit √™tre >= 0"),remainingAmount:Q().min(0,"Montant restant doit √™tre >= 0"),deliveryMethod:$().optional(),deliveryNotes:$().optional(),invoiceNotes:$().optional(),termsAccepted:ts(),signature:$().optional(),pdfBase64:$().min(1,"PDF base64 obligatoire"),pdfSizeKB:Q().min(0,"Taille PDF doit √™tre >= 0"),generatedAt:$(),generatedTimestamp:Q()});class ht{static logToConsole(t,s){var l;console.group("üîç DIAGNOSTIC PAYLOAD JSON - ANALYSE COMPL√àTE"),console.log("üì¶ PAYLOAD COMPLET √Ä ENVOYER:",JSON.stringify(t,null,2)),console.group("‚ö†Ô∏è V√âRIFICATION CHAMPS CRITIQUES REQUIS");const n=["clientEmail","clientPhone","clientName","clientAddress","invoiceNumber","invoiceDate","totalHT","totalTTC","products","paymentMethod","pdfBase64"].filter(m=>{const d=t[m],h=!d||Array.isArray(d)&&d.length===0||d==="";return h?console.error(`‚ùå CHAMP CRITIQUE MANQUANT: ${m}`):console.log(`‚úÖ ${m}:`,typeof d=="string"&&d.length>50?`${d.substring(0,50)}...`:d),h});n.length>0?(console.error("üö® CHAMPS CRITIQUES MANQUANTS:",n),console.error("‚ö†Ô∏è LE WEBHOOK N8N RECEVRA UN PAYLOAD INCOMPLET !")):console.log("‚úÖ TOUS LES CHAMPS CRITIQUES SONT PR√âSENTS"),console.groupEnd(),console.group("üó∫Ô∏è MAPPING DES DONN√âES - CORRESPONDANCE EXACTE"),[{app:"clientPhone",webhook:"phone",value:t.clientPhone},{app:"clientEmail",webhook:"email",value:t.clientEmail},{app:"totalHT",webhook:"montantHT",value:t.totalHT},{app:"totalTTC",webhook:"montantTTC",value:t.totalTTC},{app:"clientName",webhook:"clientName",value:t.clientName},{app:"invoiceNumber",webhook:"invoiceNumber",value:t.invoiceNumber},{app:"products",webhook:"products",value:t.products},{app:"pdfBase64",webhook:"fichier_facture",value:t.pdfBase64?"PDF_PRESENT":"PDF_MISSING"}].forEach(m=>{const d=m.value!==void 0&&m.value!==null&&m.value!=="";console.log(`${d?"‚úÖ":"‚ùå"} ${m.app} ‚Üí ${m.webhook}:`,d?typeof m.value=="string"&&m.value.length>30?`${m.value.substring(0,30)}...`:m.value:"MANQUANT")}),console.groupEnd(),console.group("üì¶ ANALYSE D√âTAILL√âE DES PRODUITS"),t.products&&Array.isArray(t.products)?(console.log(`üìä Nombre de produits: ${t.products.length}`),t.products.forEach((m,d)=>{console.log(`Produit ${d+1}:`,{name:m.name,quantity:m.quantity,unitPriceTTC:m.unitPriceTTC,totalTTC:m.totalTTC,category:m.category})})):console.error("‚ùå PRODUITS MANQUANTS OU FORMAT INVALIDE"),console.groupEnd(),console.group("üìÑ ANALYSE DU PDF"),t.pdfBase64?(console.log("‚úÖ PDF pr√©sent"),console.log("üìä Taille base64:",t.pdfBase64.length,"caract√®res"),console.log("üìä Taille estim√©e PDF:",t.pdfSizeKB,"KB"),console.log("üîç D√©but base64:",t.pdfBase64.substring(0,50)+"...")):console.error("‚ùå PDF MANQUANT - CRITIQUE POUR N8N"),console.groupEnd(),console.group("üîç V√âRIFICATION TYPES DE DONN√âES"),[{field:"totalHT",expected:"number",actual:typeof t.totalHT},{field:"totalTTC",expected:"number",actual:typeof t.totalTTC},{field:"taxRate",expected:"number",actual:typeof t.taxRate},{field:"depositAmount",expected:"number",actual:typeof t.depositAmount},{field:"products",expected:"array",actual:Array.isArray(t.products)?"array":typeof t.products},{field:"termsAccepted",expected:"boolean",actual:typeof t.termsAccepted}].forEach(m=>{const d=m.actual===m.expected;console.log(`${d?"‚úÖ":"‚ùå"} ${m.field}: attendu ${m.expected}, re√ßu ${m.actual}`)}),console.groupEnd(),s&&(console.group("‚ùå ERREURS DE VALIDATION"),s.issues.forEach(m=>{console.error(`‚Ä¢ ${m.path.join(".")}: ${m.message}`)}),console.groupEnd()),console.group("üìä STATISTIQUES PAYLOAD"),console.log("‚Ä¢ Taille JSON:",JSON.stringify(t).length,"caract√®res"),console.log("‚Ä¢ Nombre de produits:",((l=t.products)==null?void 0:l.length)||0),console.log("‚Ä¢ Taille PDF:",t.pdfSizeKB||0,"KB"),console.log("‚Ä¢ Signature pr√©sente:",!!t.signature),console.groupEnd(),console.groupEnd()}static logBeforeWebhookSend(t){console.group("üöÄ DIAGNOSTIC FINAL AVANT ENVOI WEBHOOK N8N"),console.log("üì¶ PAYLOAD COMPLET √Ä ENVOYER:",JSON.stringify(t,null,2));const r=["clientEmail","clientPhone","totalHT","totalTTC","invoiceNumber","pdfBase64"].filter(o=>{const i=t[o];return!i||i===""||Array.isArray(i)&&i.length===0});r.length>0?(console.error("üö® CHAMPS MANQUANTS POUR WEBHOOK:",r),console.error("‚ö†Ô∏è LE WEBHOOK N8N RISQUE DE PLANTER !")):console.log("‚úÖ PAYLOAD PR√äT POUR ENVOI WEBHOOK");const n=JSON.stringify(t).length;console.log("üìä Taille totale payload:",n,"caract√®res"),n>1e6&&console.warn("‚ö†Ô∏è PAYLOAD TR√àS VOLUMINEUX (>1MB) - RISQUE DE TIMEOUT"),console.groupEnd()}static logToFile(t,s){var r;try{const n={timestamp:new Date().toISOString(),payload:t,validation:{isValid:!s,errors:(s==null?void 0:s.issues)||[]},stats:{jsonSize:JSON.stringify(t).length,productsCount:((r=t.products)==null?void 0:r.length)||0,pdfSizeKB:t.pdfSizeKB||0,hasSignature:!!t.signature}};console.log("üìÅ LOG FICHIER (simulation):",JSON.stringify(n,null,2))}catch(n){console.error("‚ùå Erreur √©criture log fichier:",n)}}static logPayload(t,s){this.logToConsole(t,s),this.logToFile(t,s)}}class _s{static sanitizePayload(t,s,r){var c,u,g,v,x,p,N,y,P;console.log("üßπ NETTOYAGE ET PR√âPARATION DU PAYLOAD - DIAGNOSTIC COMPLET"),console.group("üìã DONN√âES BRUTES AVANT NETTOYAGE"),console.log("Invoice brute:",{invoiceNumber:t.invoiceNumber,clientName:t.clientName,clientEmail:t.clientEmail,clientPhone:t.clientPhone,products:t.products.length,paymentMethod:t.paymentMethod,signature:!!t.signature}),console.log("PDF info:",{base64Length:s.length,sizeKB:r}),console.groupEnd();const n=t.products.map(b=>{var A;const C=b.priceTTC/(1+t.taxRate/100),E=b.quantity*b.priceTTC*(1-b.discount/100);return{name:b.name.trim(),category:((A=b.category)==null?void 0:A.trim())||"",quantity:b.quantity,unitPriceHT:Math.round(C*100)/100,unitPriceTTC:b.priceTTC,discount:b.discount,discountType:b.discountType,totalTTC:Math.round(E*100)/100}}),o=n.reduce((b,C)=>b+C.totalTTC,0),i=o/(1+t.taxRate/100),l=o-i,m=t.montantAcompte||0,d=o-m;console.group("üßÆ CALCULS EFFECTU√âS"),console.log("Totaux calcul√©s:",{totalHT:Math.round(i*100)/100,totalTTC:Math.round(o*100)/100,totalTVA:Math.round(l*100)/100,depositAmount:Math.round(m*100)/100,remainingAmount:Math.round(d*100)/100}),console.groupEnd();const h={invoiceNumber:t.invoiceNumber.trim(),invoiceDate:t.invoiceDate,eventLocation:((c=t.eventLocation)==null?void 0:c.trim())||"",clientName:t.clientName.trim(),clientEmail:t.clientEmail.trim().toLowerCase(),clientPhone:t.clientPhone.trim(),clientAddress:t.clientAddress.trim(),clientCity:t.clientCity.trim(),clientPostalCode:t.clientPostalCode.trim(),clientHousingType:((u=t.clientHousingType)==null?void 0:u.trim())||"",clientDoorCode:((g=t.clientDoorCode)==null?void 0:g.trim())||"",clientSiret:(v=t.clientSiret)==null?void 0:v.trim(),advisorName:((x=t.advisorName)==null?void 0:x.trim())||"MYCONFORT",products:n,totalHT:Math.round(i*100)/100,totalTTC:Math.round(o*100)/100,totalTVA:Math.round(l*100)/100,taxRate:t.taxRate,paymentMethod:t.paymentMethod.trim(),depositAmount:Math.round(m*100)/100,remainingAmount:Math.round(d*100)/100,deliveryMethod:(p=t.deliveryMethod)==null?void 0:p.trim(),deliveryNotes:(N=t.deliveryNotes)==null?void 0:N.trim(),invoiceNotes:(y=t.invoiceNotes)==null?void 0:y.trim(),termsAccepted:t.termsAccepted,signature:(P=t.signature)==null?void 0:P.trim(),pdfBase64:s,pdfSizeKB:r,generatedAt:new Date().toISOString(),generatedTimestamp:Date.now()};return console.group("‚úÖ PAYLOAD NETTOY√â - PR√äT POUR VALIDATION"),console.log("Payload nettoy√©:",JSON.stringify(h,null,2)),console.groupEnd(),h}}class Lt{static validateAndPrepare(t,s,r){try{console.log("üîê VALIDATION DU PAYLOAD AVANT ENVOI N8N");const n=_s.sanitizePayload(t,s,r),o=Bs.safeParse(n);return o.success?(console.log("‚úÖ VALIDATION R√âUSSIE - Payload pr√™t pour envoi"),ht.logPayload(o.data),{isValid:!0,payload:o.data}):(console.error("‚ùå VALIDATION √âCHOU√âE"),ht.logPayload(n,o.error),{isValid:!1,errors:o.error.issues.map(l=>`${l.path.join(".")}: ${l.message}`)})}catch(n){return console.error("‚ùå Erreur lors de la validation:",n),{isValid:!1,errors:[`Erreur de validation: ${n instanceof Error?n.message:"Erreur inconnue"}`]}}}}const Us=({isOpen:a,onClose:t,invoice:s,onSuccess:r,onError:n})=>{var g;const[o,i]=f.useState(null),[l,m]=f.useState(!1),d=async()=>{var v,x,p;try{const N="JVBERi0xLjQKJcOkw7zDtsO4CjIgMCBvYmoKPDwKL0xlbmd0aCAzIDAgUgo+PgpzdHJlYW0K";console.log("üîç G√âN√âRATION PAYLOAD DEBUG - DIAGNOSTIC COMPLET"),console.log("üìã Donn√©es invoice brutes:",{invoiceNumber:s.invoiceNumber,clientName:s.client.name,clientEmail:s.client.email,clientPhone:s.client.phone,products:s.products.length,totalProducts:s.products.reduce((b,C)=>b+C.quantity*C.priceTTC,0)});const P=Lt.validateAndPrepare(s,N,150);i({validation:P,timestamp:new Date().toISOString(),invoiceData:s,rawPayloadSize:JSON.stringify(P.payload||{}).length,fieldMapping:{"app ‚Üí webhook":{"client.phone ‚Üí clientPhone":s.client.phone,"client.email ‚Üí clientEmail":s.client.email,"calculated totalHT ‚Üí totalHT":(v=P.payload)==null?void 0:v.totalHT,"calculated totalTTC ‚Üí totalTTC":(x=P.payload)==null?void 0:x.totalTTC,"products.length ‚Üí products":s.products.length}}}),P.isValid?r("‚úÖ Payload g√©n√©r√© et valid√© avec succ√®s"):n(`‚ùå Erreurs de validation: ${(p=P.errors)==null?void 0:p.join(", ")}`)}catch(N){n(`‚ùå Erreur g√©n√©ration payload: ${N.message}`)}},h=async()=>{m(!0);try{const v=await je.testConnection();v.success?r(v.message):n(v.message)}catch(v){n(`‚ùå Erreur test connexion: ${v.message}`)}finally{m(!1)}},c=()=>{var v;(v=o==null?void 0:o.validation)!=null&&v.payload&&(navigator.clipboard.writeText(JSON.stringify(o.validation.payload,null,2)),r("üìã Payload copi√© dans le presse-papiers"))},u=()=>{if(o){const v=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),x=URL.createObjectURL(v),p=document.createElement("a");p.href=x,p.download=`payload-debug-${s.invoiceNumber}-${Date.now()}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(x),r("üì• Fichier de debug t√©l√©charg√©")}};return a?e.jsx(ve,{isOpen:a,onClose:t,title:"üêõ Debug Payload N8N",maxWidth:"max-w-4xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-orange-600 to-red-600 text-white rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-full",children:e.jsx(Pe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Debug Payload N8N"}),e.jsx("p",{className:"text-orange-100",children:"Validation et test du payload avant envoi"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("button",{onClick:d,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg flex items-center space-x-2 font-semibold transition-all",children:[e.jsx(Pe,{className:"w-5 h-5"}),e.jsx("span",{children:"G√©n√©rer Payload Debug"})]}),e.jsxs("button",{onClick:h,disabled:l,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-3 rounded-lg flex items-center space-x-2 font-semibold transition-all",children:[e.jsx(Ve,{className:"w-5 h-5"}),e.jsx("span",{children:l?"Test...":"Test Connexion N8N"})]}),o&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:c,className:"bg-purple-600 hover:bg-purple-700 text-white px-3 py-3 rounded-lg flex items-center space-x-1 font-semibold transition-all",children:[e.jsx(St,{className:"w-4 h-4"}),e.jsx("span",{children:"Copier"})]}),e.jsxs("button",{onClick:u,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-3 rounded-lg flex items-center space-x-1 font-semibold transition-all",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{children:"T√©l√©charger"})]})]})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${o.validation.isValid?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsx("h4",{className:`font-bold mb-2 ${o.validation.isValid?"text-green-800":"text-red-800"}`,children:o.validation.isValid?"‚úÖ Validation R√©ussie":"‚ùå Erreurs de Validation"}),!o.validation.isValid&&o.validation.errors&&e.jsx("ul",{className:"list-disc ml-5 space-y-1 text-red-700",children:o.validation.errors.map((v,x)=>e.jsx("li",{className:"text-sm",children:v},x))})]}),o.validation.payload&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"üìã Payload Valid√©"}),e.jsx("pre",{className:"bg-white p-4 rounded border text-xs overflow-auto max-h-96 text-gray-800",children:JSON.stringify(o.validation.payload,null,2)})]}),o.validation.payload&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-800 mb-2",children:"üìä Statistiques Payload"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Taille JSON:"}),e.jsxs("div",{className:"text-blue-800",children:[JSON.stringify(o.validation.payload).length," ","caract√®res"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Produits:"}),e.jsx("div",{className:"text-blue-800",children:((g=o.validation.payload.products)==null?void 0:g.length)||0})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Taille PDF:"}),e.jsxs("div",{className:"text-blue-800",children:[o.validation.payload.pdfSizeKB," KB"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600 font-semibold",children:"Signature:"}),e.jsx("div",{className:"text-blue-800",children:o.validation.payload.signature?"Oui":"Non"})]})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-yellow-800 mb-2",children:"üí° Instructions Debug"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-2 text-sm text-yellow-700",children:[e.jsx("li",{children:'Cliquez sur "G√©n√©rer Payload Debug" pour valider la structure'}),e.jsx("li",{children:"V√©rifiez que tous les champs obligatoires sont pr√©sents"}),e.jsx("li",{children:"Testez la connexion N8N pour v√©rifier l'accessibilit√©"}),e.jsx("li",{children:"Copiez le payload pour le tester dans Postman/cURL"}),e.jsx("li",{children:'Dans n8n, activez "Listen for test event" pour voir les donn√©es re√ßues'})]})]})]})}):null},qe=({title:a,icon:t,iconColor:s,bgColor:r,borderColor:n,children:o})=>e.jsxs("div",{className:`${r} ${n} border rounded-lg p-4`,children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-white p-2 rounded-full",children:e.jsx(t,{className:`w-5 h-5 ${s}`})}),e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:a})]}),e.jsx("div",{className:"space-y-4",children:o})]}),gt=Et,$e=[71,122,12],M=15,G={name:"MYCONFORT",address1:"88 avenue des Ternes",address2:"75017 Paris",phone:"+33 6 61 48 60 23",email:"htconfort@gmail.com",website:"htconfort.com",siret:"824 313 530 00027",iban:"FR76 1234 5678 9012 3456 7890 123",bic:"PSSTFRPPXXX"},Hs=[{title:"1. Objet",text:"Les pr√©sentes conditions r√©gissent les ventes de MYCONFORT."},{title:"2. Produits",text:"Descriptions et caract√©ristiques indicatives ; tol√©rances d'usage."},{title:"3. Prix",text:"Prix TTC en euros, TVA 20 % ; offres valables dans la limite des stocks."},{title:"4. Commande",text:"Validation apr√®s paiement ou acompte ; confirmation par email."},{title:"5. Paiement",text:"CB Banque Populaire, virement, ch√®ques ; p√©nalit√©s de retard l√©gales."},{title:"6. Acompte",text:"Acompte non remboursable sauf obligation l√©gale ; solde √† la livraison."},{title:"7. Livraison",text:"D√©lais indicatifs 48 h ouvr√©es ; pas de reprise d'anciens matelas."},{title:"8. R√©ception",text:"R√©serves √† formuler √† la livraison ; d√©fauts apparents sous 48 h."},{title:"9. Garantie",text:"Jusqu'√† 15 ans selon r√©f√©rence ; exclusions: mauvaise utilisation/usure."},{title:"10. Retours",text:"Hors droit de r√©tractation l√©gal non applicable aux biens personnalis√©s."},{title:"11. SAV",text:"Service client Saint-Hippolyte ‚Äî htconfort@me.com ‚Äî 06 61 48 60 23."},{title:"12. Donn√©es",text:"Traitements RGPD ; droit d'acc√®s/rectification/suppression."},{title:"13. Force majeure",text:"Suspension/exon√©ration en cas d'√©v√©nement irr√©sistible et impr√©visible."},{title:"14. Droit applicable",text:"Droit fran√ßais ; tentative amiable avant toute action."},{title:"15. Juridiction",text:"Tribunaux comp√©tents du ressort du si√®ge social en cas d'√©chec amiable."}];async function Vs(a){try{return new Promise((t,s)=>{const r=new Image;r.onload=()=>{try{const n=document.createElement("canvas"),o=n.getContext("2d"),i=300,l=150;let{width:m,height:d}=r;m>i&&(d=d*i/m,m=i),d>l&&(m=m*l/d,d=l),n.width=m,n.height=d,o.fillStyle="white",o.fillRect(0,0,m,d),o.drawImage(r,0,0,m,d);const h=n.toDataURL("image/jpeg",.8);console.log("üîß Signature optimis√©e:",{originalSize:a.length,optimizedSize:h.length,reduction:`${((1-h.length/a.length)*100).toFixed(1)}%`,dimensions:`${m}x${d}px`}),t(h)}catch(n){console.warn("Signature optimization failed, using original:",n),t(a)}},r.onerror=()=>{console.warn("Failed to load signature for optimization, using original"),t(a)},r.src=a})}catch(t){return console.warn("Signature optimization error:",t),a}}async function Ws(a){try{const t=await fetch(a).then(s=>s.blob());return await new Promise((s,r)=>{const n=new Image;n.onload=()=>{try{const o=document.createElement("canvas"),i=o.getContext("2d"),l=200,m=100;let{width:d,height:h}=n;d>l&&(h=h*l/d,d=l),h>m&&(d=d*m/h,h=m),o.width=d,o.height=h,i.fillStyle="white",i.fillRect(0,0,d,h),i.drawImage(n,0,0,d,h);const c=o.toDataURL("image/jpeg",.7);console.log("üîß Logo compress√©:",{originalSize:t.size,compressedSize:c.length,reduction:`${((1-c.length/t.size)*100).toFixed(1)}%`,dimensions:`${d}x${h}px`}),s(c)}catch(o){console.warn("Logo compression failed, using original:",o);const i=new FileReader;i.onload=()=>s(i.result),i.onerror=()=>r(new Error("logo load error")),i.readAsDataURL(t)}},n.onerror=()=>r(new Error("logo load error")),n.src=URL.createObjectURL(t)})}catch(t){console.warn("Logo loading failed:",t);return}}function bt(a,t){const s=a.internal.pageSize.getWidth(),r=a.internal.pageSize.getHeight()-10;a.setDrawColor($e[0],$e[1],$e[2]),a.setLineWidth(.4),a.line(M,r-5,s-M,r-5),a.setFont("helvetica","normal"),a.setFontSize(8),a.text(`${G.name} ‚Äî ${G.address1}, ${G.address2} ‚Äî ${G.email} ‚Äî ${G.phone}`,M,r),a.text(`Page ${t} / 2`,s-M,r,{align:"right"})}const it={async generateInvoicePDF(a,t,s){var D;const r=Gs(a),n=new Ue({unit:"mm",format:"a4"}),o=n.internal.pageSize.getWidth(),i=(s==null?void 0:s.logoUrl)||"/HT-Confort_Full_Green.png",l=await Ws(i);l&&n.addImage(l,"PNG",M,10,40,20),n.setFont("helvetica","bold"),n.setFontSize(16),n.text("FACTURE",o/2,20,{align:"center"}),n.setFont("helvetica","normal"),n.setFontSize(9);const m=[G.name,G.address1,G.address2,`T√©l : ${G.phone}`,`Email : ${G.email}`,`Web : ${G.website}`,`SIRET : ${G.siret}`,`IBAN : ${G.iban}`,`BIC : ${G.bic}`];m.forEach((T,O)=>n.text(T,M,35+O*4.6)),n.setFont("helvetica","bold"),n.setFontSize(10),n.text(`Facture n¬∞ : ${r.invoiceNumber}`,M,35+m.length*4.6+6),n.setFont("helvetica","normal"),n.text(`Date : ${r.invoiceDate}`,M,35+m.length*4.6+12);const d=o-80;n.setFont("helvetica","bold"),n.text("Client",d,35),n.setFont("helvetica","normal"),n.setFontSize(9),[r.clientName||"‚Äî",r.clientAddress||"‚Äî",`${r.clientPostalCode??""} ${r.clientCity??""}`.trim()||"‚Äî",r.clientPhone?`T√©l : ${r.clientPhone}`:"",r.clientEmail?`Email : ${r.clientEmail}`:""].filter(Boolean).forEach((T,O)=>n.text(T,d,40+O*4.6));const c=(r.products||[]).map(T=>{const O=T.name||T.category||"‚Äî",U=Number(T.quantity??0),L=Number(T.priceTTC??0),B=U*L;return[O,String(U),L.toFixed(2)+" ‚Ç¨",B.toFixed(2)+" ‚Ç¨"]});gt(n,{startY:35+m.length*4.6+20,head:[["D√©signation","Qt√©","PU TTC","Total TTC"]],body:c,theme:"grid",headStyles:{fillColor:$e,textColor:255,fontStyle:"bold"},styles:{fontSize:9,cellPadding:2},margin:{left:M,right:M},columnStyles:{1:{halign:"center"},2:{halign:"right"},3:{halign:"right"}},didDrawPage:()=>{bt(n,1)},rowPageBreak:"avoid",tableWidth:o-M*2});const u=((D=n.lastAutoTable)==null?void 0:D.finalY)??120;gt(n,{startY:u+6,body:[["Total HT",`${r.montantHT.toFixed(2)} ‚Ç¨`],[`TVA ${Math.round(r.taxRate)}%`,`${r.montantTVA.toFixed(2)} ‚Ç¨`],["Total TTC",`${r.montantTTC.toFixed(2)} ‚Ç¨`]],theme:"plain",styles:{fontSize:10,halign:"right"},columnStyles:{0:{halign:"left"}},margin:{left:o-100-M,right:M}});let g=n.lastAutoTable.finalY+8;r.paymentMethod&&(n.setFont("helvetica","bold"),n.text("Mode de r√®glement",M,g),n.setFont("helvetica","normal"),g+=5,n.text(r.paymentMethod,M,g),g+=6),n.setFont("helvetica","bold"),n.text("Merci pour votre confiance üôè",M,g),n.setFont("helvetica","normal"),n.setFontSize(9);const v=`Paiement par virement : IBAN ${G.iban} ‚Äî BIC ${G.bic}. Indiquez le n¬∞ de facture ${r.invoiceNumber} en r√©f√©rence.`,x=n.splitTextToSize(v,o-M*2);if(n.text(x,M,g+5),r.signature&&r.isSigned){g+=20,n.setFont("helvetica","bold"),n.setFontSize(10),n.text("Signature client :",M,g);try{const T=await Vs(r.signature);if(n.addImage(T,"JPEG",M,g+5,50,25),g+=30,r.signatureDate){n.setFont("helvetica","normal"),n.setFontSize(8);const O=new Date(r.signatureDate).toLocaleDateString("fr-FR");n.text(`Sign√© le ${O}`,M,g),g+=5}}catch{n.setFont("helvetica","normal"),n.setFontSize(9),n.text("‚úì Signature √©lectronique enregistr√©e",M,g+5),g+=15}}g+=10,n.setFont("helvetica","bold"),n.setFontSize(8),n.text("‚öñÔ∏è INFORMATION L√âGALE - ARTICLE L224-59",M,g),n.setFont("helvetica","normal"),n.setFontSize(7);const N=n.splitTextToSize("¬´ Avant la conclusion de tout contrat entre un consommateur et un professionnel √† l'occasion d'une foire, d'un salon [...] le professionnel informe le consommateur qu'il ne dispose pas d'un d√©lai de r√©tractation. ¬ª",o-M*2);n.text(N,M,g+4),n.addPage("a4","portrait"),n.setFont("helvetica","bold"),n.setFontSize(14),n.text("Conditions G√©n√©rales de Vente",M,20);const y=(o-M*2-6)/2,P=M,b=M+y+6;let C=28,E=28;n.setFont("helvetica","normal"),n.setFontSize(9.2),Hs.forEach(T=>{const O=[`${T.title}`,T.text],U=n.splitTextToSize(O.join(" ‚Äî "),y),L=4.4,B=U.length*L+2;if(C+B<285&&C<=E){n.setFont("helvetica","bold"),n.text(T.title,P,C),n.setFont("helvetica","normal");const V=n.splitTextToSize(T.text,y);n.text(V,P,C+5),C+=V.length*L+9}else{n.setFont("helvetica","bold"),n.text(T.title,b,E),n.setFont("helvetica","normal");const V=n.splitTextToSize(T.text,y);n.text(V,b,E+5),E+=V.length*L+9}}),bt(n,2);const A=new Blob([n.output("arraybuffer")],{type:"application/pdf"}),k=A.size/(1024*1024);return console.log("üìÑ PDF g√©n√©r√©:",{pages:2,size:`${k.toFixed(2)} MB`,sizeBytes:A.size,invoiceNumber:r.invoiceNumber,hasLogo:!!l,hasSignature:!!(r.signature&&r.isSigned)}),k>5&&(console.warn(`‚ö†Ô∏è PDF tr√®s volumineux (${k.toFixed(2)}MB) - Cela peut causer des probl√®mes d'envoi!`),console.warn("üí° Conseil: V√©rifiez la taille des images (logo/signature) ou utilisez des formats plus compress√©s")),A},async generate(a,t){return this.generateInvoicePDF(a,void 0,t)}};function Gs(a){const t=(a.products||[]).map(s=>({name:s.name||s.designation||"Produit",designation:s.designation||s.name,quantity:Number(s.quantity)||1,priceTTC:Number(s.priceTTC)||0,discount:Number(s.discount)||0,discountType:s.discountType==="amount"?"amount":"percent",category:s.category||""}));return{invoiceNumber:String(a.invoiceNumber||"N/A"),invoiceDate:String(a.invoiceDate||new Date().toLocaleDateString("fr-FR")),clientName:String(a.clientName||"Client"),clientAddress:String(a.clientAddress||""),clientPostalCode:a.clientPostalCode?String(a.clientPostalCode):void 0,clientCity:a.clientCity?String(a.clientCity):void 0,clientPhone:a.clientPhone?String(a.clientPhone):void 0,clientEmail:a.clientEmail?String(a.clientEmail):void 0,products:t,montantHT:Number(a.montantHT)||0,montantTVA:Number(a.montantTVA)||0,montantTTC:Number(a.montantTTC)||0,taxRate:Number(a.taxRate)||20,paymentMethod:a.paymentMethod?String(a.paymentMethod):void 0,invoiceNotes:a.invoiceNotes?String(a.invoiceNotes):void 0,signature:a.signature?String(a.signature):void 0,isSigned:!!a.isSigned,signatureDate:a.signatureDate?String(a.signatureDate):void 0}}class It{static async generateInvoicePDF(t){console.log("üé® G√âN√âRATION PDF IDENTIQUE √Ä L'EXEMPLE HTML FOURNI"),console.log("üìÑ PDF SERVICE - DONN√âES RE√áUES:"),console.log("üî¢ Num√©ro facture:",t.invoiceNumber),console.log("üë§ Client:",t.clientName),console.log("üõí Products originaux:",t.products),console.log("üõí ANALYSE D√âTAILL√âE DES PRODUITS:"),!t.products||t.products.length===0?(console.error("‚ùå AUCUN PRODUIT RE√áU PAR LE PDF SERVICE !"),console.error("üîç Propri√©t√©s disponibles:",Object.keys(t))):t.products.forEach((n,o)=>{console.log(`üè∑Ô∏è Produit ${o+1} re√ßu par PDF:`,{name:n.name,quantity:n.quantity,priceTTC:n.priceTTC,discount:n.discount,discountType:n.discountType,TOUTES_PROPRIETES:n})});const s=new Ue({unit:"mm",format:"a4",compress:!0}),r=this.convertInvoiceData(t);return this.addHeaderLikeHTML(s,r),this.addInvoiceInfoLikeHTML(s,r),this.addClientSectionLikeHTML(s,r),this.addLogisticsSectionLikeHTML(s,r),this.addPaymentSectionLikeHTML(s,r),this.addProductsSectionLikeHTML(s,r),this.addTotalsLikeHTML(s,r),this.addFooterLikeHTML(s),console.log("‚úÖ PDF G√âN√âR√â IDENTIQUE √Ä L'EXEMPLE HTML"),s}static addHeaderLikeHTML(t,s){t.setFillColor(...this.COLORS.primary),t.rect(0,0,210,35,"F"),t.setTextColor(0,0,0),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("MyCoNfort",20,20),t.setTextColor(0,0,0),t.setFontSize(12),t.setFont("helvetica","normal"),t.text("Facturation professionnelle avec signature √©lectronique",20,28),s.signature&&(t.setFillColor(255,255,255,.2),t.roundedRect(160,12,35,10,2,2,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("SIGN√âE",177,18,{align:"center"}))}static addInvoiceInfoLikeHTML(t,s){t.setFillColor(...this.COLORS.white),t.rect(0,35,210,40,"F"),t.setTextColor(...this.COLORS.dark),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("MyCoNfort",20,50),t.setFontSize(10),t.setFont("helvetica","normal"),t.text("88 Avenue des Ternes",20,56),t.text("75017 Paris, France",20,61),t.text("SIRET: 824 313 530 00027",20,66),t.text("T√©l: 04 68 50 41 45",20,71),t.setFontSize(12),t.setFont("helvetica","bold"),t.text(`N¬∞ Facture: ${s.invoiceNumber}`,140,50),t.text(`Date: ${new Date(s.invoiceDate).toLocaleDateString("fr-FR")}`,140,56),s.eventLocation&&t.text(`Lieu: ${s.eventLocation}`,140,62)}static addClientSectionLikeHTML(t,s){t.setFillColor(...this.COLORS.primary),t.rect(0,75,210,12,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("INFORMATIONS CLIENT",105,82,{align:"center"}),t.setFillColor(...this.COLORS.grayLight),t.rect(0,87,210,25,"F"),t.setTextColor(...this.COLORS.dark),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Nom complet*",20,95),t.setFont("helvetica","normal"),t.text(s.clientName,20,100),t.setFont("helvetica","bold"),t.text("Adresse*",60,95),t.setFont("helvetica","normal"),t.text(s.clientAddress,60,100),t.setFont("helvetica","bold"),t.text("Code postal*",120,95),t.setFont("helvetica","normal"),t.text(s.clientPostalCode,120,100),t.setFont("helvetica","bold"),t.text("Ville*",150,95),t.setFont("helvetica","normal"),t.text(s.clientCity,150,100),t.setFont("helvetica","bold"),t.text("Email*",180,95),t.setFont("helvetica","normal"),t.text(s.clientEmail,180,100),t.setFont("helvetica","bold"),t.text("T√©l√©phone*",20,107),t.setFont("helvetica","normal"),t.text(s.clientPhone,50,107),s.clientDoorCode&&(t.setFont("helvetica","bold"),t.text("Code porte",120,107),t.setFont("helvetica","normal"),t.text(s.clientDoorCode,150,107))}static addLogisticsSectionLikeHTML(t,s){let r=115;t.setFillColor(...this.COLORS.blue),t.roundedRect(20,r,170,8,2,2,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("INFORMATIONS LOGISTIQUES",105,r+5,{align:"center"}),r+=12,s.deliveryMethod&&(t.setTextColor(...this.COLORS.dark),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("Mode de livraison:",20,r),t.setFont("helvetica","normal"),t.text(s.deliveryMethod,60,r),r+=8)}static addPaymentSectionLikeHTML(t,s){let r=135;t.setFillColor(...this.COLORS.primary),t.roundedRect(20,r,170,8,2,2,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("MODE DE REGLEMENT",105,r+5,{align:"center"}),r+=12,s.paymentMethod&&(t.setTextColor(...this.COLORS.dark),t.setFontSize(9),t.setFont("helvetica","bold"),t.text("M√©thode de paiement:",20,r),t.setFont("helvetica","normal"),t.text(s.paymentMethod,70,r),r+=8),t.setFont("helvetica","bold"),t.text("Signature client MyCoNfort:",20,r),s.signature&&(t.setTextColor(...this.COLORS.green),t.text("‚úì Signature √©lectronique enregistr√©e",80,r))}static addProductsSectionLikeHTML(t,s){let r=160;if(t.setFillColor(...this.COLORS.primary),t.rect(20,r,170,12,"F"),t.setTextColor(...this.COLORS.white),t.setFontSize(12),t.setFont("helvetica","bold"),t.text("Produits & Tarification",105,r+7,{align:"center"}),r+=20,s.signature){t.setTextColor(...this.COLORS.dark),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("SIGNATURE CLIENT",105,r,{align:"center"}),t.setDrawColor(...this.COLORS.grayBorder),t.setFillColor(...this.COLORS.grayLight),t.roundedRect(20,r+3,170,15,1,1,"FD");try{t.addImage(s.signature,"PNG",85,r+5,40,10,void 0,"FAST")}catch(o){console.warn("Erreur ajout signature:",o),t.setTextColor(153,153,153),t.setFontSize(8),t.text("[Signature √©lectronique valid√©e]",105,r+11,{align:"center"})}r+=25}console.log("üìä G√âN√âRATION TABLEAU PDF - data.items re√ßu:",s.items),console.log("üìä Nombre d'items pour le tableau:",s.items.length),s.items.forEach((o,i)=>{console.log(`üìä Item ${i+1} pour tableau PDF:`,{description:o.description,qty:o.qty,unitPriceHT:o.unitPriceHT,unitPriceTTC:o.unitPriceTTC,discount:o.discount,discountType:o.discountType,total:o.total,ITEM_COMPLET:o})});const n=s.items.map(o=>[o.qty.toString(),F(o.unitPriceHT),F(o.unitPriceTTC),o.discount>0?o.discountType==="percent"?`${o.discount}%`:F(o.discount):"-",F(o.total)]);console.log("üìä DONN√âES FORMAT√âES POUR LE TABLEAU:",n),Et(t,{startY:r,head:[["Quantit√©","PU HT","PU TTC","Remise","Total TTC"]],body:n,theme:"grid",headStyles:{fillColor:[...this.COLORS.primary],textColor:[...this.COLORS.white],fontSize:10,fontStyle:"bold",halign:"center",cellPadding:3},bodyStyles:{fontSize:9,cellPadding:3,textColor:[...this.COLORS.dark],halign:"center"},alternateRowStyles:{fillColor:[...this.COLORS.grayLight]},margin:{left:20,right:20}})}static addTotalsLikeHTML(t,s){const r=t.lastAutoTable.finalY+10;t.setTextColor(...this.COLORS.dark),t.setFontSize(12),t.setFont("helvetica","normal");let n=r+10;t.text("Total HT:",130,n),t.setFont("helvetica","bold"),t.text(F(s.totalHT),180,n,{align:"right"}),n+=8,t.setFont("helvetica","bold"),t.setFontSize(14),t.setTextColor(...this.COLORS.primary),t.text("TOTAL TTC:",130,n),t.text(F(s.totalTTC),180,n,{align:"right"}),s.depositAmount&&s.depositAmount>0&&(n+=12,t.setFont("helvetica","normal"),t.setFontSize(10),t.setTextColor(...this.COLORS.dark),t.text("Acompte vers√©:",130,n),t.setTextColor(...this.COLORS.blue),t.text(F(s.depositAmount),180,n,{align:"right"}),n+=6,t.setFont("helvetica","bold"),t.setTextColor(...this.COLORS.orange),t.text("RESTE √Ä PAYER:",130,n),t.text(F(s.totalTTC-s.depositAmount),180,n,{align:"right"}))}static addFooterLikeHTML(t){const s=t.internal.pageSize.height;t.setFillColor(...this.COLORS.primary),t.rect(0,s-30,210,30,"F"),t.setTextColor(0,0,0),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("MyCoNfort",105,s-20,{align:"center"}),t.setTextColor(0,0,0),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("Merci pour votre confiance !",105,s-14,{align:"center"}),t.setTextColor(0,0,0),t.setFontSize(8),t.setFont("helvetica","normal"),t.text("Votre sp√©cialiste en matelas et literie de qualit√©",105,s-10,{align:"center"}),t.text("88 Avenue des Ternes, 75017 Paris - T√©l: 04 68 50 41 45",105,s-6,{align:"center"}),t.text("Email: myconfort@gmail.com - SIRET: 824 313 530 00027",105,s-2,{align:"center"})}static async getCompressedPDFForEmail(t){console.log("üóúÔ∏è G√âN√âRATION PDF COMPRESS√â POUR ENVOI EMAIL (MAX 50KB)");try{const r=(await this.generateInvoicePDF(t)).output("blob"),n=Math.round(r.size/1024);if(console.log("üìä Taille PDF standard:",n,"KB"),n<=50)return console.log("‚úÖ PDF d√©j√† sous 50KB, aucune compression n√©cessaire"),{blob:r,sizeKB:n,compressed:!1};console.log("üîß PDF trop volumineux, g√©n√©ration version compress√©e...");const i=(await this.generateCompressedPDF(t)).output("blob"),l=Math.round(i.size/1024);return console.log("üìä Taille PDF compress√©:",l,"KB"),{blob:i,sizeKB:l,compressed:!0}}catch(s){throw console.error("‚ùå Erreur g√©n√©ration PDF compress√©:",s),s}}static async generateCompressedPDF(t){const s=new Ue({unit:"mm",format:"a4",compress:!0}),r=this.convertInvoiceData(t);return this.addCompressedHeader(s,r),this.addCompressedContent(s,r),this.addCompressedFooter(s),s}static addCompressedHeader(t,s){t.setFillColor(...this.COLORS.primary),t.rect(10,10,190,15,"F"),t.setTextColor(0,0,0),t.setFontSize(22),t.setFont("helvetica","bold"),t.text("MyCoNfort",15,20),t.setFontSize(10),t.text(`Facture: ${s.invoiceNumber}`,150,20)}static addCompressedContent(t,s){let r=35;t.setTextColor(...this.COLORS.dark),t.setFontSize(10),t.setFont("helvetica","bold"),t.text("CLIENT:",15,r),t.setFont("helvetica","normal"),t.text(s.clientName,15,r+5),t.text(s.clientEmail,15,r+10),r+=20,t.setFont("helvetica","bold"),t.text("PRODUITS:",15,r),r+=5,s.items.forEach(n=>{t.setFont("helvetica","normal"),t.text(`${n.qty}x ${n.description} - ${F(n.total)}`,15,r),r+=5}),r+=10,t.setFont("helvetica","bold"),t.setFontSize(12),t.text(`TOTAL TTC: ${F(s.totalTTC)}`,15,r)}static addCompressedFooter(t){const s=t.internal.pageSize.height;t.setTextColor(0,0,0),t.setFontSize(8),t.text("MyCoNfort - Merci de votre confiance !",105,s-10,{align:"center"})}static convertInvoiceData(t){var m,d,h;console.log("üîç CONVERTINVOICEDATA - Structure re√ßue:",{hasProducts:!!t.products,hasItems:!!t.items,hasProduits:!!t.produits,productsLength:((m=t.products)==null?void 0:m.length)||0,itemsLength:((d=t.items)==null?void 0:d.length)||0,produitsLength:((h=t.produits)==null?void 0:h.length)||0,STRUCTURE_COMPLETE:t});let s=[];t.products&&Array.isArray(t.products)&&t.products.length>0?(s=t.products,console.log("‚úÖ Utilisation de invoice.products:",s)):t.items&&Array.isArray(t.items)&&t.items.length>0?(s=t.items,console.log("‚úÖ Utilisation de invoice.items:",s)):t.produits&&Array.isArray(t.produits)&&t.produits.length>0?(s=t.produits,console.log("‚úÖ Utilisation de invoice.produits:",s)):(console.warn("‚ö†Ô∏è Aucun tableau de produits trouv√© dans la structure"),s=[]);const r=s.map((c,u)=>{console.log(`üè∑Ô∏è Mapping produit ${u+1}:`,{name:c.name||c.description||c.titre||c.libelle,quantity:c.quantity||c.qty||c.quantite||1,priceTTC:c.priceTTC||c.price||c.prix||c.unitPrice||0,STRUCTURE_PRODUIT:c});const g=c.name||c.description||c.titre||c.libelle||"Produit sans nom",v=c.quantity||c.qty||c.quantite||1,x=c.priceTTC||c.price||c.prix||c.unitPrice||0,p=c.category||c.categorie||"",N=c.discount||c.remise||0,y=c.discountType||c.typeRemise||"percentage";return{description:g,category:p,qty:v,unitPriceHT:te(x,t.taxRate),unitPriceTTC:x,discount:N,discountType:y,total:q(v,x,N,y)}});console.log("‚úÖ MAPPING TERMIN√â - Items g√©n√©r√©s pour le PDF:",r),console.log("üìä R√©sum√© du mapping:",{nombreItems:r.length,totalCalcul√©:r.reduce((c,u)=>c+u.total,0),premiersItems:r.slice(0,3).map(c=>({description:c.description,qty:c.qty,unitPriceTTC:c.unitPriceTTC,total:c.total}))});const n=r.reduce((c,u)=>c+u.total,0),o=n/(1+t.taxRate/100),i=n-o,l=r.reduce((c,u)=>{const g=u.unitPriceTTC*u.qty;return c+(g-u.total)},0);return{clientName:t.clientName,clientAddress:t.clientAddress,clientCity:t.clientCity,clientPostalCode:t.clientPostalCode,clientPhone:t.clientPhone,clientEmail:t.clientEmail,clientHousingType:t.clientHousingType,clientDoorCode:t.clientDoorCode,clientSiret:t.clientSiret,invoiceNumber:t.invoiceNumber,invoiceDate:t.invoiceDate,eventLocation:t.eventLocation,items:r,totalHT:o,totalTTC:n,totalTVA:i,totalDiscount:l,taxRate:t.taxRate,notes:t.invoiceNotes,advisorName:t.advisorName,paymentMethod:t.paymentMethod,depositAmount:t.montantAcompte,montantRestant:n-(t.montantAcompte||0),signature:t.signature,deliveryMethod:t.deliveryMethod,deliveryNotes:t.deliveryNotes,nombreChequesAVenir:t.nombreChequesAVenir}}static async downloadPDF(t){const s=await this.generateInvoicePDF(t),r=`facture_${t.invoiceNumber}.pdf`;s.save(r)}static async getPDFBlob(t){return console.log("üìé G√âN√âRATION BLOB PDF IDENTIQUE √Ä L'EXEMPLE HTML"),(await this.generateInvoicePDF(t)).output("blob")}}oe(It,"COLORS",{primary:[104,159,56],primaryDark:[124,179,66],cream:[242,239,226],dark:[51,51,51],white:[255,255,255],grayLight:[248,248,248],grayBorder:[221,221,221],red:[220,38,38],orange:[255,140,0],blue:[25,118,210],green:[76,175,80]});const Ys=()=>{const a={invoiceNumber:"TEST-001",invoiceDate:"2025-01-30",eventLocation:"Paris",taxRate:20,clientName:"Client Test",clientEmail:"test@example.com",clientPhone:"0123456789",clientAddress:"123 Rue Test",clientPostalCode:"75001",clientCity:"Paris",clientHousingType:"Appartement",clientDoorCode:"",clientSiret:"",products:[{name:"Matelas Test",category:"Literie",quantity:1,priceTTC:999.99,priceHT:833.33,totalHT:833.33,totalTTC:999.99,discount:0,discountType:"percent"},{name:"Oreiller Test",category:"Accessoires",quantity:2,priceTTC:89.9,priceHT:74.92,totalHT:149.84,totalTTC:179.8,discount:10,discountType:"percent"}],montantHT:0,montantTTC:0,montantTVA:0,montantRemise:0,paymentMethod:"Test",montantAcompte:0,montantRestant:0,deliveryMethod:"",deliveryNotes:"",signature:"",isSigned:!1,invoiceNotes:"",advisorName:"Test",termsAccepted:!0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},t=async()=>{console.log("üß™ TEST DIAGNOSTIC PDF"),console.log("üìã Invoice de test:",a);try{await It.downloadPDF(a),console.log("‚úÖ PDF g√©n√©r√© avec succ√®s")}catch(s){console.error("‚ùå Erreur g√©n√©ration PDF:",s)}};return e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h2",{children:"üî¨ Diagnostic PDF vs Aper√ßu"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginBottom:"20px"},children:[e.jsxs("div",{style:{border:"2px solid #3B82F6",borderRadius:"8px",padding:"16px"},children:[e.jsx("h3",{children:"üì± APER√áU HTML (invoice.products directement)"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#3B82F6",color:"white"},children:[e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Produit"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Qt√©"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Prix TTC"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Remise"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Total"})]})}),e.jsx("tbody",{children:a.products.map((s,r)=>{const n=q(s.quantity,s.priceTTC,s.discount,s.discountType==="percent"?"percent":"fixed");return e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:s.name}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"center"},children:s.quantity}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right"},children:F(s.priceTTC)}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right"},children:s.discount>0?`${s.discount}${s.discountType==="percent"?"%":"‚Ç¨"}`:"-"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd",textAlign:"right",fontWeight:"bold"},children:F(n)})]},r)})})]}),e.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#EBF8FF",borderRadius:"4px"},children:[e.jsx("strong",{children:"Total calcul√© dans l'aper√ßu :"}),e.jsx("br",{}),F(a.products.reduce((s,r)=>s+q(r.quantity,r.priceTTC,r.discount,r.discountType==="percent"?"percent":"fixed"),0))]})]}),e.jsxs("div",{style:{border:"2px solid #EF4444",borderRadius:"8px",padding:"16px"},children:[e.jsx("h3",{children:"üìÑ PDF (via convertInvoiceData)"}),e.jsxs("p",{style:{color:"#6B7280",fontSize:"14px"},children:["Le PDF utilise convertInvoiceData() qui mappe invoice.products vers data.items.",e.jsx("br",{}),'Cliquez sur "Tester PDF" et regardez les logs de la console pour voir ce qui se passe.']}),e.jsx("button",{onClick:t,style:{background:"#EF4444",color:"white",border:"none",padding:"12px 24px",borderRadius:"6px",cursor:"pointer",fontWeight:"bold"},children:"üß™ Tester G√©n√©ration PDF"}),e.jsxs("div",{style:{marginTop:"16px",padding:"12px",background:"#FEF2F2",borderRadius:"4px"},children:[e.jsx("strong",{children:"Instructions :"}),e.jsx("br",{}),'1. Cliquez sur "Tester PDF"',e.jsx("br",{}),"2. Regardez les logs de la console",e.jsx("br",{}),"3. Comparez les montants dans le PDF g√©n√©r√©",e.jsx("br",{}),"4. Si les montants diff√®rent, le probl√®me est dans convertInvoiceData()"]})]})]}),e.jsxs("div",{style:{background:"#F3F4F6",padding:"16px",borderRadius:"8px"},children:[e.jsx("h4",{children:"üîç Structure de test utilis√©e :"}),e.jsx("pre",{style:{fontSize:"12px",overflow:"auto"},children:JSON.stringify(a.products,null,2)})]})]})},Ks=({invoice:a,onSuccess:t,onError:s})=>{const[r,n]=f.useState(null),[o,i]=f.useState(!1),[l,m]=f.useState("payload"),[d,h]=f.useState(!1),c=async()=>{var x,p,N;try{console.log("üîç G√âN√âRATION PAYLOAD DEBUG - DIAGNOSTIC COMPLET");const y="JVBERi0xLjQKJcOkw7zDtsO4CjIgMCBvYmoKPDwKL0xlbmd0aCAzIDAgUgo+PgpzdHJlYW0K",P=150;console.group("üìã DONN√âES BRUTES INVOICE"),console.log("Invoice object:",{invoiceNumber:a.invoiceNumber,clientName:a.clientName,clientEmail:a.clientEmail,clientPhone:a.clientPhone,products:a.products.length,paymentMethod:a.paymentMethod,totalProducts:a.products.reduce((E,A)=>E+A.quantity*A.priceTTC,0)}),console.groupEnd();const b=Lt.validateAndPrepare(a,y,P),C={timestamp:new Date().toISOString(),validation:b,rawInvoice:a,payloadSize:b.payload?JSON.stringify(b.payload).length:0,fieldMapping:{"clientName ‚Üí clientName":a.clientName,"clientEmail ‚Üí clientEmail":a.clientEmail,"clientPhone ‚Üí clientPhone":a.clientPhone,"clientAddress ‚Üí clientAddress":a.clientAddress,"products.length ‚Üí products":a.products.length,"paymentMethod ‚Üí paymentMethod":a.paymentMethod,"calculated totalHT":(x=b.payload)==null?void 0:x.totalHT,"calculated totalTTC":(p=b.payload)==null?void 0:p.totalTTC},requiredFieldsCheck:{clientEmail:!!a.clientEmail,clientPhone:!!a.clientPhone,clientName:!!a.clientName,invoiceNumber:!!a.invoiceNumber,products:a.products.length>0,paymentMethod:!!a.paymentMethod},stats:{jsonSize:b.payload?JSON.stringify(b.payload).length:0,productsCount:a.products.length,pdfSizeKB:P,hasSignature:!!a.signature,termsAccepted:a.termsAccepted}};n(C),b.isValid?t("‚úÖ Payload g√©n√©r√© et valid√© avec succ√®s"):s(`‚ùå Erreurs de validation: ${(N=b.errors)==null?void 0:N.join(", ")}`)}catch(y){s(`‚ùå Erreur g√©n√©ration payload: ${y.message}`)}},u=async()=>{i(!0);try{const x=await je.testConnection();x.success?t(x.message):s(x.message)}catch(x){s(`‚ùå Erreur test connexion: ${x.message}`)}finally{i(!1)}},g=()=>{var x;(x=r==null?void 0:r.validation)!=null&&x.payload?(navigator.clipboard.writeText(JSON.stringify(r.validation.payload,null,2)),t("üìã Payload copi√© dans le presse-papiers")):s("‚ùå Aucun payload √† copier. G√©n√©rez d'abord le payload.")},v=()=>{if(r){const x=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),p=URL.createObjectURL(x),N=document.createElement("a");N.href=p,N.download=`debug-payload-${a.invoiceNumber}-${Date.now()}.json`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(p),t("üì• Fichier de debug t√©l√©charg√©")}else s("‚ùå Aucune donn√©e de debug √† t√©l√©charger")};return e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-orange-100 p-2 rounded-full",children:e.jsx(Pe,{className:"w-6 h-6 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Centre de Debug"}),e.jsx("p",{className:"text-gray-600",children:"Diagnostic et validation du payload N8N"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"G√©n√©rer Payload"})]}),e.jsxs("button",{onClick:u,disabled:o,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(Ve,{className:"w-4 h-4"}),e.jsx("span",{children:o?"Test...":"Test N8N"})]})]})]}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[{id:"payload",label:"Payload",icon:ut},{id:"connection",label:"Connexion",icon:xt},{id:"logs",label:"Logs",icon:de},{id:"pdf",label:"Test PDF",icon:rt}].map(({id:x,label:p,icon:N})=>e.jsxs("button",{onClick:()=>m(x),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-md font-medium transition-all ${l===x?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:[e.jsx(N,{className:"w-4 h-4"}),e.jsx("span",{children:p})]},x))}),e.jsxs("div",{className:"space-y-4",children:[l==="payload"&&e.jsx(qe,{title:"Validation du Payload",icon:ut,iconColor:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",children:r?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:`p-4 rounded-lg ${r.validation.isValid?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.validation.isValid?e.jsx(fe,{className:"w-5 h-5 text-green-500"}):e.jsx(Pt,{className:"w-5 h-5 text-red-500"}),e.jsx("h4",{className:`font-bold ${r.validation.isValid?"text-green-800":"text-red-800"}`,children:r.validation.isValid?"Validation R√©ussie":"Erreurs de Validation"})]}),!r.validation.isValid&&r.validation.errors&&e.jsx("ul",{className:"list-disc ml-5 space-y-1 text-red-700",children:r.validation.errors.map((x,p)=>e.jsx("li",{className:"text-sm",children:x},p))})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"üó∫Ô∏è Mapping des Champs"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm",children:Object.entries(r.fieldMapping).map(([x,p])=>{const N=p!=null&&p!=="";return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:N?"text-green-600":"text-red-600",children:N?"‚úÖ":"‚ùå"}),e.jsxs("span",{className:"font-medium",children:[x,":"]}),e.jsx("span",{className:"text-gray-600 truncate",children:typeof p=="string"&&p.length>20?`${p.substring(0,20)}...`:String(p||"MANQUANT")})]},x)})})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-yellow-800 mb-3",children:"‚ö†Ô∏è Champs Obligatoires"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 text-sm",children:Object.entries(r.requiredFieldsCheck).map(([x,p])=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:p?"text-green-600":"text-red-600",children:p?"‚úÖ":"‚ùå"}),e.jsx("span",{className:p?"text-gray-700":"text-red-700 font-medium",children:x})]},x))})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:g,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(St,{className:"w-4 h-4"}),e.jsx("span",{children:"Copier Payload"})]}),e.jsxs("button",{onClick:v,className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 font-medium transition-all",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{children:"T√©l√©charger Debug"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Aucun payload g√©n√©r√©"}),e.jsx("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium",children:"G√©n√©rer le Payload Debug"})]})}),l==="connection"&&e.jsx(qe,{title:"Test de Connexion N8N",icon:xt,iconColor:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-2",children:"Configuration Webhook"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"URL:"})," ","https://n8n.srv765811.hstgr.cloud/webhook/facture-universelle"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"M√©thode:"})," POST"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Content-Type:"})," application/json"]})]})]}),e.jsxs("button",{onClick:u,disabled:o,className:"w-full bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-6 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),e.jsx("span",{children:o?"Test en cours...":"Tester la Connexion N8N"})]})]})}),l==="logs"&&e.jsx(qe,{title:"Logs de Debug",icon:de,iconColor:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-xs overflow-auto max-h-64",children:[e.jsx("div",{children:"üìã Console Logs (ouvrez la console du navigateur pour voir les logs d√©taill√©s)"}),e.jsx("div",{children:"üîç Payload complet √† envoyer: [Voir console]"}),e.jsx("div",{children:"‚ö†Ô∏è Champs manquants: [Voir console]"}),e.jsx("div",{children:"üó∫Ô∏è Mapping des donn√©es: [Voir console]"}),e.jsx("div",{children:"üìä Statistiques payload: [Voir console]"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-800 mb-2",children:"üí° Instructions Debug"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-1 text-sm text-blue-700",children:[e.jsx("li",{children:"Ouvrez la console du navigateur (F12)"}),e.jsx("li",{children:"G√©n√©rez un payload pour voir les logs d√©taill√©s"}),e.jsx("li",{children:"V√©rifiez que tous les champs requis sont pr√©sents"}),e.jsx("li",{children:"Copiez le payload pour le tester dans Postman"}),e.jsx("li",{children:'Dans n8n, activez "Listen for test event" pour voir les donn√©es re√ßues'})]})]})]})}),l==="pdf"&&e.jsx(qe,{title:"ÔøΩ Diagnostic PDF vs Aper√ßu",icon:rt,iconColor:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-red-800 mb-2",children:"ÔøΩ Probl√®me Identifi√©"}),e.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Le PDF g√©n√©r√© affiche des montants diff√©rents de l'aper√ßu HTML. Ce diagnostic compare les deux sources de donn√©es."}),e.jsxs("ul",{className:"list-disc ml-5 space-y-1 text-sm text-red-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Aper√ßu HTML :"})," Utilise"," ",e.jsx("code",{children:"invoice.products"})," directement"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Service PDF :"})," Utilise"," ",e.jsx("code",{children:"convertInvoiceData()"})," pour mapper les donn√©es"]}),e.jsx("li",{children:"Le probl√®me est probablement dans le mapping des produits"})]})]}),e.jsx(Ys,{}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-blue-800 mb-2",children:"üí° Instructions de Test"}),e.jsxs("ol",{className:"list-decimal ml-5 space-y-1 text-sm text-blue-700",children:[e.jsx("li",{children:"Comparez les montants dans les deux colonnes ci-dessus"}),e.jsx("li",{children:'Cliquez sur "Tester G√©n√©ration PDF" (colonne droite)'}),e.jsx("li",{children:"Regardez les logs dans la console du navigateur (F12)"}),e.jsx("li",{children:"V√©rifiez que le PDF t√©l√©charg√© a les bons montants"}),e.jsxs("li",{children:["Si les montants diff√®rent, le probl√®me est dans"," ",e.jsx("code",{children:"convertInvoiceData()"})]})]})]})]})})]}),r&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-gray-800 mb-3",children:"üìä Statistiques Debug"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:r.stats.jsonSize}),e.jsx("div",{className:"text-gray-600",children:"Caract√®res JSON"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:r.stats.productsCount}),e.jsx("div",{className:"text-gray-600",children:"Produits"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:r.stats.pdfSizeKB}),e.jsx("div",{className:"text-gray-600",children:"KB PDF"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:r.stats.hasSignature?"‚úÖ":"‚ùå"}),e.jsx("div",{className:"text-gray-600",children:"Signature"})]})]})]})]})},Js=({isOpen:a,onClose:t,onSave:s})=>{const r=f.useRef(null),[n,o]=f.useState(!1),[i,l]=f.useState(null);f.useEffect(()=>{a&&r.current&&ns(()=>import("./ui-utils-Bfb2iWCB.js").then(h=>h.s),[]).then(h=>{const c=h.default,u=r.current,g=u.getBoundingClientRect();u.width=g.width*window.devicePixelRatio,u.height=g.height*window.devicePixelRatio,u.getContext("2d").scale(window.devicePixelRatio,window.devicePixelRatio);const x=new c(u,{backgroundColor:"rgb(255, 255, 255)",penColor:"rgb(0, 0, 0)",minWidth:1,maxWidth:3});l(x);const p=()=>o(!0),N=()=>o(!1);return u.addEventListener("mousedown",p),u.addEventListener("touchstart",p),u.addEventListener("mouseup",N),u.addEventListener("touchend",N),()=>{u.removeEventListener("mousedown",p),u.removeEventListener("touchstart",p),u.removeEventListener("mouseup",N),u.removeEventListener("touchend",N)}})},[a]);const m=()=>{i&&i.clear()},d=()=>{if(i&&!i.isEmpty()){const h=i.toDataURL();s(h),t()}else alert("Veuillez fournir une signature avant de valider.")};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h3",{className:"text-xl font-bold text-[#14281D]",children:"Signature du client"}),e.jsx("button",{onClick:t,className:"text-gray-500 hover:text-gray-700 transition-colors",children:e.jsx(be,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"border-2 border-gray-300 rounded mb-4 bg-white",children:e.jsx("canvas",{ref:r,className:"w-full h-48 touch-none",style:{touchAction:"none"}})}),e.jsx("div",{className:"text-sm text-gray-600 mb-4 text-center",children:n?"Signature en cours...":"Signez dans la zone ci-dessus"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("button",{onClick:m,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all",children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{children:"Effacer"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-all",children:"Annuler"}),e.jsxs("button",{onClick:d,className:"bg-[#477A0C] hover:bg-[#3A6A0A] text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-all",children:[e.jsx(os,{className:"w-4 h-4"}),e.jsx("span",{children:"Valider"})]})]})]})]})]})}):null},Qs=({message:a,type:t,show:s,onClose:r})=>(_e.useEffect(()=>{if(s){const n=setTimeout(r,3e3);return()=>clearTimeout(n)}},[s,r]),s?e.jsx("div",{className:`fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50 transition-all duration-300 ${s?"translate-y-0 opacity-100":"translate-y-2 opacity-0"}`,children:e.jsxs("div",{className:`flex items-center space-x-2 px-6 py-4 rounded-lg shadow-xl border-2 max-w-md ${t==="success"?"bg-green-50 text-green-800 border-green-200":t==="error"?"bg-red-50 text-red-800 border-red-200":t==="warning"?"bg-orange-50 text-orange-800 border-orange-200":"bg-blue-50 text-blue-800 border-blue-200"}`,children:[t==="success"?e.jsx(fe,{className:"w-6 h-6 text-green-600"}):t==="error"?e.jsx(Fe,{className:"w-6 h-6 text-red-600"}):t==="warning"?e.jsx(Pt,{className:"w-6 h-6 text-orange-600"}):e.jsx(is,{className:"w-6 h-6 text-blue-600"}),e.jsx("span",{className:"font-medium",children:a})]})}):null),Rt=a=>{localStorage.setItem("myconfortClients",JSON.stringify(a))},lt=()=>{const a=localStorage.getItem("myconfortClients");return a?JSON.parse(a):[]},Xs=a=>{localStorage.setItem("myconfortInvoiceDraft",JSON.stringify(a))},Zs=()=>{const a=localStorage.getItem("myconfortInvoiceDraft");return a?JSON.parse(a):null},er=a=>{const t=lt(),s=t.findIndex(r=>r.email===a.email&&r.name===a.name);s>=0?t[s]={...t[s],...a}:t.push({...a,id:Date.now().toString(),createdAt:new Date().toISOString()}),Rt(t)},Ot=a=>{localStorage.setItem("myconfortInvoices",JSON.stringify(a))},Se=()=>{const a=localStorage.getItem("myconfortInvoices");return a?JSON.parse(a):[]},Mt=a=>{const t=Se(),s=t.findIndex(r=>r.invoiceNumber===a.invoiceNumber);s>=0?t[s]={...a,updatedAt:new Date().toISOString()}:t.push({...a,createdAt:new Date().toISOString()}),Ot(t)},tr=a=>{const s=Se().filter(r=>r.invoiceNumber!==a);Ot(s)};function sr(){const a=Le(),[t,s]=f.useState({invoiceNumber:at(),invoiceDate:new Date().toISOString().split("T")[0],eventLocation:"",taxRate:20,clientName:"",clientEmail:"",clientPhone:"",clientAddress:"",clientAddressLine2:"",clientPostalCode:"",clientCity:"",clientHousingType:"",clientDoorCode:"",clientSiret:"",products:[],montantHT:0,montantTTC:0,montantTVA:0,montantRemise:0,paymentMethod:"",montantAcompte:0,depositPaymentMethod:"",montantRestant:0,deliveryMethod:"",deliveryAddress:"",deliveryNotes:"",signature:"",isSigned:!1,signatureDate:void 0,invoiceNotes:"",advisorName:"",termsAccepted:!1,nombreChequesAVenir:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),[r,n]=f.useState([]),[o,i]=f.useState([]),[l,m]=f.useState(!1),[d,h]=f.useState(!1),[c,u]=f.useState(!1),[g,v]=f.useState(!1),[x,p]=f.useState(!1),[N,y]=f.useState(!1),[P,b]=f.useState(!1),[C,E]=f.useState(!1),[A,k]=f.useState(!1),[D,T]=f.useState(!0),[O,U]=f.useState({show:!1,message:"",type:"success"});f.useEffect(()=>{n(lt()),i(Se());const w=Zs();w&&(s(w),L("Brouillon charg√©","success"));const S=setInterval(()=>{_()},6e4);return()=>clearInterval(S)},[]);const L=(w,S="success")=>{U({show:!0,message:w,type:S})},B=()=>{U(w=>({...w,show:!1}))},_=()=>{try{if(Xs(t),t.clientName&&t.clientEmail){const w={name:t.clientName,address:t.clientAddress,postalCode:t.clientPostalCode,city:t.clientCity,phone:t.clientPhone,email:t.clientEmail},S=V(w);er(S),n(lt())}L("Brouillon enregistr√©","success")}catch{L("Erreur lors de l'enregistrement","error")}},ee=()=>{try{if(!t.clientName||!t.clientEmail||t.products.length===0){L("Veuillez compl√©ter les informations client et ajouter au moins un produit","error");return}Mt(t),i(Se()),L(`Facture ${t.invoiceNumber} enregistr√©e avec succ√®s`,"success")}catch{L("Erreur lors de l'enregistrement de la facture","error")}},V=w=>{console.log("üßπ NETTOYAGE DES DONN√âES CLIENT:",w);const S=X=>typeof X!="string"?"":X.replace(/[\\"]*/g,"").replace(/\s+/g," ").trim(),z={...w,name:S(w.name||""),address:S(w.address||""),addressLine2:S(w.addressLine2||""),postalCode:S(w.postalCode||""),city:S(w.city||""),phone:S(w.phone||""),email:S(w.email||""),housingType:S(w.housingType||""),doorCode:S(w.doorCode||""),siret:S(w.siret||"")};z.email&&!z.email.includes("@")&&console.warn("‚ö†Ô∏è Email invalide d√©tect√©:",z.email);const Y=["@","rue","avenue","boulevard"];return z.name&&Y.some(X=>z.name.toLowerCase().includes(X))&&console.warn("‚ö†Ô∏è Le nom contient des donn√©es suspectes:",z.name),console.log("‚úÖ DONN√âES NETTOY√âES:",z),z},me=()=>{const w=[];return(!t.invoiceDate||t.invoiceDate.trim()==="")&&w.push("Date de la facture obligatoire"),(!t.eventLocation||t.eventLocation.trim()==="")&&w.push("Lieu de l'√©v√©nement obligatoire"),(!t.clientName||t.clientName.trim()==="")&&w.push("Nom complet du client obligatoire"),(!t.clientAddress||t.clientAddress.trim()==="")&&w.push("Adresse du client obligatoire"),(!t.clientPostalCode||t.clientPostalCode.trim()==="")&&w.push("Code postal du client obligatoire"),(!t.clientCity||t.clientCity.trim()==="")&&w.push("Ville du client obligatoire"),(!t.clientPhone||t.clientPhone.trim()==="")&&w.push("T√©l√©phone du client obligatoire"),(!t.clientEmail||t.clientEmail.trim()==="")&&w.push("Email du client obligatoire"),t.clientEmail&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.clientEmail)&&w.push("Format d'email invalide"),t.products.length===0&&w.push("Au moins un produit obligatoire"),{isValid:w.length===0,errors:w}},Ie=async()=>{console.log("üöÄ D√âBUT G√âN√âRATION PDF AVEC SERVICE UNIFI√â");try{const w=await it.generateInvoicePDF(t),S=Math.round(w.size/1024);return console.log("üéâ PDF g√©n√©r√© avec service unifi√© - Analyse:",{taille:S+"KB",pages:"2 pages (Facture + CGV)",source:"PDFService unifi√© (jsPDF + autotable)",format:"A4 professionnel",contientLogo:!0,contientCGV:!0}),w}catch(w){throw console.error("‚ùå Erreur lors de la g√©n√©ration PDF:",w),new Error(`Erreur g√©n√©ration PDF: ${(w==null?void 0:w.message)||"Erreur inconnue"}`)}},ne=async()=>{const w=me();if(!w.isValid){L(`Impossible de t√©l√©charger le PDF. Champs obligatoires manquants: ${w.errors.join(", ")}`,"error");return}_(),ee(),L("G√©n√©ration et t√©l√©chargement du PDF MYCONFORT en cours...","success");try{console.log("üîç T√âL√âCHARGEMENT PDF - Utilisation du m√™me PDF que webhook (HTML-based)");const S=await Ie();if(!S)throw new Error("Erreur lors de la g√©n√©ration du PDF");const z=URL.createObjectURL(S),Y=document.createElement("a");Y.href=z,Y.download=`facture-${t.invoiceNumber}.pdf`,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(z);const X=Math.round(S.size/1024);console.log("‚úÖ PDF t√©l√©charg√© avec succ√®s:",{fileName:`facture-${t.invoiceNumber}.pdf`,sizeKB:X,source:"generatePDFBlobFromPreview (HTML-based)",contientSignature:!!t.signature}),L(`PDF MYCONFORT t√©l√©charg√© avec succ√®s${t.signature?" (avec signature √©lectronique)":""} - ${X}KB`,"success")}catch(S){console.error("‚ùå PDF download error:",S),L(`Erreur lors du t√©l√©chargement du PDF: ${(S==null?void 0:S.message)||"Erreur inconnue"}`,"error")}},ue=async()=>{const w=me();if(!w.isValid){L(`Impossible d'envoyer le PDF. Champs obligatoires manquants: ${w.errors.join(", ")}`,"error");return}_(),ee(),L("üì§ Pr√©paration de l'envoi du PDF MYCONFORT...","success");try{console.log("üîç DIAGNOSTIC AVANT G√âN√âRATION PDF");const S={...t,clientName:V({name:t.clientName}).name,clientAddress:V({address:t.clientAddress}).address,clientAddressLine2:V({addressLine2:t.clientAddressLine2}).addressLine2,clientCity:V({city:t.clientCity}).city,clientEmail:V({email:t.clientEmail}).email,clientPhone:V({phone:t.clientPhone}).phone};console.log("üìã Invoice data NETTOY√â:",S),console.log("üìã Invoice data structure check:",{invoiceNumber:S.invoiceNumber,clientName:S.clientName,clientEmail:S.clientEmail,clientPhone:S.clientPhone,clientAddress:S.clientAddress,clientCity:S.clientCity,clientPostalCode:S.clientPostalCode,productsCount:S.products.length,paymentMethod:S.paymentMethod,montantAcompte:S.montantAcompte,advisorName:S.advisorName,eventLocation:S.eventLocation,taxRate:S.taxRate,termsAccepted:S.termsAccepted,totalCalculated:S.products.reduce((Xe,Re)=>Xe+Re.quantity*Re.priceTTC,0)});const z=await Ie();if(!z){console.error("‚ùå PDF Blob generation failed"),L("‚ùå Erreur lors de la g√©n√©ration du PDF","error");return}const Y=await new Promise((Xe,Re)=>{const Oe=new FileReader;Oe.onload=()=>Xe(Oe.result.split(",")[1]),Oe.onerror=()=>Re(new Error("Erreur conversion PDF en Base64")),Oe.readAsDataURL(z)}),X=Math.round(z.size/1024);if(!S.clientEmail||S.clientEmail.trim()===""){L("‚ùå Email client obligatoire pour l'envoi N8N","error");return}if(!S.clientEmail.includes("@")){L("‚ùå Format d'email client invalide","error");return}console.log("üìÑ PDF g√©n√©r√©:",{sizeKB:X,base64Length:Y.length,base64Preview:Y.substring(0,50)+"..."}),L("üîê Validation et envoi vers N8N...","success");const Ne=await je.sendInvoiceToN8n(S,Y);if(Ne.success)L(Ne.message,"success");else throw new Error(Ne.message)}catch(S){const z=S instanceof Error?S.message:"Erreur inconnue";console.error("‚ùå Erreur envoi PDF via N8N:",S),L(`‚ùå Erreur d'envoi N8N: ${z}`,"error")}},xe=()=>{const w=me();if(!w.isValid){L(`Impossible d'imprimer. Champs obligatoires manquants: ${w.errors.join(", ")}`,"error");return}_(),ee(),L("üìÑ Pr√©paration impression A4 professionnelle (2 pages)...","success");try{const S=document.getElementById("invoice-preview-section");if(!S){L("‚ùå Aper√ßu de facture non trouv√©","error");return}console.log("üìÑ IMPRESSION: Facture compl√®te (2 pages), dimensions:",{width:S.offsetWidth,height:S.offsetHeight});const z=document.body.innerHTML,Y=document.title,X=`
        <style>
          @page {
            size: A4;
            margin: 0;
          }
          
          .page {
            width: 210mm;      /* Largeur A4 exacte */
            min-height: 297mm; /* Hauteur A4 exacte */
            padding: 15mm;     /* Marges uniformes */
            page-break-after: always;
            box-sizing: border-box;
            margin: 0 auto;
            background: white;
          }
          
          body { 
            font-family: 'Inter', Arial, sans-serif; 
            margin: 0; 
            padding: 0; 
            background: white; 
            font-size: 12px; 
            line-height: 1.4; 
            color: #2D3748;
          }
          
          /* Respecter les sauts de page originaux */
          div[style*="pageBreakBefore: 'always'"] {
            page-break-before: always !important;
          }
          
          /* Conserver les couleurs et styles originaux */
          .bg-\\[\\#477A0C\\] { background: #477A0C !important; }
          .bg-\\[\\#F2EFE2\\] { background: #F2EFE2 !important; }
          .bg-white { background: white !important; }
          .text-white { color: white !important; }
          
          /* Tailles de texte optimis√©es pour A4 */
          h1 { font-size: 18px !important; margin: 8px 0 !important; }
          h2 { font-size: 16px !important; margin: 6px 0 !important; }
          h3 { font-size: 14px !important; margin: 4px 0 !important; }
          p { margin: 4px 0 !important; font-size: 11px !important; }
          
          table { 
            border-collapse: collapse; 
            width: 100%; 
            margin: 8px 0 !important; 
            font-size: 10px !important; 
          }
          table th, table td { 
            border: 1px solid #ddd; 
            padding: 6px !important; 
            line-height: 1.3; 
          }
          table th { 
            background: #f5f5f5 !important; 
            font-weight: bold; 
          }
          
          /* Ajustements de mise en page pour A4 */
          .p-4, .p-6 { padding: 8px !important; }
          .mb-4, .mb-6 { margin-bottom: 8px !important; }
          .rounded-xl, .rounded-lg { border-radius: 8px !important; }
        </style>
      `;document.title="Impression Facture MyConfort - A4 Professionnel (2 pages)";const Ne=`
        <div class="page">
          ${S.outerHTML}
        </div>
      `;document.body.innerHTML=X+Ne,setTimeout(()=>{window.print(),setTimeout(()=>{document.body.innerHTML=z,document.title=Y,L("‚úÖ Impression A4 termin√©e (format professionnel)","success")},1e3)},500)}catch(S){console.error("Erreur impression:",S),L("‚ùå Erreur lors de l'impression","error")}},j=w=>{ee(),L(w,"success")},R=w=>{L(w,"error")},I=w=>{console.log("üîç CHARGEMENT CLIENT - Donn√©es brutes:",w);const S=V(w);s(z=>({...z,clientName:S.name,clientAddress:S.address,clientAddressLine2:S.addressLine2,clientPostalCode:S.postalCode,clientCity:S.city,clientPhone:S.phone,clientEmail:S.email})),m(!1),L("Client charg√© avec succ√®s (donn√©es nettoy√©es)","success")},K=w=>{const S=r.filter((z,Y)=>Y!==w);n(S),Rt(S),L("Client supprim√©","success")},H=w=>{s(w),L(`Facture ${w.invoiceNumber} charg√©e avec succ√®s`,"success")},ae=w=>{const S=o[w];S&&(tr(S.invoiceNumber),i(Se()),L(`Facture ${S.invoiceNumber} supprim√©e`,"success"))},se=w=>{s(S=>({...S,signature:w})),L("Signature enregistr√©e - Facture pr√™te pour envoi !","success")},W=()=>{window.confirm(`Cr√©er une nouvelle facture ?

Les donn√©es actuelles seront perdues si elles ne sont pas sauvegard√©es.`)&&(s({invoiceNumber:at(),invoiceDate:new Date().toISOString().split("T")[0],eventLocation:"",taxRate:20,clientName:"",clientEmail:"",clientPhone:"",clientAddress:"",clientAddressLine2:"",clientPostalCode:"",clientCity:"",clientHousingType:"",clientDoorCode:"",clientSiret:"",products:[],montantHT:0,montantTTC:0,montantTVA:0,montantRemise:0,paymentMethod:"",montantAcompte:0,montantRestant:0,deliveryMethod:"",deliveryNotes:"",signature:"",isSigned:!1,signatureDate:"",invoiceNotes:"",advisorName:"",termsAccepted:!1,nombreChequesAVenir:0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),L("‚úÖ Nouvelle facture cr√©√©e avec succ√®s !","success"))},Qe=me();return e.jsxs("div",{className:"min-h-screen font-['Inter'] text-gray-100",style:{backgroundColor:"#14281D"},children:[e.jsx(ys,{onShowClients:()=>m(!0),onShowInvoices:()=>h(!0),onShowProducts:()=>u(!0),onShowGoogleDrive:ue,onShowDebug:()=>E(!0),onGoToIpad:()=>a("/ipad?step=facture")}),e.jsxs("main",{className:"container mx-auto px-4 py-6",id:"invoice-content",children:[e.jsx("div",{className:"text-white rounded-xl shadow-xl p-6 mb-6",style:{background:"linear-gradient(135deg, #477A0C 0%, #5A8F0F 25%, #3A6A0A 50%, #6BA015 75%, #477A0C 100%)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-white/20 p-3 rounded-full",children:e.jsx("span",{className:"text-2xl",children:"üå∏"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"MYCONFORT"}),e.jsx("p",{className:"text-green-100",children:"Facturation professionnelle avec signature √©lectronique"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-blue-100",children:"Statut de la facture"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[Qe.isValid?e.jsxs("div",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[e.jsx("span",{children:"‚úÖ"}),e.jsx("span",{children:"COMPL√àTE"})]}):e.jsxs("div",{className:"bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[e.jsx("span",{children:"‚ö†Ô∏è"}),e.jsx("span",{children:"INCOMPL√àTE"})]}),t.signature&&e.jsxs("div",{className:"bg-green-500 text-white px-3 py-1 rounded-full text-sm font-semibold flex items-center space-x-1",children:[e.jsx("span",{children:"üîí"}),e.jsx("span",{children:"SIGN√âE"})]}),e.jsxs("button",{onClick:W,className:"bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-semibold flex items-center space-x-2 transition-all hover:scale-105 shadow-md",title:"Cr√©er une nouvelle facture",children:[e.jsx("span",{children:"üìù"}),e.jsx("span",{children:"Nouvelle facture"})]})]})]})]})}),C&&e.jsx("div",{className:"mb-6",children:e.jsx(Ks,{invoice:t,onSuccess:j,onError:R})}),e.jsx(vs,{invoice:t,onUpdate:w=>s(S=>({...S,...w}))}),e.jsx("div",{id:"client-section",children:e.jsx(js,{client:{name:t.clientName,address:t.clientAddress,addressLine2:t.clientAddressLine2,postalCode:t.clientPostalCode,city:t.clientCity,phone:t.clientPhone,email:t.clientEmail,housingType:t.clientHousingType,doorCode:t.clientDoorCode,siret:t.clientSiret||""},onUpdate:w=>s(S=>({...S,clientName:w.name,clientAddress:w.address,clientAddressLine2:w.addressLine2,clientPostalCode:w.postalCode,clientCity:w.city,clientPhone:w.phone,clientEmail:w.email,clientHousingType:w.housingType||"",clientDoorCode:w.doorCode||"",clientSiret:w.siret||""}))})}),e.jsx("div",{id:"products-section",children:e.jsx(Es,{products:t.products,onUpdate:w=>s(S=>({...S,products:w})),taxRate:t.taxRate,invoiceNotes:t.invoiceNotes,onNotesChange:w=>s(S=>({...S,invoiceNotes:w})),acompteAmount:t.montantAcompte,onAcompteChange:w=>s(S=>({...S,montantAcompte:w})),paymentMethod:t.paymentMethod,onPaymentMethodChange:w=>s(S=>({...S,paymentMethod:w})),advisorName:t.advisorName,onAdvisorNameChange:w=>s(S=>({...S,advisorName:w})),termsAccepted:t.termsAccepted,onTermsAcceptedChange:w=>s(S=>({...S,termsAccepted:w})),signature:t.signature,onShowSignaturePad:()=>k(!0),nombreChequesAVenir:t.nombreChequesAVenir||0,onNombreChequesAVenirChange:w=>s(S=>({...S,nombreChequesAVenir:w}))})}),e.jsxs("div",{id:"delivery-section",className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsx("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"INFORMATIONS LOGISTIQUES"})}),e.jsxs("div",{className:"bg-[#F2EFE2] rounded-lg p-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"Mode de livraison"}),e.jsxs("select",{value:t.deliveryMethod,onChange:w=>s(S=>({...S,deliveryMethod:w.target.value})),className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold",children:[e.jsx("option",{value:"",children:"S√©lectionner"}),e.jsx("option",{value:"Colissimo 48 heures",children:"Colissimo 48 heures"}),e.jsx("option",{value:"Livraison par transporteur",children:"Livraison par transporteur"}),e.jsx("option",{value:"Retrait en magasin",children:"Retrait en magasin"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"Pr√©cisions de livraison"}),e.jsx("textarea",{value:t.deliveryNotes,onChange:w=>s(S=>({...S,deliveryNotes:w.target.value})),className:"w-full border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold h-20",placeholder:"Instructions sp√©ciales, √©tage, code d'acc√®s..."})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg text-black italic font-semibold",children:e.jsx("p",{children:"üì¶ Livraison estim√©e sous 48 heures. Les d√©lais sont donn√©s √† titre indicatif et ne sont pas contractuels."})})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-[#477A0C] flex items-center",children:[e.jsx("span",{className:"mr-3",children:"üìÑ"}),"APER√áU DE LA FACTURE"]}),e.jsx("button",{onClick:()=>T(!D),className:`px-4 py-2 rounded-lg font-semibold transition-all ${D?"bg-red-500 hover:bg-red-600 text-white":"bg-[#477A0C] hover:bg-green-700 text-white"}`,children:D?"Masquer l'aper√ßu üå∏":"Afficher l'aper√ßu üå∏"})]}),D&&e.jsx("div",{className:"border-2 border-[#477A0C] rounded-lg p-4 bg-gray-50",children:e.jsx("div",{id:"invoice-preview-section",className:"bg-white rounded-lg overflow-hidden",children:e.jsx("div",{className:"transition-all duration-500",children:e.jsx(Ye,{invoice:t})})})})]}),e.jsxs("div",{className:"bg-[#477A0C] rounded-xl shadow-[0_10px_25px_-5px_rgba(0,0,0,0.3)] p-6 mb-6 transform transition-all hover:scale-[1.005] hover:shadow-[0_15px_30px_-5px_rgba(0,0,0,0.4)]",children:[e.jsx("h2",{className:"text-xl font-bold text-[#F2EFE2] mb-4 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-3 rounded-full font-bold",children:"ACTIONS PRINCIPALES"})}),e.jsx("div",{className:"bg-[#F2EFE2] rounded-lg p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-black mb-1 font-bold",children:"Email du destinataire"}),e.jsx("input",{value:t.clientEmail,onChange:w=>s(S=>({...S,clientEmail:w.target.value})),type:"email",className:"w-full md:w-64 border-2 border-[#477A0C] rounded-lg px-4 py-3 focus:border-[#F55D3E] focus:ring-2 focus:ring-[#89BBFE] transition-all bg-white text-black font-bold",placeholder:"client@email.com"})]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>v(!0),className:"px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 bg-blue-600 hover:bg-blue-700 text-white",title:"Ouvrir l'aper√ßu de la facture et t√©l√©charger le PDF",children:[e.jsx("span",{children:"üëÅÔ∏è"}),e.jsx("span",{children:"APER√áU & PDF"})]}),e.jsxs("button",{onClick:ee,disabled:!t.clientName||!t.clientEmail||t.products.length===0,className:`px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 disabled:hover:scale-100 ${t.clientName&&t.clientEmail&&t.products.length>0?"bg-green-600 hover:bg-green-700 text-white":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,title:t.clientName&&t.clientEmail&&t.products.length>0?"Enregistrer la facture dans l'onglet Factures":"Compl√©tez les informations client et ajoutez au moins un produit",children:[e.jsx("span",{children:"üíæ"}),e.jsx("span",{children:"ENREGISTRER"})]}),e.jsxs("button",{onClick:xe,className:"px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 bg-orange-600 hover:bg-orange-700 text-white",title:"Imprimer la facture compl√®te (2 pages : facture + conditions g√©n√©rales)",children:[e.jsx("span",{children:"üñ®Ô∏è"}),e.jsx("span",{children:"IMPRIMER (2 PAGES)"})]}),e.jsxs("button",{onClick:ue,className:"px-6 py-3 rounded-xl flex items-center space-x-3 font-bold shadow-lg transform transition-all hover:scale-105 bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx("span",{children:"üìß"}),e.jsx("span",{children:"ENVOYER PAR EMAIL/DRIVE"})]})]})]})})]})]}),e.jsx(Ps,{isOpen:l,onClose:()=>m(!1),clients:r,onLoadClient:I,onDeleteClient:K}),e.jsx(Ls,{isOpen:d,onClose:()=>h(!1),invoices:o,onLoadInvoice:H,onDeleteInvoice:ae}),e.jsx(Is,{isOpen:c,onClose:()=>u(!1)}),e.jsx(Os,{isOpen:g,onClose:()=>v(!1),invoice:t,onDownload:ne}),e.jsx(Ms,{isOpen:x,onClose:()=>p(!1),onSuccess:j,onError:R}),e.jsx($s,{isOpen:N,onClose:()=>y(!1),onSuccess:j,onError:R}),e.jsx(Us,{isOpen:P,onClose:()=>b(!1),invoice:t,onSuccess:j,onError:R}),C&&e.jsx("div",{className:"fixed top-4 right-4 z-50",children:e.jsx("button",{onClick:()=>E(!1),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium",children:"Fermer Debug"})}),e.jsx(Js,{isOpen:A,onClose:()=>k(!1),onSave:se}),e.jsx(Qs,{message:O.message,type:O.type,show:O.show,onClose:B}),e.jsx("div",{className:"fixed bottom-2 right-2 text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded",children:"v2025.07.27-15h00"})]})}const J=ls((a,t)=>({step:"facture",invoiceNumber:"",invoiceDate:"",eventLocation:"",client:{name:""},produits:[],paiement:{method:""},livraison:{},signature:{dataUrl:"",timestamp:""},signatureDataUrl:void 0,invoiceNotes:"",advisorName:"",termsAccepted:!0,completion:{completedStepIds:[]},steps:["facture","client","produits","paiement","livraison","signature","recap","nouvelles-commandes"],getCurrentStepIndex:()=>{const s=t();return s.steps.indexOf(s.step)},setStep:s=>a({step:s}),goNext:()=>{const s=t(),r=s.steps.indexOf(s.step),n=Math.min(r+1,s.steps.length-1),o=s.steps[n];o&&a({step:o})},goPrev:()=>{const s=t(),r=s.steps.indexOf(s.step),n=Math.max(r-1,0),o=s.steps[n];o&&a({step:o})},setInvoiceData:s=>a(r=>({invoiceNumber:s.invoiceNumber??r.invoiceNumber,invoiceDate:s.invoiceDate??r.invoiceDate,eventLocation:s.eventLocation??r.eventLocation})),updateClient:s=>a(r=>({client:{...r.client,...s}})),addProduit:s=>a(r=>({produits:[...r.produits,s]})),updateProduit:(s,r)=>a(n=>({produits:n.produits.map(o=>o.id===s?{...o,...r}:o)})),removeProduit:s=>a(r=>({produits:r.produits.filter(n=>n.id!==s)})),updatePaiement:s=>a(r=>({paiement:{...r.paiement,...s}})),updateLivraison:s=>a(r=>({livraison:{...r.livraison,...s}})),updateSignature:s=>a(r=>({signature:{...r.signature,...s}})),setSignature:s=>a({signatureDataUrl:s}),updateInvoiceNotes:s=>a({invoiceNotes:s}),updateAdvisorName:s=>a({advisorName:s}),setTermsAccepted:s=>a({termsAccepted:s}),reset:()=>a({step:"facture",invoiceNumber:"",invoiceDate:"",eventLocation:"",client:{name:""},produits:[],paiement:{method:""},livraison:{},signature:{dataUrl:"",timestamp:""},signatureDataUrl:void 0,invoiceNotes:"",advisorName:"",termsAccepted:!0,completion:{completedStepIds:[]}}),markStepDone:s=>a(r=>{var o;const n=new Set(((o=r.completion)==null?void 0:o.completedStepIds)??[]);return n.add(s),{completion:{completedStepIds:Array.from(n)}}}),resetCompletion:()=>a({completion:{completedStepIds:[]}}),syncFromMainInvoice:s=>{a({invoiceNumber:s.invoiceNumber||"",invoiceDate:s.invoiceDate||"",eventLocation:s.eventLocation||"",client:{name:s.clientName||"",email:s.clientEmail||"",phone:s.clientPhone||"",address:s.clientAddress||"",addressLine2:s.clientAddressLine2||"",city:s.clientCity||"",postalCode:s.clientPostalCode||"",siret:s.clientSiret||"",housingType:s.clientHousingType||"",doorCode:s.clientDoorCode||""},produits:(s.products||[]).map(r=>({id:r.id||Math.random().toString(36),designation:r.designation||r.name||"",qty:r.quantity||r.qty||1,priceTTC:r.priceTTC||r.price||0,category:r.category||""})),paiement:{method:s.paymentMethod||"",depositAmount:s.montantAcompte||0,remainingAmount:s.montantRestant||0,nombreChequesAVenir:s.nombreChequesAVenir||0},livraison:{deliveryMethod:s.deliveryMethod||"",deliveryNotes:s.deliveryNotes||"",deliveryAddress:s.deliveryAddress||""},signatureDataUrl:s.signature||void 0,invoiceNotes:s.invoiceNotes||"",advisorName:s.advisorName||"",termsAccepted:s.termsAccepted||!0})},syncToMainInvoice:()=>{const s=t();return{invoiceNumber:s.invoiceNumber,invoiceDate:s.invoiceDate,eventLocation:s.eventLocation,clientName:s.client.name,clientEmail:s.client.email||"",clientPhone:s.client.phone||"",clientAddress:s.client.address||"",clientAddressLine2:s.client.addressLine2||"",clientCity:s.client.city||"",clientPostalCode:s.client.postalCode||"",clientSiret:s.client.siret||"",clientHousingType:s.client.housingType||"",clientDoorCode:s.client.doorCode||"",products:s.produits.map(r=>{const n=q(r.qty,r.priceTTC,r.discount||0,r.discountType||"percent");return{id:r.id,name:r.designation,designation:r.designation,quantity:r.qty,priceTTC:r.priceTTC,category:r.category||"",priceHT:+(r.priceTTC/1.2).toFixed(2),totalHT:+(n/1.2).toFixed(2),totalTTC:+n.toFixed(2),unitPrice:r.priceTTC,discount:r.discount||0,discountType:r.discountType||"percent",isPickupOnSite:r.isPickupOnSite}}),paymentMethod:(()=>{const r=s.paiement.method,n=s.paiement.depositAmount||0,o=s.paiement.nombreChequesAVenir||0,i=s.produits.reduce((l,m)=>{const d=q(m.qty,m.priceTTC,m.discount||0,m.discountType||"percent");return l+d},0);if(r==="Ch√®que √† venir"&&o>0){const l=Math.round((i-n)/o);return`Ch√®que √† venir (${o} ch√®ques de ${l}‚Ç¨ + acompte ${n.toFixed(2)}‚Ç¨)`}if(r!=null&&r.startsWith("Alma")&&s.paiement.nombreFoisAlma){const l=Math.round((i-n)/s.paiement.nombreFoisAlma);return`${r} (${s.paiement.nombreFoisAlma} fois de ${l}‚Ç¨ + acompte ${n.toFixed(2)}‚Ç¨)`}return n>0&&r!=="Ch√®que √† venir"&&!(r!=null&&r.startsWith("Alma"))?`${r} (acompte ${n.toFixed(2)}‚Ç¨)`:r||""})(),montantAcompte:s.paiement.depositAmount||0,depositPaymentMethod:s.paiement.depositPaymentMethod||"",montantRestant:s.paiement.remainingAmount||0,nombreChequesAVenir:s.paiement.nombreChequesAVenir||0,deliveryMethod:s.livraison.deliveryMethod||"",deliveryAddress:s.livraison.deliveryAddress||"",deliveryNotes:s.livraison.deliveryNotes||"",montantTTC:s.produits.reduce((r,n)=>{const o=q(n.qty,n.priceTTC,n.discount||0,n.discountType||"percent");return r+o},0),montantHT:s.produits.reduce((r,n)=>{const o=q(n.qty,n.priceTTC,n.discount||0,n.discountType||"percent");return r+o/1.2},0),montantTVA:s.produits.reduce((r,n)=>{const o=q(n.qty,n.priceTTC,n.discount||0,n.discountType||"percent"),i=o/1.2;return r+(o-i)},0),signature:s.signature.dataUrl||"",isSigned:!!s.signature.dataUrl,signatureDate:s.signature.dataUrl?s.signature.timestamp||new Date().toISOString():void 0,invoiceNotes:s.invoiceNotes||"",advisorName:s.advisorName||"",termsAccepted:s.termsAccepted}},setPaymentStatus:s=>a(r=>({paiement:{...r.paiement,paymentStatus:s}})),setPaymentData:s=>a(r=>({paiement:{...r.paiement,...s}})),clearPaymentData:()=>a(s=>({paiement:{...s.paiement,paymentStatus:"idle",paymentId:void 0,orderId:void 0,checkoutUrl:void 0,paymentError:void 0}}))})),ft=()=>typeof performance<"u"?performance.now():Date.now();function rr({enabled:a=!0,axis:t="both",threshold:s=60,velocity:r=.2,preventScrollOnX:n=!0,onSwipe:o,onSwipeLeft:i,onSwipeRight:l,onSwipeUp:m,onSwipeDown:d}={}){const h=f.useRef(0),c=f.useRef(0),u=f.useRef(0),g=f.useRef(!1);f.useEffect(()=>{if(!a)return;const v=N=>{var P;if(!((P=N.touches)!=null&&P.length))return;const y=N.touches[0];h.current=y.clientX,c.current=y.clientY,u.current=ft(),g.current=!0},x=N=>{g.current&&n&&(t==="x"||t==="both")&&N.preventDefault()},p=N=>{var T;if(!g.current)return;g.current=!1;const y=(T=N.changedTouches)==null?void 0:T[0];if(!y)return;const P=ft()-u.current,b=y.clientX-h.current,C=y.clientY-c.current,E=Math.abs(b),A=Math.abs(C),k=E>=A?E:A,D=P>0?k/P:0;if(!(k<s||D<r)){if((t==="x"||t==="both")&&E>=A){b<0?(o==null||o("left"),i==null||i()):(o==null||o("right"),l==null||l());return}(t==="y"||t==="both")&&A>E&&(C<0?(o==null||o("up"),m==null||m()):(o==null||o("down"),d==null||d()))}};return document.addEventListener("touchstart",v,{passive:!0}),document.addEventListener("touchmove",x,{passive:!n}),document.addEventListener("touchend",p,{passive:!0}),()=>{document.removeEventListener("touchstart",v),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",p)}},[a,t,s,r,n,o,i,l,m,d])}function nr(a){const{enabled:t=!0,threshold:s=60,velocity:r=.2,preventScrollOnX:n=!0,onNext:o,onPrev:i}=a||{};rr({enabled:t,axis:"x",threshold:s,velocity:r,preventScrollOnX:n,onSwipeLeft:()=>o==null?void 0:o(),onSwipeRight:()=>i==null?void 0:i()})}function qt({children:a}){const{goNext:t,goPrev:s,getCurrentStepIndex:r,steps:n=[],completion:o}=J(),[i,l]=f.useState(!1),[m,d]=f.useState(!1),h=r(),c=f.useMemo(()=>new Set((o==null?void 0:o.completedStepIds)??[]),[o==null?void 0:o.completedStepIds]),u=(g,v)=>c.has(g)?"done":v===h?"current":"todo";return nr({onNext:()=>t(),onPrev:()=>s(),threshold:56,velocity:.15,preventScrollOnX:!0}),e.jsxs("div",{className:"w-full h-dvh bg-gray-300 flex items-center justify-center overflow-hidden p-4",children:[m&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",children:e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-myconfort-blue border-opacity-70 bg-white/80 shadow-2xl"})}),e.jsxs("div",{className:"w-[950px] h-[650px] bg-myconfort-cream border-6 border-black rounded-lg shadow-2xl overflow-hidden relative",children:[e.jsx("button",{onClick:()=>l(!i),className:"absolute top-2 right-2 w-6 h-6 bg-black/70 hover:bg-black text-white rounded-full text-xs font-bold z-50 flex items-center justify-center transition-all",title:i?"Masquer les infos":"Afficher les infos iPad",children:i?"√ó":"i"}),i&&e.jsxs("div",{className:"absolute top-10 right-2 bg-black/90 text-white text-xs p-3 rounded-lg z-40 max-w-[200px]",children:[e.jsx("div",{className:"font-mono mb-1",children:"iPad 1024√ó768"}),e.jsx("div",{className:"text-white/80",children:"Mode paysage optimis√©"}),e.jsx("div",{className:"text-white/80",children:"Swipe ‚Üê ‚Üí pour naviguer"})]}),e.jsxs("header",{className:"w-full px-3 py-1 flex items-center justify-between border-b border-myconfort-dark/10",children:[e.jsxs("h1",{className:"text-xs font-medium text-myconfort-dark",children:["Wizard iPad ‚Äî √âtape ",Math.min(h+1,n.length),"/",n.length||0]}),e.jsx("nav",{className:"flex gap-1",children:n.map((g,v)=>{const x=u(g,v),p="h-1 w-3 rounded-full",N=x==="done"?"bg-myconfort-green":x==="current"?"bg-myconfort-blue":"bg-myconfort-dark/20";return e.jsx("span",{className:`${p} ${N}`,"aria-label":`${g} - ${x}`},g)})})]}),e.jsx("main",{className:"w-full h-[calc(768px-32px)]",children:a})]})]})}function ar({onNext:a,onQuit:t}){const{invoiceNumber:s,invoiceDate:r,eventLocation:n,advisorName:o,setInvoiceData:i,updateAdvisorName:l}=J(),[m,d]=f.useState(!1),[h,c]=f.useState(!1);f.useEffect(()=>{const y=new Date().toISOString().split("T")[0];s||i({invoiceNumber:at()}),r||i({invoiceDate:y})},[s,r,i]);const u=()=>{!n||n.trim()===""||!o||o.trim()===""||a()},g=n&&n.trim()!=="",v=!n||n.trim()==="",x=o&&o.trim()!=="",p=!o||o.trim()==="",N=g&&x;return e.jsxs("div",{className:"max-w-6xl mx-auto py-2 relative",children:[e.jsxs("div",{className:"bg-[#477A0C] rounded-lg shadow-lg p-4 mb-4 border border-gray-100",children:[e.jsx("h1",{className:"text-2xl font-bold text-[#F2EFE2] mb-3 flex items-center justify-center",children:e.jsx("span",{className:"bg-[#F2EFE2] text-[#477A0C] px-6 py-2 rounded-full font-bold text-xl",children:"üìã INFORMATIONS FACTURE"})}),e.jsx("div",{className:"bg-[#F2EFE2] rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h2",{className:"text-lg font-bold text-black mb-2",children:e.jsx("strong",{children:"MYCONFORT"})}),e.jsx("p",{className:"text-black font-semibold text-sm",children:e.jsx("strong",{children:"88 Avenue des Ternes"})}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"75017 Paris, France"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"SIRET: 824 313 530 00027"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"T√©l: 04 68 50 41 45"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"Email: myconfort@gmail.com"}),e.jsx("p",{className:"text-black font-semibold text-sm",children:"Site web: https://www.htconfort.com"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsx("span",{className:"font-bold text-black text-sm",children:"Facture n¬∞:"}),e.jsx("input",{value:s,type:"text",className:"border-2 border-[#477A0C] rounded-lg px-3 py-2 text-base font-mono text-black bg-white focus:border-[#F55D3E] focus:ring-1 focus:ring-[#89BBFE] transition-all font-bold",readOnly:!0})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("label",{className:"font-bold text-black text-sm",children:["Date: ",e.jsx("span",{className:"text-green-600",children:"‚úì Auto"})]}),e.jsx("input",{value:r,onChange:y=>i({invoiceDate:y.target.value}),type:"date",className:"border-2 border-green-500 rounded-lg px-3 py-2 text-sm text-black bg-green-50 focus:ring-1 focus:ring-green-300 transition-all font-bold"}),e.jsx("p",{className:"text-green-600 text-xs font-semibold",children:"‚úÖ Date remplie automatiquement"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("label",{className:"font-bold text-black text-sm",children:["Lieu de l'√©v√©nement: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:n,onChange:y=>{i({eventLocation:y.target.value}),d(!0)},type:"text",required:!0,className:`w-full border-2 rounded-lg px-3 py-2 text-sm text-black bg-white focus:ring-1 transition-all font-bold ${v&&m?"border-red-500 focus:border-red-500 focus:ring-red-200":g?"border-green-500 focus:border-green-600 focus:ring-green-200 bg-green-50":"border-red-500 focus:border-red-500 focus:ring-red-200"}`,placeholder:"Ex: Salon de l'habitat Paris, Maison du client, etc."}),v?e.jsx("p",{className:"text-red-600 text-xs font-bold flex items-center",children:"‚ö†Ô∏è Le lieu de l'√©v√©nement est obligatoire pour continuer"}):e.jsx("p",{className:"text-green-600 text-xs font-bold flex items-center",children:"‚úÖ Lieu renseign√© - Vous pouvez continuer"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[e.jsxs("label",{className:"font-bold text-black text-sm",children:["Conseiller/Vendeuse: ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx("input",{value:o,onChange:y=>{l(y.target.value),c(!0)},type:"text",required:!0,className:`w-full border-2 rounded-lg px-3 py-2 text-sm text-black bg-white focus:ring-1 transition-all font-bold ${p&&h?"border-red-500 focus:border-red-500 focus:ring-red-200":x?"border-green-500 focus:border-green-600 focus:ring-green-200 bg-green-50":"border-red-500 focus:border-red-500 focus:ring-red-200"}`,placeholder:"Ex: Marie Dupont, Jean Martin, etc."}),p?e.jsx("p",{className:"text-red-600 text-xs font-bold flex items-center",children:"‚ö†Ô∏è Le nom du conseiller est obligatoire pour continuer"}):e.jsx("p",{className:"text-green-600 text-xs font-bold flex items-center",children:"‚úÖ Conseiller renseign√© - Vous pouvez continuer"})]})]})]})})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6 mb-4",children:[e.jsx("button",{onClick:t,className:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-xl text-lg transition-all transform hover:scale-105 shadow-lg",children:"‚Üê Quitter"}),e.jsx("button",{onClick:u,disabled:!N,className:`px-6 py-3 font-bold rounded-xl text-lg transition-all transform shadow-lg ${N?"bg-[#477A0C] hover:bg-[#3A6A0A] text-white hover:scale-105":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:N?"‚úÖ Suivant: Client ‚Üí":v&&p?"üö´ Remplir lieu et conseiller":v?"üö´ Remplir le lieu d'abord":"üö´ Remplir le conseiller d'abord"})]})]})}function or({onNext:a,onPrev:t}){var u,g,v,x,p,N,y,P;const{client:s,updateClient:r}=J(),n=f.useRef(null),[o,i]=f.useState(!1);f.useEffect(()=>{var b;(b=n.current)==null||b.focus()},[]);const l=(b,C)=>r({[b]:C}),m={name:(((u=s.name)==null?void 0:u.trim().length)||0)>2,email:!!((g=s.email)!=null&&g.includes("@")),phone:(((v=s.phone)==null?void 0:v.trim().length)||0)>0,address:(((x=s.address)==null?void 0:x.trim().length)||0)>0,city:(((p=s.city)==null?void 0:p.trim().length)||0)>0,postalCode:(((N=s.postalCode)==null?void 0:N.trim().length)||0)>0,housingType:(((y=s.housingType)==null?void 0:y.trim().length)||0)>0,doorCode:(((P=s.doorCode)==null?void 0:P.trim().length)||0)>0||s.doorCode==="Pas de digicode"},d=b=>!o||m[b],h=m.name&&m.email&&m.phone&&m.address&&m.city&&m.postalCode&&m.housingType&&m.doorCode,c=()=>{i(!0),h&&a()};return e.jsx("div",{className:"min-h-screen w-full bg-myconfort-cream",style:{WebkitTouchCallout:"none",WebkitUserSelect:"none",userSelect:"none"},children:e.jsxs("div",{className:"mx-auto w-full max-w-6xl px-4 pt-6 pb-6",children:[e.jsxs("div",{className:"px-4 py-2 border-b border-myconfort-dark/10 mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-myconfort-dark font-manrope",children:"üë§ Informations Client"}),e.jsxs("p",{className:"text-lg text-gray-600",children:["√âtape 2/7 ‚Ä¢ Tous les champs"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})," = obligatoire"]})]}),e.jsx("div",{className:"px-4",children:e.jsxs("form",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(ke,{className:"w-4 h-4 text-myconfort-green"})," Nom complet"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{ref:n,type:"text",value:s.name||"",onChange:b=>l("name",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("name")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"Nom et pr√©nom",required:!0}),!d("name")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Le nom doit faire plus de 2 caract√®res."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(Tt,{className:"w-4 h-4 text-myconfort-green"})," Email"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"email",value:s.email||"",onChange:b=>l("email",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("email")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"example@gmail.com",required:!0}),!d("email")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Adresse email valide requise."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(cs,{className:"w-4 h-4 text-myconfort-green"})," T√©l√©phone"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"tel",value:s.phone||"",onChange:b=>l("phone",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("phone")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"06 12 34 56 78",required:!0}),!d("phone")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Num√©ro de t√©l√©phone requis."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(wt,{className:"w-4 h-4 text-myconfort-green"})," Adresse"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"text",value:s.address||"",onChange:b=>l("address",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("address")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"123 rue de la Paix",required:!0}),!d("address")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(pt,{className:"w-4 h-4 text-gray-400"})," Adresse 2 (optionnel)"]}),e.jsx("input",{type:"text",value:s.addressLine2||"",onChange:b=>l("addressLine2",b.target.value),className:"w-full px-3 py-2 text-base border-2 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none",placeholder:"B√¢timent, √©tage, etc."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(pt,{className:"w-4 h-4 text-myconfort-green"})," Ville"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"text",value:s.city||"",onChange:b=>l("city",b.target.value),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("city")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,placeholder:"Paris",required:!0}),!d("city")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(vt,{className:"w-4 h-4 text-myconfort-green"})," Code postal"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:s.postalCode||"",onChange:b=>l("postalCode",b.target.value),onFocus:b=>{b.target.style.fontSize="16px",b.target.style.webkitUserSelect="text",b.target.style.userSelect="text"},onTouchStart:b=>b.preventDefault(),className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${d("postalCode")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,style:{WebkitAppearance:"none",WebkitUserSelect:"text",userSelect:"text",touchAction:"manipulation"},placeholder:"75001",required:!0}),!d("postalCode")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(ds,{className:"w-4 h-4 text-myconfort-green"})," Type de logement ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsxs("select",{value:s.housingType||"",onChange:b=>l("housingType",b.target.value),onFocus:b=>{b.target.style.fontSize="16px",b.target.style.webkitUserSelect="none",b.target.style.userSelect="none"},className:`w-full px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none cursor-pointer ${d("housingType")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,style:{WebkitAppearance:"none",touchAction:"manipulation"},required:!0,children:[e.jsx("option",{value:"",children:"S√©lectionner..."}),e.jsx("option",{value:"Appartement",children:"Appartement"}),e.jsx("option",{value:"Maison",children:"Maison"}),e.jsx("option",{value:"Bureau",children:"Bureau"})]}),!d("housingType")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:"Ce champ est requis."})]}),e.jsxs("div",{className:"space-y-0",children:[e.jsxs("label",{className:"flex items-center gap-1 text-base font-medium text-myconfort-dark font-manrope",children:[e.jsx(ms,{className:"w-4 h-4 text-myconfort-green"})," Code porte"," ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s.doorCode==="Pas de digicode"?"":s.doorCode||"",onChange:b=>l("doorCode",b.target.value),onFocus:b=>{b.target.style.fontSize="16px",b.target.style.webkitUserSelect="text",b.target.style.userSelect="text"},disabled:s.doorCode==="Pas de digicode",className:`flex-1 px-3 py-2 text-base border-2 rounded-lg font-manrope transition-colors min-h-[40px] focus:outline-none ${s.doorCode==="Pas de digicode"?"bg-gray-100 text-gray-500 border-gray-200":d("doorCode")?"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green":"border-myconfort-coral bg-red-50 text-red-900"}`,style:{WebkitAppearance:"none",WebkitUserSelect:s.doorCode==="Pas de digicode"?"none":"text",userSelect:s.doorCode==="Pas de digicode"?"none":"text",touchAction:"manipulation"},placeholder:"A1234B"}),e.jsx("button",{type:"button",onClick:()=>l("doorCode",s.doorCode==="Pas de digicode"?"":"Pas de digicode"),className:`px-3 py-2 text-base font-medium rounded-lg border-2 transition-colors min-h-[40px] cursor-pointer select-none ${s.doorCode==="Pas de digicode"?"bg-myconfort-coral text-white border-myconfort-coral":"bg-gray-100 text-myconfort-dark border-gray-200 hover:bg-gray-200"}`,style:{WebkitUserSelect:"none",userSelect:"none",touchAction:"manipulation"},children:s.doorCode==="Pas de digicode"?"Annuler":"Pas de code"})]}),!d("doorCode")&&e.jsx("p",{className:"text-myconfort-coral text-xs",children:'Saisir un code ou choisir "Pas de code".'})]})]})]})}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6 mb-4",children:[e.jsx("button",{type:"button",onClick:t,className:"px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-xl text-lg transition-all transform hover:scale-105 shadow-lg",children:"‚Üê Pr√©c√©dent"}),e.jsx("button",{type:"button",onClick:c,className:`px-12 py-4 font-bold rounded-xl text-lg transition-all transform shadow-lg ${h?"bg-myconfort-green hover:bg-myconfort-green/90 text-white hover:scale-105":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:h?"‚úÖ Suivant ‚Üí":"üö´ Compl√©ter les champs"})]})]})})}const ir=[...Ae,"Diverse"];function lr({onNext:a,onPrev:t}){const{produits:s,addProduit:r,updateProduit:n,removeProduit:o}=J(),[i,l]=f.useState({category:"",designation:"",qty:1,priceTTC:0,discount:0,discountType:"percent"}),m=20,d=s.length>0&&s.every(p=>p.isPickupOnSite!==void 0),h=f.useMemo(()=>!i.category||i.category==="Diverse"?[]:we.filter(p=>p.category===i.category),[i.category]),c=f.useMemo(()=>{const p=s.reduce((b,C)=>b+q(Number(C.qty||0),Number(C.priceTTC||0),Number(C.discount||0),C.discountType||"percent"),0),N=s.reduce((b,C)=>{const E=q(Number(C.qty||0),Number(C.priceTTC||0),Number(C.discount||0),C.discountType||"percent");return b+te(E,m)},0),y=p-N,P=s.reduce((b,C)=>{const E=Number(C.qty||0)*Number(C.priceTTC||0),A=q(Number(C.qty||0),Number(C.priceTTC||0),Number(C.discount||0),C.discountType||"percent");return b+(E-A)},0);return{totalHT:N,totalTTC:p,totalTVA:y,totalRemise:P}},[s,m]),u=p=>{l(N=>({...N,category:p,designation:"",priceTTC:0}))},g=p=>{const N=h.find(y=>y.name===p);N&&l(y=>({...y,designation:N.name,priceTTC:N.priceTTC}))},v=()=>{if(!i.category.trim()||!i.designation.trim()||i.qty<=0||i.priceTTC<=0){alert("Veuillez remplir tous les champs obligatoires");return}const p=crypto.randomUUID();r({id:p,designation:i.designation.trim(),category:i.category,qty:Number(i.qty||1),priceTTC:Number(i.priceTTC||0),discount:Number(i.discount||0),discountType:i.discountType,isPickupOnSite:void 0}),l({category:"",designation:"",qty:1,priceTTC:0,discount:0,discountType:"percent"})},x=()=>{if(s.length===0){alert("Veuillez ajouter au moins un produit avant de continuer.");return}const p=s.filter(N=>N.isPickupOnSite===void 0);if(p.length>0){alert(`Veuillez d√©finir le mode de livraison pour tous les produits.
${p.length} produit(s) sans mode de livraison d√©fini.`);return}a()};return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"px-4 py-1 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark font-manrope",children:"üì¶ Produits & Services"}),e.jsx("p",{className:"text-sm text-gray-600",children:"√âtape 3/7 ‚Ä¢ Ajoutez les produits avec quantit√©s et prix"})]}),e.jsxs("div",{className:"flex-1 px-4 py-2 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white rounded-lg p-3 border border-myconfort-dark/10 mb-2",children:[e.jsx("h3",{className:"text-base font-medium text-myconfort-dark font-manrope mb-2",children:"‚ûï Ajouter un produit"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Cat√©gorie ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsxs("select",{value:i.category,onChange:p=>u(p.target.value),className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green",children:[e.jsx("option",{value:"",children:"S√©lectionner une cat√©gorie"}),ir.map(p=>e.jsx("option",{value:p,children:p},p))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Produit ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),i.category==="Diverse"?e.jsx("input",{type:"text",placeholder:"Saisir le nom du produit...",value:i.designation,onChange:p=>l(N=>({...N,designation:p.target.value})),disabled:!i.category,className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green disabled:bg-gray-100 disabled:text-gray-500"}):e.jsxs("select",{value:i.designation,onChange:p=>g(p.target.value),disabled:!i.category,className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green disabled:bg-gray-100 disabled:text-gray-500",children:[e.jsx("option",{value:"",children:i.category?"S√©lectionner un produit":"S√©lectionner une cat√©gorie d'abord"}),h.map(p=>e.jsx("option",{value:p.name,children:p.name},p.name))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Qt√© ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"number",min:1,value:i.qty,onChange:p=>l(N=>({...N,qty:Number(p.target.value||1)})),className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-myconfort-dark font-manrope",children:["Prix TTC (‚Ç¨) ",e.jsx("span",{className:"text-red-600 font-bold",children:"*"})]}),e.jsx("input",{type:"number",step:"0.01",value:i.priceTTC,onChange:p=>l(N=>({...N,priceTTC:Number(p.target.value||0)})),className:"w-full px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"})]}),e.jsxs("div",{className:"space-y-1 col-span-2",children:[e.jsxs("label",{className:"flex items-center gap-1 text-sm font-medium text-gray-600 font-manrope",children:["Remise (optionnel)",i.discount>0&&e.jsx("span",{className:"text-myconfort-green ml-1 font-bold",children:"‚úì"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{value:i.discountType,onChange:p=>l(N=>({...N,discountType:p.target.value})),className:"w-12 px-1 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green",children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"‚Ç¨"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"0",value:i.discount,onChange:p=>l(N=>({...N,discount:Number(p.target.value||0)})),className:"flex-1 px-3 py-2 text-sm border-2 rounded-lg font-manrope transition-colors duration-150 min-h-[40px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-transparent",children:"Action"}),e.jsx("button",{onClick:v,disabled:!i.category||!i.designation||i.qty<=0||i.priceTTC<=0,className:`w-full px-3 py-2 rounded-lg text-sm font-medium font-manrope text-white transition-all min-h-[40px] ${!i.category||!i.designation||i.qty<=0||i.priceTTC<=0?"bg-myconfort-coral hover:bg-myconfort-coral/90":"bg-myconfort-green hover:bg-myconfort-green/90 shadow-lg"}`,children:"Ajouter"})]})]})]}),e.jsx("div",{className:"flex-1 bg-white rounded-lg border border-myconfort-dark/10 overflow-hidden",children:e.jsx("div",{className:"overflow-auto h-full",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-myconfort-green text-white sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2 text-sm font-medium font-manrope",children:"PRODUIT"}),e.jsx("th",{className:"px-1 py-2 text-center text-sm font-medium font-manrope",children:"Qt√©"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"PU HT"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"PU TTC"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"Remise"}),e.jsx("th",{className:"px-1 py-2 text-center text-sm font-medium font-manrope",children:"Livraison"}),e.jsx("th",{className:"px-1 py-2 text-right text-sm font-medium font-manrope",children:"Total TTC"}),e.jsx("th",{className:"px-1 py-2 text-center text-sm font-medium font-manrope",children:"Actions"})]})}),e.jsxs("tbody",{children:[s.map((p,N)=>{const y=te(Number(p.priceTTC||0),m),P=q(Number(p.qty||0),Number(p.priceTTC||0),Number(p.discount||0),p.discountType||"percent");return e.jsxs("tr",{className:`border-b border-gray-100 ${N%2===0?"bg-gray-50":"bg-white"}`,children:[e.jsxs("td",{className:"px-2 py-2",children:[e.jsx("div",{className:"text-sm font-medium font-manrope text-myconfort-dark",children:p.designation}),e.jsx("div",{className:"text-xs text-gray-600",children:p.category||"Non d√©finie"})]}),e.jsx("td",{className:"px-1 py-2 text-center",children:e.jsx("input",{type:"number",min:1,className:"w-12 px-1 py-1 text-center text-sm border-2 rounded font-manrope transition-colors duration-150 min-h-[32px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green",value:p.qty,onChange:b=>n(p.id,{qty:Number(b.target.value||1)})})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsxs("div",{className:"text-sm font-medium font-manrope text-myconfort-dark",children:[y.toFixed(2)," ‚Ç¨"]})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsx("input",{type:"number",step:"0.01",className:"w-16 px-1 py-1 text-right text-sm border-2 rounded font-manrope transition-colors duration-150 min-h-[32px] focus:outline-none focus:ring-0 border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green",value:p.priceTTC,onChange:b=>n(p.id,{priceTTC:Number(b.target.value||0)})})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("select",{className:`w-8 px-1 py-1 text-xs border rounded font-manrope transition-colors duration-150 focus:outline-none focus:ring-0 ${(p.discount||0)>0?"border-myconfort-coral bg-red-50 text-red-700 focus:border-myconfort-coral":"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"}`,value:p.discountType||"percent",onChange:b=>n(p.id,{discountType:b.target.value}),children:[e.jsx("option",{value:"percent",children:"%"}),e.jsx("option",{value:"fixed",children:"‚Ç¨"})]}),e.jsx("input",{type:"number",step:"0.01",min:"0",className:`w-10 px-1 py-1 text-right text-xs border rounded font-manrope transition-colors duration-150 focus:outline-none focus:ring-0 ${(p.discount||0)>0?"border-myconfort-coral bg-red-50 text-red-700 focus:border-myconfort-coral":"border-gray-200 bg-white text-myconfort-dark hover:border-myconfort-green focus:border-myconfort-green"}`,value:p.discount||0,onChange:b=>n(p.id,{discount:Number(b.target.value||0)}),placeholder:"0"})]})}),e.jsx("td",{className:"px-1 py-2 text-center",children:e.jsxs("select",{className:`w-16 px-1 py-1 text-xs font-medium border rounded font-manrope transition-colors duration-150 focus:outline-none focus:ring-0 ${p.isPickupOnSite===void 0?"border-yellow-500 bg-yellow-100 text-yellow-800 focus:border-yellow-600":p.isPickupOnSite?"border-myconfort-green bg-green-100 text-green-800 focus:border-myconfort-green":"border-myconfort-coral bg-red-100 text-red-800 focus:border-myconfort-coral"}`,value:p.isPickupOnSite===void 0?"":p.isPickupOnSite?"emporter":"livrer",onChange:b=>{b.target.value===""?n(p.id,{isPickupOnSite:void 0}):n(p.id,{isPickupOnSite:b.target.value==="emporter"})},children:[e.jsx("option",{value:"",className:"text-black font-medium",children:"‚ö†Ô∏è √Ä choisir"}),e.jsx("option",{value:"livrer",className:"text-black font-medium",children:"üì¶ Livrer"}),e.jsx("option",{value:"emporter",className:"text-black font-medium",children:"üöó Emporter"})]})}),e.jsx("td",{className:"px-1 py-2 text-right",children:e.jsxs("div",{className:"text-sm font-bold text-myconfort-green font-manrope",children:[P.toFixed(2)," ‚Ç¨"]})}),e.jsx("td",{className:"px-1 py-2 text-center",children:e.jsx("button",{onClick:()=>o(p.id),className:"w-6 h-6 rounded bg-myconfort-coral text-white font-bold hover:bg-red-600 transition-all font-manrope text-xs",title:"Supprimer",children:"‚úï"})})]},p.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"px-6 py-8 text-gray-500 text-center text-sm font-manrope",colSpan:8,children:"Aucun produit pour l'instant. Utilisez le formulaire ci-dessus pour ajouter des produits."})})]}),s.length>0&&e.jsx("tfoot",{className:"bg-myconfort-cream sticky bottom-0",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-1 text-right font-bold text-xs text-myconfort-dark font-manrope",colSpan:6,children:e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsxs("span",{children:["HT: ",c.totalHT.toFixed(2),"‚Ç¨"]}),e.jsxs("span",{children:["TVA (",m,"%): ",c.totalTVA.toFixed(2),"‚Ç¨"]}),c.totalRemise>0&&e.jsxs("span",{className:"text-red-600",children:["Remise: -",c.totalRemise.toFixed(2),"‚Ç¨"]})]})}),e.jsx("td",{className:"px-1 py-1 text-right font-bold text-sm text-myconfort-green font-manrope",children:e.jsxs("strong",{children:["TTC: ",c.totalTTC.toFixed(2)," ‚Ç¨"]})}),e.jsx("td",{})]})})]})})})]}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:t,className:"px-6 py-3 rounded-full bg-white border-2 border-gray-300 text-base font-medium font-manrope text-myconfort-dark hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl",children:"‚Üê Pr√©c√©dent"}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"bg-white px-3 py-1 rounded-full shadow-lg mb-1",children:e.jsx("div",{className:"text-xs text-gray-500 font-manrope",children:"√âtape 3/7"})})}),e.jsx("button",{onClick:x,disabled:!d,className:`px-6 py-3 rounded-full text-base font-medium font-manrope transition-all shadow-lg hover:shadow-xl ${d?"bg-myconfort-green text-white hover:bg-myconfort-green/90":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:d?"Suivant ‚Üí":"‚ö†Ô∏è Produits requis"})]})]})}function Ke({leftLabel:a,onLeft:t,rightLabel:s,onRight:r,rightDisabled:n,className:o,maxWidth:i="max-w-6xl"}){const d=e.jsx("div",{className:"fixed left-0 right-0 bottom-0 z-[9999]",style:{paddingBottom:"max(env(safe-area-inset-bottom, 16px), 16px)"},children:e.jsx("div",{className:`mx-auto w-full ${i} px-6`,children:e.jsxs("div",{className:`rounded-2xl border bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 shadow-lg
                      flex items-center justify-between gap-3 px-4 ${o||""}`,style:{height:88,willChange:"transform"},children:[e.jsx("button",{type:"button",onClick:t,className:"px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold rounded-xl text-lg transition",children:a}),s?e.jsx("button",{type:"button",onClick:n?void 0:r,disabled:n,className:`px-12 py-4 font-bold rounded-xl text-lg shadow-lg transition
                          ${n?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-60":"bg-myconfort-green hover:bg-myconfort-green/90 text-white"}`,children:s}):null]})})});return typeof window<"u"?us.createPortal(d,document.body):d}function cr({onNext:a,onPrev:t}){const{paiement:s,updatePaiement:r,produits:n}=J(),[o,i]=f.useState(!1),[l,m]=f.useState(!1),d=(n??[]).reduce((b,C)=>b+q((C==null?void 0:C.qty)||0,(C==null?void 0:C.priceTTC)||0,(C==null?void 0:C.discount)||0,(C==null?void 0:C.discountType)||"fixed"),0),[h,c]=f.useState((s==null?void 0:s.method)||""),[u,g]=f.useState((s==null?void 0:s.depositAmount)||0),v=Math.max(0,d-(Number.isFinite(u)?u:0)),x=!!h&&u>=0&&u<=d,p=b=>{r({...s,...b,method:b.method??h,depositAmount:b.depositAmount??u})},P="calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)";return o?e.jsx(dr,{totalAmount:d,acompte:u,onBack:()=>i(!1),onSelect:b=>{const C=`Alma ${b}x`;c(C),p({method:C,depositAmount:u,almaInstallments:b}),i(!1)}}):l?e.jsx(mr,{totalAmount:d,acompte:u,defaultCount:Math.min(Math.max((s==null?void 0:s.chequesCount)||3,2),10),defaultNotes:(s==null?void 0:s.notes)||"",onBack:()=>m(!1),onComplete:b=>{c("Ch√®que √† venir"),p({method:"Ch√®que √† venir",depositAmount:u,chequesCount:b.count,chequeAmount:b.amount,notes:b.notes}),m(!1)}}):e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"üí≥ Mode de R√®glement"}),e.jsxs("p",{className:"text-myconfort-dark/70 text-sm",children:["√âtape 4/7 ‚Ä¢ Total : ",d.toFixed(2),"‚Ç¨ TTC"]})]}),e.jsxs("div",{className:"px-6 py-4",style:{paddingBottom:P},children:[e.jsx("div",{className:"bg-myconfort-green/10 p-4 rounded-xl border border-myconfort-green/30 mb-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-myconfort-dark",children:[d.toFixed(2),"‚Ç¨"]}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Total TTC"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-myconfort-blue",children:[u.toFixed(2),"‚Ç¨"]}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Acompte"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-bold text-orange-600",children:[v.toFixed(2),"‚Ç¨"]}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Reste √† payer"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-myconfort-dark mb-2",children:"Acompte (‚Ç¨) *"}),e.jsx("div",{className:"grid grid-cols-4 gap-2 mb-3",children:[20,30,40,50].map(b=>{const C=Math.round(d*b/100);return e.jsxs("button",{type:"button",onClick:()=>g(C),className:"px-3 py-2 bg-myconfort-blue/20 hover:bg-myconfort-blue/30 rounded-lg text-sm font-medium transition-colors",children:[b,"% (",C,"‚Ç¨)"]},b)})}),e.jsx("input",{type:"number",value:u,onChange:b=>g(Number(b.target.value)||0),min:0,max:d,className:"w-full px-4 py-3 text-xl font-bold border-2 border-gray-300 rounded-xl focus:border-myconfort-green focus:outline-none bg-white shadow-sm text-center",placeholder:"0"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsx(he,{active:h==="Esp√®ces",title:"Esp√®ces",subtitle:"Paiement comptant",emoji:"üíµ",onClick:()=>{c("Esp√®ces"),p({method:"Esp√®ces",depositAmount:u})}}),e.jsx(he,{active:h==="Virement",title:"Virement",subtitle:"Banque √† banque",emoji:"üè¶",onClick:()=>{c("Virement"),p({method:"Virement",depositAmount:u})}}),e.jsx(he,{active:h==="Carte Bleue",title:"Carte bleue",subtitle:"CB comptant",emoji:"üí≥",onClick:()=>{c("Carte Bleue"),p({method:"Carte Bleue",depositAmount:u})}}),e.jsx(he,{active:h==null?void 0:h.startsWith("Alma"),title:h!=null&&h.startsWith("Alma")?h:"Alma",subtitle:h!=null&&h.startsWith("Alma")?"Configur√© ‚úì":"2x, 3x ou 4x ‚Üí",custom:e.jsx("img",{src:ct,alt:"Alma",className:"h-6"}),onClick:()=>i(!0)}),e.jsx(he,{active:h==="Ch√®que au comptant",title:"Ch√®que (comptant)",subtitle:"Remis √† la commande",emoji:"üßæ",onClick:()=>{c("Ch√®que au comptant"),p({method:"Ch√®que au comptant",depositAmount:u})}}),e.jsx(he,{active:h==="Ch√®que √† venir",title:"Ch√®ques √† venir",subtitle:h==="Ch√®que √† venir"&&(s!=null&&s.nombreChequesAVenir)?`${s.nombreChequesAVenir} ch√®ques √ó ${(v/(s.nombreChequesAVenir||1)).toFixed(2)}‚Ç¨`:h==="Ch√®que √† venir"?"Configur√© ‚úì":"Planifier ‚Üí",emoji:"üìÑ",highlight:"amber",onClick:()=>m(!0)})]})]}),e.jsx(Ke,{leftLabel:"‚Üê Pr√©c√©dent",onLeft:t,rightLabel:"Suivant ‚Üí",onRight:x?a:()=>{},rightDisabled:!x})]})}function he({active:a,title:t,subtitle:s,emoji:r,custom:n,onClick:o,highlight:i}){const l=i==="amber"?"border-amber-500 bg-amber-50 shadow-lg":"border-myconfort-green bg-myconfort-green/10 shadow-lg";return e.jsx("button",{type:"button",onClick:o,className:`p-3 rounded-xl border-2 transition-all w-full text-left ${a?l:"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[n||e.jsx("span",{className:"text-xl",children:r}),e.jsx("div",{className:"font-semibold text-sm",children:t})]}),e.jsx("div",{className:"text-xs text-gray-600",children:s})]})})}function dr({totalAmount:a,acompte:t,onBack:s,onSelect:r}){const n=Math.max(0,a-t),l="calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)",m=[{times:2,label:"2 fois",fee:"1.5%",amount:n/2},{times:3,label:"3 fois",fee:"2.5%",amount:n/3},{times:4,label:"4 fois",fee:"3.5%",amount:n/4}];return e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:ct,alt:"Alma",className:"h-8"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"Paiement Alma"}),e.jsxs("p",{className:"text-myconfort-dark/70 text-sm",children:["Reste √† payer : ",n.toFixed(2),"‚Ç¨"]})]})]})}),e.jsx("div",{className:"px-6 py-6",style:{paddingBottom:l},children:e.jsx("div",{className:"max-w-2xl mx-auto space-y-4",children:m.map(d=>e.jsx("button",{type:"button",onClick:()=>r(d.times),className:"w-full p-6 bg-white rounded-xl border-2 border-gray-300 hover:border-myconfort-green hover:shadow-lg transition-all text-left",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-xl font-bold text-myconfort-dark",children:["Alma ",d.label]}),e.jsxs("div",{className:"text-myconfort-dark/70",children:["Frais : ",d.fee," ‚Ä¢ ",d.amount.toFixed(2),"‚Ç¨ / mois"]})]}),e.jsx("div",{className:"text-3xl",children:"‚Üí"})]})},d.times))})}),e.jsx(Ke,{leftLabel:"‚Üê Retour",onLeft:s})]})}function mr({totalAmount:a,acompte:t,defaultCount:s=3,defaultNotes:r="",onBack:n,onComplete:o}){const i=Math.max(0,a-t),[l,m]=f.useState(s),[d,h]=f.useState(r),c=Math.floor(i/l),u=i-c*l,g=l>=2&&l<=10&&c>0,p="calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)",N=Array.from({length:9},(y,P)=>P+2);return e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-amber-500/30 bg-amber-50",children:[e.jsx("h1",{className:"text-2xl font-bold text-amber-700",children:"üìÑ Ch√®ques √† venir"}),e.jsxs("p",{className:"text-amber-700/80 text-sm",children:["Reste √† payer : ",i.toFixed(2),"‚Ç¨"]})]}),e.jsxs("div",{className:"px-6 py-6 space-y-6",style:{paddingBottom:p},children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(y=>e.jsxs("button",{type:"button",onClick:()=>m(y),className:`px-3 py-2 rounded-lg text-sm font-bold transition-colors ${l===y?"bg-amber-500 text-white shadow-md":"bg-white border border-amber-500/40 text-amber-700 hover:bg-amber-50"}`,children:[y,"x"]},y))}),e.jsx("div",{className:"text-sm text-amber-800 mt-2",children:"Choisissez le nombre de ch√®ques (2 √† 10)"})]}),e.jsx("div",{className:"bg-white p-4 rounded-xl border border-amber-500/30",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-amber-700",children:[c,"‚Ç¨"]}),e.jsx("div",{className:"text-sm text-amber-800/80",children:"Montant par ch√®que"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-amber-700",children:u>0?`+${u}‚Ç¨`:"‚úì Exact"}),e.jsx("div",{className:"text-sm text-amber-800/80",children:u>0?"√Ä ajouter sur le 1er ch√®que":"R√©partition parfaite"})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-amber-800 mb-2",children:"Notes (optionnel)"}),e.jsx("textarea",{value:d,onChange:y=>h(y.target.value),rows:3,placeholder:"Ex : premier ch√®que √† l'installation, suivants tous les 30 jours‚Ä¶",className:"w-full px-4 py-3 border-2 border-amber-500/30 rounded-xl focus:border-amber-500 focus:outline-none bg-white shadow-sm resize-none"})]})]}),e.jsx(Ke,{leftLabel:"‚Üê Retour",onLeft:n,rightLabel:"Confirmer ‚Üí",onRight:g?()=>o({count:l,amount:c,notes:d}):()=>{},rightDisabled:!g,className:"border-amber-500/30 bg-amber-50/95 supports-[backdrop-filter]:bg-amber-50/80"})]})}function ur({onNext:a,onPrev:t}){const{livraison:s,updateLivraison:r,produits:n,client:o}=J(),[i,l]=f.useState(!1),m=n.filter(c=>!c.isPickupOnSite),d=n.filter(c=>c.isPickupOnSite),h=!!(s.deliveryMethod&&s.deliveryMethod.trim().length>0);return i?e.jsx(xr,{produitsALivrer:m,produitsAEmporter:d,client:o,livraison:s,updateLivraison:r,onBack:()=>l(!1),onComplete:()=>{l(!1),h&&a()}}):e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsx("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"üöö Modalit√©s de Livraison"}),e.jsxs("p",{className:"text-myconfort-dark/70 text-sm",children:["√âtape 5/7 ‚Ä¢ ",m.length," produits √† livrer,"," ",d.length," √† emporter"]})]}),e.jsx("button",{type:"button",onClick:a,className:"bg-[#477A0C] hover:bg-[#5A8F0F] text-white px-6 py-3 rounded-xl text-lg font-bold shadow-lg border-2 border-[#477A0C] transition-all",children:"Suivant ‚Üí"})]})}),e.jsxs("div",{className:"flex-1 px-6 py-4 flex flex-col justify-start",children:[e.jsx("div",{className:"bg-myconfort-green/10 p-4 rounded-xl border border-myconfort-green/30 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-green",children:m.length}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"√Ä livrer"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-blue",children:d.length}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"√Ä emporter"})]})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-lg font-medium text-myconfort-dark mb-4",children:"Mode de livraison *"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx("button",{onClick:()=>r({deliveryMethod:"Livraison Colissimo"}),className:`p-4 rounded-xl border-2 transition-all text-left ${s.deliveryMethod==="Livraison Colissimo"?"border-myconfort-green bg-myconfort-green/10 shadow-lg":"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-myconfort-dark",children:"ÔøΩ Livraison Colissimo"}),e.jsx("div",{className:"text-sm text-gray-600",children:"48 heures ‚Ä¢ Poids inf√©rieur √† 5 kg"})]}),s.deliveryMethod==="Livraison Colissimo"&&e.jsx("div",{className:"text-myconfort-green text-xl",children:"‚úì"})]})}),e.jsx("button",{onClick:()=>r({deliveryMethod:"Livraison France Express"}),className:`p-4 rounded-xl border-2 transition-all text-left ${s.deliveryMethod==="Livraison France Express"?"border-myconfort-green bg-myconfort-green/10 shadow-lg":"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-myconfort-dark",children:"‚ö° Livraison par transporteur France Express"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Date √† d√©finir dans les d√©tails du planning"})]}),s.deliveryMethod==="Livraison France Express"&&e.jsx("div",{className:"text-myconfort-green text-xl",children:"‚úì"})]})}),e.jsx("button",{onClick:()=>r({deliveryMethod:"Retrait sur stand"}),className:`p-4 rounded-xl border-2 transition-all text-left ${s.deliveryMethod==="Retrait sur stand"?"border-myconfort-green bg-myconfort-green/10 shadow-lg":"border-gray-300 bg-white hover:border-myconfort-green/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-myconfort-dark",children:"üè™ Retrait sur stand"}),e.jsx("div",{className:"text-sm text-gray-600",children:"√Ä la fin de l'√©v√©nement"})]}),s.deliveryMethod==="Retrait sur stand"&&e.jsx("div",{className:"text-myconfort-green text-xl",children:"‚úì"})]})})]})]}),e.jsx("div",{className:"h-32"})]}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:t,className:"px-6 py-3 rounded-full bg-white border-2 border-gray-300 text-base font-medium font-manrope text-myconfort-dark hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl",children:"‚Üê Pr√©c√©dent"}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("div",{className:"bg-white px-3 py-1 rounded-full shadow-lg mb-1",children:e.jsx("div",{className:"text-xs text-gray-500 font-manrope",children:"√âtape 5/7"})})}),e.jsx("button",{onClick:h?a:void 0,disabled:!h,className:`px-6 py-3 rounded-full text-base font-medium font-manrope transition-all shadow-lg hover:shadow-xl ${h?"bg-myconfort-green text-white hover:bg-myconfort-green/90":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:h?"Suivant ‚Üí":"‚ö†Ô∏è Mode requis"})]})]})}function xr({produitsALivrer:a,produitsAEmporter:t,client:s,livraison:r,updateLivraison:n,onBack:o,onComplete:i}){const[l,m]=f.useState(!1),[d,h]=f.useState(r.deliveryAddress||""),[c,u]=f.useState(r.deliveryNotes||""),g=()=>{n({deliveryAddress:l?d:s.address,deliveryNotes:c}),i()};return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"üì¶ D√©tails de Livraison"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"Configuration compl√®te de la livraison"})]}),e.jsx("div",{className:"flex-1 px-6 py-4 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-300",children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-3",children:"üìä R√©partition des produits"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-blue-600",children:["√Ä livrer (",a.length,")"]}),a.map((v,x)=>e.jsxs("div",{className:"text-gray-600",children:["‚Ä¢ ",v.designation," (x",v.qty,")"]},x))]}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-green-600",children:["√Ä emporter (",t.length,")"]}),t.map((v,x)=>e.jsxs("div",{className:"text-gray-600",children:["‚Ä¢ ",v.designation," (x",v.qty,")"]},x))]})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-300",children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-3",children:"üìç Adresse de livraison"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:!l,onChange:()=>m(!1),className:"w-4 h-4"}),e.jsxs("span",{children:["Adresse du client: ",s.address||"Non renseign√©e"]})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:l,onChange:()=>m(!0),className:"w-4 h-4"}),e.jsx("span",{children:"Adresse diff√©rente"})]}),l&&e.jsx("textarea",{value:d,onChange:v=>h(v.target.value),placeholder:"Saisir l'adresse de livraison...",rows:3,className:"w-full p-3 border rounded-lg"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-xl border border-gray-300",children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-3",children:"üìù Instructions de livraison"}),e.jsx("textarea",{value:c,onChange:v=>u(v.target.value),placeholder:"Ex: Livraison entre 9h-12h, sonner √† l'interphone, √©tage sans ascenseur...",rows:4,className:"w-full p-3 border rounded-lg resize-none"})]})]})}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:o,className:"px-6 py-3 rounded-full bg-white border-2 border-gray-300 text-base font-medium font-manrope text-myconfort-dark hover:bg-gray-50 transition-all shadow-lg hover:shadow-xl",children:"‚Üê Retour"}),e.jsx("button",{onClick:g,className:"px-6 py-3 rounded-full bg-myconfort-green text-white text-base font-medium font-manrope transition-all shadow-lg hover:shadow-xl hover:bg-myconfort-green/90",children:"Valider ‚Üí"})]})]})}function pr(a){const t=new fs(a,{throttle:16,minWidth:.75,maxWidth:2.5,penColor:"#14281D",backgroundColor:"rgba(255,255,255,0)"}),s=Math.max(window.devicePixelRatio||1,1);a.width=a.offsetWidth*s,a.height=a.offsetHeight*s;const r=a.getContext("2d");return r&&r.scale(s,s),t.clear(),t}async function hr(a){const t=new Date().toISOString(),s=a.toDataURL("image/png"),n=await(await fetch(s)).blob();return{pngDataUrl:s,blob:n,timestamp:t}}function gr({onSigned:a,onPrevious:t,className:s}){const r=f.useRef(null),[n,o]=f.useState(null);f.useEffect(()=>{if(!r.current)return;const m=pr(r.current);o(m);const d=()=>{if(!r.current)return;const h=m.isEmpty(),c=m.toData(),u=Math.max(window.devicePixelRatio||1,1);r.current.width=r.current.offsetWidth*u,r.current.height=r.current.offsetHeight*u;const g=r.current.getContext("2d");g&&g.scale(u,u),m.clear(),h||m.fromData(c)};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const i=()=>n==null?void 0:n.clear(),l=async()=>{if(!n||n.isEmpty())return;const{pngDataUrl:m,timestamp:d}=await hr(n);a==null||a(m,d)};return e.jsxs("div",{className:`flex flex-col gap-3 ${s||""}`,children:[e.jsx("div",{className:"rounded-2xl border border-myconfort-dark/20 bg-white shadow-sm p-2",children:e.jsx("div",{className:"h-[280px] w-full",children:e.jsx("canvas",{ref:r,className:"h-full w-full rounded-xl touch-none"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx("button",{onClick:t,className:"px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-800 min-h-[56px] font-semibold",children:"‚Üê Pr√©c√©dent"}),e.jsx("button",{onClick:i,className:"px-4 py-2 rounded-xl bg-myconfort-blue/20 hover:bg-myconfort-blue/30 min-h-[56px] font-semibold",children:"Effacer"}),e.jsx("button",{onClick:l,className:"px-4 py-2 rounded-xl bg-myconfort-green text-white hover:opacity-90 min-h-[56px] font-semibold",children:"Enregistrer la signature"})]})]})}function br({onNext:a,onPrev:t}){const{signature:s,updateSignature:r,termsAccepted:n,setTermsAccepted:o}=J(),[i,l]=f.useState(!1),[m,d]=f.useState(!1),h=(c,u)=>{r({dataUrl:c,timestamp:u}),n&&(d(!0),setTimeout(()=>{a()},1500))};return i?e.jsx(fr,{termsAccepted:n,setTermsAccepted:o,onBack:()=>l(!1),onAccept:()=>{o(!0),l(!1)}}):e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"‚úçÔ∏è Signature du Client"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"√âtape 6/8 ‚Ä¢ Signature obligatoire pour finaliser"})]}),e.jsxs("div",{className:"flex-1 px-6 py-4 pb-16 flex flex-col",children:[e.jsx("div",{className:"flex-1 bg-white rounded-xl border-2 border-gray-300 p-4 mb-4",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"text-lg font-semibold text-myconfort-dark",children:"üìù Signez dans la zone ci-dessous"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Utilisez votre doigt ou un stylet"})]}),e.jsx("div",{className:"flex-1 min-h-[200px]",children:e.jsx(gr,{onSigned:h,onPrevious:t})})]})}),e.jsxs("div",{className:"space-y-3",children:[(s==null?void 0:s.dataUrl)&&e.jsx("div",{className:"bg-myconfort-green/10 p-3 rounded-xl border border-myconfort-green/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-myconfort-green",children:m?"üîÑ Passage √† l'√©tape suivante...":"‚úì Signature enregistr√©e"}),e.jsx("div",{className:"text-xs text-myconfort-dark/70",children:s.timestamp&&new Date(s.timestamp).toLocaleString()})]}),e.jsx("img",{src:s.dataUrl,alt:"Signature",className:"h-12 w-24 object-contain border rounded"})]})}),e.jsxs("div",{className:"flex items-center justify-between bg-white p-3 rounded-xl border border-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",id:"terms",checked:n,onChange:c=>o(c.target.checked),className:"w-5 h-5 text-myconfort-green"}),e.jsx("label",{htmlFor:"terms",className:"text-sm font-medium text-myconfort-dark",children:"J'accepte les conditions g√©n√©rales"})]}),e.jsx("button",{onClick:()=>l(!0),className:`px-3 py-1 bg-myconfort-blue/20 hover:bg-myconfort-blue/30 
                         rounded-lg text-sm font-medium transition-colors`,children:"üìã Lire"})]})]})]})]})}function fr({termsAccepted:a,setTermsAccepted:t,onBack:s,onAccept:r}){return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"üìã Conditions G√©n√©rales de Vente"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"MyConfort - Conditions √† accepter"})]}),e.jsx("div",{className:"flex-1 px-6 py-4 overflow-y-auto",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-gray-300 space-y-4 text-sm leading-relaxed",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"1. OBJET"}),e.jsx("p",{className:"text-gray-700",children:"Les pr√©sentes conditions g√©n√©rales de vente r√©gissent les relations contractuelles entre MyConfort et ses clients dans le cadre de la vente de produits et services de confort thermique, isolation et √©quipements √©nerg√©tiques."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"2. COMMANDES"}),e.jsx("p",{className:"text-gray-700",children:"Toute commande implique l'acceptation pleine et enti√®re des pr√©sentes conditions. Les commandes ne sont d√©finitives qu'apr√®s acceptation par MyConfort et encaissement de l'acompte convenu."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"3. PRIX ET PAIEMENT"}),e.jsx("p",{className:"text-gray-700",children:"Les prix s'entendent TTC. Un acompte est exig√© √† la commande. Le solde est payable selon les modalit√©s convenues (comptant, √©chelonn√©, ou lors de la livraison). Tout retard de paiement entra√Æne des p√©nalit√©s de 3 fois le taux l√©gal."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"4. LIVRAISON ET INSTALLATION"}),e.jsx("p",{className:"text-gray-700",children:"Les d√©lais de livraison sont donn√©s √† titre indicatif. MyConfort s'engage √† respecter au mieux ces d√©lais mais ne pourra √™tre tenu responsable des retards dus aux fournisseurs ou √† des circonstances exceptionnelles."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"5. GARANTIES"}),e.jsx("p",{className:"text-gray-700",children:"MyConfort garantit ses produits selon les conditions du fabricant. La garantie main d'≈ìuvre est de 2 ans √† compter de la r√©ception des travaux. Cette garantie ne couvre pas l'usure normale, les dommages dus √† un mauvais usage ou √† un d√©faut d'entretien."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"6. DROIT DE R√âTRACTATION"}),e.jsx("p",{className:"text-gray-700",children:"Conform√©ment au Code de la consommation, le client dispose d'un d√©lai de 14 jours pour exercer son droit de r√©tractation, sauf pour les produits personnalis√©s ou les services d√©j√† ex√©cut√©s avec accord express du client."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"7. DONN√âES PERSONNELLES"}),e.jsx("p",{className:"text-gray-700",children:"Les donn√©es personnelles collect√©es sont n√©cessaires au traitement de la commande et √† la gestion de la relation commerciale. Elles ne sont pas transmises √† des tiers sans consentement. Le client dispose d'un droit d'acc√®s, de rectification et de suppression."})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-myconfort-dark mb-2",children:"8. JURIDICTION"}),e.jsx("p",{className:"text-gray-700",children:"Tout litige sera soumis aux tribunaux comp√©tents du ressort du si√®ge social de MyConfort. Le droit fran√ßais s'applique exclusivement."})]}),e.jsx("div",{className:"border-t pt-4 mt-6",children:e.jsxs("p",{className:"text-xs text-gray-500 text-center",children:["MyConfort - Si√®ge social: [Adresse] - RCS: [Num√©ro] - TVA: [Num√©ro]",e.jsx("br",{}),"Conditions g√©n√©rales mises √† jour le 24 ao√ªt 2025"]})})]})}),e.jsxs("div",{className:"px-6 py-4 border-t border-myconfort-dark/10",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:n=>t(n.target.checked),className:"w-5 h-5 text-myconfort-green"}),e.jsx("span",{className:"font-medium text-myconfort-dark",children:"J'ai lu et j'accepte les conditions g√©n√©rales"})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:s,className:`px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-800 
                       font-bold rounded-xl text-lg transition-all transform hover:scale-105
                       min-h-[56px]`,children:"‚Üê Retour"}),e.jsx("button",{onClick:a?r:void 0,disabled:!a,className:`px-12 py-4 font-bold rounded-xl text-lg transition-all transform 
                        shadow-lg min-h-[56px] ${a?"bg-myconfort-green hover:bg-myconfort-green/90 text-white hover:scale-105":"bg-red-500 hover:bg-red-600 text-white cursor-not-allowed opacity-90"}`,children:a?"Accepter et continuer ‚Üí":"Cochez pour accepter les conditions"})]})]})]})}function yr({onNext:a,onPrev:t}){const{client:s,produits:r,paiement:n,livraison:o,invoiceNumber:i,invoiceDate:l,eventLocation:m,signature:d,termsAccepted:h,advisorName:c}=J(),[u,g]=f.useState(!1),[v,x]=f.useState(!1),[p,N]=f.useState([]),y=f.useMemo(()=>{let T=0;const O=r.map(B=>{const _=q(B.qty||0,B.priceTTC||0,B.discount||0,B.discountType||"fixed");return T+=_,{...B,lineTotal:_}}),U=(n==null?void 0:n.depositAmount)||0,L=Math.max(0,T-U);return{details:O,subtotal:T,acompte:U,reste:L,total:T}},[r,n]),P=f.useMemo(()=>({invoiceNumber:i,invoiceDate:l,eventLocation:m||"",clientName:s.name||"",clientEmail:s.email||"",clientPhone:s.phone||"",clientAddress:s.address||"",clientAddressLine2:s.addressLine2||"",clientPostalCode:s.postalCode||"",clientCity:s.city||"",clientHousingType:s.housingType||"",clientDoorCode:s.doorCode||"",clientSiret:s.siret||"",products:r.map(T=>({id:T.id,name:T.designation,category:T.category||"",quantity:T.qty,priceHT:T.priceTTC/1.2,priceTTC:T.priceTTC,discount:T.discount,discountType:T.discountType,totalHT:T.qty*T.priceTTC/1.2-(T.discountType==="fixed"?T.discount:T.qty*T.priceTTC/1.2*T.discount/100),totalTTC:T.qty*T.priceTTC-(T.discountType==="fixed"?T.discount:T.qty*T.priceTTC*T.discount/100),isPickupOnSite:T.isPickupOnSite})),montantHT:y.subtotal/1.2,montantTTC:y.subtotal,montantTVA:y.subtotal-y.subtotal/1.2,montantRemise:0,taxRate:20,paymentMethod:(n==null?void 0:n.method)||"",montantAcompte:(n==null?void 0:n.depositAmount)||0,depositPaymentMethod:(n==null?void 0:n.depositPaymentMethod)||"",montantRestant:y.reste,deliveryMethod:(o==null?void 0:o.deliveryMethod)||"",deliveryAddress:(o==null?void 0:o.deliveryAddress)||"",deliveryNotes:(o==null?void 0:o.deliveryNotes)||"",signature:(d==null?void 0:d.dataUrl)||"",isSigned:!!(d!=null&&d.dataUrl),signatureDate:(d==null?void 0:d.timestamp)||"",invoiceNotes:"",advisorName:c||"",termsAccepted:h||!1,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),[i,l,m,s,r,n,o,d,h,c,y]),b=async()=>{try{x(!0),Mt(P),N(T=>[...T,`Facture ${P.invoiceNumber} enregistr√©e`])}catch(T){console.error("Erreur sauvegarde:",T)}finally{x(!1)}},C=async()=>{try{x(!0);const T=await it.generateInvoicePDF(P),O=URL.createObjectURL(T);if(!window.open(O,"_blank")){const L=document.createElement("a");L.href=O,L.download=`facture-${P.invoiceNumber}.pdf`,L.click(),URL.revokeObjectURL(O)}N(L=>[...L,`PDF facture ${P.invoiceNumber} ouvert pour impression`])}catch(T){console.error("Erreur impression:",T)}finally{x(!1)}},E=async()=>{try{x(!0);const T=await it.generateInvoicePDF(P),O=new FileReader,U=await new Promise((L,B)=>{O.onload=()=>{const ee=O.result.split(",")[1];L(ee)},O.onerror=B,O.readAsDataURL(T)});await je.sendInvoiceToN8n(P,U),N(L=>[...L,`Facture ${P.invoiceNumber} envoy√©e par email`])}catch(T){console.error("Erreur envoi:",T)}finally{x(!1)}},A=p.some(T=>T.includes("enregistr√©e")),k=p.some(T=>T.includes("envoy√©e par email")),D=p.some(T=>T.includes("ouvert pour impression"));return u?e.jsx("div",{className:"h-full flex items-center justify-center bg-gradient-to-br from-green-50 to-green-100",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-2xl shadow-lg max-w-md",children:[e.jsx("div",{className:"animate-spin text-5xl mb-4",children:"‚è≥"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-3",children:"Finalisation en cours..."}),e.jsx("p",{className:"text-gray-600",children:"G√©n√©ration de la facture"})]})}):e.jsxs("div",{className:"h-full flex flex-col bg-[#F2EFE2] overflow-hidden",children:[e.jsx("div",{className:"bg-white shadow-sm p-3 border-b flex-shrink-0",children:e.jsxs("h1",{className:"text-xl font-bold text-gray-800 flex items-center gap-2",children:["üìÑ R√©capitulatif Final",e.jsxs("span",{className:"text-lg font-normal text-blue-600",children:["#",i]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 pb-20",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"üìã Facture"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Num√©ro :"}),e.jsx("span",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Date :"}),e.jsx("span",{className:"font-medium",children:l})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Lieu :"}),e.jsx("span",{className:"font-medium",children:m})]}),c&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Conseiller :"}),e.jsx("span",{className:"font-medium",children:c})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"üë§ Client"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Nom :"}),e.jsx("span",{className:"font-medium",children:s.name||"Non renseign√©"})]}),s.email&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Email :"}),e.jsx("span",{className:"font-medium text-xs",children:s.email})]}),s.phone&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"T√©l :"}),e.jsx("span",{className:"font-medium",children:s.phone})]}),s.address&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Adresse :"}),e.jsx("span",{className:"font-medium text-xs",children:s.address})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"üí≥ Paiement"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Mode :"}),e.jsx("span",{className:"font-medium",children:(n==null?void 0:n.method)||"Non d√©fini"})]}),(n==null?void 0:n.depositAmount)&&n.depositAmount>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Acompte :"}),e.jsxs("span",{className:"font-medium text-green-600",children:[n.depositAmount.toFixed(2)," ‚Ç¨"]})]}),(n==null?void 0:n.nombreChequesAVenir)&&n.nombreChequesAVenir>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Ch√®ques √† venir :"}),e.jsxs("span",{className:"font-medium",children:[n.nombreChequesAVenir," ch√®ques de ",(y.reste/n.nombreChequesAVenir).toFixed(2)," ‚Ç¨"]})]}),(n==null?void 0:n.nombreChequesAVenir)&&n.nombreChequesAVenir>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Montant total des ch√®ques :"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[y.reste.toFixed(2)," ‚Ç¨"]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsxs("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:["üì¶ Produits (",r.length,")"]}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:y.details.map((T,O)=>{var U;return e.jsx("div",{className:"border-b border-gray-100 pb-2 last:border-b-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("div",{className:"font-medium text-sm text-gray-800 truncate",children:T.designation}),e.jsxs("div",{className:"text-xs text-gray-500",children:[T.qty," √ó ",(U=T.priceTTC)==null?void 0:U.toFixed(2),"‚Ç¨",T.isPickupOnSite?" üì¶":" üöö"]})]}),e.jsxs("div",{className:"font-medium text-sm text-gray-800",children:[T.lineTotal.toFixed(2),"‚Ç¨"]})]})},O)})}),e.jsxs("div",{className:"border-t-2 border-gray-300 pt-2 mt-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-800",children:"Total TTC :"}),e.jsxs("span",{className:"font-bold text-xl text-blue-600",children:[y.total.toFixed(2)," ‚Ç¨"]})]}),y.acompte>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 mt-1",children:[e.jsx("span",{children:"Acompte vers√© :"}),e.jsxs("span",{children:["-",y.acompte.toFixed(2)," ‚Ç¨"]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-orange-600 mt-1",children:[e.jsx("span",{children:"Reste √† r√©gler :"}),e.jsxs("span",{children:[y.reste.toFixed(2)," ‚Ç¨"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"üöö Livraison"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Mode :"}),e.jsx("span",{className:"font-medium",children:(o==null?void 0:o.deliveryMethod)||"Non d√©fini"})]}),(o==null?void 0:o.deliveryNotes)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Notes :"}),e.jsx("p",{className:"text-xs text-gray-800 mt-1",children:o.deliveryNotes})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md",children:[e.jsx("h3",{className:"font-bold text-gray-800 mb-3 flex items-center gap-2",children:"‚úçÔ∏è Signature & CGV"}),e.jsx("div",{className:"flex items-center justify-between",children:d!=null&&d.dataUrl?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-16 h-12 bg-gray-100 rounded border flex items-center justify-center overflow-hidden",children:e.jsx("img",{src:d.dataUrl,alt:"Signature",className:"max-w-full max-h-full object-contain"})}),e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{className:"text-green-600 font-medium",children:"‚úÖ Sign√©e"}),d.timestamp&&e.jsx("div",{className:"text-gray-500",children:new Date(d.timestamp).toLocaleString()})]})]}):e.jsx("div",{className:"text-orange-600 text-sm",children:"‚ö†Ô∏è Signature manquante"})}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:`text-sm font-medium ${h?"text-green-600":"text-orange-600"}`,children:h?"‚úÖ CGV accept√©es":"‚ö†Ô∏è CGV non accept√©es"})})]})]})]})]})}),e.jsx("div",{className:"bg-[#F2EFE2] border-t border-[#477A0C]/20 shadow-lg p-4 flex-shrink-0",style:{position:"fixed",left:0,bottom:0,width:"100vw",zIndex:100,boxShadow:"0 -2px 12px rgba(71,122,12,0.08)"},children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[(!A||!k)&&e.jsx("div",{className:"mb-4 p-3 bg-orange-100 border border-orange-300 rounded-lg",children:e.jsxs("p",{className:"text-sm text-orange-800 text-center",children:["‚ö†Ô∏è ",e.jsx("strong",{children:"Enregistrer"})," et ",e.jsx("strong",{children:"Envoyer"})," sont obligatoires pour continuer"]})}),e.jsxs("div",{className:"grid grid-cols-5 gap-3",children:[e.jsxs("button",{onClick:t,className:"bg-gray-500 hover:bg-gray-600 text-white rounded-xl font-medium transition-colors px-4 py-3 flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"‚Üê"}),e.jsx("div",{className:"text-xs",children:"Retour"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:b,disabled:v,className:"w-full bg-[#477A0C] hover:bg-[#3A6A0A] disabled:bg-gray-400 text-white rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"üíæ"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Enregistrer"}),e.jsx("div",{className:"text-xs opacity-80",children:"Facture"})]})]}),!A&&e.jsx("div",{className:"absolute -top-2 -left-2 bg-red-500 text-white text-xs px-1 py-0.5 rounded-full font-bold",children:"!"}),A&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"‚úì"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:C,disabled:v,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"üñ®Ô∏è"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Imprimer"}),e.jsx("div",{className:"text-xs opacity-80",children:"PDF A4"})]})]}),D&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"‚úì"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:E,disabled:v||!s.email,className:"w-full bg-purple-600 hover:bg-purple-700 disabled:bg-gray-400 text-white rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px]",children:[e.jsx("span",{className:"text-lg mb-1",children:"üìß"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Envoyer"}),e.jsx("div",{className:"text-xs opacity-80",children:"Email"})]})]}),!k&&e.jsx("div",{className:"absolute -top-2 -left-2 bg-red-500 text-white text-xs px-1 py-0.5 rounded-full font-bold",children:"!"}),k&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 text-white rounded-full flex items-center justify-center text-xs",children:"‚úì"})]}),e.jsxs("button",{onClick:()=>{A&&k&&(window.location.href="/ipad?step=facture")},disabled:!A||!k,className:`rounded-xl font-bold transition-colors shadow-lg flex flex-col items-center justify-center min-h-[70px] ${A&&k?"bg-[#477A0C] hover:bg-[#3A6A0A] text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:[e.jsx("span",{className:"text-lg mb-1",children:"üÜï"}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs",children:"Nouvelle"}),e.jsx("div",{className:"text-xs opacity-80",children:"Commande"})]})]})]}),v&&e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center gap-2 bg-white px-4 py-2 rounded-lg border",children:[e.jsx("div",{className:"animate-spin text-[#477A0C]",children:"‚è≥"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Traitement en cours..."})]})})]})})]})}function vr({onPrev:a}){const{reset:t,setStep:s}=J(),[r,n]=f.useState(!1),o=async()=>{n(!0),setTimeout(()=>{t(),s("facture"),n(!1)},1e3)};return e.jsxs("div",{className:"w-full h-full bg-myconfort-cream flex flex-col overflow-hidden relative",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"üéØ Nouvelles Commandes"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"√âtape 8/8 ‚Ä¢ Terminer et recommencer"})]}),e.jsx("div",{className:"flex-1 px-6 py-8 flex flex-col justify-center items-center",children:r?e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-myconfort-green mx-auto"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-myconfort-dark mb-2",children:"üîÑ R√©initialisation en cours..."}),e.jsx("p",{className:"text-myconfort-dark/70",children:"Pr√©paration d'une nouvelle commande"})]})]}):e.jsxs("div",{className:"max-w-2xl text-center space-y-8",children:[e.jsx("div",{className:"w-24 h-24 bg-myconfort-green/10 rounded-full flex items-center justify-center mx-auto",children:e.jsx("div",{className:"text-4xl",children:"‚úÖ"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-myconfort-dark",children:"Commande termin√©e !"}),e.jsx("p",{className:"text-lg text-myconfort-dark/70",children:"Votre facture a √©t√© enregistr√©e avec succ√®s. Vous pouvez maintenant cr√©er une nouvelle commande."})]}),e.jsxs("div",{className:"bg-myconfort-green/5 p-6 rounded-xl border border-myconfort-green/20",children:[e.jsx("h3",{className:"text-lg font-bold text-myconfort-dark mb-4",children:"üìä R√©sum√© de cette session"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-green",children:"1"}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Facture cr√©√©e"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-myconfort-blue",children:"7"}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"√âtapes compl√©t√©es"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"3"}),e.jsx("div",{className:"text-sm text-myconfort-dark/70",children:"Actions r√©alis√©es"})]})]})]}),e.jsx("button",{onClick:o,className:`w-full max-w-md px-8 py-6 bg-myconfort-green hover:bg-myconfort-green/90 
                         text-white font-bold rounded-xl text-xl shadow-lg transition-all 
                         transform hover:scale-105 mx-auto block`,children:"üöÄ Cr√©er une nouvelle commande"}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>window.location.reload(),className:`px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-800 
                           font-medium rounded-lg transition-all`,children:"üîÑ Recharger l'application"}),e.jsx("button",{onClick:()=>window.open("/","_blank"),className:`px-6 py-3 bg-myconfort-blue hover:bg-myconfort-blue/90 text-white 
                           font-medium rounded-lg transition-all`,children:"üè† Accueil (nouvel onglet)"})]})]})}),e.jsxs("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 z-50 flex gap-4",children:[e.jsx("button",{onClick:a,disabled:r,className:`px-8 py-4 font-bold rounded-xl text-lg transition-all shadow-lg min-h-[56px] ${r?"bg-gray-200 text-gray-400 cursor-not-allowed":"bg-gray-200 hover:bg-gray-300 text-gray-800 transform hover:scale-105"}`,children:"‚Üê Retour au r√©cap"}),e.jsx("div",{className:"px-4 py-4 text-sm text-myconfort-dark/60 flex items-center",children:"Fin du processus de commande"})]})]})}const Ee=["facture","client","produits","paiement","livraison","signature","recap","nouvelles-commandes"];function jr(){const a=Le(),{search:t}=xs(),s=new URLSearchParams(t).get("step")||"facture",r=J(m=>m.setStep),n=J(m=>m.step);f.useEffect(()=>{r(s)},[s,r]);const[o,i]=f.useState(window.innerWidth>window.innerHeight?"landscape":"portrait");f.useEffect(()=>{const m=()=>{i(window.innerWidth>window.innerHeight?"landscape":"portrait")};return window.addEventListener("resize",m),window.addEventListener("orientationchange",m),()=>{window.removeEventListener("resize",m),window.removeEventListener("orientationchange",m)}},[]);const l=o==="portrait";return e.jsx("div",{className:"fixed inset-0 bg-white overflow-hidden",style:{width:"100vw",height:"100dvh",paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",paddingLeft:"env(safe-area-inset-left, 0px)",paddingRight:"env(safe-area-inset-right, 0px)"},children:l?e.jsx("div",{className:"w-full h-full flex items-center justify-center p-8 text-center bg-gradient-to-br from-[#477A0C] to-[#5A8F0F]",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 shadow-2xl max-w-md",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üì±"}),e.jsx("h1",{className:"text-2xl font-bold text-[#477A0C] mb-4",children:"Tourne l'iPad en paysage"}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:"Le mode iPad MyConfort est optimis√© pour l'orientation paysage afin de profiter pleinement de l'interface tactile."}),e.jsx("div",{className:"mt-6 p-3 bg-green-50 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-800 font-medium",children:"üîÑ Rotation automatique activ√©e"})})]})}):e.jsx(qt,{children:e.jsx(Nr,{step:n,onGo:m=>{const d=Ee.indexOf(n),h=Ee[d+(m==="next"?1:-1)];h&&a(`/ipad?step=${h}`)},onQuit:()=>a("/")})})})}function Nr({step:a,onGo:t,onQuit:s}){const r=Ee.indexOf(a),n=r===0,o=r===Ee.length-1,{invoiceNumber:i,invoiceDate:l,eventLocation:m,client:d,produits:h,paiement:c}=J(),u=f.useCallback(()=>{var N,y,P,b,C,E,A,k;let x=!0,p="";switch(a){case"facture":i.trim()?l?m.trim()||(p="Le lieu de l'√©v√©nement est obligatoire",x=!1):(p="La date de facture est obligatoire",x=!1):(p="Le num√©ro de facture est obligatoire",x=!1);break;case"client":!((N=d.name)!=null&&N.trim())||d.name.trim().length<3?(p="Le nom du client est obligatoire (minimum 3 caract√®res)",x=!1):!((y=d.email)!=null&&y.trim())||!d.email.includes("@")?(p="Un email valide est obligatoire",x=!1):(P=d.phone)!=null&&P.trim()?(b=d.address)!=null&&b.trim()?(C=d.city)!=null&&C.trim()?(E=d.postalCode)!=null&&E.trim()?(A=d.housingType)!=null&&A.trim()?!((k=d.doorCode)!=null&&k.trim())&&d.doorCode!=="Pas de digicode"&&(p='Le code porte/digicode est obligatoire (ou cochez "Pas de digicode")',x=!1):(p="Le type de logement est obligatoire",x=!1):(p="Le code postal est obligatoire",x=!1):(p="La ville du client est obligatoire",x=!1):(p="L'adresse du client est obligatoire",x=!1):(p="Le t√©l√©phone du client est obligatoire",x=!1);break;case"produits":h.length===0?(p="Au moins un produit est obligatoire",x=!1):h.some(D=>D.isPickupOnSite===void 0)&&(p="Veuillez d√©finir le mode de livraison pour tous les produits",x=!1);break;case"paiement":c.method||(p="Veuillez s√©lectionner un mode de paiement",x=!1);break}return{isValid:x,errorMessage:p}},[a,i,l,m,d.name,d.email,d.phone,d.address,d.city,d.postalCode,d.housingType,d.doorCode,h,c]),g=f.useCallback(()=>{const{isValid:x,errorMessage:p}=u();x?t("next"):alert(p)},[u,t]),v=f.useMemo(()=>{const x={onNext:g,onPrev:()=>t("prev"),onQuit:s,isFirstStep:n,isLastStep:o};switch(a){case"facture":return e.jsx(ar,{...x});case"client":return e.jsx(or,{...x});case"produits":return e.jsx(lr,{...x});case"paiement":return e.jsx(cr,{...x});case"livraison":return e.jsx(ur,{...x});case"signature":return e.jsx(br,{...x});case"recap":return e.jsx(yr,{...x});case"nouvelles-commandes":return e.jsx(vr,{...x});default:return e.jsx("div",{children:"√âtape inconnue"})}},[a,t,s,n,o,g]);return e.jsxs("div",{className:"w-full h-full flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"h-7 flex items-center justify-between px-3 bg-gradient-to-r from-[#477A0C] to-[#5A8F0F] text-white text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"text-sm",children:"üå∏"}),e.jsx("span",{className:"font-medium truncate",children:Cr(a)})]}),e.jsx("button",{onClick:s,className:"bg-white/20 hover:bg-white/30 px-2 py-0.5 rounded text-xs transition-all",children:"Quitter"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:v}),e.jsxs("div",{className:"h-12 bg-white border-t border-gray-200 flex items-center justify-between px-3",children:[e.jsx("div",{className:"flex items-center",children:!n&&e.jsx("button",{onClick:()=>t("prev"),className:"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-medium transition-all min-h-[32px]",children:"‚Üê Pr√©c√©dent"})}),e.jsx("div",{className:"flex gap-0.5",children:Ee.map((x,p)=>e.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${p===r?"bg-[#477A0C]":p<r?"bg-green-400":"bg-gray-300"}`},p))}),e.jsx("div",{className:"flex items-center",children:!o&&e.jsx("button",{onClick:g,className:"px-4 py-2 bg-[#477A0C] hover:bg-[#5A8F0F] text-white rounded-lg text-sm font-medium transition-all shadow-sm min-h-[32px]",children:"Suivant ‚Üí"})})]})]})}function Cr(a){switch(a){case"facture":return"Facture";case"client":return"Client";case"produits":return"Produits";case"paiement":return"Paiement";case"livraison":return"Livraison";case"signature":return"Signature";case"recap":return"R√©cap";case"nouvelles-commandes":return"Nouvelles commandes";default:return"√âtape"}}const Tr=({label:a="Retour",onBack:t,className:s="",showIcon:r=!0})=>{const n=Le(),o=()=>{t?t():n(-1)};return e.jsxs("button",{onClick:o,className:`
        flex items-center gap-3 px-4 py-3 min-h-[56px]
        text-lg font-medium text-myconfort-dark
        bg-white border border-gray-200 rounded-lg
        hover:bg-gray-50 active:bg-gray-100
        transition-colors duration-150
        touch-manipulation
        ${s}
      `,type:"button","aria-label":`${a} √† la page pr√©c√©dente`,children:[r&&e.jsx(ye,{size:24,className:"text-myconfort-green flex-shrink-0"}),e.jsx("span",{className:"font-manrope",children:a})]})};function yt(){const{getCurrentStepIndex:a,steps:t,goNext:s,goPrev:r}=J(),n=a(),o=t[n]||"step";return e.jsx(qt,{children:e.jsxs("div",{className:"h-full w-full p-6 flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Tr,{}),e.jsx("span",{className:"text-sm text-myconfort-dark/70",children:"Gesture: swipe gauche/droite"})]}),e.jsxs("section",{className:"flex-1 rounded-2xl bg-white shadow-sm border p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold text-myconfort-dark capitalize",children:o}),e.jsxs("p",{className:"mt-2 text-myconfort-dark/70",children:['√âcran placeholder pour "',o,'".']})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 rounded-xl bg-myconfort-blue/20 hover:bg-myconfort-blue/30",children:"Pr√©c√©dent"}),e.jsx("button",{type:"button",onClick:s,className:"px-4 py-2 rounded-xl bg-myconfort-green text-white hover:opacity-90",children:"Suivant"})]})]})})}function wr(){const a=Le(),[t]=Ft();return f.useEffect(()=>{const s=setTimeout(()=>{a("/")},5e3);return()=>clearTimeout(s)},[a]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center",children:[e.jsx("div",{className:"text-6xl mb-6",children:"‚úÖ"}),e.jsx("h1",{className:"text-2xl font-bold text-green-800 mb-4",children:"Paiement r√©ussi !"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Votre paiement a √©t√© trait√© avec succ√®s. Vous allez recevoir un email de confirmation."}),e.jsxs("div",{className:"space-y-4",children:[t.get("amount")&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-green-700",children:"Montant"}),e.jsxs("div",{className:"text-xl font-bold text-green-800",children:[t.get("amount")," ‚Ç¨"]})]}),t.get("transaction_id")&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Transaction ID"}),e.jsx("div",{className:"text-sm font-mono text-gray-800",children:t.get("transaction_id")})]})]}),e.jsxs("div",{className:"mt-8 space-y-3",children:[e.jsx("button",{onClick:()=>a("/"),className:"w-full bg-[#477A0C] hover:bg-[#3A6A0A] text-white font-semibold py-3 px-4 rounded-lg transition-colors",children:"Retour √† l'accueil"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Redirection automatique dans 5 secondes..."})]})]})})}function Ar(){const a=Le(),[t]=Ft(),{setPaymentStatus:s,setStep:r,setPaymentData:n}=J(),[o,i]=f.useState(15),l=t.get("orderId");return f.useEffect(()=>{s("cancelled"),n({paymentError:"Paiement annul√© par l'utilisateur"});const m=setInterval(()=>{i(d=>d<=1?(clearInterval(m),r("paiement"),a("/ipad"),0):d-1)},1e3);return()=>clearInterval(m)},[s,n,r,a]),e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 to-orange-100 flex items-center justify-center p-8",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl p-12 max-w-2xl w-full text-center",children:[e.jsx("div",{className:"w-24 h-24 bg-red-500 rounded-full flex items-center justify-center mx-auto mb-8",children:e.jsx("svg",{className:"w-12 h-12 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h1",{className:"text-4xl font-bold text-red-600 mb-4",children:"‚ùå Paiement Annul√©"}),e.jsxs("p",{className:"text-xl text-gray-600 mb-8",children:["Le paiement pour la commande ",e.jsxs("strong",{children:["#",l]})," a √©t√© annul√©."]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-6 mb-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-3",children:"Pas de probl√®me !"}),e.jsxs("ul",{className:"text-blue-700 space-y-2 text-left",children:[e.jsx("li",{children:"üí° Vos donn√©es ont √©t√© sauvegard√©es"}),e.jsx("li",{children:"üîÑ Vous pouvez r√©essayer le paiement"}),e.jsx("li",{children:"üí¨ Ou choisir un autre mode de paiement"})]})]}),e.jsxs("p",{className:"text-gray-500 mb-6",children:["Retour au paiement dans"," ",e.jsx("span",{className:"font-bold text-red-600",children:o})," ","secondes..."]}),e.jsxs("div",{className:"flex gap-4 justify-center",children:[e.jsx("button",{onClick:()=>{r("paiement"),a("/ipad")},className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl",children:"‚Üê Retour au paiement"}),e.jsx("button",{onClick:()=>a("/"),className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl",children:"üè† Accueil"})]})]})})}const Sr=()=>/iPad|Macintosh/.test(navigator.userAgent)&&"ontouchend"in document,Je=({isOpen:a,title:t,onClose:s,onSave:r,children:n,saveLabel:o="Valider"})=>{if(f.useEffect(()=>{if(!a)return;const l=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=l}},[a]),!a)return null;const i=Sr();return e.jsx("div",{role:"dialog","aria-modal":"true",className:"fixed inset-0 z-[1000] flex items-stretch justify-center bg-black/30",children:e.jsxs("div",{className:`bg-white shadow-xl flex flex-col w-full ${i?"h-full max-w-full":"h-[90vh] max-w-3xl"} rounded-none md:rounded-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b bg-white",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:t}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium transition-colors",onClick:s,children:"Annuler"}),r&&e.jsx("button",{className:"px-4 py-2 rounded-lg bg-[#477A0C] text-white hover:bg-[#3A6A0A] font-medium transition-colors",onClick:r,children:o})]})]}),e.jsx("div",{className:"p-4 overflow-auto grow",children:n}),e.jsx("div",{className:"pb-safe-area-inset-bottom"})]})})},Er=({isOpen:a,initial:t,onCancel:s,onSave:r})=>{const[n,o]=f.useState(t),i=f.useRef(null);f.useEffect(()=>{o(t)},[t,a]),f.useEffect(()=>{a&&i.current&&setTimeout(()=>{var m;return(m=i.current)==null?void 0:m.focus()},100)},[a]);const l=()=>{if(!n.clientName.trim()||!n.clientEmail.trim()){alert("Nom et email sont obligatoires");return}r(n)};return e.jsx(Je,{isOpen:a,title:"‚úèÔ∏è Client ‚Äî √âdition plein √©cran",onClose:s,onSave:l,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nom complet *"}),e.jsx("input",{ref:i,className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientName,onChange:m=>o({...n,clientName:m.target.value}),placeholder:"Nom et pr√©nom du client"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Email *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"email",value:n.clientEmail,onChange:m=>o({...n,clientEmail:m.target.value}),placeholder:"email@example.com"})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Adresse (ligne 1) *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientAddress,onChange:m=>o({...n,clientAddress:m.target.value}),placeholder:"Num√©ro et nom de rue"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Adresse (ligne 2)"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.addressLine2||"",onChange:m=>o({...n,addressLine2:m.target.value}),placeholder:"Compl√©ment d'adresse (optionnel)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Code postal *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientPostalCode,onChange:m=>o({...n,clientPostalCode:m.target.value}),placeholder:"75000"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Ville *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientCity,onChange:m=>o({...n,clientCity:m.target.value}),placeholder:"Paris"})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"T√©l√©phone *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientPhone,onChange:m=>o({...n,clientPhone:m.target.value}),placeholder:"06 12 34 56 78"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Code porte"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientDoorCode||"",onChange:m=>o({...n,clientDoorCode:m.target.value}),placeholder:"A123B"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Type logement"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientHousingType||"",onChange:m=>o({...n,clientHousingType:m.target.value}),children:[e.jsx("option",{value:"",children:"Choisir..."}),e.jsx("option",{value:"Appartement",children:"Appartement"}),e.jsx("option",{value:"Maison",children:"Maison"}),e.jsx("option",{value:"Studio",children:"Studio"}),e.jsx("option",{value:"Loft",children:"Loft"}),e.jsx("option",{value:"Bureau",children:"Bureau"}),e.jsx("option",{value:"Commerce",children:"Commerce"})]})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"SIRET (professionnel)"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:n.clientSiret||"",onChange:m=>o({...n,clientSiret:m.target.value}),placeholder:"12345678901234"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-4 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"üí° Astuce iPad :"}),` Les champs marqu√©s d'un * sont obligatoires. Touchez "Enregistrer" pour sauvegarder et revenir √† la facture.`]})]})})},Pr=({isOpen:a,initial:t,onCancel:s,onSave:r})=>{const[n,o]=f.useState(t);f.useEffect(()=>{o(t.length>0?t:[i()])},[t,a]);const i=()=>({name:"",price:0,quantity:1,category:"Climatisation",discount:0,discountType:"percentage"}),l=()=>{o([...n,i()])},m=u=>{n.length>1&&o(n.filter((g,v)=>v!==u))},d=(u,g)=>{o(n.map((v,x)=>x===u?{...v,...g}:v))},h=()=>n.reduce((u,g)=>{const v=g.price*g.quantity,x=g.discountType==="percentage"?v*(g.discount/100):g.discount;return u+(v-x)},0),c=()=>{const u=n.filter(g=>g.name.trim()&&g.price>0);if(u.length===0){alert("Ajoutez au moins un produit valide");return}r(u)};return e.jsx(Je,{isOpen:a,title:"üõí Produits ‚Äî √âdition plein √©cran",onClose:s,onSave:c,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-6",children:[n.map((u,g)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-medium text-gray-700",children:["Produit ",g+1]}),n.length>1&&e.jsx("button",{onClick:()=>m(g),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(De,{size:16})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nom du produit *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:u.name,onChange:v=>d(g,{name:v.target.value}),placeholder:"Ex: Climatisation r√©versible"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Cat√©gorie"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:u.category,onChange:v=>d(g,{category:v.target.value}),children:[e.jsx("option",{value:"Climatisation",children:"Climatisation"}),e.jsx("option",{value:"Chauffage",children:"Chauffage"}),e.jsx("option",{value:"Ventilation",children:"Ventilation"}),e.jsx("option",{value:"Maintenance",children:"Maintenance"}),e.jsx("option",{value:"Installation",children:"Installation"}),e.jsx("option",{value:"Autre",children:"Autre"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Prix unitaire HT *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"0",step:"0.01",value:u.price,onChange:v=>d(g,{price:parseFloat(v.target.value)||0}),placeholder:"0.00"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Quantit√© *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"1",value:u.quantity,onChange:v=>d(g,{quantity:parseInt(v.target.value)||1})})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Sous-total HT"}),e.jsxs("div",{className:"border border-gray-200 rounded-lg px-4 py-3 bg-gray-100 text-base",children:[(u.price*u.quantity).toFixed(2)," ‚Ç¨"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Remise"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"0",step:"0.01",value:u.discount,onChange:v=>d(g,{discount:parseFloat(v.target.value)||0}),placeholder:"0"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Type de remise"}),e.jsxs("select",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",value:u.discountType,onChange:v=>d(g,{discountType:v.target.value}),children:[e.jsx("option",{value:"percentage",children:"Pourcentage (%)"}),e.jsx("option",{value:"fixed",children:"Montant fixe (‚Ç¨)"})]})]})]}),u.discount>0&&e.jsxs("div",{className:"text-sm text-gray-600 bg-white p-3 rounded border",children:[e.jsxs("div",{children:["Sous-total : ",(u.price*u.quantity).toFixed(2)," ‚Ç¨"]}),e.jsxs("div",{children:["Remise : -",u.discountType==="percentage"?`${u.discount}% (${(u.price*u.quantity*(u.discount/100)).toFixed(2)} ‚Ç¨)`:`${u.discount.toFixed(2)} ‚Ç¨`]}),e.jsxs("div",{className:"font-medium text-[#477A0C]",children:["Total ligne :"," ",(u.price*u.quantity-(u.discountType==="percentage"?u.price*u.quantity*(u.discount/100):u.discount)).toFixed(2)," ","‚Ç¨ HT"]})]})]},g)),e.jsxs("button",{onClick:l,className:"w-full flex items-center justify-center gap-2 py-4 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-[#477A0C] hover:text-[#477A0C] transition-colors",children:[e.jsx(Be,{size:20}),"Ajouter un produit"]}),e.jsxs("div",{className:"bg-[#477A0C] text-white p-4 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold",children:["Total HT : ",h().toFixed(2)," ‚Ç¨"]}),e.jsxs("div",{className:"text-sm opacity-90",children:["TVA 20% : ",(h()*.2).toFixed(2)," ‚Ç¨"]}),e.jsxs("div",{className:"text-xl font-bold",children:["Total TTC : ",(h()*1.2).toFixed(2)," ‚Ç¨"]})]}),e.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"üí° Astuce iPad :"})," Touchez les champs pour les modifier. Utilisez le bouton + pour ajouter des produits et la corbeille pour les supprimer."]})]})})},Fr=({isOpen:a,initial:t,onCancel:s,onSave:r})=>{const[n,o]=f.useState(t),i=f.useRef(null);f.useEffect(()=>{o(t)},[t,a]),f.useEffect(()=>{a&&i.current&&setTimeout(()=>{var m;return(m=i.current)==null?void 0:m.focus()},100)},[a]);const l=()=>{r(n)};return e.jsx(Je,{isOpen:a,title:"üìù Notes ‚Äî √âdition plein √©cran",onClose:s,onSave:l,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Notes g√©n√©rales"}),e.jsx("textarea",{ref:i,className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[200px] resize-y",value:n.notes,onChange:m=>o({...n,notes:m.target.value}),placeholder:`Ajoutez ici toutes les informations importantes sur cette intervention...

Exemples :
‚Ä¢ Acc√®s au logement
‚Ä¢ Particularit√©s techniques
‚Ä¢ Demandes sp√©cifiques du client
‚Ä¢ Points d'attention`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[n.notes.length," caract√®res ‚Ä¢ Visible sur la facture"]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Notes publiques (facture)"}),e.jsx("textarea",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[120px] resize-y",value:n.publicNotes||"",onChange:m=>o({...n,publicNotes:m.target.value}),placeholder:`Notes qui appara√Ætront sur la facture client...

Exemples :
‚Ä¢ Conditions de garantie
‚Ä¢ Instructions d'utilisation
‚Ä¢ Prochaine maintenance recommand√©e`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(n.publicNotes||"").length," caract√®res ‚Ä¢ Visible par le client"]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700",children:"Notes internes (priv√©es)"}),e.jsx("textarea",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[120px] resize-y",value:n.internalNotes||"",onChange:m=>o({...n,internalNotes:m.target.value}),placeholder:`Notes internes, non visibles par le client...

Exemples :
‚Ä¢ Probl√®mes rencontr√©s
‚Ä¢ Temps pass√©
‚Ä¢ Mat√©riel utilis√©
‚Ä¢ Points √† retenir pour la prochaine fois`}),e.jsxs("div",{className:"text-xs text-gray-500",children:[(n.internalNotes||"").length," caract√®res ‚Ä¢ Usage interne uniquement"]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-2",children:"üí° Mod√®les de notes"}),e.jsxs("div",{className:"space-y-2 text-sm text-blue-700",children:[e.jsxs("button",{onClick:()=>o({...n,publicNotes:`Garantie 2 ans pi√®ces et main d'≈ìuvre.
Maintenance recommand√©e tous les 6 mois.
Manuel d'utilisation remis au client.`}),className:"block w-full text-left p-2 bg-white rounded hover:bg-blue-50 transition-colors",children:[e.jsx("strong",{children:"Garantie standard"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Garantie 2 ans, maintenance, manuel..."})]}),e.jsxs("button",{onClick:()=>o({...n,notes:`Intervention r√©alis√©e selon les normes en vigueur.
Client satisfait de la prestation.
Aucun probl√®me particulier signal√©.`}),className:"block w-full text-left p-2 bg-white rounded hover:bg-blue-50 transition-colors",children:[e.jsx("strong",{children:"Intervention standard"}),e.jsx("br",{}),e.jsx("span",{className:"text-xs",children:"Notes d'intervention classique..."})]})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"üì± Aide iPad :"})," Les zones de texte s'agrandissent automatiquement. Utilisez les mod√®les ci-dessus pour gagner du temps. Les notes publiques appara√Ætront sur la facture client."]})]})})},kr=({isOpen:a,initial:t,totalAmount:s,onCancel:r,onSave:n})=>{const[o,i]=f.useState(t);f.useEffect(()=>{i(t)},[t,a]);const l=()=>s-o.acompte,m=()=>{const u=l();return o.nombreCheques===0?0:Math.floor(u/o.nombreCheques)},d=()=>{const u=[],g=[20,25,30,40,50];for(const v of g){const x=Math.round(s*v/100),p=s-x,N=Math.floor(p/o.nombreCheques),y=p%o.nombreCheques;u.push({pourcentage:v,acompte:x,montantParCheque:N,modulo:y,quality:y===0?"excellent":y<=2?"bon":"moyen"})}return u.sort((v,x)=>v.modulo-x.modulo)},h=u=>{i({...o,acompte:u})},c=()=>{if(o.paymentMethod==="cheque"&&o.nombreCheques>10){alert("Maximum 10 ch√®ques autoris√©s");return}n(o)};return e.jsx(Je,{isOpen:a,title:"üí≥ Paiement ‚Äî √âdition plein √©cran",onClose:r,onSave:c,saveLabel:"Enregistrer",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-[#477A0C] text-white p-4 rounded-lg",children:[e.jsxs("div",{className:"text-lg font-bold",children:["Total facture : ",s.toFixed(2)," ‚Ç¨ TTC"]}),e.jsx("div",{className:"text-sm opacity-90",children:"TVA 20% incluse"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Mode de paiement principal"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[{value:"cheque",label:"üìù Ch√®que(s)",desc:"Paiement par ch√®que(s)"},{value:"cash",label:"üí∏ Esp√®ces",desc:"Paiement comptant"},{value:"transfer",label:"üè™ Virement",desc:"Virement bancaire"},{value:"alma",label:"üí≥ Alma",desc:"Paiement en plusieurs fois"}].map(u=>e.jsxs("button",{onClick:()=>i({...o,paymentMethod:u.value}),className:`p-4 border-2 rounded-lg text-left transition-all ${o.paymentMethod===u.value?"border-[#477A0C] bg-[#477A0C]/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("div",{className:"font-medium",children:u.label}),e.jsx("div",{className:"text-sm text-gray-600",children:u.desc})]},u.value))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Acompte √† l'installation"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"0",max:s,step:"10",value:o.acompte,onChange:u=>i({...o,acompte:parseFloat(u.target.value)||0}),placeholder:"0"})]}),o.paymentMethod==="cheque"&&e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nombre de ch√®ques (max 10)"}),e.jsx("input",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent",type:"number",min:"1",max:"10",value:o.nombreCheques,onChange:u=>i({...o,nombreCheques:parseInt(u.target.value)||1})})]})]}),o.paymentMethod==="cheque"&&o.nombreCheques>0&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-3",children:`‚ú® Suggestions d'acomptes "magiques" (ch√®ques ronds)`}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:d().slice(0,4).map((u,g)=>e.jsxs("button",{onClick:()=>h(u.acompte),className:`p-3 bg-white rounded border text-left hover:border-blue-300 transition-colors ${u.quality==="excellent"?"ring-1 ring-green-300":""}`,children:[e.jsxs("div",{className:"font-medium text-blue-800",children:[u.pourcentage,"% = ",u.acompte,"‚Ç¨"]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[o.nombreCheques," √ó ",u.montantParCheque,"‚Ç¨",u.modulo>0&&` + ${u.modulo}‚Ç¨`,u.quality==="excellent"&&" üéØ"]})]},g))})]}),o.acompte>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"üìä R√©capitulatif paiement"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Acompte installation :"}),e.jsxs("span",{className:"font-medium",children:[o.acompte.toFixed(2)," ‚Ç¨"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Reste √† payer :"}),e.jsxs("span",{className:"font-medium",children:[l().toFixed(2)," ‚Ç¨"]})]}),o.paymentMethod==="cheque"&&o.nombreCheques>0&&e.jsxs("div",{className:"flex justify-between border-t pt-1",children:[e.jsxs("span",{children:[o.nombreCheques," ch√®ques de :"]}),e.jsxs("span",{className:"font-medium",children:[m().toFixed(2)," ‚Ç¨ chacun"]})]})]})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Notes sur le paiement"}),e.jsx("textarea",{className:"border border-gray-300 rounded-lg px-4 py-3 text-base focus:ring-2 focus:ring-[#477A0C] focus:border-transparent min-h-[100px] resize-y",value:o.notes||"",onChange:u=>i({...o,notes:u.target.value}),placeholder:"Instructions particuli√®res, dates de ch√®ques, conditions sp√©ciales..."})]}),e.jsxs("div",{className:"text-xs text-gray-500 p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"font-medium",children:"üí° Aide iPad :"})," Utilisez les suggestions d'acomptes magiques pour obtenir des ch√®ques avec des montants ronds (sans centimes). Maximum 10 ch√®ques autoris√©s."]})]})})};function ze(a){const[t,s]=f.useState(a),[r,n]=f.useState(!1),o=f.useCallback(m=>{s(d=>({...d,...m})),n(!0)},[]),i=f.useCallback(()=>n(!1),[]),l=f.useCallback(m=>{s(m),n(!1)},[]);return{value:t,setValue:s,open:r,start:o,close:i,apply:l}}const Dr=()=>{const[a,t]=f.useState({clientName:"Jean Dupont",clientEmail:"jean.dupont@email.com",clientAddress:"123 Rue de la Paix",clientPostalCode:"75001",clientCity:"Paris",clientPhone:"06 12 34 56 78",clientDoorCode:"A123B",clientHousingType:"Appartement",clientSiret:"",addressLine2:"B√¢timent A, 3√®me √©tage",notes:"Intervention de maintenance climatisation",publicNotes:"Garantie 2 ans pi√®ces et main d'≈ìuvre",internalNotes:"Client tr√®s satisfait, RDV maintenance dans 6 mois"}),[s,r]=f.useState([{name:"Climatisation r√©versible Samsung",price:1200,quantity:1,category:"Climatisation",discount:10,discountType:"percentage"},{name:"Installation et mise en service",price:300,quantity:1,category:"Installation",discount:0,discountType:"percentage"}]),[n,o]=f.useState({paymentMethod:"cheque",acompte:300,nombreCheques:3,chequeDates:[],chequeMontants:[],notes:"Acompte √† l'installation, solde en 3 ch√®ques"}),i=ze({clientName:a.clientName,clientEmail:a.clientEmail,clientAddress:a.clientAddress,clientPostalCode:a.clientPostalCode,clientCity:a.clientCity,clientPhone:a.clientPhone,clientDoorCode:a.clientDoorCode,clientHousingType:a.clientHousingType,clientSiret:a.clientSiret,addressLine2:a.addressLine2}),l=ze(s),m=ze({notes:a.notes,publicNotes:a.publicNotes,internalNotes:a.internalNotes}),d=ze(n),h=x=>{t(p=>({...p,...x})),i.apply(x)},c=x=>{r(x),l.apply(x)},u=x=>{t(p=>({...p,notes:x.notes,publicNotes:x.publicNotes||"",internalNotes:x.internalNotes||""})),m.apply(x)},g=x=>{o(x),d.apply(x)},v=()=>s.reduce((x,p)=>{const N=p.price*p.quantity,y=p.discountType==="percentage"?N*(p.discount/100):p.discount;return x+(N-y)},0);return e.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"üéØ iPad Wizard - D√©monstration"}),e.jsx("p",{className:"text-gray-600",children:"Touchez les blocs ci-dessous pour les √©diter en plein √©cran (optimis√© iPad)"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>i.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"text-[#477A0C]",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Client"})]}),e.jsx(ce,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-700",children:a.clientName}),e.jsx("div",{className:"text-gray-600",children:a.clientEmail}),e.jsx("div",{className:"text-gray-600",children:a.clientPhone})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-600",children:a.clientAddress}),a.addressLine2&&e.jsx("div",{className:"text-gray-600",children:a.addressLine2}),e.jsxs("div",{className:"text-gray-600",children:[a.clientPostalCode," ",a.clientCity]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>l.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"text-[#477A0C]",size:20}),e.jsxs("h2",{className:"text-lg font-semibold text-gray-900",children:["Produits (",s.length,")"]})]}),e.jsx(ce,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-2",children:[s.map((x,p)=>e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:x.name}),e.jsxs("span",{className:"text-gray-500 ml-2",children:["x",x.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:[(x.price*x.quantity).toFixed(2)," ‚Ç¨"]}),x.discount>0&&e.jsxs("div",{className:"text-xs text-gray-500",children:["-",x.discountType==="percentage"?`${x.discount}%`:`${x.discount}‚Ç¨`]})]})]},p)),e.jsxs("div",{className:"border-t pt-2 mt-2",children:[e.jsxs("div",{className:"flex justify-between text-sm font-medium",children:[e.jsx("span",{children:"Total HT"}),e.jsxs("span",{children:[v().toFixed(2)," ‚Ç¨"]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold text-[#477A0C]",children:[e.jsx("span",{children:"Total TTC"}),e.jsxs("span",{children:[(v()*1.2).toFixed(2)," ‚Ç¨"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>d.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"text-[#477A0C]",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Paiement"})]}),e.jsx(ce,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Mode :"}),e.jsx("span",{children:n.paymentMethod==="cheque"?"üìù Ch√®que(s)":n.paymentMethod==="cash"?"üí∏ Esp√®ces":n.paymentMethod==="transfer"?"üè™ Virement":"üí≥ Alma"})]}),n.acompte>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Acompte :"}),e.jsxs("span",{children:[n.acompte.toFixed(2)," ‚Ç¨"]})]}),n.paymentMethod==="cheque"&&n.nombreCheques>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Solde :"}),e.jsxs("span",{children:[n.nombreCheques," ch√®ques"]})]}),n.notes&&e.jsxs("div",{className:"text-gray-600 mt-2",children:[e.jsx("span",{className:"font-medium",children:"Notes :"})," ",n.notes]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-4 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>m.start(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"text-[#477A0C]",size:20}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Notes"})]}),e.jsx(ce,{size:16,className:"text-gray-400"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"G√©n√©rales:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.notes})]}),a.publicNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Publiques:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.publicNotes})]}),a.internalNotes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Internes:"}),e.jsx("p",{className:"text-gray-600 mt-1",children:a.internalNotes})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-center",children:[e.jsx("div",{className:"text-blue-800 font-medium mb-1",children:"üì± Mode iPad Wizard activ√©"}),e.jsx("div",{className:"text-blue-600 text-sm",children:"Sur iPad, les √©diteurs s'ouvrent en plein √©cran pour une saisie confortable. Sur desktop, ils s'ouvrent en modal large."})]})]}),e.jsx(Er,{isOpen:i.open,initial:i.value,onCancel:i.close,onSave:h}),e.jsx(Pr,{isOpen:l.open,initial:l.value,onCancel:l.close,onSave:c}),e.jsx(Fr,{isOpen:m.open,initial:m.value,onCancel:m.close,onSave:u}),e.jsx(kr,{isOpen:d.open,initial:d.value,totalAmount:v()*1.2,onCancel:d.close,onSave:g})]})};function Lr(){return e.jsxs("div",{className:"w-full min-h-[100svh] bg-myconfort-cream relative overflow-x-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-myconfort-dark/10 bg-white",children:[e.jsx("h1",{className:"text-2xl font-bold text-myconfort-dark",children:"üîß Test Footer Flottant"}),e.jsx("p",{className:"text-myconfort-dark/70 text-sm",children:"Test de visibilit√© des boutons sur iPad Safari"})]}),e.jsxs("div",{className:"px-6 py-8 space-y-6",style:{paddingBottom:"calc(88px + max(env(safe-area-inset-bottom, 16px), 16px) + 16px)"},children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl border shadow-sm",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-myconfort-dark",children:"Instructions de test :"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-2 text-myconfort-dark/80",children:[e.jsx("li",{children:'V√©rifiez que vous voyez les boutons "Pr√©c√©dent" et "Suivant" en bas'}),e.jsx("li",{children:"Faites d√©filer jusqu'en bas pour confirmer qu'ils restent visibles"}),e.jsx("li",{children:"Testez que les boutons r√©agissent au touch"}),e.jsx("li",{children:"V√©rifiez qu'il n'y a pas de masquage par le safe-area"})]})]}),e.jsxs("div",{className:"bg-myconfort-green/10 p-6 rounded-xl border border-myconfort-green/30",children:[e.jsx("h3",{className:"text-lg font-bold text-myconfort-dark mb-2",children:"Configuration actuelle :"}),e.jsxs("ul",{className:"space-y-1 text-sm text-myconfort-dark/70",children:[e.jsx("li",{children:"‚Ä¢ Viewport : viewport-fit=cover"}),e.jsx("li",{children:"‚Ä¢ Wrapper : min-h-[100svh] overflow-x-hidden"}),e.jsx("li",{children:"‚Ä¢ Footer : z-[9999] fixed + Portal"}),e.jsx("li",{children:"‚Ä¢ Safe-area : max(env(safe-area-inset-bottom, 16px), 16px)"}),e.jsx("li",{children:"‚Ä¢ Content padding : calc(88px + safe-area + 16px)"})]})]}),Array.from({length:10},(r,n)=>e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsxs("h4",{className:"font-semibold",children:["Section ",n+1]}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Contenu de test pour v√©rifier le scroll et l'affichage du footer. Les boutons doivent rester visibles en permanence."})]},n)),e.jsxs("div",{className:"bg-red-50 border border-red-200 p-6 rounded-xl",children:[e.jsx("h3",{className:"text-lg font-bold text-red-700 mb-2",children:"üö® Si vous ne voyez pas les boutons :"}),e.jsxs("ul",{className:"space-y-1 text-sm text-red-600",children:[e.jsx("li",{children:"1. Probl√®me Safari iPad (zoom, orientation, etc.)"}),e.jsx("li",{children:"2. Probl√®me CSS safe-area non support√©"}),e.jsx("li",{children:"3. Probl√®me z-index ou Portal"}),e.jsx("li",{children:"4. Probl√®me viewport fit ou configuration"})]})]})]}),e.jsx(Ke,{leftLabel:"‚Üê Pr√©c√©dent",onLeft:()=>alert("Bouton Pr√©c√©dent fonctionne !"),rightLabel:"Suivant ‚Üí",onRight:()=>alert("Bouton Suivant fonctionne !")})]})}function Ir(){const{n:a}=gs(),t=Number(a),s=Number.isFinite(t)?Math.min(Math.max(t,1),7):1;return e.jsx(nt,{to:`/wizard/step/${s}`,replace:!0})}function Rr(){return e.jsx("div",{children:e.jsx(ps,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(hs,{children:[e.jsx(Z,{path:"/",element:e.jsx(sr,{})}),e.jsx(Z,{path:"/wizard",element:e.jsx(yt,{})}),e.jsx(Z,{path:"/wizard/:step",element:e.jsx(yt,{})}),e.jsx(Z,{path:"/wizard/step/0",element:e.jsx(nt,{to:"/wizard/step/7",replace:!0})}),e.jsx(Z,{path:"/wizard/step/8",element:e.jsx(nt,{to:"/wizard/step/7",replace:!0})}),e.jsx(Z,{path:"/wizard/step/:n",element:e.jsx(Ir,{})}),e.jsx(Z,{path:"/ipad",element:e.jsx(jr,{})}),e.jsx(Z,{path:"/wizard-demo",element:e.jsx(Dr,{})}),e.jsx(Z,{path:"/payment/success",element:e.jsx(wr,{})}),e.jsx(Z,{path:"/payment/cancel",element:e.jsx(Ar,{})}),e.jsx(Z,{path:"/debug-footer",element:e.jsx(Lr,{})})]})})})}console.log("### BUILD LIVE ###",new Date().toISOString());window.addEventListener("error",a=>console.error("[GLOBAL ERROR]",a.message));window.addEventListener("unhandledrejection",a=>console.error("[UNHANDLED]",a.reason));bs(document.getElementById("root")).render(e.jsx(f.StrictMode,{children:e.jsx(Rr,{})}));
