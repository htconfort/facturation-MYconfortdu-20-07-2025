#!/bin/bash

# ğŸ” Configuration des secrets Netlify pour dÃ©ploiement automatique
# Script de configuration GitHub Actions + Netlify

echo "ğŸ” CONFIGURATION AUTOMATISATION NETLIFY"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

echo ""
echo "ğŸ“‹ Ã‰TAPES REQUISES POUR ACTIVER LE DÃ‰PLOIEMENT AUTOMATIQUE :"
echo ""

echo "1ï¸âƒ£ OBTENIR LES TOKENS NETLIFY :"
echo "   â€¢ Connectez-vous sur https://app.netlify.com"
echo "   â€¢ Allez dans 'User settings' â†’ 'Applications' â†’ 'Personal access tokens'"
echo "   â€¢ CrÃ©ez un nouveau token avec les permissions 'sites:write'"
echo "   â€¢ Copiez le token gÃ©nÃ©rÃ© (NETLIFY_AUTH_TOKEN)"
echo ""

echo "2ï¸âƒ£ OBTENIR L'ID DU SITE NETLIFY :"
echo "   â€¢ Dans votre dashboard Netlify, sÃ©lectionnez votre site"
echo "   â€¢ Allez dans 'Site settings' â†’ 'General' â†’ 'Site details'"
echo "   â€¢ Copiez l'API ID du site (NETLIFY_SITE_ID)"
echo ""

echo "3ï¸âƒ£ CONFIGURER LES SECRETS GITHUB :"
echo "   â€¢ Allez sur https://github.com/htconfort/facturation-MYconfortdu-20-07-2025"
echo "   â€¢ Cliquez sur 'Settings' â†’ 'Secrets and variables' â†’ 'Actions'"
echo "   â€¢ Ajoutez ces 2 secrets :"
echo ""
echo "   ğŸ“ Nom: NETLIFY_AUTH_TOKEN"
echo "   ğŸ”‘ Valeur: [Votre token personnel Netlify]"
echo ""
echo "   ğŸ“ Nom: NETLIFY_SITE_ID"
echo "   ğŸ”‘ Valeur: [L'API ID de votre site Netlify]"
echo ""

echo "4ï¸âƒ£ CRÃ‰ER LE SITE NETLIFY (si pas encore fait) :"
echo "   â€¢ Sur Netlify, cliquez 'Add new site' â†’ 'Import an existing project'"
echo "   â€¢ Connectez GitHub et sÃ©lectionnez le repository"
echo "   â€¢ Configuration de build :"
echo "     - Build command: npm run build"
echo "     - Publish directory: dist"
echo "     - Site name: myconfort-facturation (ou autre)"
echo ""

echo "5ï¸âƒ£ VÃ‰RIFICATION NETLIFY.TOML :"
echo "   âœ… Le fichier netlify.toml est dÃ©jÃ  configurÃ©"
echo "   âœ… Proxy N8N configurÃ© vers srv765811.hstgr.cloud"
echo "   âœ… Redirections SPA activÃ©es"
echo "   âœ… Headers de sÃ©curitÃ© dÃ©finis"
echo ""

echo "ğŸš€ DÃ‰CLENCHEMENT AUTOMATIQUE :"
echo "   â€¢ Push sur 'main' ou 'feature/boutons-suivant-ipad' â†’ DÃ©ploiement production"
echo "   â€¢ Pull Request â†’ DÃ©ploiement preview"
echo "   â€¢ Build automatique en ~2-4 minutes"
echo ""

echo "ğŸ” MONITORING DU DÃ‰PLOIEMENT :"
echo "   â€¢ GitHub Actions : Onglet 'Actions' du repository"
echo "   â€¢ Netlify Dashboard : Onglet 'Deploys' de votre site"
echo "   â€¢ Logs dÃ©taillÃ©s dans les deux interfaces"
echo ""

echo "âš¡ COMMANDES RAPIDES POUR TESTER :"
echo ""
echo "# Test local du build"
echo "npm run build"
echo ""
echo "# Push pour dÃ©clencher le dÃ©ploiement"
echo "git add ."
echo "git commit -m 'trigger: Test dÃ©ploiement automatique'"
echo "git push"
echo ""

echo "âœ… FICHIERS CRÃ‰Ã‰S :"
echo "   ğŸ“„ .github/workflows/netlify-deploy.yml"
echo "   ğŸ“„ netlify.toml (existant et configurÃ©)"
echo "   ğŸ“„ DEPLOYMENT_GUIDE.md"
echo "   ğŸ“„ deploy-netlify-preparation.sh"
echo ""

echo "ğŸ¯ RÃ‰SULTAT ATTENDU :"
echo "   Une fois configurÃ©, chaque push dÃ©clenchera automatiquement :"
echo "   â€¢ Build TypeScript + Vite"
echo "   â€¢ Tests de validation"
echo "   â€¢ DÃ©ploiement sur Netlify"
echo "   â€¢ Mise Ã  jour du site en production"
echo ""

echo "ğŸ’¡ TIPS :"
echo "   â€¢ Gardez les tokens secrets prÃ©cieusement"
echo "   â€¢ Testez d'abord avec une branche de dÃ©veloppement"
echo "   â€¢ VÃ©rifiez les logs en cas d'Ã©chec"
echo "   â€¢ Le dÃ©ploiement prend environ 2-4 minutes"
echo ""
echo "ğŸš€ PrÃªt pour l'automatisation complÃ¨te !"
